{
  "title": "Koa2 å¦‚ä½•å®ç° JWT é‰´æƒï¼Ÿä»é›¶åˆ°ä¸€çš„å…¨ç¨‹æ‹†è§£",
  "date": "2024-06-22T00:00:00.000Z",
  "description": "æ·±å…¥å‰–æå¦‚ä½•åœ¨ Koa2 ä¸­å®ç° JWT é‰´æƒï¼Œæ¶µç›–åŸç†ã€å®ç°ã€ä¼˜åŒ–ä¸æœ€ä½³å®è·µï¼Œä¸“ä¸ºå‰ç«¯å¼€å‘è€…æ‰“é€ ï¼Œå¸¦ä½ ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œè§£é” Web å¼€å‘çš„å®‰å…¨å¯†ç ã€‚",
  "keywords": "Koa2, JWT, é‰´æƒ, Node.js, Web å®‰å…¨, å‰ç«¯å¼€å‘, ä¸­é—´ä»¶, Token",
  "author": "æ™“é¾™",
  "image": "/images/hero/koa2-jwt.jpg",
  "tags": [
    "Koa2",
    "JWT",
    "Node.js",
    "Web å®‰å…¨"
  ],
  "views": 0,
  "likes": 0,
  "category": "Node.js",
  "body": {
    "raw": "\nå¦‚æœä½ æ˜¯ä¸€ä¸ªå‰ç«¯å¼€å‘è€…ï¼Œä¹ æƒ¯äº†åœ¨ React æˆ– Vue çš„ä¸–ç•Œé‡ŒæŒ¥æ´’è‡ªå¦‚ï¼Œé‚£ä¹ˆå½“ä½ ç¬¬ä¸€æ¬¡è§¦ç¢°åç«¯ï¼Œå°¤å…¶æ˜¯åƒ **Koa2** è¿™æ ·ä¼˜é›…çš„ Node.js æ¡†æ¶æ—¶ï¼Œå¯èƒ½ä¼šè§‰å¾—åƒèµ°è¿›äº†ä¸€é—´æ‘†æ»¡é­”æ³•é“å…·çš„å¯†å®¤â€”â€”æ—¢å…´å¥‹åˆæœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ã€‚è€Œ **JWTï¼ˆJSON Web Tokenï¼‰** é‰´æƒï¼Œå°±åƒè¿™é—´å¯†å®¤é‡Œçš„ä¸€æŠŠä¸‡èƒ½é’¥åŒ™ï¼Œå¯ä»¥å¸®ä½ æ‰“å¼€ç”¨æˆ·è®¤è¯ä¸æˆæƒçš„å¤§é—¨ ğŸ”‘ã€‚\n\nè¿™ç¯‡æ–‡ç« å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œå…¨é¢æ‹†è§£å¦‚ä½•åœ¨ Koa2 ä¸­å®ç° JWT é‰´æƒã€‚æˆ‘ä»¬ä¼šä» **JWT çš„æ ¸å¿ƒåŸç†** è®²èµ·ï¼Œé€æ­¥æ·±å…¥åˆ° Koa2 çš„ä¸­é—´ä»¶å®ç°ï¼Œå†åˆ°æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨åŠ å›ºï¼Œæœ€åé™„ä¸Šä¸€äº›è®©ä»£ç æ›´ä¼˜é›…çš„æœ€ä½³å®è·µã€‚ä¸ä»…æœ‰æ¸…æ™°çš„ä»£ç ç¤ºä¾‹ï¼Œè¿˜æœ‰å¹½é»˜çš„ç±»æ¯”ã€å®ç”¨çš„è¡¨æ ¼ï¼Œç”šè‡³ä¸€ç‚¹ç‚¹â€œé«˜çº§â€çš„å†·ç¬‘è¯ï¼ˆåˆ«å«Œå¼ƒï¼Œæˆ‘å°½åŠ›äº† ğŸ˜ï¼‰ã€‚ç›®æ ‡æ˜¯è®©è¿™ç¯‡åšå®¢ä¸ä»…ä¸“ä¸šï¼Œè¿˜èƒ½è®©ä½ è¯»å¾—æ´¥æ´¥æœ‰å‘³ï¼Œåƒåœ¨å¬ä¸€ä¸ªè€æœ‹å‹èŠæŠ€æœ¯ã€‚\n\n> **é€‚åˆè°ï¼Ÿ**  \n> - å¯¹ Koa2 å’Œ JWT æ„Ÿå…´è¶£çš„å‰ç«¯å¼€å‘è€…  \n> - æƒ³ä»å‰ç«¯è·¨ç•Œåˆ°å…¨æ ˆçš„åŒå­¦  \n> - å¯¹ Web å®‰å…¨å’Œé‰´æƒæœºåˆ¶æœ‰å¥½å¥‡å¿ƒçš„å¼€å‘è€…  \n> - å¸Œæœ›å†™å‡ºä¼˜é›… Node.js ä»£ç çš„â€œå¼ºè¿«ç—‡æ‚£è€…â€ ğŸ˜œ\n\n---\n\n## æ–‡ç« ç»“æ„ï¼šæ€ç»´å¯¼å›¾å¼æ‹†è§£\n\nä¸ºäº†è®©è¿™ç¯‡é•¿æ–‡ï¼ˆæ˜¯çš„ï¼Œ15000 å­—ä¸æ˜¯å¼€ç©ç¬‘ï¼ï¼‰é€»è¾‘æ¸…æ™°ï¼Œæˆ‘å…ˆç»™ä½ ç”»ä¸€å¼ â€œæ€ç»´å¯¼å›¾â€ï¼š\n\n1. **ä»€ä¹ˆæ˜¯ JWTï¼Ÿ**  \n   - JWT çš„å®šä¹‰ä¸ç»“æ„  \n   - ä¸ºä»€ä¹ˆé€‰æ‹© JWTï¼Ÿ  \n   - JWT vs Sessionï¼šä¸€åœºâ€œæ–°è€äº¤æ›¿â€çš„è¾ƒé‡  \n\n2. **Koa2 ç®€ä»‹ï¼šä¼˜é›…çš„åç«¯é­”æ³•**  \n   - Koa2 çš„æ ¸å¿ƒç‰¹æ€§  \n   - ä¸ºä»€ä¹ˆç”¨ Koa2 å®ç° JWTï¼Ÿ  \n\n3. **JWT é‰´æƒçš„å®ç°åŸç†**  \n   - Headerã€Payloadã€Signature çš„â€œé“ä¸‰è§’â€  \n   - JWT çš„åŠ å¯†ä¸è§£å¯†è¿‡ç¨‹  \n   - æ— çŠ¶æ€è®¤è¯çš„é­…åŠ›  \n\n4. **Koa2 + JWT å®æˆ˜ï¼šä»é›¶æ­å»º**  \n   - ç¯å¢ƒæ­å»º  \n   - ç”Ÿæˆä¸éªŒè¯ Token  \n   - ä¸­é—´ä»¶å®ç°é‰´æƒ  \n   - é”™è¯¯å¤„ç†ä¸å“åº”ä¼˜åŒ–  \n\n5. **é«˜çº§è¿›é˜¶ï¼šä¼˜åŒ–ä¸å®‰å…¨åŠ å›º**  \n   - Token åˆ·æ–°æœºåˆ¶  \n   - é˜²å¾¡å¸¸è§æ”»å‡»ï¼ˆXSSã€CSRFã€Token æ³„éœ²ï¼‰  \n   - æ€§èƒ½ä¼˜åŒ–æŠ€å·§  \n\n6. **æœ€ä½³å®è·µï¼šè®©ä»£ç æ›´ä¼˜é›…**  \n   - ç»“æ„åŒ–é¡¹ç›®ç›®å½•  \n   - ç¯å¢ƒå˜é‡ç®¡ç†  \n   - æ—¥å¿—ä¸ç›‘æ§  \n   - å•å…ƒæµ‹è¯•  \n\n7. **å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ**  \n   - Token è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ  \n   - å¦‚ä½•å¤„ç†å¤§è§„æ¨¡ç”¨æˆ·ï¼Ÿ  \n   - è·¨åŸŸé‰´æƒæ€ä¹ˆæï¼Ÿ  \n\n8. **æ€»ç»“ä¸å±•æœ›**  \n   - JWT çš„æœªæ¥  \n   - Koa2 åœ¨å…¨æ ˆå¼€å‘ä¸­çš„æ½œåŠ›  \n\n---\n\n## 1. ä»€ä¹ˆæ˜¯ JWTï¼ŸğŸ”\n\n### 1.1 JWT çš„å®šä¹‰ä¸ç»“æ„\n\n**JWTï¼ˆJSON Web Tokenï¼‰** æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨ç½‘ç»œåº”ç”¨é—´ä¼ é€’ä¿¡æ¯ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª **ç´§å‡‘çš„ã€URL å®‰å…¨çš„å­—ç¬¦ä¸²**ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š**Headerï¼ˆå¤´éƒ¨ï¼‰**ã€**Payloadï¼ˆè´Ÿè½½ï¼‰** å’Œ **Signatureï¼ˆç­¾åï¼‰**ï¼Œç”¨ç‚¹å·ï¼ˆ`.`ï¼‰åˆ†éš”ã€‚é•¿è¿™æ ·ï¼š\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\nè®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹è¿™ä¸²â€œç¥ç§˜ä»£ç â€ï¼š\n\n| éƒ¨åˆ†       | æè¿°                                                                 | ç¤ºä¾‹                                                                 |\n|------------|----------------------------------------------------------------------|----------------------------------------------------------------------|\n| **Header** | åŒ…å« Token çš„ç±»å‹ï¼ˆé€šå¸¸æ˜¯ JWTï¼‰å’ŒåŠ å¯†ç®—æ³•ï¼ˆå¦‚ HMAC SHA256 æˆ– RSAï¼‰ã€‚ | `{\"alg\": \"HS256\", \"typ\": \"JWT\"}`                                     |\n| **Payload** | åŒ…å«å®é™…çš„æ•°æ®ï¼ˆç§°ä¸º Claimsï¼‰ï¼Œå¦‚ç”¨æˆ· IDã€è§’è‰²ã€è¿‡æœŸæ—¶é—´ç­‰ã€‚          | `{\"sub\": \"1234567890\", \"name\": \"John Doe\", \"iat\": 1516239022}`       |\n| **Signature** | ä½¿ç”¨å¯†é’¥å¯¹ Header å’Œ Payload è¿›è¡Œç­¾åï¼Œç¡®ä¿æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚            | ï¼ˆä¸€ä¸²åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œå–å†³äºå¯†é’¥å’Œç®—æ³•ï¼‰                             |\n\næ¯éƒ¨åˆ†éƒ½ä¼šè¢« **Base64Url ç¼–ç **ï¼Œç„¶åæ‹¼æ¥æˆæœ€ç»ˆçš„ Tokenã€‚ç±»æ¯”ä¸€ä¸‹ï¼ŒJWT å°±åƒä¸€å¼ ç«è½¦ç¥¨ ğŸ«ï¼šHeader æ˜¯ç¥¨çš„ç±»å‹ï¼ˆé«˜é“è¿˜æ˜¯æ™®å¿«ï¼‰ï¼ŒPayload æ˜¯ä½ çš„åº§ä½ä¿¡æ¯ï¼ŒSignature æ˜¯é˜²ä¼ªæ°´å°ï¼Œç¡®ä¿ç¥¨ä¸è¢«ä¼ªé€ ã€‚\n\n*_Tipsï¼šPayload ä¸­çš„æ•°æ®æ˜¯å…¬å¼€çš„ï¼ˆBase64 åªæ˜¯ç¼–ç ï¼Œä¸æ˜¯åŠ å¯†ï¼‰ï¼Œæ‰€ä»¥åƒä¸‡åˆ«æŠŠå¯†ç è¿™ç§æ•æ„Ÿä¿¡æ¯æ”¾è¿›å»ï¼_*\n\n### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹© JWTï¼Ÿ\n\nJWT çš„æœ€å¤§é­…åŠ›åœ¨äºå®ƒçš„ **æ— çŠ¶æ€æ€§**ã€‚ä¼ ç»ŸåŸºäº Session çš„è®¤è¯éœ€è¦æœåŠ¡å™¨å­˜å‚¨ç”¨æˆ·çŠ¶æ€ï¼ˆæ¯”å¦‚ Session IDï¼‰ï¼Œè€Œ JWT æŠŠæ‰€æœ‰ä¿¡æ¯éƒ½å¡è¿› Token é‡Œï¼ŒæœåŠ¡å™¨åªéœ€è¦éªŒè¯ç­¾åå³å¯ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚è¿™å°±åƒä»â€œæ‰“ç”µè¯é—®å®¢æœâ€å‡çº§åˆ°â€œè‡ªåŠ©æ‰«ç å…¥åœºâ€â€”â€”æ•ˆç‡æ›´é«˜ï¼Œæ‰©å±•æ€§æ›´å¼º ğŸ’ªã€‚\n\nJWT çš„ä¼˜ç‚¹æ€»ç»“ï¼š\n\n| ä¼˜ç‚¹               | è¯´æ˜                                                                 |\n|--------------------|----------------------------------------------------------------------|\n| **æ— çŠ¶æ€**         | æœåŠ¡å™¨æ— éœ€å­˜å‚¨ Sessionï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿã€‚                              |\n| **è·¨åŸŸå‹å¥½**       | Token å¯ä»¥è½»æ¾åœ¨ä¸åŒåŸŸåé—´ä¼ é€’ï¼Œå®Œç¾é€‚é…å‰åç«¯åˆ†ç¦»ã€‚                  |\n| **çµæ´»æ€§**         | Payload å¯è‡ªå®šä¹‰ï¼Œé€‚åˆå¤šç§åœºæ™¯ï¼ˆå¦‚æƒé™æ§åˆ¶ï¼‰ã€‚                        |\n| **ç§»åŠ¨ç«¯é€‚é…**     | å¤©ç„¶æ”¯æŒ RESTful APIï¼Œé€‚åˆç§»åŠ¨ç«¯å’Œå¾®æœåŠ¡æ¶æ„ã€‚                        |\n\nä½†å®ƒä¹Ÿä¸æ˜¯â€œå®Œç¾ç”·å‹â€ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯”å¦‚ Token ä¸€æ—¦æ³„éœ²å°±å¯èƒ½è¢«æ»¥ç”¨ï¼Œè€Œä¸”æ— æ³•ä¸»åŠ¨å¤±æ•ˆï¼ˆé™¤éå¼•å…¥å¤æ‚æœºåˆ¶ï¼‰ã€‚æ‰€ä»¥ï¼ŒJWT æ›´åƒä¸€ä¸ªâ€œé«˜æƒ…å•†ä½†éœ€è¦å°å¿ƒå‘µæŠ¤â€çš„å·¥å…· ğŸ˜…ã€‚\n\n*_Tipsï¼šé€‰æ‹© JWT å‰ï¼Œè¯„ä¼°ä½ çš„é¡¹ç›®æ˜¯å¦çœŸçš„éœ€è¦æ— çŠ¶æ€è®¤è¯ã€‚å¦‚æœæ˜¯å°å‹é¡¹ç›®ï¼ŒSession å¯èƒ½æ›´ç®€å•ã€‚_*\n\n### 1.3 JWT vs Sessionï¼šä¸€åœºâ€œæ–°è€äº¤æ›¿â€çš„è¾ƒé‡\n\nä¸ºäº†è®©ä½ æ›´ç›´è§‚åœ°ç†è§£ JWTï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹å®ƒå’Œä¼ ç»Ÿ Session çš„åŒºåˆ«ï¼š\n\n| ç‰¹æ€§               | JWT                                                                 | Session                                                             |\n|--------------------|----------------------------------------------------------------------|----------------------------------------------------------------------|\n| **å­˜å‚¨æ–¹å¼**       | å®¢æˆ·ç«¯å­˜å‚¨ï¼ˆé€šå¸¸åœ¨ LocalStorage æˆ– Cookieï¼‰ã€‚                         | æœåŠ¡å™¨å­˜å‚¨ï¼ˆSession ID å­˜åœ¨ Cookie ä¸­ï¼‰ã€‚                            |\n| **çŠ¶æ€æ€§**         | æ— çŠ¶æ€ï¼ŒæœåŠ¡å™¨åªéªŒè¯ Tokenã€‚                                          | æœ‰çŠ¶æ€ï¼ŒæœåŠ¡å™¨éœ€ç»´æŠ¤ Session æ•°æ®ã€‚                                  |\n| **æ‰©å±•æ€§**         | é€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ— éœ€å…±äº« Sessionã€‚                                     | éœ€è¦ Session åŒæ­¥ï¼ˆå¦‚ç”¨ Redisï¼‰ï¼Œå¤æ‚åº¦é«˜ã€‚                           |\n| **å®‰å…¨æ€§**         | ä¾èµ–ç­¾åå’Œ HTTPSï¼Œéœ€é˜²èŒƒ Token æ³„éœ²ã€‚                                  | ä¾èµ– Cookie å®‰å…¨ï¼Œéœ€é˜²èŒƒ CSRF æ”»å‡»ã€‚                                 |\n| **æ€§èƒ½**           | éªŒè¯é€Ÿåº¦å¿«ï¼Œä½† Token ä½“ç§¯å¯èƒ½è¾ƒå¤§ã€‚                                    | æŸ¥è¯¢ Session å¯èƒ½æœ‰å»¶è¿Ÿï¼Œä¾èµ–å­˜å‚¨æ€§èƒ½ã€‚                               |\n\nç±»æ¯”ä¸€ä¸‹ï¼ŒSession åƒæ˜¯åœ¨å®¶é—¨å£æ”¾ä¸ªé—¨å«ï¼Œè®¤è¯†ä½ æ‰æ”¾è¡Œï¼›è€Œ JWT æ˜¯ç»™ä½ å‘ä¸€å¼  VIP å¡ï¼Œä½ æ‹¿ç€å¡å°±èƒ½ç•…é€šæ— é˜»ã€‚ä¸¤ç§æ–¹å¼å„æœ‰åƒç§‹ï¼Œé€‰å“ªä¸ªå¾—çœ‹ä½ çš„â€œé—¨â€æœ‰å¤šå¤æ‚ ğŸšªã€‚\n\n*_Tipsï¼šJWT é€‚åˆ API é©±åŠ¨çš„ç°ä»£åº”ç”¨ï¼Œä½†åˆ«å¿˜äº†ä¸ºå®ƒé…ä¸Š HTTPSï¼Œå¦åˆ™ Token è£¸å¥”å¯ä¸æ˜¯é—¹ç€ç©çš„ï¼_*\n\n---\n\n## 2. Koa2 ç®€ä»‹ï¼šä¼˜é›…çš„åç«¯é­”æ³• âœ¨\n\n### 2.1 Koa2 çš„æ ¸å¿ƒç‰¹æ€§\n\n**Koa2** æ˜¯ Node.js çš„ä¸€ä¸ªè½»é‡çº§æ¡†æ¶ï¼Œç”± Express çš„åŸç­äººé©¬æ‰“é€ ï¼Œå·ç§°â€œä¸‹ä¸€ä»£ Web æ¡†æ¶â€ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹æ˜¯ **ä¸­é—´ä»¶æœºåˆ¶** å’Œ **async/await** çš„æ·±åº¦æ”¯æŒï¼Œè®©ä»£ç ç®€æ´å¾—åƒä¸€é¦–å°æ¸…æ–°è¯—æ­Œ ğŸ¶ã€‚\n\nKoa2 çš„æ ¸å¿ƒç‰¹æ€§ï¼š\n\n- **æ´‹è‘±æ¨¡å‹ä¸­é—´ä»¶**ï¼šè¯·æ±‚å’Œå“åº”åƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå±‚å±‚å¤„ç†ï¼Œé€»è¾‘æ¸…æ™°ã€‚  \n- **è½»é‡æ ¸å¿ƒ**ï¼šKoa æœ¬èº«ä¸ç»‘å®šä»»ä½•åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½é ä¸­é—´ä»¶å®ç°ï¼Œè‡ªç”±åº¦æé«˜ã€‚  \n- **ä¼˜é›…çš„é”™è¯¯å¤„ç†**ï¼šé€šè¿‡ try/catch å’Œä¸­é—´ä»¶ï¼Œé”™è¯¯å¤„ç†ä¸æ»‘æ— æ¯”ã€‚  \n- **ç°ä»£åŒ–**ï¼šåŸºäº ES6+ï¼Œå®Œç¾æ”¯æŒ async/awaitï¼Œå‘Šåˆ«å›è°ƒåœ°ç‹±ã€‚\n\nç”¨ç±»æ¯”æ¥è¯´ï¼ŒExpress åƒä¸€è¾†å…¨å‰¯æ­¦è£…çš„è¶Šé‡è½¦ï¼ŒåŠŸèƒ½é½å…¨ä½†æœ‰ç‚¹ç¬¨é‡ï¼›è€Œ Koa2 æ˜¯è¾†è½»ç›ˆçš„è·‘è½¦ï¼Œçµæ´»ã€ä¼˜é›…ï¼Œä½†ä½ å¾—è‡ªå·±è£…ç‚¹é…ä»¶ ğŸš—ã€‚\n\n*_Tipsï¼šKoa2 çš„ä¸­é—´ä»¶æ˜¯åŒå‘çš„ï¼Œå†™ä»£ç æ—¶åˆ«å¿˜äº†å¤„ç†â€œå“åº”â€é˜¶æ®µçš„é€»è¾‘ï¼_*\n\n### 2.2 ä¸ºä»€ä¹ˆç”¨ Koa2 å®ç° JWTï¼Ÿ\n\nKoa2 å’Œ JWT ç®€ç›´æ˜¯å¤©ä½œä¹‹åˆï¼š\n\n1. **ä¸­é—´ä»¶å¤©ç„¶é€‚é…é‰´æƒ**ï¼šJWT éªŒè¯æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œæ‹¦æˆªå™¨â€ï¼ŒKoa2 çš„ä¸­é—´ä»¶æœºåˆ¶è®©å®ç°é‰´æƒé€»è¾‘å˜å¾—ç›´è§‚ã€‚  \n2. **å¼‚æ­¥å‹å¥½**ï¼šéªŒè¯ Token å¯èƒ½æ¶‰åŠåŠ å¯†è§£å¯†ï¼ŒKoa2 çš„ async/await è®©ä»£ç æ›´ç®€æ´ã€‚  \n3. **è½»é‡é«˜æ•ˆ**ï¼šKoa2 ä¸ä¼šç»™ä½ å¡ä¸€å †ä¸éœ€è¦çš„åŠŸèƒ½ï¼Œé€‚åˆå¿«é€Ÿæ­å»º API æœåŠ¡ã€‚  \n4. **ç¤¾åŒºæ”¯æŒ**ï¼šKoa2 æœ‰ä¸°å¯Œçš„ä¸­é—´ä»¶ç”Ÿæ€ï¼Œæ¯”å¦‚ `koa-jwt`ï¼Œçœæ—¶çœåŠ›ã€‚\n\nä¸€å¥è¯æ€»ç»“ï¼šKoa2 å°±åƒä¸€ä¸ªæ‡‚å¾—å¦‚ä½•â€œæ°åˆ°å¥½å¤„â€é…åˆä½ çš„èˆä¼´ï¼Œå’Œ JWT ä¸€èµ·è·³å‡ºä¼˜é›…çš„é‰´æƒä¹‹èˆ ğŸ’ƒã€‚\n\n*_Tipsï¼šç”¨ Koa2 æ—¶ï¼Œåˆ«å¿˜äº†è£…ä¸ª `koa-router`ï¼Œä¸ç„¶ä½ çš„è·¯ç”±ä¼šåƒæ— å¤´è‹è‡åˆ°å¤„ä¹±æ’ï¼_*\n\n---\n\n## 3. JWT é‰´æƒçš„å®ç°åŸç† ğŸ”\n\n### 3.1 Headerã€Payloadã€Signature çš„â€œé“ä¸‰è§’â€\n\nJWT çš„æ ¸å¿ƒæ˜¯å®ƒçš„ä¸‰éƒ¨åˆ†ç»“æ„ï¼Œæˆ‘ä»¬å†æ·±å…¥çœ‹çœ‹ï¼š\n\n- **Header**ï¼šæè¿° Token çš„å…ƒä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ `{\"alg\": \"HS256\", \"typ\": \"JWT\"}`ã€‚`alg` æŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå¸¸è§çš„æœ‰ï¼š\n  - **HS256**ï¼ˆHMAC SHA256ï¼‰ï¼šå¯¹ç§°åŠ å¯†ï¼Œç”¨åŒä¸€ä¸ªå¯†é’¥åŠ å¯†å’Œè§£å¯†ã€‚  \n  - **RS256**ï¼ˆRSA SHA256ï¼‰ï¼šéå¯¹ç§°åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚  \n\n- **Payload**ï¼šå­˜æ”¾å®é™…æ•°æ®ï¼Œåˆ†ä¸ºä¸‰ç±» Claimsï¼š\n  - **Registered Claims**ï¼šæ ‡å‡†å­—æ®µï¼Œå¦‚ `iss`ï¼ˆå‘è¡Œè€…ï¼‰ã€`exp`ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ã€`sub`ï¼ˆä¸»é¢˜ï¼‰ã€‚  \n  - **Public Claims**ï¼šè‡ªå®šä¹‰å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ· IDã€è§’è‰²ç­‰ã€‚  \n  - **Private Claims**ï¼šåŒæ–¹çº¦å®šçš„ç§æœ‰å­—æ®µï¼Œéœ€è°¨æ…ä½¿ç”¨ã€‚  \n\n- **Signature**ï¼šç”¨å¯†é’¥å¯¹ `Base64Url(Header).Base64Url(Payload)` è¿›è¡Œç­¾åï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚å…¬å¼å¦‚ä¸‹ï¼š\n\n  ```javascript\n  Signature = HMAC-SHA256(\n    base64UrlEncode(Header) + \".\" + base64UrlEncode(Payload),\n    Secret\n  )\n  ```\n\nç±»æ¯”ä¸€ä¸‹ï¼ŒHeader æ˜¯ä½ çš„èº«ä»½è¯ç±»å‹ï¼ŒPayload æ˜¯ä½ çš„ä¸ªäººä¿¡æ¯ï¼ŒSignature æ˜¯å…¬å®‰å±€çš„ç›–ç« ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ ğŸ›‚ã€‚\n\n*_Tipsï¼šä¼˜å…ˆç”¨ `exp` è®¾ç½® Token è¿‡æœŸæ—¶é—´ï¼Œé¿å…â€œæ°¸ä¸è¿‡æœŸâ€çš„å®‰å…¨éšæ‚£ï¼_*\n\n### 3.2 JWT çš„åŠ å¯†ä¸è§£å¯†è¿‡ç¨‹\n\nJWT çš„ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹å°±åƒä¸€åœºâ€œé­”æ³•ä»ªå¼â€ï¼š\n\n1. **ç”Ÿæˆ Token**ï¼š\n   - å‡†å¤‡ Header å’Œ Payloadï¼Œåˆ†åˆ« Base64Url ç¼–ç ã€‚  \n   - ç”¨å¯†é’¥å¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²ç­¾åï¼Œå¾—åˆ° Signatureã€‚  \n   - ä¸‰éƒ¨åˆ†ç”¨ `.` æ‹¼æ¥ï¼Œç”Ÿæˆæœ€ç»ˆ Tokenã€‚  \n\n2. **éªŒè¯ Token**ï¼š\n   - å®¢æˆ·ç«¯å°† Token æ”¾å…¥è¯·æ±‚å¤´ï¼ˆé€šå¸¸æ˜¯ `Authorization: Bearer <token>`ï¼‰ã€‚  \n   - æœåŠ¡å™¨æ‹†åˆ† Tokenï¼ŒéªŒè¯ Signature æ˜¯å¦åŒ¹é…ã€‚  \n   - æ£€æŸ¥ Payload ä¸­çš„ `exp` æ˜¯å¦è¿‡æœŸï¼Œç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚  \n\nç”¨ä»£ç è¡¨ç¤ºï¼ˆä¼ªä»£ç ï¼‰ï¼š\n\n```javascript\n// ç”Ÿæˆ Token\nfunction generateToken(payload, secret) {\n  const header = { alg: \"HS256\", typ: \"JWT\" };\n  const encodedHeader = base64UrlEncode(JSON.stringify(header));\n  const encodedPayload = base64UrlEncode(JSON.stringify(payload));\n  const signature = hmacSha256(`${encodedHeader}.${encodedPayload}`, secret);\n  return `${encodedHeader}.${encodedPayload}.${signature}`;\n}\n\n// éªŒè¯ Token\nfunction verifyToken(token, secret) {\n  const [encodedHeader, encodedPayload, signature] = token.split(\".\");\n  const expectedSignature = hmacSha256(`${encodedHeader}.${encodedPayload}`, secret);\n  if (signature !== expectedSignature) throw new Error(\"Invalid Token\");\n  const payload = JSON.parse(base64UrlDecode(encodedPayload));\n  if (payload.exp < Date.now() / 1000) throw new Error(\"Token expired\");\n  return payload;\n}\n```\n\nè¿™å°±åƒåœ¨å‘ä¸€å¼ â€œé­”æ³•é€šè¡Œè¯â€ï¼Œå®¢æˆ·ç«¯æ‹¿ç€å®ƒæ¥æ•²é—¨ï¼ŒæœåŠ¡å™¨å¾—ç¡®è®¤å®ƒä¸æ˜¯å‡çš„ ğŸ”®ã€‚\n\n*_Tipsï¼šç­¾åå¯†é’¥è¦å¦¥å–„ä¿ç®¡ï¼Œæ³„éœ²å¯†é’¥ç­‰äºæŠŠâ€œé­”æ³•ä¹¦â€é€ç»™æ•Œäººï¼_*\n\n### 3.3 æ— çŠ¶æ€è®¤è¯çš„é­…åŠ›\n\nJWT çš„æ— çŠ¶æ€æ€§æ˜¯å®ƒçš„æ€æ‰‹é”ã€‚æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä»»ä½•ç”¨æˆ·çŠ¶æ€ï¼Œåªéœ€éªŒè¯ Token ç­¾åæ˜¯å¦åˆæ³•ã€‚è¿™å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼š\n\n- **åˆ†å¸ƒå¼å‹å¥½**ï¼šå¤šä¸ªæœåŠ¡å™¨æ— éœ€å…±äº« Session æ•°æ®ï¼Œè½»æ¾åº”å¯¹é«˜å¹¶å‘ã€‚  \n- **å®¢æˆ·ç«¯çµæ´»**ï¼šToken å¯ä»¥å­˜å‚¨åœ¨ LocalStorageã€Cookie ç”šè‡³ Headerï¼Œé€‚é…å¤šç§åœºæ™¯ã€‚  \n- **æ€§èƒ½é«˜æ•ˆ**ï¼šéªŒè¯ Token åªéœ€ä¸€æ¬¡è®¡ç®—ï¼Œæ— éœ€æŸ¥æ•°æ®åº“ã€‚\n\nä½†æ— çŠ¶æ€ä¹Ÿæœ‰â€œå‰¯ä½œç”¨â€ï¼šä¸€æ—¦ Token å‘å‡ºï¼ŒæœåŠ¡å™¨æ— æ³•ä¸»åŠ¨è®©å®ƒå¤±æ•ˆï¼ˆé™¤éç”¨é»‘åå•æœºåˆ¶ï¼‰ã€‚è¿™å°±åƒä½ å‘äº†ä¸€å¼  VIP å¡ï¼Œå¡æ²¡è¿‡æœŸå‰ï¼ŒæŒå¡äººéšæ—¶èƒ½è¿›åœº ğŸ˜…ã€‚\n\n*_Tipsï¼šä¸º Token è®¾ç½®çŸ­ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ 1 å°æ—¶ï¼‰ï¼Œå¹¶é…åˆåˆ·æ–°æœºåˆ¶ï¼Œå…¼é¡¾å®‰å…¨å’Œä½“éªŒï¼_*\n\n---\n\n## 4. Koa2 + JWT å®æˆ˜ï¼šä»é›¶æ­å»º ğŸš€\n\nç°åœ¨è¿›å…¥é‡å¤´æˆï¼æˆ‘ä»¬å°†ç”¨ Koa2 å®ç°ä¸€ä¸ªå®Œæ•´çš„ JWT é‰´æƒç³»ç»Ÿï¼ŒåŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€Token ç”Ÿæˆã€éªŒè¯å’Œä¿æŠ¤è·¯ç”±ã€‚\n\n### 4.1 ç¯å¢ƒæ­å»º\n\nå…ˆåˆå§‹åŒ–ä¸€ä¸ª Koa2 é¡¹ç›®ï¼š\n\n```bash\nmkdir koa2-jwt-demo\ncd koa2-jwt-demo\nnpm init -y\nnpm install koa koa-router koa-bodyparser jsonwebtoken dotenv\n```\n\nç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n```\nkoa2-jwt-demo/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ controllers/\nâ”‚   â”‚   â””â”€â”€ auth.js\nâ”‚   â”œâ”€â”€ middleware/\nâ”‚   â”‚   â””â”€â”€ jwt.js\nâ”‚   â”œâ”€â”€ routes/\nâ”‚   â”‚   â””â”€â”€ index.js\nâ”‚   â””â”€â”€ index.js\nâ”œâ”€â”€ .env\nâ””â”€â”€ package.json\n```\n\nåˆ›å»ºä¸€ä¸ª `.env` æ–‡ä»¶ï¼Œå­˜å‚¨å¯†é’¥ï¼š\n\n```env\nJWT_SECRET=your-very-secure-secret-key\nPORT=3000\n```\n\n*_Tipsï¼šå¯†é’¥è¦è¶³å¤Ÿå¤æ‚ï¼Œè‡³å°‘ 32 ä½ï¼Œéšæœºç”Ÿæˆæ˜¯æœ€ä½³é€‰æ‹©ï¼_*\n\n### 4.2 ç”Ÿæˆä¸éªŒè¯ Token\n\næˆ‘ä»¬ç”¨ `jsonwebtoken` åº“æ¥ç”Ÿæˆå’ŒéªŒè¯ Tokenã€‚å…ˆå†™ä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£ï¼š\n\n```javascript\n// src/controllers/auth.js\nconst jwt = require(\"jsonwebtoken\");\nrequire(\"dotenv\").config();\n\nconst login = async (ctx) => {\n  const { username, password } = ctx.request.body;\n\n  // æ¨¡æ‹Ÿç”¨æˆ·éªŒè¯ï¼ˆå®é™…é¡¹ç›®ä¸­åº”æŸ¥æ•°æ®åº“ï¼‰\n  if (username === \"admin\" && password === \"123456\") {\n    const payload = {\n      userId: 1,\n      username,\n      role: \"admin\",\n      iat: Math.floor(Date.now() / 1000), // å‘è¡Œæ—¶é—´\n      exp: Math.floor(Date.now() / 1000) + 60 * 60, // 1 å°æ—¶åè¿‡æœŸ\n    };\n\n    const token = jwt.sign(payload, process.env.JWT_SECRET);\n    ctx.body = {\n      code: 200,\n      message: \"ç™»å½•æˆåŠŸ\",\n      data: { token },\n    };\n  } else {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: \"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\",\n    };\n  }\n};\n\nmodule.exports = { login };\n```\n\nè¿™æ®µä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªç™»å½•é€»è¾‘ï¼Œå®é™…é¡¹ç›®ä¸­ä½ éœ€è¦è¿æ¥æ•°æ®åº“éªŒè¯ç”¨æˆ·ã€‚ç”Ÿæˆçš„ Token åŒ…å«ç”¨æˆ· IDã€è§’è‰²ç­‰ä¿¡æ¯ï¼Œå¹¶è®¾ç½®äº† 1 å°æ—¶çš„è¿‡æœŸæ—¶é—´ã€‚\n\n*_Tipsï¼šPayload å°½é‡ç²¾ç®€ï¼Œåªæ”¾å¿…è¦ä¿¡æ¯ï¼Œå‡å°‘ Token ä½“ç§¯ï¼_*\n\n### 4.3 ä¸­é—´ä»¶å®ç°é‰´æƒ\n\næ¥ä¸‹æ¥å†™ä¸€ä¸ª JWT éªŒè¯ä¸­é—´ä»¶ï¼Œç”¨äºä¿æŠ¤éœ€è¦ç™»å½•çš„è·¯ç”±ï¼š\n\n```javascript\n// src/middleware/jwt.js\nconst jwt = require(\"jsonwebtoken\");\nrequire(\"dotenv\").config();\n\nconst verifyToken = async (ctx, next) => {\n  const token = ctx.headers.authorization?.split(\" \")[1]; // æå– Bearer åçš„ Token\n\n  if (!token) {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: \"æœªæä¾› Token\",\n    };\n    return;\n  }\n\n  try {\n    const payload = jwt.verify(token, process.env.JWT_SECRET);\n    ctx.state.user = payload; // å°†ç”¨æˆ·ä¿¡æ¯æŒ‚åˆ° ctx.stateï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨\n    await next();\n  } catch (err) {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: err.message === \"jwt expired\" ? \"Token å·²è¿‡æœŸ\" : \"æ— æ•ˆçš„ Token\",\n    };\n  }\n};\n\nmodule.exports = verifyToken;\n```\n\nè¿™ä¸ªä¸­é—´ä»¶ä¼šï¼š\n\n1. ä»è¯·æ±‚å¤´æå– Tokenï¼ˆæ ¼å¼ä¸º `Authorization: Bearer <token>`ï¼‰ã€‚  \n2. ç”¨ `jwt.verify` éªŒè¯ Token çš„åˆæ³•æ€§å’Œæœ‰æ•ˆæœŸã€‚  \n3. å¦‚æœéªŒè¯é€šè¿‡ï¼Œå°† Payload å­˜åˆ° `ctx.state.user`ï¼Œä¾›åç»­è·¯ç”±ä½¿ç”¨ã€‚  \n4. å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å› 401 é”™è¯¯ã€‚\n\n*_Tipsï¼šæŠŠ Token æ”¾åœ¨ Header è€Œä¸æ˜¯ Cookieï¼Œå¯ä»¥æ›´å¥½åœ°é€‚é…å‰åç«¯åˆ†ç¦»ï¼_*\n\n### 4.4 è·¯ç”±ä¸ä¸»ç¨‹åº\n\nç°åœ¨æŠŠç™»å½•å’Œå—ä¿æŠ¤çš„è·¯ç”±ç»„ç»‡èµ·æ¥ï¼š\n\n```javascript\n// src/routes/index.js\nconst Router = require(\"koa-router\");\nconst { login } = require(\"../controllers/auth\");\nconst verifyToken = require(\"../middleware/jwt\");\n\nconst router = new Router();\n\nrouter.post(\"/login\", login);\n\nrouter.get(\"/protected\", verifyToken, async (ctx) => {\n  ctx.body = {\n    code: 200,\n    message: \"æ¬¢è¿è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼\",\n    data: {\n      user: ctx.state.user,\n    },\n  };\n});\n\nmodule.exports = router;\n```\n\nä¸»ç¨‹åºå¦‚ä¸‹ï¼š\n\n```javascript\n// src/index.js\nconst Koa = require(\"koa\");\nconst bodyParser = require(\"koa-bodyparser\");\nconst router = require(\"./routes\");\n\nconst app = new Koa();\n\napp.use(bodyParser());\napp.use(router.routes()).use(router.allowedMethods());\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Server running on http://localhost:${PORT}`);\n});\n```\n\nå¯åŠ¨é¡¹ç›®ï¼š\n\n```bash\nnode src/index.js\n```\n\nç°åœ¨å¯ä»¥ç”¨ Postman æˆ– cURL æµ‹è¯•ï¼š\n\n```bash\n# ç™»å½•\ncurl -X POST http://localhost:3000/login -H \"Content-Type: application/json\" -d '{\"username\":\"admin\",\"password\":\"123456\"}'\n\n# è®¿é—®å—ä¿æŠ¤è·¯ç”±\ncurl -X GET http://localhost:3000/protected -H \"Authorization: Bearer <your-token>\"\n```\n\nå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œç™»å½•ä¼šè¿”å›ä¸€ä¸ª Tokenï¼Œå—ä¿æŠ¤è·¯ç”±ä¼šè¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚å¦åˆ™ï¼Œä½ ä¼šçœ‹åˆ° 401 é”™è¯¯æç¤ºã€‚\n\n*_Tipsï¼šæµ‹è¯•æ—¶ç”¨å·¥å…·æ¨¡æ‹Ÿè¯·æ±‚ï¼Œåˆ«ç›´æ¥åœ¨æµè§ˆå™¨æ•² URLï¼Œä¸ç„¶ä½ ä¼šå‘ç°è‡ªå·±åƒåœ¨å’Œç©ºæ°”æ–—æ™ºæ–—å‹‡ï¼_*\n\n### 4.5 é”™è¯¯å¤„ç†ä¸å“åº”ä¼˜åŒ–\n\nä¸Šé¢çš„ä»£ç å·²ç»å¯ä»¥å·¥ä½œï¼Œä½†è¿˜æœ‰æ”¹è¿›ç©ºé—´ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿä¸€å“åº”æ ¼å¼ï¼Œå¢åŠ é”™è¯¯æ—¥å¿—ï¼š\n\n```javascript\n// src/middleware/response.js\nconst responseHandler = async (ctx, next) => {\n  try {\n    await next();\n    if (ctx.body === undefined) {\n      ctx.status = 404;\n      ctx.body = {\n        code: 404,\n        message: \"èµ„æºä¸å­˜åœ¨\",\n      };\n    }\n  } catch (err) {\n    console.error(\"æœåŠ¡å™¨é”™è¯¯:\", err);\n    ctx.status = err.status || 500;\n    ctx.body = {\n      code: ctx.status,\n      message: err.message || \"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\",\n    };\n  }\n};\n\nmodule.exports = responseHandler;\n```\n\næ›´æ–°ä¸»ç¨‹åºï¼š\n\n```javascript\n// src/index.js\nconst Koa = require(\"koa\");\nconst bodyParser = require(\"koa-bodyparser\");\nconst router = require(\"./routes\");\nconst responseHandler = require(\"./middleware/response\");\n\nconst app = new Koa();\n\napp.use(responseHandler);\napp.use(bodyParser());\napp.use(router.routes()).use(router.allowedMethods());\n\nconst PORT = process.env.PORT || 3000;\napp.listen(PORT, () => {\n  console.log(`Server running on http://localhost:${PORT}`);\n});\n```\n\nç°åœ¨ï¼Œæ‰€æœ‰æ¥å£éƒ½ä¼šæœ‰ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼Œé”™è¯¯ä¹Ÿä¼šè¢«å¦¥å–„è®°å½•ã€‚\n\n*_Tipsï¼šç»Ÿä¸€å“åº”æ ¼å¼å¯ä»¥è®©å‰ç«¯å¼€å‘è€…æ›´è½»æ¾åœ°å¤„ç† APIï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬ï¼_*\n\n---\n\n## 5. é«˜çº§è¿›é˜¶ï¼šä¼˜åŒ–ä¸å®‰å…¨åŠ å›º ğŸ›¡ï¸\n\n### 5.1 Token åˆ·æ–°æœºåˆ¶\n\nToken è¿‡æœŸæ˜¯ JWT çš„å¸¸è§é—®é¢˜ã€‚å¦‚æœ Token ç”Ÿå‘½å‘¨æœŸå¤ªçŸ­ï¼Œç”¨æˆ·å¯èƒ½é¢‘ç¹éœ€è¦é‡æ–°ç™»å½•ï¼›å¦‚æœå¤ªé•¿ï¼Œåˆæœ‰å®‰å…¨é£é™©ã€‚è§£å†³åŠæ³•æ˜¯å¼•å…¥ **Refresh Token**ã€‚\n\n**å®ç°æ€è·¯**ï¼š\n\n1. ç™»å½•æ—¶ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ª Access Tokenï¼ˆçŸ­ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚ 1 å°æ—¶ï¼‰å’Œä¸€ä¸ª Refresh Tokenï¼ˆé•¿ç”Ÿå‘½å‘¨æœŸï¼Œæ¯”å¦‚ 7 å¤©ï¼‰ã€‚  \n2. Access Token è¿‡æœŸåï¼Œå®¢æˆ·ç«¯ç”¨ Refresh Token è¯·æ±‚æ–°çš„ Access Tokenã€‚  \n3. Refresh Token åº”å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œå¹¶æ”¯æŒå¤±æ•ˆæœºåˆ¶ã€‚\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```javascript\n// src/controllers/auth.js\nconst jwt = require(\"jsonwebtoken\");\nrequire(\"dotenv\").config();\n\n// æ¨¡æ‹Ÿæ•°æ®åº“\nconst refreshTokens = new Set();\n\nconst login = async (ctx) => {\n  const { username, password } = ctx.request.body;\n\n  if (username === \"admin\" && password === \"123456\") {\n    const payload = { userId: 1, username, role: \"admin\" };\n    const accessToken = jwt.sign(\n      { ...payload, iat: Math.floor(Date.now() / 1000), exp: Math.floor(Date.now() / 1000) + 60 * 60 },\n      process.env.JWT_SECRET\n    );\n    const refreshToken = jwt.sign(\n      { ...payload, iat: Math.floor(Date.now() / 1000), exp: Math.floor(Date.now() / 1000) + 7 * 24 * 60 * 60 },\n      process.env.JWT_SECRET\n    );\n\n    refreshTokens.add(refreshToken); // å­˜å‚¨ Refresh Token\n\n    ctx.body = {\n      code: 200,\n      message: \"ç™»å½•æˆåŠŸ\",\n      data: { accessToken, refreshToken },\n    };\n  } else {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: \"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\",\n    };\n  }\n};\n\nconst refresh = async (ctx) => {\n  const { refreshToken } = ctx.request.body;\n\n  if (!refreshToken || !refreshTokens.has(refreshToken)) {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: \"æ— æ•ˆçš„ Refresh Token\",\n    };\n    return;\n  }\n\n  try {\n    const payload = jwt.verify(refreshToken, process.env.JWT_SECRET);\n    const newAccessToken = jwt.sign(\n      { userId: payload.userId, username: payload.username, role: payload.role, iat: Math.floor(Date.now() / 1000), exp: Math.floor(Date.now() / 1000) + 60 * 60 },\n      process.env.JWT_SECRET\n    );\n\n    ctx.body = {\n      code: 200,\n      message: \"Token åˆ·æ–°æˆåŠŸ\",\n      data: { accessToken: newAccessToken },\n    };\n  } catch (err) {\n    ctx.status = 401;\n    ctx.body = {\n      code: 401,\n      message: \"Refresh Token å·²è¿‡æœŸ\",\n    };\n  }\n};\n\nmodule.exports = { login, refresh };\n```\n\næ›´æ–°è·¯ç”±ï¼š\n\n```javascript\n// src/routes/index.js\nrouter.post(\"/refresh\", refresh);\n```\n\nç°åœ¨å®¢æˆ·ç«¯å¯ä»¥åœ¨ Access Token è¿‡æœŸæ—¶ï¼Œé€šè¿‡ `/refresh` æ¥å£è·å–æ–° Tokenã€‚\n\n*_Tipsï¼šRefresh Token æœ€å¥½å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œå¹¶è®¾ç½®å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ»¥ç”¨ï¼_*\n\n### 5.2 é˜²å¾¡å¸¸è§æ”»å‡»\n\nJWT è™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¹Ÿå®¹æ˜“æˆä¸ºæ”»å‡»ç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§å¨èƒåŠé˜²å¾¡æªæ–½ï¼š\n\n| å¨èƒç±»å‹       | æè¿°                                                                 | é˜²å¾¡æªæ–½                                                                 |\n|----------------|----------------------------------------------------------------------|--------------------------------------------------------------------------|\n| **XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰** | æ”»å‡»è€…çªƒå–å­˜å‚¨åœ¨ LocalStorage çš„ Tokenã€‚                             | ä½¿ç”¨ HttpOnly Cookie å­˜å‚¨ Tokenï¼Œå¼€å¯ XSS é˜²æŠ¤ï¼ˆå¦‚ Content Security Policyï¼‰ã€‚ |\n| **CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰** | æ”»å‡»è€…è¯±å¯¼ç”¨æˆ·å‘é€æ¶æ„è¯·æ±‚ã€‚                                         | é…åˆ CSRF Token æˆ– SameSite Cookieï¼Œé™åˆ¶è·¨åŸŸè¯·æ±‚ã€‚                        |\n| **Token æ³„éœ²** | Token è¢«æ‹¦æˆªæˆ–æ„å¤–æš´éœ²ã€‚                                             | ä½¿ç”¨ HTTPS åŠ å¯†ä¼ è¾“ï¼Œè®¾ç½®çŸ­ç”Ÿå‘½å‘¨æœŸï¼Œå®šæœŸè½®æ¢å¯†é’¥ã€‚                       |\n| **é‡æ”¾æ”»å‡»**   | æ”»å‡»è€…é‡å¤ä½¿ç”¨æ—§ Tokenã€‚                                             | åœ¨ Payload ä¸­åŠ å…¥ä¸€æ¬¡æ€§ `nonce` æˆ–æ—¶é—´æˆ³ï¼ŒéªŒè¯åé”€æ¯ã€‚                   |\n\nç¤ºä¾‹ï¼šä¸º Token æ·»åŠ  `nonce` é˜²å¾¡é‡æ”¾æ”»å‡»ï¼š\n\n```javascript\nconst login = async (ctx) => {\n  const { username, password } = ctx.request.body;\n  if (username === \"admin\" && password === \"123456\") {\n    const nonce = require(\"crypto\").randomBytes(16).toString(\"hex\"); // ç”Ÿæˆéšæœº nonce\n    const payload = {\n      userId: 1,\n      username,\n      role: \"admin\",\n      nonce,\n      iat: Math.floor(Date.now() / 1000),\n      exp: Math.floor(Date.now() / 1000) + 60 * 60,\n    };\n    const token = jwt.sign(payload, process.env.JWT_SECRET);\n    // å­˜å‚¨ nonce åˆ°æ•°æ®åº“ï¼ˆæ¨¡æ‹Ÿï¼‰\n    ctx.body = { code: 200, message: \"ç™»å½•æˆåŠŸ\", data: { token } };\n  }\n};\n```\n\néªŒè¯æ—¶æ£€æŸ¥ `nonce` æ˜¯å¦åŒ¹é…å¹¶é”€æ¯ã€‚\n\n*_Tipsï¼šå®‰å…¨æ— å°äº‹ï¼Œå®šæœŸå®¡è®¡ä»£ç ï¼Œå…³æ³¨ OWASP Top 10 æ¼æ´ï¼_*\n\n### 5.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§\n\nå½“ç”¨æˆ·é‡å¢å¤§æ—¶ï¼ŒJWT éªŒè¯å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼š\n\n- **å‡å°‘ Token ä½“ç§¯**ï¼šPayload åªå­˜å¿…è¦å­—æ®µï¼Œç¼©çŸ­ Base64 ç¼–ç é•¿åº¦ã€‚  \n- **ç¼“å­˜å¯†é’¥**ï¼šé¿å…æ¯æ¬¡éªŒè¯éƒ½è¯»å–ç¯å¢ƒå˜é‡æˆ–æ•°æ®åº“ã€‚  \n- **å¼‚æ­¥éªŒè¯**ï¼šåˆ©ç”¨ Koa2 çš„ async/awaitï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚  \n- **é™æµä¿æŠ¤**ï¼šç”¨ `koa-ratelimit` é™åˆ¶æ¶æ„è¯·æ±‚ï¼Œä¿æŠ¤æœåŠ¡å™¨ã€‚\n\nç¤ºä¾‹ï¼šæ·»åŠ é™æµä¸­é—´ä»¶ï¼š\n\n```javascript\nconst rateLimit = require(\"koa-ratelimit\");\napp.use(\n  rateLimit({\n    driver: \"memory\",\n    db: new Map(),\n    duration: 60000, // 1 åˆ†é’Ÿ\n    max: 100, // æœ€å¤š 100 æ¬¡è¯·æ±‚\n  })\n);\n```\n\n*_Tipsï¼šæ€§èƒ½ä¼˜åŒ–è¦ç»“åˆç›‘æ§ï¼Œæ¨èç”¨ Prometheus æˆ– New Relic è§‚å¯Ÿ API å“åº”æ—¶é—´ï¼_*\n\n---\n\n## 6. æœ€ä½³å®è·µï¼šè®©ä»£ç æ›´ä¼˜é›… ğŸŒŸ\n\n### 6.1 ç»“æ„åŒ–é¡¹ç›®ç›®å½•\n\nä¸€ä¸ªæ¸…æ™°çš„ç›®å½•ç»“æ„èƒ½è®©ä½ çš„ä»£ç çœ‹èµ·æ¥åƒä¸€æœ¬â€œæœ‰æ¡ç†çš„é­”æ³•ä¹¦â€ï¼š\n\n```\nkoa2-jwt-demo/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶\nâ”‚   â”œâ”€â”€ controllers/     # ä¸šåŠ¡é€»è¾‘\nâ”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶\nâ”‚   â”œâ”€â”€ models/          # æ•°æ®åº“æ¨¡å‹\nâ”‚   â”œâ”€â”€ routes/          # è·¯ç”±\nâ”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°\nâ”‚   â””â”€â”€ index.js         # å…¥å£\nâ”œâ”€â”€ tests/               # å•å…ƒæµ‹è¯•\nâ”œâ”€â”€ .env                 # ç¯å¢ƒå˜é‡\nâ”œâ”€â”€ .gitignore\nâ””â”€â”€ package.json\n```\n\n*_Tipsï¼šç›®å½•åˆ†å±‚è¦é€‚åº¦ï¼Œè¿‡äºå¤æ‚åè€Œä¼šå¢åŠ ç»´æŠ¤æˆæœ¬ï¼_*\n\n### 6.2 ç¯å¢ƒå˜é‡ç®¡ç†\n\nä½¿ç”¨ `dotenv` ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸ºä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰è®¾ç½®ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š\n\n```javascript\n// src/config/index.js\nrequire(\"dotenv\").config();\n\nmodule.exports = {\n  jwtSecret: process.env.JWT_SECRET,\n  port: process.env.PORT || 3000,\n  isProduction: process.env.NODE_ENV === \"production\",\n};\n```\n\n*_Tipsï¼šæ°¸è¿œä¸è¦æŠŠ `.env` æ–‡ä»¶æäº¤åˆ° Gitï¼ŒåŠ å…¥ `.gitignore` æ˜¯åŸºæœ¬æ“ä½œï¼_*\n\n### 6.3 æ—¥å¿—ä¸ç›‘æ§\n\nä½¿ç”¨ `winston` æˆ– `pino` è®°å½•æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼š\n\n```javascript\nconst pino = require(\"pino\");\nconst logger = pino();\n\napp.use(async (ctx, next) => {\n  logger.info(`[${ctx.method}] ${ctx.url}`);\n  await next();\n});\n```\n\n*_Tipsï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSON æ ¼å¼ï¼‰ï¼Œæ–¹ä¾¿æ—¥å¿—åˆ†æå·¥å…·å¤„ç†ï¼_*\n\n### 6.4 å•å…ƒæµ‹è¯•\n\nä¸ºå…³é”®é€»è¾‘ï¼ˆå¦‚ Token ç”Ÿæˆå’ŒéªŒè¯ï¼‰å†™å•å…ƒæµ‹è¯•ï¼Œç”¨ `mocha` æˆ– `jest`ï¼š\n\n```javascript\nconst jwt = require(\"jsonwebtoken\");\nconst assert = require(\"assert\");\n\ndescribe(\"JWT\", () => {\n  it(\"should generate valid token\", () => {\n    const payload = { userId: 1 };\n    const token = jwt.sign(payload, \"secret\");\n    const decoded = jwt.verify(token, \"secret\");\n    assert.strictEqual(decoded.userId, 1);\n  });\n});\n```\n\n*_Tipsï¼šæµ‹è¯•è¦†ç›–ç‡ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œä¼˜å…ˆè¦†ç›–æ ¸å¿ƒé€»è¾‘å’Œè¾¹ç•Œæƒ…å†µï¼_*\n\n---\n\n## 7. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ â“\n\n### 7.1 Token è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ\n\n- **ç°è±¡**ï¼šç”¨æˆ·æ”¶åˆ° 401 é”™è¯¯ï¼Œæç¤º Token è¿‡æœŸã€‚  \n- **è§£å†³**ï¼šå®ç° Refresh Token æœºåˆ¶ï¼ˆå¦‚ä¸Šæ–‡æ‰€è¿°ï¼‰ï¼Œæˆ–å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•ã€‚  \n- **é¢„é˜²**ï¼šå‰ç«¯å¯ä»¥åœ¨ Token å¿«è¿‡æœŸæ—¶ï¼ˆæ¯”å¦‚è¿˜å‰© 5 åˆ†é’Ÿï¼‰ä¸»åŠ¨åˆ·æ–°ã€‚\n\n*_Tipsï¼šå‰ç«¯ç”¨æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç† 401 é”™è¯¯ï¼Œè‡ªåŠ¨è§¦å‘åˆ·æ–°é€»è¾‘ï¼_*\n\n### 7.2 å¦‚ä½•å¤„ç†å¤§è§„æ¨¡ç”¨æˆ·ï¼Ÿ\n\n- **æŒ‘æˆ˜**ï¼šé«˜å¹¶å‘ä¸‹ï¼ŒToken éªŒè¯å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚  \n- **è§£å†³**ï¼š\n  - ä½¿ç”¨æ›´å¿«çš„ç­¾åç®—æ³•ï¼ˆå¦‚ HS256 è€Œé RS256ï¼‰ã€‚  \n  - éƒ¨ç½² Redis ç¼“å­˜å¸¸ç”¨ Tokenï¼ˆéœ€æƒè¡¡å®‰å…¨æ€§ï¼‰ã€‚  \n  - ä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼Œåˆ†æ•£éªŒè¯å‹åŠ›ã€‚  \n\n*_Tipsï¼šå¤§è§„æ¨¡ç³»ç»Ÿå»ºè®®å¼•å…¥ API ç½‘å…³ï¼Œç»Ÿä¸€å¤„ç†é‰´æƒï¼_*\n\n### 7.3 è·¨åŸŸé‰´æƒæ€ä¹ˆæï¼Ÿ\n\n- **ç°è±¡**ï¼šå‰åç«¯åˆ†ç¦»æ—¶ï¼Œæµè§ˆå™¨æŠ¥ CORS é”™è¯¯ã€‚  \n- **è§£å†³**ï¼šç”¨ `koa-cors` ä¸­é—´ä»¶å¯ç”¨è·¨åŸŸï¼š\n\n```javascript\nconst cors = require(\"@koa/cors\");\napp.use(cors({ credentials: true }));\n```\n\n- **æ³¨æ„**ï¼šè®¾ç½® `Access-Control-Allow-Headers` åŒ…å« `Authorization`ã€‚\n\n*_Tipsï¼šè·¨åŸŸé…ç½®è¦ç²¾ç¡®ï¼Œé¿å…å¼€æ”¾è¿‡å¤šæƒé™å¯¼è‡´å®‰å…¨é£é™©ï¼_*\n\n---\n\n## 8. æ€»ç»“ä¸å±•æœ› ğŸš€\n\né€šè¿‡è¿™ç¯‡åšå®¢ï¼Œæˆ‘ä»¬ä» JWT çš„åŸç†åˆ° Koa2 çš„å®æˆ˜ï¼Œå®Œæ•´èµ°äº†ä¸€éé‰´æƒå®ç°çš„æ—…ç¨‹ã€‚JWT å°±åƒä¸€æŠŠâ€œæ— å½¢çš„é’¥åŒ™â€ï¼Œæ—¢è½»ä¾¿åˆå¼ºå¤§ï¼Œè€Œ Koa2 åˆ™æ˜¯é‚£ä¸ªè®©ä½ æŒ¥æ´’è‡ªå¦‚çš„â€œé­”æ³•ç”»å¸ƒâ€ã€‚å¸Œæœ›ä½ ä¸ä»…å­¦ä¼šäº†ä»£ç ï¼Œè¿˜æ„Ÿå—åˆ° Web å®‰å…¨çš„é­…åŠ›ã€‚\n\n**æœªæ¥å±•æœ›**ï¼š\n\n- **JWT çš„è¿›åŒ–**ï¼šéšç€ Web å®‰å…¨éœ€æ±‚çš„å¢é•¿ï¼ŒJWT å¯èƒ½ä¼šä¸æ›´å…ˆè¿›çš„æ ‡å‡†ï¼ˆå¦‚ WebAuthnï¼‰ç»“åˆï¼Œæä¾›æ›´å¼ºçš„è®¤è¯èƒ½åŠ›ã€‚  \n- **Koa2 çš„æ½œåŠ›**ï¼šä½œä¸ºå…¨æ ˆå¼€å‘çš„åˆ©å™¨ï¼ŒKoa2 åœ¨ Serverless å’Œå¾®æœåŠ¡æ¶æ„ä¸­ä»æœ‰å¹¿é˜”ç©ºé—´ã€‚  \n- **å…¨æ ˆè§†é‡**ï¼šå‰ç«¯å¼€å‘è€…æŒæ¡ JWT å’Œ Koa2ï¼Œä¸ä»…èƒ½å†™å‡ºæ›´å®‰å…¨çš„ä»£ç ï¼Œè¿˜èƒ½æ›´å¥½åœ°ä¸åç«¯åä½œã€‚\n\næœ€åï¼Œé€ä½ ä¸€å¥â€œé«˜çº§å†·ç¬‘è¯â€ï¼šä¸ºä»€ä¹ˆ JWT æ€»æ˜¯é‚£ä¹ˆè‡ªä¿¡ï¼Ÿå› ä¸ºå®ƒçŸ¥é“ï¼Œåªè¦æœ‰ç­¾åï¼Œå®ƒå°±æ˜¯â€œçœŸçš„â€ï¼ğŸ˜\n\n> **æƒ³æ·±å…¥å­¦ä¹ ï¼Ÿ**  \n> - æŸ¥çœ‹ [jsonwebtoken](https://github.com/auth0/node-jsonwebtoken) å®˜æ–¹æ–‡æ¡£  \n> - æ¢ç´¢ [Koa2 å®˜ç½‘](https://koajs.com/) çš„ä¸­é—´ä»¶ç”Ÿæ€  \n> - å…³æ³¨ OWASP å®‰å…¨æŒ‡å—ï¼Œå†™å‡ºæ›´å®‰å…¨çš„ä»£ç   \n\nå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æˆä¸ºä½ å…¨æ ˆè·¯ä¸Šçš„â€œé­”æ³•æ‰‹å†Œâ€ï¼Œéšæ—¶ç¿»å¼€ï¼Œéšæ—¶å¯å‘ï¼âœ¨\n\n---",
    "code": "var Component=(()=>{var p=Object.create;var a=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var u=(l,n)=>()=>(n||l((n={exports:{}}).exports,n),n.exports),B=(l,n)=>{for(var r in n)a(l,r,{get:n[r],enumerable:!0})},d=(l,n,r,s)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of y(n))!g.call(l,c)&&c!==r&&a(l,c,{get:()=>n[c],enumerable:!(s=E(n,c))||s.enumerable});return l};var k=(l,n,r)=>(r=l!=null?p(F(l)):{},d(n||!l||!l.__esModule?a(r,\"default\",{value:l,enumerable:!0}):r,l)),T=l=>d(a({},\"__esModule\",{value:!0}),l);var i=u((x,o)=>{o.exports=_jsx_runtime});var f={};B(f,{default:()=>h,frontmatter:()=>m});var e=k(i()),m={type:\"Post\",title:\"Koa2 \\u5982\\u4F55\\u5B9E\\u73B0 JWT \\u9274\\u6743\\uFF1F\\u4ECE\\u96F6\\u5230\\u4E00\\u7684\\u5168\\u7A0B\\u62C6\\u89E3\",date:\"2024-06-22\",description:\"\\u6DF1\\u5165\\u5256\\u6790\\u5982\\u4F55\\u5728 Koa2 \\u4E2D\\u5B9E\\u73B0 JWT \\u9274\\u6743\\uFF0C\\u6DB5\\u76D6\\u539F\\u7406\\u3001\\u5B9E\\u73B0\\u3001\\u4F18\\u5316\\u4E0E\\u6700\\u4F73\\u5B9E\\u8DF5\\uFF0C\\u4E13\\u4E3A\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\u6253\\u9020\\uFF0C\\u5E26\\u4F60\\u4ECE\\u57FA\\u7840\\u5230\\u8FDB\\u9636\\uFF0C\\u89E3\\u9501 Web \\u5F00\\u53D1\\u7684\\u5B89\\u5168\\u5BC6\\u7801\\u3002\",keywords:\"Koa2, JWT, \\u9274\\u6743, Node.js, Web \\u5B89\\u5168, \\u524D\\u7AEF\\u5F00\\u53D1, \\u4E2D\\u95F4\\u4EF6, Token\",author:\"\\u6653\\u9F99\",image:\"/images/hero/koa2-jwt.jpg\",tags:[\"Koa2\",\"JWT\",\"Node.js\",\"Web \\u5B89\\u5168\"],category:\"Node.js\"};function t(l){let n={a:\"a\",blockquote:\"blockquote\",code:\"code\",em:\"em\",figure:\"figure\",h2:\"h2\",h3:\"h3\",hr:\"hr\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",ul:\"ul\",...l.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"\\u5982\\u679C\\u4F60\\u662F\\u4E00\\u4E2A\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\uFF0C\\u4E60\\u60EF\\u4E86\\u5728 React \\u6216 Vue \\u7684\\u4E16\\u754C\\u91CC\\u6325\\u6D12\\u81EA\\u5982\\uFF0C\\u90A3\\u4E48\\u5F53\\u4F60\\u7B2C\\u4E00\\u6B21\\u89E6\\u78B0\\u540E\\u7AEF\\uFF0C\\u5C24\\u5176\\u662F\\u50CF \",(0,e.jsx)(n.strong,{children:\"Koa2\"}),\" \\u8FD9\\u6837\\u4F18\\u96C5\\u7684 Node.js \\u6846\\u67B6\\u65F6\\uFF0C\\u53EF\\u80FD\\u4F1A\\u89C9\\u5F97\\u50CF\\u8D70\\u8FDB\\u4E86\\u4E00\\u95F4\\u6446\\u6EE1\\u9B54\\u6CD5\\u9053\\u5177\\u7684\\u5BC6\\u5BA4\\u2014\\u2014\\u65E2\\u5174\\u594B\\u53C8\\u6709\\u70B9\\u6478\\u4E0D\\u7740\\u5934\\u8111\\u3002\\u800C \",(0,e.jsx)(n.strong,{children:\"JWT\\uFF08JSON Web Token\\uFF09\"}),\" \\u9274\\u6743\\uFF0C\\u5C31\\u50CF\\u8FD9\\u95F4\\u5BC6\\u5BA4\\u91CC\\u7684\\u4E00\\u628A\\u4E07\\u80FD\\u94A5\\u5319\\uFF0C\\u53EF\\u4EE5\\u5E2E\\u4F60\\u6253\\u5F00\\u7528\\u6237\\u8BA4\\u8BC1\\u4E0E\\u6388\\u6743\\u7684\\u5927\\u95E8 \\u{1F511}\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8FD9\\u7BC7\\u6587\\u7AE0\\u5C06\\u5E26\\u4F60\\u4ECE\\u96F6\\u5F00\\u59CB\\uFF0C\\u5168\\u9762\\u62C6\\u89E3\\u5982\\u4F55\\u5728 Koa2 \\u4E2D\\u5B9E\\u73B0 JWT \\u9274\\u6743\\u3002\\u6211\\u4EEC\\u4F1A\\u4ECE \",(0,e.jsx)(n.strong,{children:\"JWT \\u7684\\u6838\\u5FC3\\u539F\\u7406\"}),\" \\u8BB2\\u8D77\\uFF0C\\u9010\\u6B65\\u6DF1\\u5165\\u5230 Koa2 \\u7684\\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\uFF0C\\u518D\\u5230\\u6027\\u80FD\\u4F18\\u5316\\u548C\\u5B89\\u5168\\u52A0\\u56FA\\uFF0C\\u6700\\u540E\\u9644\\u4E0A\\u4E00\\u4E9B\\u8BA9\\u4EE3\\u7801\\u66F4\\u4F18\\u96C5\\u7684\\u6700\\u4F73\\u5B9E\\u8DF5\\u3002\\u4E0D\\u4EC5\\u6709\\u6E05\\u6670\\u7684\\u4EE3\\u7801\\u793A\\u4F8B\\uFF0C\\u8FD8\\u6709\\u5E7D\\u9ED8\\u7684\\u7C7B\\u6BD4\\u3001\\u5B9E\\u7528\\u7684\\u8868\\u683C\\uFF0C\\u751A\\u81F3\\u4E00\\u70B9\\u70B9\\u201C\\u9AD8\\u7EA7\\u201D\\u7684\\u51B7\\u7B11\\u8BDD\\uFF08\\u522B\\u5ACC\\u5F03\\uFF0C\\u6211\\u5C3D\\u529B\\u4E86 \\u{1F60F}\\uFF09\\u3002\\u76EE\\u6807\\u662F\\u8BA9\\u8FD9\\u7BC7\\u535A\\u5BA2\\u4E0D\\u4EC5\\u4E13\\u4E1A\\uFF0C\\u8FD8\\u80FD\\u8BA9\\u4F60\\u8BFB\\u5F97\\u6D25\\u6D25\\u6709\\u5473\\uFF0C\\u50CF\\u5728\\u542C\\u4E00\\u4E2A\\u8001\\u670B\\u53CB\\u804A\\u6280\\u672F\\u3002\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u9002\\u5408\\u8C01\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u5BF9 Koa2 \\u548C JWT \\u611F\\u5174\\u8DA3\\u7684\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u60F3\\u4ECE\\u524D\\u7AEF\\u8DE8\\u754C\\u5230\\u5168\\u6808\\u7684\\u540C\\u5B66\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5BF9 Web \\u5B89\\u5168\\u548C\\u9274\\u6743\\u673A\\u5236\\u6709\\u597D\\u5947\\u5FC3\\u7684\\u5F00\\u53D1\\u8005\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5E0C\\u671B\\u5199\\u51FA\\u4F18\\u96C5 Node.js \\u4EE3\\u7801\\u7684\\u201C\\u5F3A\\u8FEB\\u75C7\\u60A3\\u8005\\u201D \\u{1F61C}\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"\\u6587\\u7AE0\\u7ED3\\u6784\\u601D\\u7EF4\\u5BFC\\u56FE\\u5F0F\\u62C6\\u89E3\",children:(0,e.jsx)(n.a,{href:\"#\\u6587\\u7AE0\\u7ED3\\u6784\\u601D\\u7EF4\\u5BFC\\u56FE\\u5F0F\\u62C6\\u89E3\",children:\"\\u6587\\u7AE0\\u7ED3\\u6784\\uFF1A\\u601D\\u7EF4\\u5BFC\\u56FE\\u5F0F\\u62C6\\u89E3\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E3A\\u4E86\\u8BA9\\u8FD9\\u7BC7\\u957F\\u6587\\uFF08\\u662F\\u7684\\uFF0C15000 \\u5B57\\u4E0D\\u662F\\u5F00\\u73A9\\u7B11\\uFF01\\uFF09\\u903B\\u8F91\\u6E05\\u6670\\uFF0C\\u6211\\u5148\\u7ED9\\u4F60\\u753B\\u4E00\\u5F20\\u201C\\u601D\\u7EF4\\u5BFC\\u56FE\\u201D\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u4EC0\\u4E48\\u662F JWT\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"JWT \\u7684\\u5B9A\\u4E49\\u4E0E\\u7ED3\\u6784\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u4E3A\\u4EC0\\u4E48\\u9009\\u62E9 JWT\\uFF1F\"}),`\n`,(0,e.jsx)(n.li,{children:\"JWT vs Session\\uFF1A\\u4E00\\u573A\\u201C\\u65B0\\u8001\\u4EA4\\u66FF\\u201D\\u7684\\u8F83\\u91CF\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Koa2 \\u7B80\\u4ECB\\uFF1A\\u4F18\\u96C5\\u7684\\u540E\\u7AEF\\u9B54\\u6CD5\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Koa2 \\u7684\\u6838\\u5FC3\\u7279\\u6027\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u4E3A\\u4EC0\\u4E48\\u7528 Koa2 \\u5B9E\\u73B0 JWT\\uFF1F\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"JWT \\u9274\\u6743\\u7684\\u5B9E\\u73B0\\u539F\\u7406\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Header\\u3001Payload\\u3001Signature \\u7684\\u201C\\u94C1\\u4E09\\u89D2\\u201D\"}),`\n`,(0,e.jsx)(n.li,{children:\"JWT \\u7684\\u52A0\\u5BC6\\u4E0E\\u89E3\\u5BC6\\u8FC7\\u7A0B\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u65E0\\u72B6\\u6001\\u8BA4\\u8BC1\\u7684\\u9B45\\u529B\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Koa2 + JWT \\u5B9E\\u6218\\uFF1A\\u4ECE\\u96F6\\u642D\\u5EFA\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u73AF\\u5883\\u642D\\u5EFA\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u751F\\u6210\\u4E0E\\u9A8C\\u8BC1 Token\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\u9274\\u6743\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u9519\\u8BEF\\u5904\\u7406\\u4E0E\\u54CD\\u5E94\\u4F18\\u5316\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u9AD8\\u7EA7\\u8FDB\\u9636\\uFF1A\\u4F18\\u5316\\u4E0E\\u5B89\\u5168\\u52A0\\u56FA\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Token \\u5237\\u65B0\\u673A\\u5236\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u9632\\u5FA1\\u5E38\\u89C1\\u653B\\u51FB\\uFF08XSS\\u3001CSRF\\u3001Token \\u6CC4\\u9732\\uFF09\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u6027\\u80FD\\u4F18\\u5316\\u6280\\u5DE7\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u6700\\u4F73\\u5B9E\\u8DF5\\uFF1A\\u8BA9\\u4EE3\\u7801\\u66F4\\u4F18\\u96C5\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u7ED3\\u6784\\u5316\\u9879\\u76EE\\u76EE\\u5F55\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u73AF\\u5883\\u53D8\\u91CF\\u7BA1\\u7406\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u65E5\\u5FD7\\u4E0E\\u76D1\\u63A7\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5355\\u5143\\u6D4B\\u8BD5\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u5E38\\u89C1\\u95EE\\u9898\\u4E0E\\u89E3\\u51B3\\u65B9\\u6848\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Token \\u8FC7\\u671F\\u600E\\u4E48\\u529E\\uFF1F\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5982\\u4F55\\u5904\\u7406\\u5927\\u89C4\\u6A21\\u7528\\u6237\\uFF1F\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u8DE8\\u57DF\\u9274\\u6743\\u600E\\u4E48\\u641E\\uFF1F\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u603B\\u7ED3\\u4E0E\\u5C55\\u671B\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"JWT \\u7684\\u672A\\u6765\"}),`\n`,(0,e.jsx)(n.li,{children:\"Koa2 \\u5728\\u5168\\u6808\\u5F00\\u53D1\\u4E2D\\u7684\\u6F5C\\u529B\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"1-\\u4EC0\\u4E48\\u662F-jwt\",children:(0,e.jsx)(n.a,{href:\"#1-\\u4EC0\\u4E48\\u662F-jwt\",children:\"1. \\u4EC0\\u4E48\\u662F JWT\\uFF1F\\u{1F50D}\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"11-jwt-\\u7684\\u5B9A\\u4E49\\u4E0E\\u7ED3\\u6784\",children:(0,e.jsx)(n.a,{href:\"#11-jwt-\\u7684\\u5B9A\\u4E49\\u4E0E\\u7ED3\\u6784\",children:\"1.1 JWT \\u7684\\u5B9A\\u4E49\\u4E0E\\u7ED3\\u6784\"})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"JWT\\uFF08JSON Web Token\\uFF09\"}),\" \\u662F\\u4E00\\u4E2A\\u5F00\\u653E\\u6807\\u51C6\\uFF08RFC 7519\\uFF09\\uFF0C\\u7528\\u4E8E\\u5728\\u7F51\\u7EDC\\u5E94\\u7528\\u95F4\\u4F20\\u9012\\u4FE1\\u606F\\u3002\\u5B83\\u672C\\u8D28\\u4E0A\\u662F\\u4E00\\u4E2A \",(0,e.jsx)(n.strong,{children:\"\\u7D27\\u51D1\\u7684\\u3001URL \\u5B89\\u5168\\u7684\\u5B57\\u7B26\\u4E32\"}),\"\\uFF0C\\u7531\\u4E09\\u90E8\\u5206\\u7EC4\\u6210\\uFF1A\",(0,e.jsx)(n.strong,{children:\"Header\\uFF08\\u5934\\u90E8\\uFF09\"}),\"\\u3001\",(0,e.jsx)(n.strong,{children:\"Payload\\uFF08\\u8D1F\\u8F7D\\uFF09\"}),\" \\u548C \",(0,e.jsx)(n.strong,{children:\"Signature\\uFF08\\u7B7E\\u540D\\uFF09\"}),\"\\uFF0C\\u7528\\u70B9\\u53F7\\uFF08\",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\".\"})})})}),\"\\uFF09\\u5206\\u9694\\u3002\\u957F\\u8FD9\\u6837\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\"})})})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8BA9\\u6211\\u4EEC\\u62C6\\u89E3\\u4E00\\u4E0B\\u8FD9\\u4E32\\u201C\\u795E\\u79D8\\u4EE3\\u7801\\u201D\\uFF1A\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"\\u90E8\\u5206\"}),(0,e.jsx)(n.th,{children:\"\\u63CF\\u8FF0\"}),(0,e.jsx)(n.th,{children:\"\\u793A\\u4F8B\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Header\"})}),(0,e.jsx)(n.td,{children:\"\\u5305\\u542B Token \\u7684\\u7C7B\\u578B\\uFF08\\u901A\\u5E38\\u662F JWT\\uFF09\\u548C\\u52A0\\u5BC6\\u7B97\\u6CD5\\uFF08\\u5982 HMAC SHA256 \\u6216 RSA\\uFF09\\u3002\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:'{\"alg\": \"HS256\", \"typ\": \"JWT\"}'})})})})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Payload\"})}),(0,e.jsx)(n.td,{children:\"\\u5305\\u542B\\u5B9E\\u9645\\u7684\\u6570\\u636E\\uFF08\\u79F0\\u4E3A Claims\\uFF09\\uFF0C\\u5982\\u7528\\u6237 ID\\u3001\\u89D2\\u8272\\u3001\\u8FC7\\u671F\\u65F6\\u95F4\\u7B49\\u3002\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:'{\"sub\": \"1234567890\", \"name\": \"John Doe\", \"iat\": 1516239022}'})})})})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Signature\"})}),(0,e.jsx)(n.td,{children:\"\\u4F7F\\u7528\\u5BC6\\u94A5\\u5BF9 Header \\u548C Payload \\u8FDB\\u884C\\u7B7E\\u540D\\uFF0C\\u786E\\u4FDD\\u6570\\u636E\\u672A\\u88AB\\u7BE1\\u6539\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\uFF08\\u4E00\\u4E32\\u52A0\\u5BC6\\u540E\\u7684\\u5B57\\u7B26\\u4E32\\uFF0C\\u53D6\\u51B3\\u4E8E\\u5BC6\\u94A5\\u548C\\u7B97\\u6CD5\\uFF09\"})]})]})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6BCF\\u90E8\\u5206\\u90FD\\u4F1A\\u88AB \",(0,e.jsx)(n.strong,{children:\"Base64Url \\u7F16\\u7801\"}),\"\\uFF0C\\u7136\\u540E\\u62FC\\u63A5\\u6210\\u6700\\u7EC8\\u7684 Token\\u3002\\u7C7B\\u6BD4\\u4E00\\u4E0B\\uFF0CJWT \\u5C31\\u50CF\\u4E00\\u5F20\\u706B\\u8F66\\u7968 \\u{1F3AB}\\uFF1AHeader \\u662F\\u7968\\u7684\\u7C7B\\u578B\\uFF08\\u9AD8\\u94C1\\u8FD8\\u662F\\u666E\\u5FEB\\uFF09\\uFF0CPayload \\u662F\\u4F60\\u7684\\u5EA7\\u4F4D\\u4FE1\\u606F\\uFF0CSignature \\u662F\\u9632\\u4F2A\\u6C34\\u5370\\uFF0C\\u786E\\u4FDD\\u7968\\u4E0D\\u88AB\\u4F2A\\u9020\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1APayload \\u4E2D\\u7684\\u6570\\u636E\\u662F\\u516C\\u5F00\\u7684\\uFF08Base64 \\u53EA\\u662F\\u7F16\\u7801\\uFF0C\\u4E0D\\u662F\\u52A0\\u5BC6\\uFF09\\uFF0C\\u6240\\u4EE5\\u5343\\u4E07\\u522B\\u628A\\u5BC6\\u7801\\u8FD9\\u79CD\\u654F\\u611F\\u4FE1\\u606F\\u653E\\u8FDB\\u53BB\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"12-\\u4E3A\\u4EC0\\u4E48\\u9009\\u62E9-jwt\",children:(0,e.jsx)(n.a,{href:\"#12-\\u4E3A\\u4EC0\\u4E48\\u9009\\u62E9-jwt\",children:\"1.2 \\u4E3A\\u4EC0\\u4E48\\u9009\\u62E9 JWT\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"JWT \\u7684\\u6700\\u5927\\u9B45\\u529B\\u5728\\u4E8E\\u5B83\\u7684 \",(0,e.jsx)(n.strong,{children:\"\\u65E0\\u72B6\\u6001\\u6027\"}),\"\\u3002\\u4F20\\u7EDF\\u57FA\\u4E8E Session \\u7684\\u8BA4\\u8BC1\\u9700\\u8981\\u670D\\u52A1\\u5668\\u5B58\\u50A8\\u7528\\u6237\\u72B6\\u6001\\uFF08\\u6BD4\\u5982 Session ID\\uFF09\\uFF0C\\u800C JWT \\u628A\\u6240\\u6709\\u4FE1\\u606F\\u90FD\\u585E\\u8FDB Token \\u91CC\\uFF0C\\u670D\\u52A1\\u5668\\u53EA\\u9700\\u8981\\u9A8C\\u8BC1\\u7B7E\\u540D\\u5373\\u53EF\\u786E\\u8BA4\\u7528\\u6237\\u8EAB\\u4EFD\\u3002\\u8FD9\\u5C31\\u50CF\\u4ECE\\u201C\\u6253\\u7535\\u8BDD\\u95EE\\u5BA2\\u670D\\u201D\\u5347\\u7EA7\\u5230\\u201C\\u81EA\\u52A9\\u626B\\u7801\\u5165\\u573A\\u201D\\u2014\\u2014\\u6548\\u7387\\u66F4\\u9AD8\\uFF0C\\u6269\\u5C55\\u6027\\u66F4\\u5F3A \\u{1F4AA}\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"JWT \\u7684\\u4F18\\u70B9\\u603B\\u7ED3\\uFF1A\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"\\u4F18\\u70B9\"}),(0,e.jsx)(n.th,{children:\"\\u8BF4\\u660E\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u65E0\\u72B6\\u6001\"})}),(0,e.jsx)(n.td,{children:\"\\u670D\\u52A1\\u5668\\u65E0\\u9700\\u5B58\\u50A8 Session\\uFF0C\\u9002\\u5408\\u5206\\u5E03\\u5F0F\\u7CFB\\u7EDF\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u8DE8\\u57DF\\u53CB\\u597D\"})}),(0,e.jsx)(n.td,{children:\"Token \\u53EF\\u4EE5\\u8F7B\\u677E\\u5728\\u4E0D\\u540C\\u57DF\\u540D\\u95F4\\u4F20\\u9012\\uFF0C\\u5B8C\\u7F8E\\u9002\\u914D\\u524D\\u540E\\u7AEF\\u5206\\u79BB\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u7075\\u6D3B\\u6027\"})}),(0,e.jsx)(n.td,{children:\"Payload \\u53EF\\u81EA\\u5B9A\\u4E49\\uFF0C\\u9002\\u5408\\u591A\\u79CD\\u573A\\u666F\\uFF08\\u5982\\u6743\\u9650\\u63A7\\u5236\\uFF09\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u79FB\\u52A8\\u7AEF\\u9002\\u914D\"})}),(0,e.jsx)(n.td,{children:\"\\u5929\\u7136\\u652F\\u6301 RESTful API\\uFF0C\\u9002\\u5408\\u79FB\\u52A8\\u7AEF\\u548C\\u5FAE\\u670D\\u52A1\\u67B6\\u6784\\u3002\"})]})]})]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F46\\u5B83\\u4E5F\\u4E0D\\u662F\\u201C\\u5B8C\\u7F8E\\u7537\\u53CB\\u201D\\u3002\\u7F3A\\u70B9\\u4E5F\\u5F88\\u660E\\u663E\\uFF0C\\u6BD4\\u5982 Token \\u4E00\\u65E6\\u6CC4\\u9732\\u5C31\\u53EF\\u80FD\\u88AB\\u6EE5\\u7528\\uFF0C\\u800C\\u4E14\\u65E0\\u6CD5\\u4E3B\\u52A8\\u5931\\u6548\\uFF08\\u9664\\u975E\\u5F15\\u5165\\u590D\\u6742\\u673A\\u5236\\uFF09\\u3002\\u6240\\u4EE5\\uFF0CJWT \\u66F4\\u50CF\\u4E00\\u4E2A\\u201C\\u9AD8\\u60C5\\u5546\\u4F46\\u9700\\u8981\\u5C0F\\u5FC3\\u5475\\u62A4\\u201D\\u7684\\u5DE5\\u5177 \\u{1F605}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u9009\\u62E9 JWT \\u524D\\uFF0C\\u8BC4\\u4F30\\u4F60\\u7684\\u9879\\u76EE\\u662F\\u5426\\u771F\\u7684\\u9700\\u8981\\u65E0\\u72B6\\u6001\\u8BA4\\u8BC1\\u3002\\u5982\\u679C\\u662F\\u5C0F\\u578B\\u9879\\u76EE\\uFF0CSession \\u53EF\\u80FD\\u66F4\\u7B80\\u5355\\u3002\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"13-jwt-vs-session\\u4E00\\u573A\\u65B0\\u8001\\u4EA4\\u66FF\\u7684\\u8F83\\u91CF\",children:(0,e.jsx)(n.a,{href:\"#13-jwt-vs-session\\u4E00\\u573A\\u65B0\\u8001\\u4EA4\\u66FF\\u7684\\u8F83\\u91CF\",children:\"1.3 JWT vs Session\\uFF1A\\u4E00\\u573A\\u201C\\u65B0\\u8001\\u4EA4\\u66FF\\u201D\\u7684\\u8F83\\u91CF\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E3A\\u4E86\\u8BA9\\u4F60\\u66F4\\u76F4\\u89C2\\u5730\\u7406\\u89E3 JWT\\uFF0C\\u6211\\u4EEC\\u6765\\u5BF9\\u6BD4\\u4E00\\u4E0B\\u5B83\\u548C\\u4F20\\u7EDF Session \\u7684\\u533A\\u522B\\uFF1A\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"\\u7279\\u6027\"}),(0,e.jsx)(n.th,{children:\"JWT\"}),(0,e.jsx)(n.th,{children:\"Session\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u5B58\\u50A8\\u65B9\\u5F0F\"})}),(0,e.jsx)(n.td,{children:\"\\u5BA2\\u6237\\u7AEF\\u5B58\\u50A8\\uFF08\\u901A\\u5E38\\u5728 LocalStorage \\u6216 Cookie\\uFF09\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u670D\\u52A1\\u5668\\u5B58\\u50A8\\uFF08Session ID \\u5B58\\u5728 Cookie \\u4E2D\\uFF09\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u72B6\\u6001\\u6027\"})}),(0,e.jsx)(n.td,{children:\"\\u65E0\\u72B6\\u6001\\uFF0C\\u670D\\u52A1\\u5668\\u53EA\\u9A8C\\u8BC1 Token\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u6709\\u72B6\\u6001\\uFF0C\\u670D\\u52A1\\u5668\\u9700\\u7EF4\\u62A4 Session \\u6570\\u636E\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u6269\\u5C55\\u6027\"})}),(0,e.jsx)(n.td,{children:\"\\u9002\\u5408\\u5206\\u5E03\\u5F0F\\u7CFB\\u7EDF\\uFF0C\\u65E0\\u9700\\u5171\\u4EAB Session\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u9700\\u8981 Session \\u540C\\u6B65\\uFF08\\u5982\\u7528 Redis\\uFF09\\uFF0C\\u590D\\u6742\\u5EA6\\u9AD8\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u5B89\\u5168\\u6027\"})}),(0,e.jsx)(n.td,{children:\"\\u4F9D\\u8D56\\u7B7E\\u540D\\u548C HTTPS\\uFF0C\\u9700\\u9632\\u8303 Token \\u6CC4\\u9732\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u4F9D\\u8D56 Cookie \\u5B89\\u5168\\uFF0C\\u9700\\u9632\\u8303 CSRF \\u653B\\u51FB\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u6027\\u80FD\"})}),(0,e.jsx)(n.td,{children:\"\\u9A8C\\u8BC1\\u901F\\u5EA6\\u5FEB\\uFF0C\\u4F46 Token \\u4F53\\u79EF\\u53EF\\u80FD\\u8F83\\u5927\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u67E5\\u8BE2 Session \\u53EF\\u80FD\\u6709\\u5EF6\\u8FDF\\uFF0C\\u4F9D\\u8D56\\u5B58\\u50A8\\u6027\\u80FD\\u3002\"})]})]})]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7C7B\\u6BD4\\u4E00\\u4E0B\\uFF0CSession \\u50CF\\u662F\\u5728\\u5BB6\\u95E8\\u53E3\\u653E\\u4E2A\\u95E8\\u536B\\uFF0C\\u8BA4\\u8BC6\\u4F60\\u624D\\u653E\\u884C\\uFF1B\\u800C JWT \\u662F\\u7ED9\\u4F60\\u53D1\\u4E00\\u5F20 VIP \\u5361\\uFF0C\\u4F60\\u62FF\\u7740\\u5361\\u5C31\\u80FD\\u7545\\u901A\\u65E0\\u963B\\u3002\\u4E24\\u79CD\\u65B9\\u5F0F\\u5404\\u6709\\u5343\\u79CB\\uFF0C\\u9009\\u54EA\\u4E2A\\u5F97\\u770B\\u4F60\\u7684\\u201C\\u95E8\\u201D\\u6709\\u591A\\u590D\\u6742 \\u{1F6AA}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1AJWT \\u9002\\u5408 API \\u9A71\\u52A8\\u7684\\u73B0\\u4EE3\\u5E94\\u7528\\uFF0C\\u4F46\\u522B\\u5FD8\\u4E86\\u4E3A\\u5B83\\u914D\\u4E0A HTTPS\\uFF0C\\u5426\\u5219 Token \\u88F8\\u5954\\u53EF\\u4E0D\\u662F\\u95F9\\u7740\\u73A9\\u7684\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"2-koa2-\\u7B80\\u4ECB\\u4F18\\u96C5\\u7684\\u540E\\u7AEF\\u9B54\\u6CD5-\",children:(0,e.jsx)(n.a,{href:\"#2-koa2-\\u7B80\\u4ECB\\u4F18\\u96C5\\u7684\\u540E\\u7AEF\\u9B54\\u6CD5-\",children:\"2. Koa2 \\u7B80\\u4ECB\\uFF1A\\u4F18\\u96C5\\u7684\\u540E\\u7AEF\\u9B54\\u6CD5 \\u2728\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"21-koa2-\\u7684\\u6838\\u5FC3\\u7279\\u6027\",children:(0,e.jsx)(n.a,{href:\"#21-koa2-\\u7684\\u6838\\u5FC3\\u7279\\u6027\",children:\"2.1 Koa2 \\u7684\\u6838\\u5FC3\\u7279\\u6027\"})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Koa2\"}),\" \\u662F Node.js \\u7684\\u4E00\\u4E2A\\u8F7B\\u91CF\\u7EA7\\u6846\\u67B6\\uFF0C\\u7531 Express \\u7684\\u539F\\u73ED\\u4EBA\\u9A6C\\u6253\\u9020\\uFF0C\\u53F7\\u79F0\\u201C\\u4E0B\\u4E00\\u4EE3 Web \\u6846\\u67B6\\u201D\\u3002\\u5B83\\u6700\\u5927\\u7684\\u7279\\u70B9\\u662F \",(0,e.jsx)(n.strong,{children:\"\\u4E2D\\u95F4\\u4EF6\\u673A\\u5236\"}),\" \\u548C \",(0,e.jsx)(n.strong,{children:\"async/await\"}),\" \\u7684\\u6DF1\\u5EA6\\u652F\\u6301\\uFF0C\\u8BA9\\u4EE3\\u7801\\u7B80\\u6D01\\u5F97\\u50CF\\u4E00\\u9996\\u5C0F\\u6E05\\u65B0\\u8BD7\\u6B4C \\u{1F3B6}\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Koa2 \\u7684\\u6838\\u5FC3\\u7279\\u6027\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6D0B\\u8471\\u6A21\\u578B\\u4E2D\\u95F4\\u4EF6\"}),\"\\uFF1A\\u8BF7\\u6C42\\u548C\\u54CD\\u5E94\\u50CF\\u5265\\u6D0B\\u8471\\u4E00\\u6837\\uFF0C\\u5C42\\u5C42\\u5904\\u7406\\uFF0C\\u903B\\u8F91\\u6E05\\u6670\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u8F7B\\u91CF\\u6838\\u5FC3\"}),\"\\uFF1AKoa \\u672C\\u8EAB\\u4E0D\\u7ED1\\u5B9A\\u4EFB\\u4F55\\u529F\\u80FD\\uFF0C\\u6240\\u6709\\u529F\\u80FD\\u9760\\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\uFF0C\\u81EA\\u7531\\u5EA6\\u6781\\u9AD8\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u4F18\\u96C5\\u7684\\u9519\\u8BEF\\u5904\\u7406\"}),\"\\uFF1A\\u901A\\u8FC7 try/catch \\u548C\\u4E2D\\u95F4\\u4EF6\\uFF0C\\u9519\\u8BEF\\u5904\\u7406\\u4E1D\\u6ED1\\u65E0\\u6BD4\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u73B0\\u4EE3\\u5316\"}),\"\\uFF1A\\u57FA\\u4E8E ES6+\\uFF0C\\u5B8C\\u7F8E\\u652F\\u6301 async/await\\uFF0C\\u544A\\u522B\\u56DE\\u8C03\\u5730\\u72F1\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7528\\u7C7B\\u6BD4\\u6765\\u8BF4\\uFF0CExpress \\u50CF\\u4E00\\u8F86\\u5168\\u526F\\u6B66\\u88C5\\u7684\\u8D8A\\u91CE\\u8F66\\uFF0C\\u529F\\u80FD\\u9F50\\u5168\\u4F46\\u6709\\u70B9\\u7B28\\u91CD\\uFF1B\\u800C Koa2 \\u662F\\u8F86\\u8F7B\\u76C8\\u7684\\u8DD1\\u8F66\\uFF0C\\u7075\\u6D3B\\u3001\\u4F18\\u96C5\\uFF0C\\u4F46\\u4F60\\u5F97\\u81EA\\u5DF1\\u88C5\\u70B9\\u914D\\u4EF6 \\u{1F697}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1AKoa2 \\u7684\\u4E2D\\u95F4\\u4EF6\\u662F\\u53CC\\u5411\\u7684\\uFF0C\\u5199\\u4EE3\\u7801\\u65F6\\u522B\\u5FD8\\u4E86\\u5904\\u7406\\u201C\\u54CD\\u5E94\\u201D\\u9636\\u6BB5\\u7684\\u903B\\u8F91\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"22-\\u4E3A\\u4EC0\\u4E48\\u7528-koa2-\\u5B9E\\u73B0-jwt\",children:(0,e.jsx)(n.a,{href:\"#22-\\u4E3A\\u4EC0\\u4E48\\u7528-koa2-\\u5B9E\\u73B0-jwt\",children:\"2.2 \\u4E3A\\u4EC0\\u4E48\\u7528 Koa2 \\u5B9E\\u73B0 JWT\\uFF1F\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Koa2 \\u548C JWT \\u7B80\\u76F4\\u662F\\u5929\\u4F5C\\u4E4B\\u5408\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u4E2D\\u95F4\\u4EF6\\u5929\\u7136\\u9002\\u914D\\u9274\\u6743\"}),\"\\uFF1AJWT \\u9A8C\\u8BC1\\u672C\\u8D28\\u4E0A\\u662F\\u4E00\\u4E2A\\u201C\\u62E6\\u622A\\u5668\\u201D\\uFF0CKoa2 \\u7684\\u4E2D\\u95F4\\u4EF6\\u673A\\u5236\\u8BA9\\u5B9E\\u73B0\\u9274\\u6743\\u903B\\u8F91\\u53D8\\u5F97\\u76F4\\u89C2\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u5F02\\u6B65\\u53CB\\u597D\"}),\"\\uFF1A\\u9A8C\\u8BC1 Token \\u53EF\\u80FD\\u6D89\\u53CA\\u52A0\\u5BC6\\u89E3\\u5BC6\\uFF0CKoa2 \\u7684 async/await \\u8BA9\\u4EE3\\u7801\\u66F4\\u7B80\\u6D01\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u8F7B\\u91CF\\u9AD8\\u6548\"}),\"\\uFF1AKoa2 \\u4E0D\\u4F1A\\u7ED9\\u4F60\\u585E\\u4E00\\u5806\\u4E0D\\u9700\\u8981\\u7684\\u529F\\u80FD\\uFF0C\\u9002\\u5408\\u5FEB\\u901F\\u642D\\u5EFA API \\u670D\\u52A1\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u793E\\u533A\\u652F\\u6301\"}),\"\\uFF1AKoa2 \\u6709\\u4E30\\u5BCC\\u7684\\u4E2D\\u95F4\\u4EF6\\u751F\\u6001\\uFF0C\\u6BD4\\u5982 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa-jwt\"})})})}),\"\\uFF0C\\u7701\\u65F6\\u7701\\u529B\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E00\\u53E5\\u8BDD\\u603B\\u7ED3\\uFF1AKoa2 \\u5C31\\u50CF\\u4E00\\u4E2A\\u61C2\\u5F97\\u5982\\u4F55\\u201C\\u6070\\u5230\\u597D\\u5904\\u201D\\u914D\\u5408\\u4F60\\u7684\\u821E\\u4F34\\uFF0C\\u548C JWT \\u4E00\\u8D77\\u8DF3\\u51FA\\u4F18\\u96C5\\u7684\\u9274\\u6743\\u4E4B\\u821E \\u{1F483}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsxs)(n.em,{children:[\"Tips\\uFF1A\\u7528 Koa2 \\u65F6\\uFF0C\\u522B\\u5FD8\\u4E86\\u88C5\\u4E2A \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa-router\"})})})}),\"\\uFF0C\\u4E0D\\u7136\\u4F60\\u7684\\u8DEF\\u7531\\u4F1A\\u50CF\\u65E0\\u5934\\u82CD\\u8747\\u5230\\u5904\\u4E71\\u649E\\uFF01\"]})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"3-jwt-\\u9274\\u6743\\u7684\\u5B9E\\u73B0\\u539F\\u7406-\",children:(0,e.jsx)(n.a,{href:\"#3-jwt-\\u9274\\u6743\\u7684\\u5B9E\\u73B0\\u539F\\u7406-\",children:\"3. JWT \\u9274\\u6743\\u7684\\u5B9E\\u73B0\\u539F\\u7406 \\u{1F510}\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"31-headerpayloadsignature-\\u7684\\u94C1\\u4E09\\u89D2\",children:(0,e.jsx)(n.a,{href:\"#31-headerpayloadsignature-\\u7684\\u94C1\\u4E09\\u89D2\",children:\"3.1 Header\\u3001Payload\\u3001Signature \\u7684\\u201C\\u94C1\\u4E09\\u89D2\\u201D\"})}),`\n`,(0,e.jsx)(n.p,{children:\"JWT \\u7684\\u6838\\u5FC3\\u662F\\u5B83\\u7684\\u4E09\\u90E8\\u5206\\u7ED3\\u6784\\uFF0C\\u6211\\u4EEC\\u518D\\u6DF1\\u5165\\u770B\\u770B\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Header\"}),\"\\uFF1A\\u63CF\\u8FF0 Token \\u7684\\u5143\\u4FE1\\u606F\\uFF0C\\u901A\\u5E38\\u662F \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:'{\"alg\": \"HS256\", \"typ\": \"JWT\"}'})})})}),\"\\u3002\",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"alg\"})})})}),\" \\u6307\\u5B9A\\u4E86\\u7B7E\\u540D\\u7B97\\u6CD5\\uFF0C\\u5E38\\u89C1\\u7684\\u6709\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"HS256\"}),\"\\uFF08HMAC SHA256\\uFF09\\uFF1A\\u5BF9\\u79F0\\u52A0\\u5BC6\\uFF0C\\u7528\\u540C\\u4E00\\u4E2A\\u5BC6\\u94A5\\u52A0\\u5BC6\\u548C\\u89E3\\u5BC6\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"RS256\"}),\"\\uFF08RSA SHA256\\uFF09\\uFF1A\\u975E\\u5BF9\\u79F0\\u52A0\\u5BC6\\uFF0C\\u516C\\u94A5\\u89E3\\u5BC6\\uFF0C\\u79C1\\u94A5\\u52A0\\u5BC6\\uFF0C\\u5B89\\u5168\\u6027\\u66F4\\u9AD8\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Payload\"}),\"\\uFF1A\\u5B58\\u653E\\u5B9E\\u9645\\u6570\\u636E\\uFF0C\\u5206\\u4E3A\\u4E09\\u7C7B Claims\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Registered Claims\"}),\"\\uFF1A\\u6807\\u51C6\\u5B57\\u6BB5\\uFF0C\\u5982 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"iss\"})})})}),\"\\uFF08\\u53D1\\u884C\\u8005\\uFF09\\u3001\",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"exp\"})})})}),\"\\uFF08\\u8FC7\\u671F\\u65F6\\u95F4\\uFF09\\u3001\",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"sub\"})})})}),\"\\uFF08\\u4E3B\\u9898\\uFF09\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Public Claims\"}),\"\\uFF1A\\u81EA\\u5B9A\\u4E49\\u5B57\\u6BB5\\uFF0C\\u6BD4\\u5982\\u7528\\u6237 ID\\u3001\\u89D2\\u8272\\u7B49\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Private Claims\"}),\"\\uFF1A\\u53CC\\u65B9\\u7EA6\\u5B9A\\u7684\\u79C1\\u6709\\u5B57\\u6BB5\\uFF0C\\u9700\\u8C28\\u614E\\u4F7F\\u7528\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Signature\"}),\"\\uFF1A\\u7528\\u5BC6\\u94A5\\u5BF9 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"Base64Url(Header).Base64Url(Payload)\"})})})}),\" \\u8FDB\\u884C\\u7B7E\\u540D\\uFF0C\\u786E\\u4FDD\\u6570\\u636E\\u5B8C\\u6574\\u6027\\u3002\\u516C\\u5F0F\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"Signature \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" HMAC\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"-\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"SHA256\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"  base64UrlEncode\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Header) \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \".\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" +\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" base64UrlEncode\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Payload),\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  Secret\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\")\"})})]})})}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7C7B\\u6BD4\\u4E00\\u4E0B\\uFF0CHeader \\u662F\\u4F60\\u7684\\u8EAB\\u4EFD\\u8BC1\\u7C7B\\u578B\\uFF0CPayload \\u662F\\u4F60\\u7684\\u4E2A\\u4EBA\\u4FE1\\u606F\\uFF0CSignature \\u662F\\u516C\\u5B89\\u5C40\\u7684\\u76D6\\u7AE0\\uFF0C\\u4E09\\u8005\\u7F3A\\u4E00\\u4E0D\\u53EF \\u{1F6C2}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsxs)(n.em,{children:[\"Tips\\uFF1A\\u4F18\\u5148\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"exp\"})})})}),\" \\u8BBE\\u7F6E Token \\u8FC7\\u671F\\u65F6\\u95F4\\uFF0C\\u907F\\u514D\\u201C\\u6C38\\u4E0D\\u8FC7\\u671F\\u201D\\u7684\\u5B89\\u5168\\u9690\\u60A3\\uFF01\"]})})}),`\n`,(0,e.jsx)(n.h3,{id:\"32-jwt-\\u7684\\u52A0\\u5BC6\\u4E0E\\u89E3\\u5BC6\\u8FC7\\u7A0B\",children:(0,e.jsx)(n.a,{href:\"#32-jwt-\\u7684\\u52A0\\u5BC6\\u4E0E\\u89E3\\u5BC6\\u8FC7\\u7A0B\",children:\"3.2 JWT \\u7684\\u52A0\\u5BC6\\u4E0E\\u89E3\\u5BC6\\u8FC7\\u7A0B\"})}),`\n`,(0,e.jsx)(n.p,{children:\"JWT \\u7684\\u751F\\u6210\\u548C\\u9A8C\\u8BC1\\u8FC7\\u7A0B\\u5C31\\u50CF\\u4E00\\u573A\\u201C\\u9B54\\u6CD5\\u4EEA\\u5F0F\\u201D\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u751F\\u6210 Token\"}),\"\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u51C6\\u5907 Header \\u548C Payload\\uFF0C\\u5206\\u522B Base64Url \\u7F16\\u7801\\u3002\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u7528\\u5BC6\\u94A5\\u5BF9\\u62FC\\u63A5\\u540E\\u7684\\u5B57\\u7B26\\u4E32\\u7B7E\\u540D\\uFF0C\\u5F97\\u5230 Signature\\u3002\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u4E09\\u90E8\\u5206\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\".\"})})})}),\" \\u62FC\\u63A5\\uFF0C\\u751F\\u6210\\u6700\\u7EC8 Token\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u9A8C\\u8BC1 Token\"}),\"\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"\\u5BA2\\u6237\\u7AEF\\u5C06 Token \\u653E\\u5165\\u8BF7\\u6C42\\u5934\\uFF08\\u901A\\u5E38\\u662F \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"Authorization: Bearer <token>\"})})})}),\"\\uFF09\\u3002\"]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u670D\\u52A1\\u5668\\u62C6\\u5206 Token\\uFF0C\\u9A8C\\u8BC1 Signature \\u662F\\u5426\\u5339\\u914D\\u3002\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u68C0\\u67E5 Payload \\u4E2D\\u7684 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"exp\"})})})}),\" \\u662F\\u5426\\u8FC7\\u671F\\uFF0C\\u786E\\u8BA4\\u7528\\u6237\\u8EAB\\u4EFD\\u3002\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7528\\u4EE3\\u7801\\u8868\\u793A\\uFF08\\u4F2A\\u4EE3\\u7801\\uFF09\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u751F\\u6210 Token\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"function\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" generateToken\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"payload\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"secret\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" header\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { alg: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"HS256\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", typ: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"JWT\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" };\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" encodedHeader\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" base64UrlEncode\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(header));\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" encodedPayload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" base64UrlEncode\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(payload));\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" signature\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" hmacSha256\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"`${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedHeader\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}.${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedPayload\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", secret);\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  return\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" `${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedHeader\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}.${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedPayload\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}.${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"signature\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"}\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u9A8C\\u8BC1 Token\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"function\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" verifyToken\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"token\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"secret\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" [\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"encodedHeader\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"encodedPayload\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"signature\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"] \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" token.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"split\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\".\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" expectedSignature\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" hmacSha256\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"`${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedHeader\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}.${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"encodedPayload\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", secret);\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (signature \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"!==\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" expectedSignature) \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"throw\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Error\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"Invalid Token\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" JSON\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"parse\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"base64UrlDecode\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(encodedPayload));\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (payload.exp \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"<\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"throw\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Error\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"Token expired\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  return\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" payload;\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"}\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8FD9\\u5C31\\u50CF\\u5728\\u53D1\\u4E00\\u5F20\\u201C\\u9B54\\u6CD5\\u901A\\u884C\\u8BC1\\u201D\\uFF0C\\u5BA2\\u6237\\u7AEF\\u62FF\\u7740\\u5B83\\u6765\\u6572\\u95E8\\uFF0C\\u670D\\u52A1\\u5668\\u5F97\\u786E\\u8BA4\\u5B83\\u4E0D\\u662F\\u5047\\u7684 \\u{1F52E}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u7B7E\\u540D\\u5BC6\\u94A5\\u8981\\u59A5\\u5584\\u4FDD\\u7BA1\\uFF0C\\u6CC4\\u9732\\u5BC6\\u94A5\\u7B49\\u4E8E\\u628A\\u201C\\u9B54\\u6CD5\\u4E66\\u201D\\u9001\\u7ED9\\u654C\\u4EBA\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"33-\\u65E0\\u72B6\\u6001\\u8BA4\\u8BC1\\u7684\\u9B45\\u529B\",children:(0,e.jsx)(n.a,{href:\"#33-\\u65E0\\u72B6\\u6001\\u8BA4\\u8BC1\\u7684\\u9B45\\u529B\",children:\"3.3 \\u65E0\\u72B6\\u6001\\u8BA4\\u8BC1\\u7684\\u9B45\\u529B\"})}),`\n`,(0,e.jsx)(n.p,{children:\"JWT \\u7684\\u65E0\\u72B6\\u6001\\u6027\\u662F\\u5B83\\u7684\\u6740\\u624B\\u950F\\u3002\\u670D\\u52A1\\u5668\\u4E0D\\u9700\\u8981\\u5B58\\u50A8\\u4EFB\\u4F55\\u7528\\u6237\\u72B6\\u6001\\uFF0C\\u53EA\\u9700\\u9A8C\\u8BC1 Token \\u7B7E\\u540D\\u662F\\u5426\\u5408\\u6CD5\\u3002\\u8FD9\\u5E26\\u6765\\u7684\\u597D\\u5904\\u662F\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u5206\\u5E03\\u5F0F\\u53CB\\u597D\"}),\"\\uFF1A\\u591A\\u4E2A\\u670D\\u52A1\\u5668\\u65E0\\u9700\\u5171\\u4EAB Session \\u6570\\u636E\\uFF0C\\u8F7B\\u677E\\u5E94\\u5BF9\\u9AD8\\u5E76\\u53D1\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u5BA2\\u6237\\u7AEF\\u7075\\u6D3B\"}),\"\\uFF1AToken \\u53EF\\u4EE5\\u5B58\\u50A8\\u5728 LocalStorage\\u3001Cookie \\u751A\\u81F3 Header\\uFF0C\\u9002\\u914D\\u591A\\u79CD\\u573A\\u666F\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6027\\u80FD\\u9AD8\\u6548\"}),\"\\uFF1A\\u9A8C\\u8BC1 Token \\u53EA\\u9700\\u4E00\\u6B21\\u8BA1\\u7B97\\uFF0C\\u65E0\\u9700\\u67E5\\u6570\\u636E\\u5E93\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F46\\u65E0\\u72B6\\u6001\\u4E5F\\u6709\\u201C\\u526F\\u4F5C\\u7528\\u201D\\uFF1A\\u4E00\\u65E6 Token \\u53D1\\u51FA\\uFF0C\\u670D\\u52A1\\u5668\\u65E0\\u6CD5\\u4E3B\\u52A8\\u8BA9\\u5B83\\u5931\\u6548\\uFF08\\u9664\\u975E\\u7528\\u9ED1\\u540D\\u5355\\u673A\\u5236\\uFF09\\u3002\\u8FD9\\u5C31\\u50CF\\u4F60\\u53D1\\u4E86\\u4E00\\u5F20 VIP \\u5361\\uFF0C\\u5361\\u6CA1\\u8FC7\\u671F\\u524D\\uFF0C\\u6301\\u5361\\u4EBA\\u968F\\u65F6\\u80FD\\u8FDB\\u573A \\u{1F605}\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u4E3A Token \\u8BBE\\u7F6E\\u77ED\\u751F\\u547D\\u5468\\u671F\\uFF08\\u6BD4\\u5982 1 \\u5C0F\\u65F6\\uFF09\\uFF0C\\u5E76\\u914D\\u5408\\u5237\\u65B0\\u673A\\u5236\\uFF0C\\u517C\\u987E\\u5B89\\u5168\\u548C\\u4F53\\u9A8C\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"4-koa2--jwt-\\u5B9E\\u6218\\u4ECE\\u96F6\\u642D\\u5EFA-\",children:(0,e.jsx)(n.a,{href:\"#4-koa2--jwt-\\u5B9E\\u6218\\u4ECE\\u96F6\\u642D\\u5EFA-\",children:\"4. Koa2 + JWT \\u5B9E\\u6218\\uFF1A\\u4ECE\\u96F6\\u642D\\u5EFA \\u{1F680}\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u73B0\\u5728\\u8FDB\\u5165\\u91CD\\u5934\\u620F\\uFF01\\u6211\\u4EEC\\u5C06\\u7528 Koa2 \\u5B9E\\u73B0\\u4E00\\u4E2A\\u5B8C\\u6574\\u7684 JWT \\u9274\\u6743\\u7CFB\\u7EDF\\uFF0C\\u5305\\u62EC\\u7528\\u6237\\u767B\\u5F55\\u3001Token \\u751F\\u6210\\u3001\\u9A8C\\u8BC1\\u548C\\u4FDD\\u62A4\\u8DEF\\u7531\\u3002\"}),`\n`,(0,e.jsx)(n.h3,{id:\"41-\\u73AF\\u5883\\u642D\\u5EFA\",children:(0,e.jsx)(n.a,{href:\"#41-\\u73AF\\u5883\\u642D\\u5EFA\",children:\"4.1 \\u73AF\\u5883\\u642D\\u5EFA\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5148\\u521D\\u59CB\\u5316\\u4E00\\u4E2A Koa2 \\u9879\\u76EE\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"mkdir\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" koa2-jwt-demo\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"cd\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" koa2-jwt-demo\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"npm\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" init\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -y\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"npm\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" koa\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" koa-router\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" koa-bodyparser\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" jsonwebtoken\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" dotenv\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u76EE\\u5F55\\u7ED3\\u6784\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa2-jwt-demo/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 src/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 controllers/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u2502   \\u2514\\u2500\\u2500 auth.js\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 middleware/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u2502   \\u2514\\u2500\\u2500 jwt.js\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 routes/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u2502   \\u2514\\u2500\\u2500 index.js\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u2514\\u2500\\u2500 index.js\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 .env\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2514\\u2500\\u2500 package.json\"})})]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u521B\\u5EFA\\u4E00\\u4E2A \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\".env\"})})})}),\" \\u6587\\u4EF6\\uFF0C\\u5B58\\u50A8\\u5BC6\\u94A5\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"env\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"env\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"JWT_SECRET=your-very-secure-secret-key\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"PORT=3000\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u5BC6\\u94A5\\u8981\\u8DB3\\u591F\\u590D\\u6742\\uFF0C\\u81F3\\u5C11 32 \\u4F4D\\uFF0C\\u968F\\u673A\\u751F\\u6210\\u662F\\u6700\\u4F73\\u9009\\u62E9\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"42-\\u751F\\u6210\\u4E0E\\u9A8C\\u8BC1-token\",children:(0,e.jsx)(n.a,{href:\"#42-\\u751F\\u6210\\u4E0E\\u9A8C\\u8BC1-token\",children:\"4.2 \\u751F\\u6210\\u4E0E\\u9A8C\\u8BC1 Token\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"jsonwebtoken\"})})})}),\" \\u5E93\\u6765\\u751F\\u6210\\u548C\\u9A8C\\u8BC1 Token\\u3002\\u5148\\u5199\\u4E00\\u4E2A\\u7B80\\u5355\\u7684\\u767B\\u5F55\\u63A5\\u53E3\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/controllers/auth.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" jwt\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"jsonwebtoken\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"dotenv\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"config\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" login\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"username\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"password\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" ctx.request.body;\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"  // \\u6A21\\u62DF\\u7528\\u6237\\u9A8C\\u8BC1\\uFF08\\u5B9E\\u9645\\u9879\\u76EE\\u4E2D\\u5E94\\u67E5\\u6570\\u636E\\u5E93\\uFF09\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (username \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" &&\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" password \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"123456\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      userId: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      username,\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      role: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      iat: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"), \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u53D1\\u884C\\u65F6\\u95F4\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      exp: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// 1 \\u5C0F\\u65F6\\u540E\\u8FC7\\u671F\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" token\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(payload, process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"200\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u767B\\u5F55\\u6210\\u529F\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      data: { token },\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"else\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u7528\\u6237\\u540D\\u6216\\u5BC6\\u7801\\u9519\\u8BEF\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { login };\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8FD9\\u6BB5\\u4EE3\\u7801\\u6A21\\u62DF\\u4E86\\u4E00\\u4E2A\\u767B\\u5F55\\u903B\\u8F91\\uFF0C\\u5B9E\\u9645\\u9879\\u76EE\\u4E2D\\u4F60\\u9700\\u8981\\u8FDE\\u63A5\\u6570\\u636E\\u5E93\\u9A8C\\u8BC1\\u7528\\u6237\\u3002\\u751F\\u6210\\u7684 Token \\u5305\\u542B\\u7528\\u6237 ID\\u3001\\u89D2\\u8272\\u7B49\\u4FE1\\u606F\\uFF0C\\u5E76\\u8BBE\\u7F6E\\u4E86 1 \\u5C0F\\u65F6\\u7684\\u8FC7\\u671F\\u65F6\\u95F4\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1APayload \\u5C3D\\u91CF\\u7CBE\\u7B80\\uFF0C\\u53EA\\u653E\\u5FC5\\u8981\\u4FE1\\u606F\\uFF0C\\u51CF\\u5C11 Token \\u4F53\\u79EF\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"43-\\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\u9274\\u6743\",children:(0,e.jsx)(n.a,{href:\"#43-\\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\u9274\\u6743\",children:\"4.3 \\u4E2D\\u95F4\\u4EF6\\u5B9E\\u73B0\\u9274\\u6743\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u63A5\\u4E0B\\u6765\\u5199\\u4E00\\u4E2A JWT \\u9A8C\\u8BC1\\u4E2D\\u95F4\\u4EF6\\uFF0C\\u7528\\u4E8E\\u4FDD\\u62A4\\u9700\\u8981\\u767B\\u5F55\\u7684\\u8DEF\\u7531\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/middleware/jwt.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" jwt\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"jsonwebtoken\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"dotenv\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"config\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" verifyToken\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" token\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" ctx.headers.authorization?.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"split\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\" \"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\")[\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"]; \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u63D0\\u53D6 Bearer \\u540E\\u7684 Token\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"!\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"token) {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u672A\\u63D0\\u4F9B Token\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    return\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  try\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"verify\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(token, process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.state.user \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" payload; \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u5C06\\u7528\\u6237\\u4FE1\\u606F\\u6302\\u5230 ctx.state\\uFF0C\\u65B9\\u4FBF\\u540E\\u7EED\\u4F7F\\u7528\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    await\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"catch\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (err) {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: err.message \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"jwt expired\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" ?\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"Token \\u5DF2\\u8FC7\\u671F\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" :\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"\\u65E0\\u6548\\u7684 Token\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" verifyToken;\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8FD9\\u4E2A\\u4E2D\\u95F4\\u4EF6\\u4F1A\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"\\u4ECE\\u8BF7\\u6C42\\u5934\\u63D0\\u53D6 Token\\uFF08\\u683C\\u5F0F\\u4E3A \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"Authorization: Bearer <token>\"})})})}),\"\\uFF09\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"jwt.verify\"})})})}),\" \\u9A8C\\u8BC1 Token \\u7684\\u5408\\u6CD5\\u6027\\u548C\\u6709\\u6548\\u671F\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u5982\\u679C\\u9A8C\\u8BC1\\u901A\\u8FC7\\uFF0C\\u5C06 Payload \\u5B58\\u5230 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"ctx.state.user\"})})})}),\"\\uFF0C\\u4F9B\\u540E\\u7EED\\u8DEF\\u7531\\u4F7F\\u7528\\u3002\"]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5982\\u679C\\u9A8C\\u8BC1\\u5931\\u8D25\\uFF0C\\u8FD4\\u56DE 401 \\u9519\\u8BEF\\u3002\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u628A Token \\u653E\\u5728 Header \\u800C\\u4E0D\\u662F Cookie\\uFF0C\\u53EF\\u4EE5\\u66F4\\u597D\\u5730\\u9002\\u914D\\u524D\\u540E\\u7AEF\\u5206\\u79BB\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"44-\\u8DEF\\u7531\\u4E0E\\u4E3B\\u7A0B\\u5E8F\",children:(0,e.jsx)(n.a,{href:\"#44-\\u8DEF\\u7531\\u4E0E\\u4E3B\\u7A0B\\u5E8F\",children:\"4.4 \\u8DEF\\u7531\\u4E0E\\u4E3B\\u7A0B\\u5E8F\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u73B0\\u5728\\u628A\\u767B\\u5F55\\u548C\\u53D7\\u4FDD\\u62A4\\u7684\\u8DEF\\u7531\\u7EC4\\u7EC7\\u8D77\\u6765\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/routes/index.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" Router\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa-router\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"login\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"../controllers/auth\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" verifyToken\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"../middleware/jwt\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" router\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Router\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"post\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"/login\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", login);\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"get\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"/protected\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", verifyToken, \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"200\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u6B22\\u8FCE\\u8BBF\\u95EE\\u53D7\\u4FDD\\u62A4\\u7684\\u8D44\\u6E90\\uFF01\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    data: {\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      user: ctx.state.user,\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    },\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"});\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" router;\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E3B\\u7A0B\\u5E8F\\u5982\\u4E0B\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/index.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" Koa\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" bodyParser\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa-bodyparser\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" router\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"./routes\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" app\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Koa\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"bodyParser\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"routes\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"()).\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"allowedMethods\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" ||\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 3000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"listen\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  console.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"log\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"`Server running on http://localhost:${\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u542F\\u52A8\\u9879\\u76EE\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"node\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" src/index.js\"})]})})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u73B0\\u5728\\u53EF\\u4EE5\\u7528 Postman \\u6216 cURL \\u6D4B\\u8BD5\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"# \\u767B\\u5F55\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"curl\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -X\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" POST\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" http://localhost:3000/login\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -H\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"Content-Type: application/json\"'}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -d\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:` '{\"username\":\"admin\",\"password\":\"123456\"}'`})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"# \\u8BBF\\u95EE\\u53D7\\u4FDD\\u62A4\\u8DEF\\u7531\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"curl\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -X\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" GET\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\" http://localhost:3000/protected\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" -H\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"Authorization: Bearer <your-token>\"'})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5982\\u679C\\u4E00\\u5207\\u987A\\u5229\\uFF0C\\u767B\\u5F55\\u4F1A\\u8FD4\\u56DE\\u4E00\\u4E2A Token\\uFF0C\\u53D7\\u4FDD\\u62A4\\u8DEF\\u7531\\u4F1A\\u8FD4\\u56DE\\u7528\\u6237\\u4FE1\\u606F\\u3002\\u5426\\u5219\\uFF0C\\u4F60\\u4F1A\\u770B\\u5230 401 \\u9519\\u8BEF\\u63D0\\u793A\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u6D4B\\u8BD5\\u65F6\\u7528\\u5DE5\\u5177\\u6A21\\u62DF\\u8BF7\\u6C42\\uFF0C\\u522B\\u76F4\\u63A5\\u5728\\u6D4F\\u89C8\\u5668\\u6572 URL\\uFF0C\\u4E0D\\u7136\\u4F60\\u4F1A\\u53D1\\u73B0\\u81EA\\u5DF1\\u50CF\\u5728\\u548C\\u7A7A\\u6C14\\u6597\\u667A\\u6597\\u52C7\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"45-\\u9519\\u8BEF\\u5904\\u7406\\u4E0E\\u54CD\\u5E94\\u4F18\\u5316\",children:(0,e.jsx)(n.a,{href:\"#45-\\u9519\\u8BEF\\u5904\\u7406\\u4E0E\\u54CD\\u5E94\\u4F18\\u5316\",children:\"4.5 \\u9519\\u8BEF\\u5904\\u7406\\u4E0E\\u54CD\\u5E94\\u4F18\\u5316\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E0A\\u9762\\u7684\\u4EE3\\u7801\\u5DF2\\u7ECF\\u53EF\\u4EE5\\u5DE5\\u4F5C\\uFF0C\\u4F46\\u8FD8\\u6709\\u6539\\u8FDB\\u7A7A\\u95F4\\u3002\\u6BD4\\u5982\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u7EDF\\u4E00\\u54CD\\u5E94\\u683C\\u5F0F\\uFF0C\\u589E\\u52A0\\u9519\\u8BEF\\u65E5\\u5FD7\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/middleware/response.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" responseHandler\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  try\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    await\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" undefined\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 404\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"        code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"404\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"        message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u8D44\\u6E90\\u4E0D\\u5B58\\u5728\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"catch\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (err) {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    console.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"error\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u670D\\u52A1\\u5668\\u9519\\u8BEF:\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", err);\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" err.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"||\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 500\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: ctx.status,\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: err.message \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"||\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"\\u670D\\u52A1\\u5668\\u5185\\u90E8\\u9519\\u8BEF\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" responseHandler;\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u66F4\\u65B0\\u4E3B\\u7A0B\\u5E8F\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/index.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" Koa\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" bodyParser\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa-bodyparser\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" router\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"./routes\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" responseHandler\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"./middleware/response\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" app\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Koa\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(responseHandler);\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"bodyParser\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"routes\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"()).\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"allowedMethods\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" ||\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 3000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"listen\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  console.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"log\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"`Server running on http://localhost:${\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u73B0\\u5728\\uFF0C\\u6240\\u6709\\u63A5\\u53E3\\u90FD\\u4F1A\\u6709\\u7EDF\\u4E00\\u7684\\u54CD\\u5E94\\u683C\\u5F0F\\uFF0C\\u9519\\u8BEF\\u4E5F\\u4F1A\\u88AB\\u59A5\\u5584\\u8BB0\\u5F55\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u7EDF\\u4E00\\u54CD\\u5E94\\u683C\\u5F0F\\u53EF\\u4EE5\\u8BA9\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\u66F4\\u8F7B\\u677E\\u5730\\u5904\\u7406 API\\uFF0C\\u51CF\\u5C11\\u6C9F\\u901A\\u6210\\u672C\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"5-\\u9AD8\\u7EA7\\u8FDB\\u9636\\u4F18\\u5316\\u4E0E\\u5B89\\u5168\\u52A0\\u56FA-\\uFE0F\",children:(0,e.jsx)(n.a,{href:\"#5-\\u9AD8\\u7EA7\\u8FDB\\u9636\\u4F18\\u5316\\u4E0E\\u5B89\\u5168\\u52A0\\u56FA-\\uFE0F\",children:\"5. \\u9AD8\\u7EA7\\u8FDB\\u9636\\uFF1A\\u4F18\\u5316\\u4E0E\\u5B89\\u5168\\u52A0\\u56FA \\u{1F6E1}\\uFE0F\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"51-token-\\u5237\\u65B0\\u673A\\u5236\",children:(0,e.jsx)(n.a,{href:\"#51-token-\\u5237\\u65B0\\u673A\\u5236\",children:\"5.1 Token \\u5237\\u65B0\\u673A\\u5236\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Token \\u8FC7\\u671F\\u662F JWT \\u7684\\u5E38\\u89C1\\u95EE\\u9898\\u3002\\u5982\\u679C Token \\u751F\\u547D\\u5468\\u671F\\u592A\\u77ED\\uFF0C\\u7528\\u6237\\u53EF\\u80FD\\u9891\\u7E41\\u9700\\u8981\\u91CD\\u65B0\\u767B\\u5F55\\uFF1B\\u5982\\u679C\\u592A\\u957F\\uFF0C\\u53C8\\u6709\\u5B89\\u5168\\u98CE\\u9669\\u3002\\u89E3\\u51B3\\u529E\\u6CD5\\u662F\\u5F15\\u5165 \",(0,e.jsx)(n.strong,{children:\"Refresh Token\"}),\"\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u5B9E\\u73B0\\u601D\\u8DEF\"}),\"\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u767B\\u5F55\\u65F6\\uFF0C\\u540C\\u65F6\\u8FD4\\u56DE\\u4E00\\u4E2A Access Token\\uFF08\\u77ED\\u751F\\u547D\\u5468\\u671F\\uFF0C\\u6BD4\\u5982 1 \\u5C0F\\u65F6\\uFF09\\u548C\\u4E00\\u4E2A Refresh Token\\uFF08\\u957F\\u751F\\u547D\\u5468\\u671F\\uFF0C\\u6BD4\\u5982 7 \\u5929\\uFF09\\u3002\"}),`\n`,(0,e.jsx)(n.li,{children:\"Access Token \\u8FC7\\u671F\\u540E\\uFF0C\\u5BA2\\u6237\\u7AEF\\u7528 Refresh Token \\u8BF7\\u6C42\\u65B0\\u7684 Access Token\\u3002\"}),`\n`,(0,e.jsx)(n.li,{children:\"Refresh Token \\u5E94\\u5B58\\u50A8\\u5728\\u6570\\u636E\\u5E93\\uFF0C\\u5E76\\u652F\\u6301\\u5931\\u6548\\u673A\\u5236\\u3002\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u793A\\u4F8B\\u4EE3\\u7801\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/controllers/auth.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" jwt\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"jsonwebtoken\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"dotenv\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"config\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u6A21\\u62DF\\u6570\\u636E\\u5E93\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" refreshTokens\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Set\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" login\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"username\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"password\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" ctx.request.body;\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (username \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" &&\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" password \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"123456\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { userId: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", username, role: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" };\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" accessToken\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      { \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"...\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"payload, iat: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"), exp: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" },\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    );\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" refreshToken\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      { \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"...\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"payload, iat: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"), exp: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 7\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 24\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" },\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    );\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    refreshTokens.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"add\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(refreshToken); \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u5B58\\u50A8 Refresh Token\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"200\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u767B\\u5F55\\u6210\\u529F\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      data: { accessToken, refreshToken },\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"else\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u7528\\u6237\\u540D\\u6216\\u5BC6\\u7801\\u9519\\u8BEF\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" refresh\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"refreshToken\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" ctx.request.body;\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"!\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"refreshToken \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"||\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" !\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"refreshTokens.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"has\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(refreshToken)) {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u65E0\\u6548\\u7684 Refresh Token\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    return\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  try\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"verify\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(refreshToken, process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" newAccessToken\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      { userId: payload.userId, username: payload.username, role: payload.role, iat: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"), exp: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" },\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    );\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"200\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"Token \\u5237\\u65B0\\u6210\\u529F\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      data: { accessToken: newAccessToken },\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"catch\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (err) {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.status \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"401\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"Refresh Token \\u5DF2\\u8FC7\\u671F\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { login, refresh };\"})]})]})})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u66F4\\u65B0\\u8DEF\\u7531\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/routes/index.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"router.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"post\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"/refresh\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", refresh);\"})]})]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u73B0\\u5728\\u5BA2\\u6237\\u7AEF\\u53EF\\u4EE5\\u5728 Access Token \\u8FC7\\u671F\\u65F6\\uFF0C\\u901A\\u8FC7 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"/refresh\"})})})}),\" \\u63A5\\u53E3\\u83B7\\u53D6\\u65B0 Token\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1ARefresh Token \\u6700\\u597D\\u5B58\\u50A8\\u5728\\u6570\\u636E\\u5E93\\uFF0C\\u5E76\\u8BBE\\u7F6E\\u5931\\u6548\\u673A\\u5236\\uFF0C\\u9632\\u6B62\\u6EE5\\u7528\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"52-\\u9632\\u5FA1\\u5E38\\u89C1\\u653B\\u51FB\",children:(0,e.jsx)(n.a,{href:\"#52-\\u9632\\u5FA1\\u5E38\\u89C1\\u653B\\u51FB\",children:\"5.2 \\u9632\\u5FA1\\u5E38\\u89C1\\u653B\\u51FB\"})}),`\n`,(0,e.jsx)(n.p,{children:\"JWT \\u867D\\u7136\\u65B9\\u4FBF\\uFF0C\\u4F46\\u4E5F\\u5BB9\\u6613\\u6210\\u4E3A\\u653B\\u51FB\\u76EE\\u6807\\u3002\\u4EE5\\u4E0B\\u662F\\u51E0\\u79CD\\u5E38\\u89C1\\u5A01\\u80C1\\u53CA\\u9632\\u5FA1\\u63AA\\u65BD\\uFF1A\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"\\u5A01\\u80C1\\u7C7B\\u578B\"}),(0,e.jsx)(n.th,{children:\"\\u63CF\\u8FF0\"}),(0,e.jsx)(n.th,{children:\"\\u9632\\u5FA1\\u63AA\\u65BD\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"XSS\\uFF08\\u8DE8\\u7AD9\\u811A\\u672C\\u653B\\u51FB\\uFF09\"})}),(0,e.jsx)(n.td,{children:\"\\u653B\\u51FB\\u8005\\u7A83\\u53D6\\u5B58\\u50A8\\u5728 LocalStorage \\u7684 Token\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u4F7F\\u7528 HttpOnly Cookie \\u5B58\\u50A8 Token\\uFF0C\\u5F00\\u542F XSS \\u9632\\u62A4\\uFF08\\u5982 Content Security Policy\\uFF09\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"CSRF\\uFF08\\u8DE8\\u7AD9\\u8BF7\\u6C42\\u4F2A\\u9020\\uFF09\"})}),(0,e.jsx)(n.td,{children:\"\\u653B\\u51FB\\u8005\\u8BF1\\u5BFC\\u7528\\u6237\\u53D1\\u9001\\u6076\\u610F\\u8BF7\\u6C42\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u914D\\u5408 CSRF Token \\u6216 SameSite Cookie\\uFF0C\\u9650\\u5236\\u8DE8\\u57DF\\u8BF7\\u6C42\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Token \\u6CC4\\u9732\"})}),(0,e.jsx)(n.td,{children:\"Token \\u88AB\\u62E6\\u622A\\u6216\\u610F\\u5916\\u66B4\\u9732\\u3002\"}),(0,e.jsx)(n.td,{children:\"\\u4F7F\\u7528 HTTPS \\u52A0\\u5BC6\\u4F20\\u8F93\\uFF0C\\u8BBE\\u7F6E\\u77ED\\u751F\\u547D\\u5468\\u671F\\uFF0C\\u5B9A\\u671F\\u8F6E\\u6362\\u5BC6\\u94A5\\u3002\"})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"\\u91CD\\u653E\\u653B\\u51FB\"})}),(0,e.jsx)(n.td,{children:\"\\u653B\\u51FB\\u8005\\u91CD\\u590D\\u4F7F\\u7528\\u65E7 Token\\u3002\"}),(0,e.jsxs)(n.td,{children:[\"\\u5728 Payload \\u4E2D\\u52A0\\u5165\\u4E00\\u6B21\\u6027 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"nonce\"})})})}),\" \\u6216\\u65F6\\u95F4\\u6233\\uFF0C\\u9A8C\\u8BC1\\u540E\\u9500\\u6BC1\\u3002\"]})]})]})]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u793A\\u4F8B\\uFF1A\\u4E3A Token \\u6DFB\\u52A0 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"nonce\"})})})}),\" \\u9632\\u5FA1\\u91CD\\u653E\\u653B\\u51FB\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" login\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"username\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"password\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" } \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" ctx.request.body;\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (username \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" &&\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" password \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"123456\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" nonce\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"crypto\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"randomBytes\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"16\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"toString\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"hex\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"); \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u751F\\u6210\\u968F\\u673A nonce\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      userId: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      username,\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      role: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"admin\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      nonce,\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      iat: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"),\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"      exp: Math.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"floor\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(Date.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"/\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 1000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"+\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" *\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 60\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    };\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" token\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(payload, process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"    // \\u5B58\\u50A8 nonce \\u5230\\u6570\\u636E\\u5E93\\uFF08\\u6A21\\u62DF\\uFF09\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ctx.body \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { code: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"200\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", message: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"\\u767B\\u5F55\\u6210\\u529F\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", data: { token } };\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})})]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u9A8C\\u8BC1\\u65F6\\u68C0\\u67E5 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"nonce\"})})})}),\" \\u662F\\u5426\\u5339\\u914D\\u5E76\\u9500\\u6BC1\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u5B89\\u5168\\u65E0\\u5C0F\\u4E8B\\uFF0C\\u5B9A\\u671F\\u5BA1\\u8BA1\\u4EE3\\u7801\\uFF0C\\u5173\\u6CE8 OWASP Top 10 \\u6F0F\\u6D1E\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"53-\\u6027\\u80FD\\u4F18\\u5316\\u6280\\u5DE7\",children:(0,e.jsx)(n.a,{href:\"#53-\\u6027\\u80FD\\u4F18\\u5316\\u6280\\u5DE7\",children:\"5.3 \\u6027\\u80FD\\u4F18\\u5316\\u6280\\u5DE7\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5F53\\u7528\\u6237\\u91CF\\u589E\\u5927\\u65F6\\uFF0CJWT \\u9A8C\\u8BC1\\u53EF\\u80FD\\u6210\\u4E3A\\u6027\\u80FD\\u74F6\\u9888\\u3002\\u4EE5\\u4E0B\\u662F\\u4E00\\u4E9B\\u4F18\\u5316\\u5EFA\\u8BAE\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u51CF\\u5C11 Token \\u4F53\\u79EF\"}),\"\\uFF1APayload \\u53EA\\u5B58\\u5FC5\\u8981\\u5B57\\u6BB5\\uFF0C\\u7F29\\u77ED Base64 \\u7F16\\u7801\\u957F\\u5EA6\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u7F13\\u5B58\\u5BC6\\u94A5\"}),\"\\uFF1A\\u907F\\u514D\\u6BCF\\u6B21\\u9A8C\\u8BC1\\u90FD\\u8BFB\\u53D6\\u73AF\\u5883\\u53D8\\u91CF\\u6216\\u6570\\u636E\\u5E93\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u5F02\\u6B65\\u9A8C\\u8BC1\"}),\"\\uFF1A\\u5229\\u7528 Koa2 \\u7684 async/await\\uFF0C\\u907F\\u514D\\u963B\\u585E\\u4E3B\\u7EBF\\u7A0B\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u9650\\u6D41\\u4FDD\\u62A4\"}),\"\\uFF1A\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa-ratelimit\"})})})}),\" \\u9650\\u5236\\u6076\\u610F\\u8BF7\\u6C42\\uFF0C\\u4FDD\\u62A4\\u670D\\u52A1\\u5668\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u793A\\u4F8B\\uFF1A\\u6DFB\\u52A0\\u9650\\u6D41\\u4E2D\\u95F4\\u4EF6\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" rateLimit\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"koa-ratelimit\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"  rateLimit\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"({\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    driver: \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"memory\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    db: \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"new\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" Map\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    duration: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"60000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// 1 \\u5206\\u949F\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    max: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"100\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// \\u6700\\u591A 100 \\u6B21\\u8BF7\\u6C42\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  })\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u6027\\u80FD\\u4F18\\u5316\\u8981\\u7ED3\\u5408\\u76D1\\u63A7\\uFF0C\\u63A8\\u8350\\u7528 Prometheus \\u6216 New Relic \\u89C2\\u5BDF API \\u54CD\\u5E94\\u65F6\\u95F4\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"6-\\u6700\\u4F73\\u5B9E\\u8DF5\\u8BA9\\u4EE3\\u7801\\u66F4\\u4F18\\u96C5-\",children:(0,e.jsx)(n.a,{href:\"#6-\\u6700\\u4F73\\u5B9E\\u8DF5\\u8BA9\\u4EE3\\u7801\\u66F4\\u4F18\\u96C5-\",children:\"6. \\u6700\\u4F73\\u5B9E\\u8DF5\\uFF1A\\u8BA9\\u4EE3\\u7801\\u66F4\\u4F18\\u96C5 \\u{1F31F}\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"61-\\u7ED3\\u6784\\u5316\\u9879\\u76EE\\u76EE\\u5F55\",children:(0,e.jsx)(n.a,{href:\"#61-\\u7ED3\\u6784\\u5316\\u9879\\u76EE\\u76EE\\u5F55\",children:\"6.1 \\u7ED3\\u6784\\u5316\\u9879\\u76EE\\u76EE\\u5F55\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4E00\\u4E2A\\u6E05\\u6670\\u7684\\u76EE\\u5F55\\u7ED3\\u6784\\u80FD\\u8BA9\\u4F60\\u7684\\u4EE3\\u7801\\u770B\\u8D77\\u6765\\u50CF\\u4E00\\u672C\\u201C\\u6709\\u6761\\u7406\\u7684\\u9B54\\u6CD5\\u4E66\\u201D\\uFF1A\"}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa2-jwt-demo/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 src/\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 config/          # \\u914D\\u7F6E\\u6587\\u4EF6\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 controllers/     # \\u4E1A\\u52A1\\u903B\\u8F91\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 middleware/      # \\u4E2D\\u95F4\\u4EF6\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 models/          # \\u6570\\u636E\\u5E93\\u6A21\\u578B\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 routes/          # \\u8DEF\\u7531\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u251C\\u2500\\u2500 utils/           # \\u5DE5\\u5177\\u51FD\\u6570\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2502   \\u2514\\u2500\\u2500 index.js         # \\u5165\\u53E3\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 tests/               # \\u5355\\u5143\\u6D4B\\u8BD5\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 .env                 # \\u73AF\\u5883\\u53D8\\u91CF\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u251C\\u2500\\u2500 .gitignore\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"\\u2514\\u2500\\u2500 package.json\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u76EE\\u5F55\\u5206\\u5C42\\u8981\\u9002\\u5EA6\\uFF0C\\u8FC7\\u4E8E\\u590D\\u6742\\u53CD\\u800C\\u4F1A\\u589E\\u52A0\\u7EF4\\u62A4\\u6210\\u672C\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"62-\\u73AF\\u5883\\u53D8\\u91CF\\u7BA1\\u7406\",children:(0,e.jsx)(n.a,{href:\"#62-\\u73AF\\u5883\\u53D8\\u91CF\\u7BA1\\u7406\",children:\"6.2 \\u73AF\\u5883\\u53D8\\u91CF\\u7BA1\\u7406\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4F7F\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"dotenv\"})})})}),\" \\u7BA1\\u7406\\u73AF\\u5883\\u53D8\\u91CF\\uFF0C\\u5E76\\u4E3A\\u4E0D\\u540C\\u73AF\\u5883\\uFF08\\u5F00\\u53D1\\u3001\\u6D4B\\u8BD5\\u3001\\u751F\\u4EA7\\uFF09\\u8BBE\\u7F6E\\u4E0D\\u540C\\u7684\\u914D\\u7F6E\\u6587\\u4EF6\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#6A737D\"},children:\"// src/config/index.js\"})}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"dotenv\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\").\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"config\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"module\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"exports\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  jwtSecret: process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"JWT_SECRET\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  port: process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"PORT\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" ||\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" 3000\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  isProduction: process.env.\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"NODE_ENV\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" ===\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:' \"production\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"};\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsxs)(n.em,{children:[\"Tips\\uFF1A\\u6C38\\u8FDC\\u4E0D\\u8981\\u628A \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\".env\"})})})}),\" \\u6587\\u4EF6\\u63D0\\u4EA4\\u5230 Git\\uFF0C\\u52A0\\u5165 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\".gitignore\"})})})}),\" \\u662F\\u57FA\\u672C\\u64CD\\u4F5C\\uFF01\"]})})}),`\n`,(0,e.jsx)(n.h3,{id:\"63-\\u65E5\\u5FD7\\u4E0E\\u76D1\\u63A7\",children:(0,e.jsx)(n.a,{href:\"#63-\\u65E5\\u5FD7\\u4E0E\\u76D1\\u63A7\",children:\"6.3 \\u65E5\\u5FD7\\u4E0E\\u76D1\\u63A7\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4F7F\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"winston\"})})})}),\" \\u6216 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"pino\"})})})}),\" \\u8BB0\\u5F55\\u65E5\\u5FD7\\uFF0C\\u65B9\\u4FBF\\u8C03\\u8BD5\\u548C\\u6392\\u67E5\\u95EE\\u9898\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" pino\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"pino\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" logger\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" pino\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"async\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,e.jsx)(n.span,{style:{color:\"#FFAB70\"},children:\"next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  logger.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"info\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"`[${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"method\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}] ${\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"ctx\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\".\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"url\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:\"}`\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"  await\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" next\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u751F\\u4EA7\\u73AF\\u5883\\u5EFA\\u8BAE\\u7528\\u7ED3\\u6784\\u5316\\u65E5\\u5FD7\\uFF08JSON \\u683C\\u5F0F\\uFF09\\uFF0C\\u65B9\\u4FBF\\u65E5\\u5FD7\\u5206\\u6790\\u5DE5\\u5177\\u5904\\u7406\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"64-\\u5355\\u5143\\u6D4B\\u8BD5\",children:(0,e.jsx)(n.a,{href:\"#64-\\u5355\\u5143\\u6D4B\\u8BD5\",children:\"6.4 \\u5355\\u5143\\u6D4B\\u8BD5\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E3A\\u5173\\u952E\\u903B\\u8F91\\uFF08\\u5982 Token \\u751F\\u6210\\u548C\\u9A8C\\u8BC1\\uFF09\\u5199\\u5355\\u5143\\u6D4B\\u8BD5\\uFF0C\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"mocha\"})})})}),\" \\u6216 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"jest\"})})})}),\"\\uFF1A\"]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" jwt\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"jsonwebtoken\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" assert\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"assert\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"describe\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"JWT\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"  it\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"should generate valid token\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" payload\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" { userId: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" };\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" token\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"sign\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(payload, \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"secret\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" decoded\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" jwt.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"verify\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(token, \"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"secret\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"    assert.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"strictEqual\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(decoded.userId, \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"1\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"  });\"})}),`\n`,(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u6D4B\\u8BD5\\u8986\\u76D6\\u7387\\u4E0D\\u662F\\u8D8A\\u9AD8\\u8D8A\\u597D\\uFF0C\\u4F18\\u5148\\u8986\\u76D6\\u6838\\u5FC3\\u903B\\u8F91\\u548C\\u8FB9\\u754C\\u60C5\\u51B5\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"7-\\u5E38\\u89C1\\u95EE\\u9898\\u4E0E\\u89E3\\u51B3\\u65B9\\u6848-\",children:(0,e.jsx)(n.a,{href:\"#7-\\u5E38\\u89C1\\u95EE\\u9898\\u4E0E\\u89E3\\u51B3\\u65B9\\u6848-\",children:\"7. \\u5E38\\u89C1\\u95EE\\u9898\\u4E0E\\u89E3\\u51B3\\u65B9\\u6848 \\u2753\"})}),`\n`,(0,e.jsx)(n.h3,{id:\"71-token-\\u8FC7\\u671F\\u600E\\u4E48\\u529E\",children:(0,e.jsx)(n.a,{href:\"#71-token-\\u8FC7\\u671F\\u600E\\u4E48\\u529E\",children:\"7.1 Token \\u8FC7\\u671F\\u600E\\u4E48\\u529E\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u73B0\\u8C61\"}),\"\\uFF1A\\u7528\\u6237\\u6536\\u5230 401 \\u9519\\u8BEF\\uFF0C\\u63D0\\u793A Token \\u8FC7\\u671F\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u89E3\\u51B3\"}),\"\\uFF1A\\u5B9E\\u73B0 Refresh Token \\u673A\\u5236\\uFF08\\u5982\\u4E0A\\u6587\\u6240\\u8FF0\\uFF09\\uFF0C\\u6216\\u5F15\\u5BFC\\u7528\\u6237\\u91CD\\u65B0\\u767B\\u5F55\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u9884\\u9632\"}),\"\\uFF1A\\u524D\\u7AEF\\u53EF\\u4EE5\\u5728 Token \\u5FEB\\u8FC7\\u671F\\u65F6\\uFF08\\u6BD4\\u5982\\u8FD8\\u5269 5 \\u5206\\u949F\\uFF09\\u4E3B\\u52A8\\u5237\\u65B0\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u524D\\u7AEF\\u7528\\u62E6\\u622A\\u5668\\u7EDF\\u4E00\\u5904\\u7406 401 \\u9519\\u8BEF\\uFF0C\\u81EA\\u52A8\\u89E6\\u53D1\\u5237\\u65B0\\u903B\\u8F91\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"72-\\u5982\\u4F55\\u5904\\u7406\\u5927\\u89C4\\u6A21\\u7528\\u6237\",children:(0,e.jsx)(n.a,{href:\"#72-\\u5982\\u4F55\\u5904\\u7406\\u5927\\u89C4\\u6A21\\u7528\\u6237\",children:\"7.2 \\u5982\\u4F55\\u5904\\u7406\\u5927\\u89C4\\u6A21\\u7528\\u6237\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6311\\u6218\"}),\"\\uFF1A\\u9AD8\\u5E76\\u53D1\\u4E0B\\uFF0CToken \\u9A8C\\u8BC1\\u53EF\\u80FD\\u6210\\u4E3A\\u74F6\\u9888\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u89E3\\u51B3\"}),\"\\uFF1A\",`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u4F7F\\u7528\\u66F4\\u5FEB\\u7684\\u7B7E\\u540D\\u7B97\\u6CD5\\uFF08\\u5982 HS256 \\u800C\\u975E RS256\\uFF09\\u3002\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u90E8\\u7F72 Redis \\u7F13\\u5B58\\u5E38\\u7528 Token\\uFF08\\u9700\\u6743\\u8861\\u5B89\\u5168\\u6027\\uFF09\\u3002\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u4F7F\\u7528\\u8D1F\\u8F7D\\u5747\\u8861\\uFF0C\\u5206\\u6563\\u9A8C\\u8BC1\\u538B\\u529B\\u3002\"}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u5927\\u89C4\\u6A21\\u7CFB\\u7EDF\\u5EFA\\u8BAE\\u5F15\\u5165 API \\u7F51\\u5173\\uFF0C\\u7EDF\\u4E00\\u5904\\u7406\\u9274\\u6743\\uFF01\"})})}),`\n`,(0,e.jsx)(n.h3,{id:\"73-\\u8DE8\\u57DF\\u9274\\u6743\\u600E\\u4E48\\u641E\",children:(0,e.jsx)(n.a,{href:\"#73-\\u8DE8\\u57DF\\u9274\\u6743\\u600E\\u4E48\\u641E\",children:\"7.3 \\u8DE8\\u57DF\\u9274\\u6743\\u600E\\u4E48\\u641E\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u73B0\\u8C61\"}),\"\\uFF1A\\u524D\\u540E\\u7AEF\\u5206\\u79BB\\u65F6\\uFF0C\\u6D4F\\u89C8\\u5668\\u62A5 CORS \\u9519\\u8BEF\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u89E3\\u51B3\"}),\"\\uFF1A\\u7528 \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"koa-cors\"})})})}),\" \\u4E2D\\u95F4\\u4EF6\\u542F\\u7528\\u8DE8\\u57DF\\uFF1A\"]}),`\n`]}),`\n`,(0,e.jsx)(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,e.jsxs)(n.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\" cors\"}),(0,e.jsx)(n.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\" require\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#9ECBFF\"},children:'\"@koa/cors\"'}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,e.jsxs)(n.span,{\"data-line\":\"\",children:[(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"app.\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"use\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,e.jsx)(n.span,{style:{color:\"#B392F0\"},children:\"cors\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\"({ credentials: \"}),(0,e.jsx)(n.span,{style:{color:\"#79B8FF\"},children:\"true\"}),(0,e.jsx)(n.span,{style:{color:\"#E1E4E8\"},children:\" }));\"})]})]})})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u6CE8\\u610F\"}),\"\\uFF1A\\u8BBE\\u7F6E \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"Access-Control-Allow-Headers\"})})})}),\" \\u5305\\u542B \",(0,e.jsx)(n.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,e.jsx)(n.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,e.jsx)(n.span,{\"data-line\":\"\",children:(0,e.jsx)(n.span,{children:\"Authorization\"})})})}),\"\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:(0,e.jsx)(n.em,{children:\"Tips\\uFF1A\\u8DE8\\u57DF\\u914D\\u7F6E\\u8981\\u7CBE\\u786E\\uFF0C\\u907F\\u514D\\u5F00\\u653E\\u8FC7\\u591A\\u6743\\u9650\\u5BFC\\u81F4\\u5B89\\u5168\\u98CE\\u9669\\uFF01\"})})}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.h2,{id:\"8-\\u603B\\u7ED3\\u4E0E\\u5C55\\u671B-\",children:(0,e.jsx)(n.a,{href:\"#8-\\u603B\\u7ED3\\u4E0E\\u5C55\\u671B-\",children:\"8. \\u603B\\u7ED3\\u4E0E\\u5C55\\u671B \\u{1F680}\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u901A\\u8FC7\\u8FD9\\u7BC7\\u535A\\u5BA2\\uFF0C\\u6211\\u4EEC\\u4ECE JWT \\u7684\\u539F\\u7406\\u5230 Koa2 \\u7684\\u5B9E\\u6218\\uFF0C\\u5B8C\\u6574\\u8D70\\u4E86\\u4E00\\u904D\\u9274\\u6743\\u5B9E\\u73B0\\u7684\\u65C5\\u7A0B\\u3002JWT \\u5C31\\u50CF\\u4E00\\u628A\\u201C\\u65E0\\u5F62\\u7684\\u94A5\\u5319\\u201D\\uFF0C\\u65E2\\u8F7B\\u4FBF\\u53C8\\u5F3A\\u5927\\uFF0C\\u800C Koa2 \\u5219\\u662F\\u90A3\\u4E2A\\u8BA9\\u4F60\\u6325\\u6D12\\u81EA\\u5982\\u7684\\u201C\\u9B54\\u6CD5\\u753B\\u5E03\\u201D\\u3002\\u5E0C\\u671B\\u4F60\\u4E0D\\u4EC5\\u5B66\\u4F1A\\u4E86\\u4EE3\\u7801\\uFF0C\\u8FD8\\u611F\\u53D7\\u5230 Web \\u5B89\\u5168\\u7684\\u9B45\\u529B\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"\\u672A\\u6765\\u5C55\\u671B\"}),\"\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"JWT \\u7684\\u8FDB\\u5316\"}),\"\\uFF1A\\u968F\\u7740 Web \\u5B89\\u5168\\u9700\\u6C42\\u7684\\u589E\\u957F\\uFF0CJWT \\u53EF\\u80FD\\u4F1A\\u4E0E\\u66F4\\u5148\\u8FDB\\u7684\\u6807\\u51C6\\uFF08\\u5982 WebAuthn\\uFF09\\u7ED3\\u5408\\uFF0C\\u63D0\\u4F9B\\u66F4\\u5F3A\\u7684\\u8BA4\\u8BC1\\u80FD\\u529B\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Koa2 \\u7684\\u6F5C\\u529B\"}),\"\\uFF1A\\u4F5C\\u4E3A\\u5168\\u6808\\u5F00\\u53D1\\u7684\\u5229\\u5668\\uFF0CKoa2 \\u5728 Serverless \\u548C\\u5FAE\\u670D\\u52A1\\u67B6\\u6784\\u4E2D\\u4ECD\\u6709\\u5E7F\\u9614\\u7A7A\\u95F4\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"\\u5168\\u6808\\u89C6\\u91CE\"}),\"\\uFF1A\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\u638C\\u63E1 JWT \\u548C Koa2\\uFF0C\\u4E0D\\u4EC5\\u80FD\\u5199\\u51FA\\u66F4\\u5B89\\u5168\\u7684\\u4EE3\\u7801\\uFF0C\\u8FD8\\u80FD\\u66F4\\u597D\\u5730\\u4E0E\\u540E\\u7AEF\\u534F\\u4F5C\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6700\\u540E\\uFF0C\\u9001\\u4F60\\u4E00\\u53E5\\u201C\\u9AD8\\u7EA7\\u51B7\\u7B11\\u8BDD\\u201D\\uFF1A\\u4E3A\\u4EC0\\u4E48 JWT \\u603B\\u662F\\u90A3\\u4E48\\u81EA\\u4FE1\\uFF1F\\u56E0\\u4E3A\\u5B83\\u77E5\\u9053\\uFF0C\\u53EA\\u8981\\u6709\\u7B7E\\u540D\\uFF0C\\u5B83\\u5C31\\u662F\\u201C\\u771F\\u7684\\u201D\\uFF01\\u{1F60E}\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"\\u60F3\\u6DF1\\u5165\\u5B66\\u4E60\\uFF1F\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"\\u67E5\\u770B \",(0,e.jsx)(n.a,{href:\"https://github.com/auth0/node-jsonwebtoken\",children:\"jsonwebtoken\"}),\" \\u5B98\\u65B9\\u6587\\u6863\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u63A2\\u7D22 \",(0,e.jsx)(n.a,{href:\"https://koajs.com/\",children:\"Koa2 \\u5B98\\u7F51\"}),\" \\u7684\\u4E2D\\u95F4\\u4EF6\\u751F\\u6001\"]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u5173\\u6CE8 OWASP \\u5B89\\u5168\\u6307\\u5357\\uFF0C\\u5199\\u51FA\\u66F4\\u5B89\\u5168\\u7684\\u4EE3\\u7801\"}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5E0C\\u671B\\u8FD9\\u7BC7\\u6587\\u7AE0\\u80FD\\u6210\\u4E3A\\u4F60\\u5168\\u6808\\u8DEF\\u4E0A\\u7684\\u201C\\u9B54\\u6CD5\\u624B\\u518C\\u201D\\uFF0C\\u968F\\u65F6\\u7FFB\\u5F00\\uFF0C\\u968F\\u65F6\\u542F\\u53D1\\uFF01\\u2728\"}),`\n`,(0,e.jsx)(n.hr,{})]})}function h(l={}){let{wrapper:n}=l.components||{};return n?(0,e.jsx)(n,{...l,children:(0,e.jsx)(t,{...l})}):t(l)}return T(f);})();\n;return Component;"
  },
  "_id": "Node.js/Koa2å¦‚ä½•å®ç°JWTé‰´æƒ.mdx",
  "_raw": {
    "sourceFilePath": "Node.js/Koa2å¦‚ä½•å®ç°JWTé‰´æƒ.mdx",
    "sourceFileName": "Koa2å¦‚ä½•å®ç°JWTé‰´æƒ.mdx",
    "sourceFileDir": "Node.js",
    "contentType": "mdx",
    "flattenedPath": "Node.js/Koa2å¦‚ä½•å®ç°JWTé‰´æƒ"
  },
  "type": "Post",
  "url": "/blog/Node.js/Koa2å¦‚ä½•å®ç°JWTé‰´æƒ"
}