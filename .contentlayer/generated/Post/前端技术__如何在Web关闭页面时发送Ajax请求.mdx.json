{
  "title": "å¦‚ä½•åœ¨ Web å…³é—­é¡µé¢æ—¶å‘é€ Ajax è¯·æ±‚ï¼Ÿ",
  "date": "2023-02-19T00:00:00.000Z",
  "description": "æ·±å…¥æŽ¢è®¨å¦‚ä½•åœ¨ç”¨æˆ·å…³é—­é¡µé¢æ—¶ä¼˜é›…åœ°å‘é€ Ajax è¯·æ±‚ï¼Œæ¶µç›–åŽŸç†ã€å®žçŽ°æ–¹æ¡ˆã€æœ€ä½³å®žè·µä¸Žæ³¨æ„äº‹é¡¹ï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘è€…åº”å¯¹å¤æ‚åœºæ™¯ã€‚",
  "keywords": "Ajax, Web å…³é—­é¡µé¢, beforeunload, sendBeacon, å‰ç«¯å¼€å‘, JavaScript, ç½‘ç»œè¯·æ±‚, äº‹ä»¶ç›‘å¬",
  "author": "æ™“é¾™",
  "image": "/images/hero/ajax-on-close.jpg",
  "tags": [
    "JavaScript",
    "Web å¼€å‘",
    "å‰ç«¯ä¼˜åŒ–"
  ],
  "views": 0,
  "likes": 0,
  "category": "å‰ç«¯æŠ€æœ¯",
  "body": {
    "raw": "\nä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„éœ€æ±‚ï¼šç”¨æˆ·å…³é—­é¡µé¢æ—¶ï¼Œéœ€è¦æ‚„æ‚„åœ°å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œè®°å½•ç‚¹ä»€ä¹ˆï¼Œæ¯”å¦‚â€œç”¨æˆ·è·‘è·¯äº†â€æˆ–è€…â€œä¼šè¯ç»“æŸäº†â€ï¼Ÿå¬èµ·æ¥ç®€å•ï¼Œä½†å®žé™…æ“ä½œèµ·æ¥å´åƒæ˜¯åœ¨å’Œæµè§ˆå™¨çŽ©ä¸€åœºâ€œçŒ«æ‰è€é¼ â€çš„æ¸¸æˆ ðŸ±ðŸ­ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å½»åº•æ‹†è§£è¿™ä¸ªåœºæ™¯ï¼ŒèŠèŠå¦‚ä½•ä¼˜é›…åœ°å®žçŽ°è¿™ä¸ªåŠŸèƒ½ï¼Œæ·±å…¥åŽŸç†ï¼Œå¸¦ä¸Šä»£ç ç¤ºä¾‹ï¼Œå†é™„èµ ä¸€äº›å®žæˆ˜å° tipsï¼Œè®©ä½ ä¸‹æ¬¡é¢å¯¹è¿™ç§éœ€æ±‚æ—¶èƒ¸æœ‰æˆç«¹ã€‚\n\n## ä¸ºä»€ä¹ˆè¿™äº‹å„¿ä¸ç®€å•ï¼Ÿ\n\nåœ¨ Web å¼€å‘ä¸­ï¼Œå‘é€ Ajax è¯·æ±‚é€šå¸¸æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œç”¨ `fetch` æˆ–è€… `XMLHttpRequest` éšä¾¿ä¸€å†™å°±æžå®šã€‚ä½†å½“é¡µé¢å…³é—­æ—¶ï¼Œäº‹æƒ…å°±å˜å¾—æ£˜æ‰‹äº†ã€‚æµè§ˆå™¨å¯ä¸æ˜¯ä½ çš„å¥½å…„å¼Ÿï¼Œå®ƒä¸ä¼šä¹–ä¹–ç­‰ç€ä½ çš„è¯·æ±‚å‘å®Œå†å…³é—¨èµ°äººã€‚ç›¸åï¼Œå®ƒæ›´åƒä¸ªæ€¥æ€§å­çš„å¿«é€’å‘˜ï¼šåŒ…è£¹ï¼ˆé¡µé¢ï¼‰ä¸€æ‰”ï¼Œç«‹é©¬è·‘è·¯ï¼Œæ ¹æœ¬ä¸ç®¡ä½ çš„è¯·æ±‚è¿˜åœ¨åŠè·¯ä¸Šæ™ƒè¡ã€‚\n\nè¿™èƒŒåŽçš„åŽŸå› æ˜¯ï¼Œæµè§ˆå™¨åœ¨é¡µé¢å¸è½½ï¼ˆunloadï¼‰æ—¶ä¼šè¿…é€Ÿç»ˆæ­¢æ‰€æœ‰æœªå®Œæˆçš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç½‘ç»œè¯·æ±‚ã€‚è¿™ç§è¡Œä¸ºæ˜¯ä¸ºäº†ä¿è¯å…³é—­é¡µé¢çš„é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒï¼Œä½†å¯¹æˆ‘ä»¬å¼€å‘è€…æ¥è¯´ï¼Œå´æ˜¯ä¸ªä¸å°çš„å‘ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨è¿™çŸ­æš‚çš„â€œå‘Šåˆ«æ—¶åˆ»â€é‡Œå¡žè¿›ä¸€ä¸ª Ajax è¯·æ±‚å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ­å¼€ç­”æ¡ˆã€‚\n\n## æ–¹æ¡ˆä¸€ï¼šç›‘å¬ `beforeunload` äº‹ä»¶ + ä¼ ç»Ÿ Ajax\n\næœ€ç›´è§‚çš„æ€è·¯æ˜¯åˆ©ç”¨ `beforeunload` äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶ä¼šåœ¨é¡µé¢å³å°†å¸è½½æ—¶è§¦å‘ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ªâ€œä¸´ç»ˆé—è¨€â€çš„æœºä¼šã€‚æ¥çœ‹çœ‹æ€Žä¹ˆå®žçŽ°ï¼š\n\n```javascript\nwindow.addEventListener('beforeunload', () => {\n  const xhr = new XMLHttpRequest();\n  xhr.open('POST', '/api/log-exit', true);\n  xhr.setRequestHeader('Content-Type', 'application/json');\n  xhr.send(JSON.stringify({ message: 'ç”¨æˆ·è·‘è·¯å•¦ï¼' }));\n});\n```\n\n### åŽŸç†å‰–æž\n`beforeunload` æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œé€šå¸¸ç”¨äºŽæé†’ç”¨æˆ·â€œä½ æœ‰æœªä¿å­˜çš„å†…å®¹å“¦ï¼Œç¡®å®šè¦èµ°å—ï¼Ÿâ€ã€‚å®ƒçš„è§¦å‘æ—¶æœºåœ¨é¡µé¢å…³é—­æˆ–åˆ·æ–°ä¹‹å‰ï¼Œç†è®ºä¸Šæ˜¯ä¸ªå‘é€è¯·æ±‚çš„å¥½åœ°æ–¹ã€‚ä½†é—®é¢˜æ¥äº†ï¼šæµè§ˆå™¨å¹¶ä¸ä¼šä¿è¯ä½ çš„ Ajax è¯·æ±‚èƒ½å‘å‡ºåŽ»ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º `XMLHttpRequest` æ˜¯å¼‚æ­¥çš„ï¼Œè€Œé¡µé¢å¸è½½æ˜¯ä¸ªâ€œèµ¶æ—¶é—´â€çš„è¿‡ç¨‹ï¼Œæµè§ˆå™¨å¯èƒ½åœ¨è¯·æ±‚å‘å‡ºåŽç«‹åˆ»å…³é—­é¡µé¢ï¼Œå¯¼è‡´è¯·æ±‚è¢«å–æ¶ˆã€‚\n\n### æµ‹è¯•ä¸€ä¸‹\nè¯•è¯•ä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šå‘çŽ°ç»“æžœå¾ˆéšæœºã€‚æœ‰æ—¶å€™è¯·æ±‚èƒ½å‘å‡ºåŽ»ï¼Œæœ‰æ—¶å€™å°±åƒæ‰”è¿›é»‘æ´žçš„ä¿¡ï¼Œè¿žä¸ªå›žéŸ³éƒ½æ²¡æœ‰ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨å®žçŽ°çš„ä¸ä¸€è‡´æ€§ï¼ˆæ˜¯çš„ï¼ŒChromeã€Safariã€Firefox åˆåŒå’å•ä¸ç»Ÿä¸€äº† ðŸ¤¦â€â™‚ï¸ï¼‰ã€‚\n\n### å° Tips\n- **åŒæ­¥è¯·æ±‚è¡Œä¸è¡Œï¼Ÿ** å¯ä»¥è¯•è¯•æŠŠ `xhr.open` çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ä¸º `false`ï¼Œå¼ºåˆ¶åŒæ­¥è¯·æ±‚ã€‚ä½†çŽ°ä»£æµè§ˆå™¨å¯¹åŒæ­¥è¯·æ±‚çš„æ”¯æŒè¶Šæ¥è¶Šå·®ï¼Œç”šè‡³ä¼šæŠ›è­¦å‘Šï¼Œæ€§èƒ½ä¹Ÿä¸å‹å¥½ï¼Œæ…Žç”¨ï¼\n- **åŠ ä¸ªä¿é™©**ï¼šåœ¨ `beforeunload` ä¸­è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ `return \"ç¡®å®šè¦èµ°å—ï¼Ÿ\"`ï¼‰ï¼Œä¼šå¼¹ç¡®è®¤æ¡†ï¼Œç»™è¯·æ±‚äº‰å–ç‚¹æ—¶é—´ã€‚ä¸è¿‡ï¼Œç”¨æˆ·ä½“éªŒä¼šå˜å·®ï¼Œæ…Žé‡è€ƒè™‘ã€‚\n\n## æ–¹æ¡ˆäºŒï¼š`navigator.sendBeacon` â€”â€” æµè§ˆå™¨çš„å°ç¤¼ç‰© ðŸŽ\n\næ—¢ç„¶ä¼ ç»Ÿ Ajax ä¸é è°±ï¼Œæµè§ˆå™¨è€å¤§å“¥ç»™æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªä¸“é—¨çš„å·¥å…·ï¼š`navigator.sendBeacon`ã€‚è¿™çŽ©æ„å„¿ç®€ç›´æ˜¯ä¸ºâ€œä¸´ç»ˆè¯·æ±‚â€é‡èº«æ‰“é€ çš„ã€‚\n\n```javascript\nwindow.addEventListener('beforeunload', () => {\n  const data = new Blob([JSON.stringify({ message: 'å†è§ï¼Œæˆ‘èµ°å•¦ï¼' })], {\n    type: 'application/json',\n  });\n  navigator.sendBeacon('/api/log-exit', data);\n});\n```\n\n### ä¸ºä»€ä¹ˆå®ƒæ›´ç‰›ï¼Ÿ\n`sendBeacon` çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºŽï¼Œå®ƒå°†è¯·æ±‚äº¤ç»™æµè§ˆå™¨çš„åŽŸç”Ÿé˜Ÿåˆ—å¤„ç†ã€‚å³ä½¿é¡µé¢å·²ç»å…³é—­ï¼Œæµè§ˆå™¨ä¹Ÿä¼šåœ¨åŽå°é»˜é»˜å®Œæˆå‘é€ï¼Œä¸ä¼šè¢«ç²—æš´æ‰“æ–­ã€‚æ¯”å–»ä¸€ä¸‹ï¼Œä¼ ç»Ÿ Ajax åƒæ˜¯ä½ åœ¨ç«è½¦ç«™å°ä¸Šå–Šè¯ï¼Œè½¦é—¨ä¸€å…³å°±æ²¡æˆäº†ï¼›è€Œ `sendBeacon` åƒæ˜¯ä½ æå‰æŠŠä¿¡å¡žè¿›äº†é‚®ç­’ï¼Œç«è½¦å¼€èµ°åŽé‚®å·®ç…§æ ·é€ã€‚\n\n### æ·±å…¥åŽŸç†\n- **å¼‚æ­¥ä½†å¯é **ï¼š`sendBeacon` æ˜¯å¼‚æ­¥çš„ï¼Œä½†å®ƒä¸ä¼šé˜»å¡žé¡µé¢å…³é—­ï¼Œè€Œæ˜¯äº¤ç»™æµè§ˆå™¨å†…æ ¸çš„ç½‘ç»œå±‚åŽ»å¤„ç†ã€‚\n- **é™åˆ¶å°‘**ï¼šä¸åƒ `XMLHttpRequest`ï¼Œå®ƒä¸éœ€è¦ä¿æŒé¡µé¢æ´»è·ƒï¼Œå¤©ç„¶é€‚åˆâ€œå…³é—¨è¯·æ±‚â€ã€‚\n- **æ•°æ®æ ¼å¼**ï¼šæ”¯æŒ `Blob`ã€`FormData` ç­‰æ ¼å¼ï¼Œçµæ´»æ€§æ‹‰æ»¡ã€‚\n\n### ç¤ºä¾‹æ‰©å±•ï¼šè®°å½•ç”¨æˆ·åœç•™æ—¶é—´\nå‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·ç¦»å¼€æ—¶è®°å½•é¡µé¢åœç•™æ—¶é—´ï¼š\n\n```javascript\nconst startTime = Date.now();\nwindow.addEventListener('beforeunload', () => {\n  const stayTime = Date.now() - startTime;\n  const formData = new FormData();\n  formData.append('stayTime', stayTime);\n  formData.append('page', window.location.pathname);\n  navigator.sendBeacon('/api/track', formData);\n});\n```\n\næœåŠ¡å™¨æ”¶åˆ°åŽï¼Œå°±èƒ½åˆ†æžç”¨æˆ·è¡Œä¸ºï¼Œç®€ç›´ä¸è¦å¤ªé¦™ï¼\n\n### å° Tips\n- **æ£€æŸ¥å…¼å®¹æ€§**ï¼š`sendBeacon` åœ¨çŽ°ä»£æµè§ˆå™¨ï¼ˆChrome 39+ã€Firefox 31+ã€Safari 11.1+ï¼‰éƒ½æ”¯æŒï¼Œä½†è€å¤è‘£ï¼ˆå¦‚ IEï¼‰ä¸è¡Œã€‚å¯ä»¥ç”¨ `if ('sendBeacon' in navigator)` åˆ¤æ–­ã€‚\n- **æ•°æ®å¤§å°é™åˆ¶**ï¼šè¯·æ±‚ payload ä¸€èˆ¬å»ºè®®æŽ§åˆ¶åœ¨ 64KB å†…ï¼Œè¶…è¿‡å¯èƒ½è¢«æˆªæ–­ã€‚\n- **è°ƒè¯•æŠ€å·§**ï¼šå› ä¸ºå®ƒæ˜¯åŽå°å‘é€ï¼Œå¼€å‘è€…å·¥å…·é‡Œå¯èƒ½çœ‹ä¸åˆ°è¯·æ±‚ã€‚å¯ä»¥åœ¨æœåŠ¡å™¨æ—¥å¿—é‡ŒéªŒè¯ã€‚\n\n## æ–¹æ¡ˆä¸‰ï¼šç»“åˆ `visibilitychange` åšä¸ªåŒä¿é™©\n\nå…‰é  `beforeunload` å’Œ `sendBeacon` è¿˜ä¸å¤Ÿç¨³ï¼Ÿé‚£æˆ‘ä»¬å†åŠ ä¸€å±‚é˜²æŠ¤ç½‘ï¼š`visibilitychange` äº‹ä»¶ã€‚å®ƒä¼šåœ¨é¡µé¢å¯è§æ€§å˜åŒ–æ—¶è§¦å‘ï¼Œæ¯”å¦‚ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µæˆ–æœ€å°åŒ–çª—å£ã€‚\n\n```javascript\nlet hasSent = false;\ndocument.addEventListener('visibilitychange', () => {\n  if (document.visibilityState === 'hidden' && !hasSent) {\n    navigator.sendBeacon('/api/log-exit', JSON.stringify({ event: 'hidden' }));\n    hasSent = true; // é¿å…é‡å¤å‘é€\n  }\n});\n\nwindow.addEventListener('beforeunload', () => {\n  if (!hasSent) {\n    navigator.sendBeacon('/api/log-exit', JSON.stringify({ event: 'unload' }));\n  }\n});\n```\n\n### ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ\nç”¨æˆ·ä¸ä¸€å®šä¼šç›´æŽ¥å…³é—­é¡µé¢ï¼Œå¯èƒ½å…ˆåˆ‡æ¢æ ‡ç­¾é¡µå†å›žæ¥ã€‚`visibilitychange` èƒ½æå‰æ•èŽ·è¿™ç§â€œåŠç¦»åœºâ€çŠ¶æ€ï¼Œç»“åˆ `beforeunload`ï¼Œå½¢æˆåŒé‡ä¿éšœã€‚å°±åƒæ‰“æ¸¸æˆå¼€åŒBUFFï¼Œç¨³ä¸­æ±‚èƒœï¼\n\n### å° Tips\n- **åŽ»é‡é€»è¾‘**ï¼šç”¨ `hasSent` æ ‡å¿—ä½é˜²æ­¢é‡å¤å‘é€ï¼Œä¸ç„¶æœåŠ¡å™¨å¯èƒ½ä¼šè¢«ä½ çš„â€œçƒ­æƒ…â€æ·¹æ²¡ã€‚\n- **åœºæ™¯é€‚é…**ï¼šå¦‚æžœåªæ˜¯è®°å½•â€œå½»åº•ç¦»å¼€â€ï¼Œå¯ä»¥åªç”¨ `beforeunload`ï¼›å¦‚æžœå…³å¿ƒâ€œä¸´æ—¶ç¦»å¼€â€ï¼ŒåŠ  `visibilitychange` æ›´å…¨é¢ã€‚\n\n## æœ€ä½³å®žè·µï¼šæ‰“é€ ä¸€ä¸ªå¥å£®çš„é€€å‡ºæ—¥å¿—ç³»ç»Ÿ\n\nå…‰ä¼šå‘è¯·æ±‚è¿˜ä¸å¤Ÿï¼Œå’±ä»¬å¾—æŠŠæ´»å¹²æ¼‚äº®ï¼ä»¥ä¸‹æ˜¯ä¸€äº›å®žæˆ˜å»ºè®®ï¼š\n\n1. **ä¼˜é›…é™çº§**\n   ```javascript\n   window.addEventListener('beforeunload', () => {\n     const data = JSON.stringify({ message: 'å†è§å•¦' });\n     if ('sendBeacon' in navigator) {\n       navigator.sendBeacon('/api/log-exit', data);\n     } else {\n       fetch('/api/log-exit', { method: 'POST', body: data, keepalive: true });\n     }\n   });\n   ```\n   - **è§£æž**ï¼šç”¨ `sendBeacon` ä¼˜å…ˆï¼Œfallback åˆ° `fetch` çš„ `keepalive` æ¨¡å¼ï¼ˆChrome 66+ æ”¯æŒï¼‰ï¼ŒåŒä¿é™©ã€‚\n   - **Tips**ï¼š`keepalive: true` èƒ½è®©è¯·æ±‚åœ¨é¡µé¢å…³é—­åŽç»§ç»­å­˜æ´»ï¼Œä½†æ•°æ®é‡é™åˆ¶æ›´ä¸¥æ ¼ï¼ˆé€šå¸¸ 64KBï¼‰ã€‚\n\n2. **æ‰¹é‡å‘é€**\n   å¦‚æžœéœ€è¦å‘é€å¤šæ¡æ•°æ®ï¼Œåˆ«ä¸€æ¡æ¡å‘ï¼Œæ”’ä¸€æ³¢ä¸€èµ·é€ï¼š\n   ```javascript\n   const logs = [];\n   function logEvent(event) {\n     logs.push(event);\n   }\n   window.addEventListener('beforeunload', () => {\n     navigator.sendBeacon('/api/batch-log', JSON.stringify(logs));\n   });\n   ```\n\n3. **é”™è¯¯å¤„ç†**\n   å› ä¸º `sendBeacon` ä¸è¿”å›ž Promiseï¼Œæ²¡æ³•ç›´æŽ¥æ•èŽ·å¤±è´¥ã€‚ä½†å¯ä»¥åœ¨å‘é€å‰åšæ ¡éªŒï¼š\n   ```javascript\n   window.addEventListener('beforeunload', () => {\n     try {\n       const data = JSON.stringify({ message: 'bye' });\n       if (data.length > 60000) throw new Error('æ•°æ®å¤ªå¤§å•¦ï¼');\n       navigator.sendBeacon('/api/log-exit', data);\n     } catch (e) {\n       console.error('å‘é€å¤±è´¥ï¼š', e);\n     }\n   });\n   ```\n\n4. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**\n   åˆ«åœ¨ `beforeunload` é‡Œå¹²å¤ªå¤šæ‚æ´»ï¼Œä¿æŒè½»é‡ã€‚ç”¨æˆ·å…³é¡µé¢æ—¶æœ€è®¨åŽŒå¡é¡¿ï¼Œåƒæžäº†è¶…å¸‚ç»“è´¦æ—¶æ”¶é“¶å‘˜ç£¨è¹­çš„æ„Ÿè§‰ã€‚\n\n## æ³¨æ„äº‹é¡¹ï¼šåˆ«è¸©è¿™äº›å‘ï¼\n\n- **ä¸è¦æŒ‡æœ›è¿”å›žå€¼**ï¼š`sendBeacon` æ˜¯å•å‘çš„ï¼Œåˆ«æƒ³ç€æœåŠ¡å™¨å›žä¸ªâ€œæ”¶åˆ°â€ï¼Œå®ƒåŽ‹æ ¹ä¸careã€‚\n- **é¿å…å¤æ‚è®¡ç®—**ï¼šé¡µé¢å…³é—­å‰çš„ä»£ç è¦å¿«ï¼Œåˆ«åœ¨è¿™æ—¶å€™ç®—ä»€ä¹ˆæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚\n- **æµ‹è¯•çŽ¯å¢ƒå·®å¼‚**ï¼šå¼€å‘æ—¶ç”¨ `localhost` æµ‹è¯•å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†çº¿ä¸Š HTTPS çŽ¯å¢ƒå¯èƒ½æœ‰è·¨åŸŸé™åˆ¶ï¼Œæå‰é…å¥½ CORSã€‚\n\n## å¹½é»˜ç»“å°¾ï¼šæµè§ˆå™¨ä¸æ˜¯ä½ å¦ˆï¼Œä½†ä¹Ÿèƒ½å¸®ä½ é€ä¿¡\n\nå®žçŽ°â€œå…³é—­é¡µé¢å‘é€ Ajaxâ€è¿™äº‹å„¿ï¼Œå°±åƒè·Ÿæµè§ˆå™¨è°ˆæ¡ä»¶ï¼šä½ å¾—å¿«ã€å‡†ã€ç‹ ï¼Œè¿˜è¦æ‡‚å®ƒçš„è„¾æ°”ã€‚`beforeunload` æ˜¯è€æ´¾åšæ³•ï¼Œå¶å°”é è°±ï¼›`sendBeacon` æ˜¯æ–°å® ï¼Œç¨³å¦‚è€ç‹—ï¼›åŠ ä¸Š `visibilitychange`ï¼Œç®€ç›´æ˜¯ä¸‰å‰‘å®¢é½ä¸Šé˜µã€‚å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®ä½ åœ¨ä¸‹æ¬¡éœ€æ±‚é‡Œå¤§å±•èº«æ‰‹ï¼Œåˆ«è®©äº§å“ç»ç†æŠ“ç€ä½ é—®ï¼šâ€œä¸ºå•¥æ•°æ®æ²¡è®°ä¸‹æ¥ï¼Ÿâ€ ðŸ˜œ\n\næœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…æ›´éªšçš„æ“ä½œï¼Œæ¬¢è¿Žç•™è¨€ï¼Œå’±ä»¬ä¸€èµ·æŽ¢è®¨ï¼æ¯•ç«Ÿï¼Œå‰ç«¯çš„ä¸–ç•Œé‡Œï¼Œå‘å¤šä¹è¶£ä¹Ÿå¤šï¼Œå¯¹å§ï¼Ÿ\n\n--- ",
    "code": "var Component=(()=>{var p=Object.create;var d=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var F=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),f=(l,e)=>{for(var a in e)d(l,a,{get:e[a],enumerable:!0})},t=(l,e,a,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of y(e))!u.call(l,r)&&r!==a&&d(l,r,{get:()=>e[r],enumerable:!(c=E(e,r))||c.enumerable});return l};var B=(l,e,a)=>(a=l!=null?p(g(l)):{},t(e||!l||!l.__esModule?d(a,\"default\",{value:l,enumerable:!0}):a,l)),b=l=>t(d({},\"__esModule\",{value:!0}),l);var s=F((v,i)=>{i.exports=_jsx_runtime});var x={};f(x,{default:()=>h,frontmatter:()=>m});var n=B(s()),m={type:\"Post\",title:\"\\u5982\\u4F55\\u5728 Web \\u5173\\u95ED\\u9875\\u9762\\u65F6\\u53D1\\u9001 Ajax \\u8BF7\\u6C42\\uFF1F\",date:\"2023-02-19\",description:\"\\u6DF1\\u5165\\u63A2\\u8BA8\\u5982\\u4F55\\u5728\\u7528\\u6237\\u5173\\u95ED\\u9875\\u9762\\u65F6\\u4F18\\u96C5\\u5730\\u53D1\\u9001 Ajax \\u8BF7\\u6C42\\uFF0C\\u6DB5\\u76D6\\u539F\\u7406\\u3001\\u5B9E\\u73B0\\u65B9\\u6848\\u3001\\u6700\\u4F73\\u5B9E\\u8DF5\\u4E0E\\u6CE8\\u610F\\u4E8B\\u9879\\uFF0C\\u52A9\\u529B\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\u5E94\\u5BF9\\u590D\\u6742\\u573A\\u666F\\u3002\",keywords:\"Ajax, Web \\u5173\\u95ED\\u9875\\u9762, beforeunload, sendBeacon, \\u524D\\u7AEF\\u5F00\\u53D1, JavaScript, \\u7F51\\u7EDC\\u8BF7\\u6C42, \\u4E8B\\u4EF6\\u76D1\\u542C\",author:\"\\u6653\\u9F99\",image:\"/images/hero/ajax-on-close.jpg\",tags:[\"JavaScript\",\"Web \\u5F00\\u53D1\",\"\\u524D\\u7AEF\\u4F18\\u5316\"],category:\"\\u524D\\u7AEF\\u6280\\u672F\"};function o(l){let e={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",h3:\"h3\",hr:\"hr\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...l.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"\\u4F5C\\u4E3A\\u524D\\u7AEF\\u5F00\\u53D1\\u8005\\uFF0C\\u4F60\\u662F\\u5426\\u9047\\u5230\\u8FC7\\u8FD9\\u6837\\u7684\\u9700\\u6C42\\uFF1A\\u7528\\u6237\\u5173\\u95ED\\u9875\\u9762\\u65F6\\uFF0C\\u9700\\u8981\\u6084\\u6084\\u5730\\u53D1\\u9001\\u4E00\\u4E2A\\u8BF7\\u6C42\\u5230\\u670D\\u52A1\\u5668\\uFF0C\\u8BB0\\u5F55\\u70B9\\u4EC0\\u4E48\\uFF0C\\u6BD4\\u5982\\u201C\\u7528\\u6237\\u8DD1\\u8DEF\\u4E86\\u201D\\u6216\\u8005\\u201C\\u4F1A\\u8BDD\\u7ED3\\u675F\\u4E86\\u201D\\uFF1F\\u542C\\u8D77\\u6765\\u7B80\\u5355\\uFF0C\\u4F46\\u5B9E\\u9645\\u64CD\\u4F5C\\u8D77\\u6765\\u5374\\u50CF\\u662F\\u5728\\u548C\\u6D4F\\u89C8\\u5668\\u73A9\\u4E00\\u573A\\u201C\\u732B\\u6349\\u8001\\u9F20\\u201D\\u7684\\u6E38\\u620F \\u{1F431}\\u{1F42D}\\u3002\\u4ECA\\u5929\\uFF0C\\u6211\\u4EEC\\u5C31\\u6765\\u5F7B\\u5E95\\u62C6\\u89E3\\u8FD9\\u4E2A\\u573A\\u666F\\uFF0C\\u804A\\u804A\\u5982\\u4F55\\u4F18\\u96C5\\u5730\\u5B9E\\u73B0\\u8FD9\\u4E2A\\u529F\\u80FD\\uFF0C\\u6DF1\\u5165\\u539F\\u7406\\uFF0C\\u5E26\\u4E0A\\u4EE3\\u7801\\u793A\\u4F8B\\uFF0C\\u518D\\u9644\\u8D60\\u4E00\\u4E9B\\u5B9E\\u6218\\u5C0F tips\\uFF0C\\u8BA9\\u4F60\\u4E0B\\u6B21\\u9762\\u5BF9\\u8FD9\\u79CD\\u9700\\u6C42\\u65F6\\u80F8\\u6709\\u6210\\u7AF9\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u4E8B\\u513F\\u4E0D\\u7B80\\u5355\",children:(0,n.jsx)(e.a,{href:\"#\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u4E8B\\u513F\\u4E0D\\u7B80\\u5355\",children:\"\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u4E8B\\u513F\\u4E0D\\u7B80\\u5355\\uFF1F\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5728 Web \\u5F00\\u53D1\\u4E2D\\uFF0C\\u53D1\\u9001 Ajax \\u8BF7\\u6C42\\u901A\\u5E38\\u662F\\u5BB6\\u5E38\\u4FBF\\u996D\\uFF0C\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"fetch\"})})})}),\" \\u6216\\u8005 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"XMLHttpRequest\"})})})}),\" \\u968F\\u4FBF\\u4E00\\u5199\\u5C31\\u641E\\u5B9A\\u3002\\u4F46\\u5F53\\u9875\\u9762\\u5173\\u95ED\\u65F6\\uFF0C\\u4E8B\\u60C5\\u5C31\\u53D8\\u5F97\\u68D8\\u624B\\u4E86\\u3002\\u6D4F\\u89C8\\u5668\\u53EF\\u4E0D\\u662F\\u4F60\\u7684\\u597D\\u5144\\u5F1F\\uFF0C\\u5B83\\u4E0D\\u4F1A\\u4E56\\u4E56\\u7B49\\u7740\\u4F60\\u7684\\u8BF7\\u6C42\\u53D1\\u5B8C\\u518D\\u5173\\u95E8\\u8D70\\u4EBA\\u3002\\u76F8\\u53CD\\uFF0C\\u5B83\\u66F4\\u50CF\\u4E2A\\u6025\\u6027\\u5B50\\u7684\\u5FEB\\u9012\\u5458\\uFF1A\\u5305\\u88F9\\uFF08\\u9875\\u9762\\uFF09\\u4E00\\u6254\\uFF0C\\u7ACB\\u9A6C\\u8DD1\\u8DEF\\uFF0C\\u6839\\u672C\\u4E0D\\u7BA1\\u4F60\\u7684\\u8BF7\\u6C42\\u8FD8\\u5728\\u534A\\u8DEF\\u4E0A\\u6643\\u8361\\u3002\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD9\\u80CC\\u540E\\u7684\\u539F\\u56E0\\u662F\\uFF0C\\u6D4F\\u89C8\\u5668\\u5728\\u9875\\u9762\\u5378\\u8F7D\\uFF08unload\\uFF09\\u65F6\\u4F1A\\u8FC5\\u901F\\u7EC8\\u6B62\\u6240\\u6709\\u672A\\u5B8C\\u6210\\u7684\\u4EFB\\u52A1\\uFF0C\\u5305\\u62EC\\u7F51\\u7EDC\\u8BF7\\u6C42\\u3002\\u8FD9\\u79CD\\u884C\\u4E3A\\u662F\\u4E3A\\u4E86\\u4FDD\\u8BC1\\u5173\\u95ED\\u9875\\u9762\\u7684\\u901F\\u5EA6\\u548C\\u7528\\u6237\\u4F53\\u9A8C\\uFF0C\\u4F46\\u5BF9\\u6211\\u4EEC\\u5F00\\u53D1\\u8005\\u6765\\u8BF4\\uFF0C\\u5374\\u662F\\u4E2A\\u4E0D\\u5C0F\\u7684\\u5751\\u3002\\u90A3\\u4E48\\uFF0C\\u5982\\u4F55\\u5728\\u8FD9\\u77ED\\u6682\\u7684\\u201C\\u544A\\u522B\\u65F6\\u523B\\u201D\\u91CC\\u585E\\u8FDB\\u4E00\\u4E2A Ajax \\u8BF7\\u6C42\\u5462\\uFF1F\\u8BA9\\u6211\\u4EEC\\u4E00\\u6B65\\u6B65\\u63ED\\u5F00\\u7B54\\u6848\\u3002\"}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u65B9\\u6848\\u4E00\\u76D1\\u542C-beforeunload-\\u4E8B\\u4EF6--\\u4F20\\u7EDF-ajax\",children:(0,n.jsxs)(e.a,{href:\"#\\u65B9\\u6848\\u4E00\\u76D1\\u542C-beforeunload-\\u4E8B\\u4EF6--\\u4F20\\u7EDF-ajax\",children:[\"\\u65B9\\u6848\\u4E00\\uFF1A\\u76D1\\u542C \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u4E8B\\u4EF6 + \\u4F20\\u7EDF Ajax\"]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u6700\\u76F4\\u89C2\\u7684\\u601D\\u8DEF\\u662F\\u5229\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u4E8B\\u4EF6\\u3002\\u8FD9\\u4E2A\\u4E8B\\u4EF6\\u4F1A\\u5728\\u9875\\u9762\\u5373\\u5C06\\u5378\\u8F7D\\u65F6\\u89E6\\u53D1\\uFF0C\\u7ED9\\u6211\\u4EEC\\u4E00\\u4E2A\\u201C\\u4E34\\u7EC8\\u9057\\u8A00\\u201D\\u7684\\u673A\\u4F1A\\u3002\\u6765\\u770B\\u770B\\u600E\\u4E48\\u5B9E\\u73B0\\uFF1A\"]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" xhr\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" XMLHttpRequest\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  xhr.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"open\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'POST'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"true\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  xhr.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"setRequestHeader\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'Content-Type'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'application/json'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  xhr.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"send\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ message: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'\\u7528\\u6237\\u8DD1\\u8DEF\\u5566\\uFF01'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" }));\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u539F\\u7406\\u5256\\u6790\",children:(0,n.jsx)(e.a,{href:\"#\\u539F\\u7406\\u5256\\u6790\",children:\"\\u539F\\u7406\\u5256\\u6790\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u662F\\u6D4F\\u89C8\\u5668\\u63D0\\u4F9B\\u7684\\u4E00\\u4E2A\\u751F\\u547D\\u5468\\u671F\\u4E8B\\u4EF6\\uFF0C\\u901A\\u5E38\\u7528\\u4E8E\\u63D0\\u9192\\u7528\\u6237\\u201C\\u4F60\\u6709\\u672A\\u4FDD\\u5B58\\u7684\\u5185\\u5BB9\\u54E6\\uFF0C\\u786E\\u5B9A\\u8981\\u8D70\\u5417\\uFF1F\\u201D\\u3002\\u5B83\\u7684\\u89E6\\u53D1\\u65F6\\u673A\\u5728\\u9875\\u9762\\u5173\\u95ED\\u6216\\u5237\\u65B0\\u4E4B\\u524D\\uFF0C\\u7406\\u8BBA\\u4E0A\\u662F\\u4E2A\\u53D1\\u9001\\u8BF7\\u6C42\\u7684\\u597D\\u5730\\u65B9\\u3002\\u4F46\\u95EE\\u9898\\u6765\\u4E86\\uFF1A\\u6D4F\\u89C8\\u5668\\u5E76\\u4E0D\\u4F1A\\u4FDD\\u8BC1\\u4F60\\u7684 Ajax \\u8BF7\\u6C42\\u80FD\\u53D1\\u51FA\\u53BB\\u3002\\u4E3A\\u4EC0\\u4E48\\uFF1F\\u56E0\\u4E3A \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"XMLHttpRequest\"})})})}),\" \\u662F\\u5F02\\u6B65\\u7684\\uFF0C\\u800C\\u9875\\u9762\\u5378\\u8F7D\\u662F\\u4E2A\\u201C\\u8D76\\u65F6\\u95F4\\u201D\\u7684\\u8FC7\\u7A0B\\uFF0C\\u6D4F\\u89C8\\u5668\\u53EF\\u80FD\\u5728\\u8BF7\\u6C42\\u53D1\\u51FA\\u540E\\u7ACB\\u523B\\u5173\\u95ED\\u9875\\u9762\\uFF0C\\u5BFC\\u81F4\\u8BF7\\u6C42\\u88AB\\u53D6\\u6D88\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u6D4B\\u8BD5\\u4E00\\u4E0B\",children:(0,n.jsx)(e.a,{href:\"#\\u6D4B\\u8BD5\\u4E00\\u4E0B\",children:\"\\u6D4B\\u8BD5\\u4E00\\u4E0B\"})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8BD5\\u8BD5\\u4E0A\\u9762\\u7684\\u4EE3\\u7801\\uFF0C\\u4F60\\u4F1A\\u53D1\\u73B0\\u7ED3\\u679C\\u5F88\\u968F\\u673A\\u3002\\u6709\\u65F6\\u5019\\u8BF7\\u6C42\\u80FD\\u53D1\\u51FA\\u53BB\\uFF0C\\u6709\\u65F6\\u5019\\u5C31\\u50CF\\u6254\\u8FDB\\u9ED1\\u6D1E\\u7684\\u4FE1\\uFF0C\\u8FDE\\u4E2A\\u56DE\\u97F3\\u90FD\\u6CA1\\u6709\\u3002\\u8FD9\\u662F\\u56E0\\u4E3A\\u6D4F\\u89C8\\u5668\\u5B9E\\u73B0\\u7684\\u4E0D\\u4E00\\u81F4\\u6027\\uFF08\\u662F\\u7684\\uFF0CChrome\\u3001Safari\\u3001Firefox \\u53C8\\u53CC\\u53D2\\u53D5\\u4E0D\\u7EDF\\u4E00\\u4E86 \\u{1F926}\\u200D\\u2642\\uFE0F\\uFF09\\u3002\"}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u5C0F-tips\",children:(0,n.jsx)(e.a,{href:\"#\\u5C0F-tips\",children:\"\\u5C0F Tips\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u540C\\u6B65\\u8BF7\\u6C42\\u884C\\u4E0D\\u884C\\uFF1F\"}),\" \\u53EF\\u4EE5\\u8BD5\\u8BD5\\u628A \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"xhr.open\"})})})}),\" \\u7684\\u7B2C\\u4E09\\u4E2A\\u53C2\\u6570\\u8BBE\\u4E3A \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"false\"})})})}),\"\\uFF0C\\u5F3A\\u5236\\u540C\\u6B65\\u8BF7\\u6C42\\u3002\\u4F46\\u73B0\\u4EE3\\u6D4F\\u89C8\\u5668\\u5BF9\\u540C\\u6B65\\u8BF7\\u6C42\\u7684\\u652F\\u6301\\u8D8A\\u6765\\u8D8A\\u5DEE\\uFF0C\\u751A\\u81F3\\u4F1A\\u629B\\u8B66\\u544A\\uFF0C\\u6027\\u80FD\\u4E5F\\u4E0D\\u53CB\\u597D\\uFF0C\\u614E\\u7528\\uFF01\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u52A0\\u4E2A\\u4FDD\\u9669\"}),\"\\uFF1A\\u5728 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u4E2D\\u8FD4\\u56DE\\u4E00\\u4E2A\\u5B57\\u7B26\\u4E32\\uFF08\\u6BD4\\u5982 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:'return \"\\u786E\\u5B9A\\u8981\\u8D70\\u5417\\uFF1F\"'})})})}),\"\\uFF09\\uFF0C\\u4F1A\\u5F39\\u786E\\u8BA4\\u6846\\uFF0C\\u7ED9\\u8BF7\\u6C42\\u4E89\\u53D6\\u70B9\\u65F6\\u95F4\\u3002\\u4E0D\\u8FC7\\uFF0C\\u7528\\u6237\\u4F53\\u9A8C\\u4F1A\\u53D8\\u5DEE\\uFF0C\\u614E\\u91CD\\u8003\\u8651\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u65B9\\u6848\\u4E8Cnavigatorsendbeacon--\\u6D4F\\u89C8\\u5668\\u7684\\u5C0F\\u793C\\u7269-\",children:(0,n.jsxs)(e.a,{href:\"#\\u65B9\\u6848\\u4E8Cnavigatorsendbeacon--\\u6D4F\\u89C8\\u5668\\u7684\\u5C0F\\u793C\\u7269-\",children:[\"\\u65B9\\u6848\\u4E8C\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"navigator.sendBeacon\"})})})}),\" \\u2014\\u2014 \\u6D4F\\u89C8\\u5668\\u7684\\u5C0F\\u793C\\u7269 \\u{1F381}\"]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u65E2\\u7136\\u4F20\\u7EDF Ajax \\u4E0D\\u9760\\u8C31\\uFF0C\\u6D4F\\u89C8\\u5668\\u8001\\u5927\\u54E5\\u7ED9\\u6211\\u4EEC\\u51C6\\u5907\\u4E86\\u4E00\\u4E2A\\u4E13\\u95E8\\u7684\\u5DE5\\u5177\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"navigator.sendBeacon\"})})})}),\"\\u3002\\u8FD9\\u73A9\\u610F\\u513F\\u7B80\\u76F4\\u662F\\u4E3A\\u201C\\u4E34\\u7EC8\\u8BF7\\u6C42\\u201D\\u91CF\\u8EAB\\u6253\\u9020\\u7684\\u3002\"]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" data\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" Blob\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"([\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ message: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'\\u518D\\u89C1\\uFF0C\\u6211\\u8D70\\u5566\\uFF01'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" })], {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    type: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'application/json'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  });\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", data);\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u4E3A\\u4EC0\\u4E48\\u5B83\\u66F4\\u725B\",children:(0,n.jsx)(e.a,{href:\"#\\u4E3A\\u4EC0\\u4E48\\u5B83\\u66F4\\u725B\",children:\"\\u4E3A\\u4EC0\\u4E48\\u5B83\\u66F4\\u725B\\uFF1F\"})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u7684\\u6838\\u5FC3\\u4F18\\u52BF\\u5728\\u4E8E\\uFF0C\\u5B83\\u5C06\\u8BF7\\u6C42\\u4EA4\\u7ED9\\u6D4F\\u89C8\\u5668\\u7684\\u539F\\u751F\\u961F\\u5217\\u5904\\u7406\\u3002\\u5373\\u4F7F\\u9875\\u9762\\u5DF2\\u7ECF\\u5173\\u95ED\\uFF0C\\u6D4F\\u89C8\\u5668\\u4E5F\\u4F1A\\u5728\\u540E\\u53F0\\u9ED8\\u9ED8\\u5B8C\\u6210\\u53D1\\u9001\\uFF0C\\u4E0D\\u4F1A\\u88AB\\u7C97\\u66B4\\u6253\\u65AD\\u3002\\u6BD4\\u55BB\\u4E00\\u4E0B\\uFF0C\\u4F20\\u7EDF Ajax \\u50CF\\u662F\\u4F60\\u5728\\u706B\\u8F66\\u7AD9\\u53F0\\u4E0A\\u558A\\u8BDD\\uFF0C\\u8F66\\u95E8\\u4E00\\u5173\\u5C31\\u6CA1\\u620F\\u4E86\\uFF1B\\u800C \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u50CF\\u662F\\u4F60\\u63D0\\u524D\\u628A\\u4FE1\\u585E\\u8FDB\\u4E86\\u90AE\\u7B52\\uFF0C\\u706B\\u8F66\\u5F00\\u8D70\\u540E\\u90AE\\u5DEE\\u7167\\u6837\\u9001\\u3002\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u6DF1\\u5165\\u539F\\u7406\",children:(0,n.jsx)(e.a,{href:\"#\\u6DF1\\u5165\\u539F\\u7406\",children:\"\\u6DF1\\u5165\\u539F\\u7406\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u5F02\\u6B65\\u4F46\\u53EF\\u9760\"}),\"\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u662F\\u5F02\\u6B65\\u7684\\uFF0C\\u4F46\\u5B83\\u4E0D\\u4F1A\\u963B\\u585E\\u9875\\u9762\\u5173\\u95ED\\uFF0C\\u800C\\u662F\\u4EA4\\u7ED9\\u6D4F\\u89C8\\u5668\\u5185\\u6838\\u7684\\u7F51\\u7EDC\\u5C42\\u53BB\\u5904\\u7406\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u9650\\u5236\\u5C11\"}),\"\\uFF1A\\u4E0D\\u50CF \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"XMLHttpRequest\"})})})}),\"\\uFF0C\\u5B83\\u4E0D\\u9700\\u8981\\u4FDD\\u6301\\u9875\\u9762\\u6D3B\\u8DC3\\uFF0C\\u5929\\u7136\\u9002\\u5408\\u201C\\u5173\\u95E8\\u8BF7\\u6C42\\u201D\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u6570\\u636E\\u683C\\u5F0F\"}),\"\\uFF1A\\u652F\\u6301 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"Blob\"})})})}),\"\\u3001\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"FormData\"})})})}),\" \\u7B49\\u683C\\u5F0F\\uFF0C\\u7075\\u6D3B\\u6027\\u62C9\\u6EE1\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u793A\\u4F8B\\u6269\\u5C55\\u8BB0\\u5F55\\u7528\\u6237\\u505C\\u7559\\u65F6\\u95F4\",children:(0,n.jsx)(e.a,{href:\"#\\u793A\\u4F8B\\u6269\\u5C55\\u8BB0\\u5F55\\u7528\\u6237\\u505C\\u7559\\u65F6\\u95F4\",children:\"\\u793A\\u4F8B\\u6269\\u5C55\\uFF1A\\u8BB0\\u5F55\\u7528\\u6237\\u505C\\u7559\\u65F6\\u95F4\"})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5047\\u8BBE\\u4F60\\u60F3\\u5728\\u7528\\u6237\\u79BB\\u5F00\\u65F6\\u8BB0\\u5F55\\u9875\\u9762\\u505C\\u7559\\u65F6\\u95F4\\uFF1A\"}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" startTime\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" Date.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" stayTime\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" Date.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"now\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"-\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" startTime;\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" formData\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" FormData\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  formData.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"append\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'stayTime'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", stayTime);\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  formData.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"append\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'page'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", window.location.pathname);\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/track'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", formData);\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u670D\\u52A1\\u5668\\u6536\\u5230\\u540E\\uFF0C\\u5C31\\u80FD\\u5206\\u6790\\u7528\\u6237\\u884C\\u4E3A\\uFF0C\\u7B80\\u76F4\\u4E0D\\u8981\\u592A\\u9999\\uFF01\"}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u5C0F-tips-1\",children:(0,n.jsx)(e.a,{href:\"#\\u5C0F-tips-1\",children:\"\\u5C0F Tips\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u68C0\\u67E5\\u517C\\u5BB9\\u6027\"}),\"\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u5728\\u73B0\\u4EE3\\u6D4F\\u89C8\\u5668\\uFF08Chrome 39+\\u3001Firefox 31+\\u3001Safari 11.1+\\uFF09\\u90FD\\u652F\\u6301\\uFF0C\\u4F46\\u8001\\u53E4\\u8463\\uFF08\\u5982 IE\\uFF09\\u4E0D\\u884C\\u3002\\u53EF\\u4EE5\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"if ('sendBeacon' in navigator)\"})})})}),\" \\u5224\\u65AD\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u6570\\u636E\\u5927\\u5C0F\\u9650\\u5236\"}),\"\\uFF1A\\u8BF7\\u6C42 payload \\u4E00\\u822C\\u5EFA\\u8BAE\\u63A7\\u5236\\u5728 64KB \\u5185\\uFF0C\\u8D85\\u8FC7\\u53EF\\u80FD\\u88AB\\u622A\\u65AD\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u8C03\\u8BD5\\u6280\\u5DE7\"}),\"\\uFF1A\\u56E0\\u4E3A\\u5B83\\u662F\\u540E\\u53F0\\u53D1\\u9001\\uFF0C\\u5F00\\u53D1\\u8005\\u5DE5\\u5177\\u91CC\\u53EF\\u80FD\\u770B\\u4E0D\\u5230\\u8BF7\\u6C42\\u3002\\u53EF\\u4EE5\\u5728\\u670D\\u52A1\\u5668\\u65E5\\u5FD7\\u91CC\\u9A8C\\u8BC1\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u65B9\\u6848\\u4E09\\u7ED3\\u5408-visibilitychange-\\u505A\\u4E2A\\u53CC\\u4FDD\\u9669\",children:(0,n.jsxs)(e.a,{href:\"#\\u65B9\\u6848\\u4E09\\u7ED3\\u5408-visibilitychange-\\u505A\\u4E2A\\u53CC\\u4FDD\\u9669\",children:[\"\\u65B9\\u6848\\u4E09\\uFF1A\\u7ED3\\u5408 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"visibilitychange\"})})})}),\" \\u505A\\u4E2A\\u53CC\\u4FDD\\u9669\"]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5149\\u9760 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u548C \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u8FD8\\u4E0D\\u591F\\u7A33\\uFF1F\\u90A3\\u6211\\u4EEC\\u518D\\u52A0\\u4E00\\u5C42\\u9632\\u62A4\\u7F51\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"visibilitychange\"})})})}),\" \\u4E8B\\u4EF6\\u3002\\u5B83\\u4F1A\\u5728\\u9875\\u9762\\u53EF\\u89C1\\u6027\\u53D8\\u5316\\u65F6\\u89E6\\u53D1\\uFF0C\\u6BD4\\u5982\\u7528\\u6237\\u5207\\u6362\\u6807\\u7B7E\\u9875\\u6216\\u6700\\u5C0F\\u5316\\u7A97\\u53E3\\u3002\"]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"let\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" hasSent \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" false\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"document.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'visibilitychange'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" (document.visibilityState \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"===\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" 'hidden'\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" &&\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" !\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"hasSent) {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ event: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'hidden'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" }));\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    hasSent \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" true\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"// \\u907F\\u514D\\u91CD\\u590D\\u53D1\\u9001\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"!\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"hasSent) {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ event: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'unload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" }));\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u6837\\u505A\",children:(0,n.jsx)(e.a,{href:\"#\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u6837\\u505A\",children:\"\\u4E3A\\u4EC0\\u4E48\\u8FD9\\u6837\\u505A\\uFF1F\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u7528\\u6237\\u4E0D\\u4E00\\u5B9A\\u4F1A\\u76F4\\u63A5\\u5173\\u95ED\\u9875\\u9762\\uFF0C\\u53EF\\u80FD\\u5148\\u5207\\u6362\\u6807\\u7B7E\\u9875\\u518D\\u56DE\\u6765\\u3002\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"visibilitychange\"})})})}),\" \\u80FD\\u63D0\\u524D\\u6355\\u83B7\\u8FD9\\u79CD\\u201C\\u534A\\u79BB\\u573A\\u201D\\u72B6\\u6001\\uFF0C\\u7ED3\\u5408 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\"\\uFF0C\\u5F62\\u6210\\u53CC\\u91CD\\u4FDD\\u969C\\u3002\\u5C31\\u50CF\\u6253\\u6E38\\u620F\\u5F00\\u53CCBUFF\\uFF0C\\u7A33\\u4E2D\\u6C42\\u80DC\\uFF01\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"\\u5C0F-tips-2\",children:(0,n.jsx)(e.a,{href:\"#\\u5C0F-tips-2\",children:\"\\u5C0F Tips\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u53BB\\u91CD\\u903B\\u8F91\"}),\"\\uFF1A\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"hasSent\"})})})}),\" \\u6807\\u5FD7\\u4F4D\\u9632\\u6B62\\u91CD\\u590D\\u53D1\\u9001\\uFF0C\\u4E0D\\u7136\\u670D\\u52A1\\u5668\\u53EF\\u80FD\\u4F1A\\u88AB\\u4F60\\u7684\\u201C\\u70ED\\u60C5\\u201D\\u6DF9\\u6CA1\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u573A\\u666F\\u9002\\u914D\"}),\"\\uFF1A\\u5982\\u679C\\u53EA\\u662F\\u8BB0\\u5F55\\u201C\\u5F7B\\u5E95\\u79BB\\u5F00\\u201D\\uFF0C\\u53EF\\u4EE5\\u53EA\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\"\\uFF1B\\u5982\\u679C\\u5173\\u5FC3\\u201C\\u4E34\\u65F6\\u79BB\\u5F00\\u201D\\uFF0C\\u52A0 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"visibilitychange\"})})})}),\" \\u66F4\\u5168\\u9762\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u6700\\u4F73\\u5B9E\\u8DF5\\u6253\\u9020\\u4E00\\u4E2A\\u5065\\u58EE\\u7684\\u9000\\u51FA\\u65E5\\u5FD7\\u7CFB\\u7EDF\",children:(0,n.jsx)(e.a,{href:\"#\\u6700\\u4F73\\u5B9E\\u8DF5\\u6253\\u9020\\u4E00\\u4E2A\\u5065\\u58EE\\u7684\\u9000\\u51FA\\u65E5\\u5FD7\\u7CFB\\u7EDF\",children:\"\\u6700\\u4F73\\u5B9E\\u8DF5\\uFF1A\\u6253\\u9020\\u4E00\\u4E2A\\u5065\\u58EE\\u7684\\u9000\\u51FA\\u65E5\\u5FD7\\u7CFB\\u7EDF\"})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u5149\\u4F1A\\u53D1\\u8BF7\\u6C42\\u8FD8\\u4E0D\\u591F\\uFF0C\\u54B1\\u4EEC\\u5F97\\u628A\\u6D3B\\u5E72\\u6F02\\u4EAE\\uFF01\\u4EE5\\u4E0B\\u662F\\u4E00\\u4E9B\\u5B9E\\u6218\\u5EFA\\u8BAE\\uFF1A\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"\\u4F18\\u96C5\\u964D\\u7EA7\"})}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" data\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ message: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'\\u518D\\u89C1\\u5566'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" });\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  if\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'sendBeacon'\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" in\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" navigator) {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", data);\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"else\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"    fetch\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", { method: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'POST'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", body: data, keepalive: \"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"true\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" });\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u89E3\\u6790\"}),\"\\uFF1A\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u4F18\\u5148\\uFF0Cfallback \\u5230 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"fetch\"})})})}),\" \\u7684 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"keepalive\"})})})}),\" \\u6A21\\u5F0F\\uFF08Chrome 66+ \\u652F\\u6301\\uFF09\\uFF0C\\u53CC\\u4FDD\\u9669\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Tips\"}),\"\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"keepalive: true\"})})})}),\" \\u80FD\\u8BA9\\u8BF7\\u6C42\\u5728\\u9875\\u9762\\u5173\\u95ED\\u540E\\u7EE7\\u7EED\\u5B58\\u6D3B\\uFF0C\\u4F46\\u6570\\u636E\\u91CF\\u9650\\u5236\\u66F4\\u4E25\\u683C\\uFF08\\u901A\\u5E38 64KB\\uFF09\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"\\u6279\\u91CF\\u53D1\\u9001\"}),`\n\\u5982\\u679C\\u9700\\u8981\\u53D1\\u9001\\u591A\\u6761\\u6570\\u636E\\uFF0C\\u522B\\u4E00\\u6761\\u6761\\u53D1\\uFF0C\\u6512\\u4E00\\u6CE2\\u4E00\\u8D77\\u9001\\uFF1A`]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" logs\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" [];\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"function\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" logEvent\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#FFAB70\"},children:\"event\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  logs.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"push\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(event);\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"}\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/batch-log'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", \"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(logs));\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"\\u9519\\u8BEF\\u5904\\u7406\"}),`\n\\u56E0\\u4E3A `,(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u4E0D\\u8FD4\\u56DE Promise\\uFF0C\\u6CA1\\u6CD5\\u76F4\\u63A5\\u6355\\u83B7\\u5931\\u8D25\\u3002\\u4F46\\u53EF\\u4EE5\\u5728\\u53D1\\u9001\\u524D\\u505A\\u6821\\u9A8C\\uFF1A\"]}),`\n`,(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{tabIndex:\"0\",\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",children:(0,n.jsxs)(e.code,{\"data-language\":\"javascript\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"window.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"addEventListener\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'beforeunload'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", () \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"=>\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"  try\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"    const\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" data\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" =\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" JSON\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\".\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"stringify\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"({ message: \"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'bye'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" });\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"    if\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" (data.\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"length\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" >\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" 60000\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\") \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"throw\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" new\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" Error\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'\\u6570\\u636E\\u592A\\u5927\\u5566\\uFF01'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    navigator.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"sendBeacon\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'/api/log-exit'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", data);\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  } \"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"catch\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" (e) {\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"    console.\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"error\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\"'\\u53D1\\u9001\\u5931\\u8D25\\uFF1A'\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\", e);\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"  }\"})}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\"});\"})})]})})}),`\n`]}),`\n`,(0,n.jsxs)(e.li,{children:[`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"\\u7528\\u6237\\u4F53\\u9A8C\\u4F18\\u5316\"}),`\n\\u522B\\u5728 `,(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u91CC\\u5E72\\u592A\\u591A\\u6742\\u6D3B\\uFF0C\\u4FDD\\u6301\\u8F7B\\u91CF\\u3002\\u7528\\u6237\\u5173\\u9875\\u9762\\u65F6\\u6700\\u8BA8\\u538C\\u5361\\u987F\\uFF0C\\u50CF\\u6781\\u4E86\\u8D85\\u5E02\\u7ED3\\u8D26\\u65F6\\u6536\\u94F6\\u5458\\u78E8\\u8E6D\\u7684\\u611F\\u89C9\\u3002\"]}),`\n`]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u6CE8\\u610F\\u4E8B\\u9879\\u522B\\u8E29\\u8FD9\\u4E9B\\u5751\",children:(0,n.jsx)(e.a,{href:\"#\\u6CE8\\u610F\\u4E8B\\u9879\\u522B\\u8E29\\u8FD9\\u4E9B\\u5751\",children:\"\\u6CE8\\u610F\\u4E8B\\u9879\\uFF1A\\u522B\\u8E29\\u8FD9\\u4E9B\\u5751\\uFF01\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u4E0D\\u8981\\u6307\\u671B\\u8FD4\\u56DE\\u503C\"}),\"\\uFF1A\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u662F\\u5355\\u5411\\u7684\\uFF0C\\u522B\\u60F3\\u7740\\u670D\\u52A1\\u5668\\u56DE\\u4E2A\\u201C\\u6536\\u5230\\u201D\\uFF0C\\u5B83\\u538B\\u6839\\u4E0Dcare\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u907F\\u514D\\u590D\\u6742\\u8BA1\\u7B97\"}),\"\\uFF1A\\u9875\\u9762\\u5173\\u95ED\\u524D\\u7684\\u4EE3\\u7801\\u8981\\u5FEB\\uFF0C\\u522B\\u5728\\u8FD9\\u65F6\\u5019\\u7B97\\u4EC0\\u4E48\\u6590\\u6CE2\\u90A3\\u5951\\u6570\\u5217\\u3002\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"\\u6D4B\\u8BD5\\u73AF\\u5883\\u5DEE\\u5F02\"}),\"\\uFF1A\\u5F00\\u53D1\\u65F6\\u7528 \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"localhost\"})})})}),\" \\u6D4B\\u8BD5\\u53EF\\u80FD\\u6CA1\\u95EE\\u9898\\uFF0C\\u4F46\\u7EBF\\u4E0A HTTPS \\u73AF\\u5883\\u53EF\\u80FD\\u6709\\u8DE8\\u57DF\\u9650\\u5236\\uFF0C\\u63D0\\u524D\\u914D\\u597D CORS\\u3002\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"\\u5E7D\\u9ED8\\u7ED3\\u5C3E\\u6D4F\\u89C8\\u5668\\u4E0D\\u662F\\u4F60\\u5988\\u4F46\\u4E5F\\u80FD\\u5E2E\\u4F60\\u9001\\u4FE1\",children:(0,n.jsx)(e.a,{href:\"#\\u5E7D\\u9ED8\\u7ED3\\u5C3E\\u6D4F\\u89C8\\u5668\\u4E0D\\u662F\\u4F60\\u5988\\u4F46\\u4E5F\\u80FD\\u5E2E\\u4F60\\u9001\\u4FE1\",children:\"\\u5E7D\\u9ED8\\u7ED3\\u5C3E\\uFF1A\\u6D4F\\u89C8\\u5668\\u4E0D\\u662F\\u4F60\\u5988\\uFF0C\\u4F46\\u4E5F\\u80FD\\u5E2E\\u4F60\\u9001\\u4FE1\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u5B9E\\u73B0\\u201C\\u5173\\u95ED\\u9875\\u9762\\u53D1\\u9001 Ajax\\u201D\\u8FD9\\u4E8B\\u513F\\uFF0C\\u5C31\\u50CF\\u8DDF\\u6D4F\\u89C8\\u5668\\u8C08\\u6761\\u4EF6\\uFF1A\\u4F60\\u5F97\\u5FEB\\u3001\\u51C6\\u3001\\u72E0\\uFF0C\\u8FD8\\u8981\\u61C2\\u5B83\\u7684\\u813E\\u6C14\\u3002\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"beforeunload\"})})})}),\" \\u662F\\u8001\\u6D3E\\u505A\\u6CD5\\uFF0C\\u5076\\u5C14\\u9760\\u8C31\\uFF1B\",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"sendBeacon\"})})})}),\" \\u662F\\u65B0\\u5BA0\\uFF0C\\u7A33\\u5982\\u8001\\u72D7\\uFF1B\\u52A0\\u4E0A \",(0,n.jsx)(e.span,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.code,{\"data-language\":\"text\",\"data-theme\":\"github-dark\",children:(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{children:\"visibilitychange\"})})})}),\"\\uFF0C\\u7B80\\u76F4\\u662F\\u4E09\\u5251\\u5BA2\\u9F50\\u4E0A\\u9635\\u3002\\u5E0C\\u671B\\u8FD9\\u7BC7\\u535A\\u5BA2\\u80FD\\u5E2E\\u4F60\\u5728\\u4E0B\\u6B21\\u9700\\u6C42\\u91CC\\u5927\\u5C55\\u8EAB\\u624B\\uFF0C\\u522B\\u8BA9\\u4EA7\\u54C1\\u7ECF\\u7406\\u6293\\u7740\\u4F60\\u95EE\\uFF1A\\u201C\\u4E3A\\u5565\\u6570\\u636E\\u6CA1\\u8BB0\\u4E0B\\u6765\\uFF1F\\u201D \\u{1F61C}\"]}),`\n`,(0,n.jsx)(e.p,{children:\"\\u6709\\u4EC0\\u4E48\\u7591\\u95EE\\u6216\\u8005\\u66F4\\u9A9A\\u7684\\u64CD\\u4F5C\\uFF0C\\u6B22\\u8FCE\\u7559\\u8A00\\uFF0C\\u54B1\\u4EEC\\u4E00\\u8D77\\u63A2\\u8BA8\\uFF01\\u6BD5\\u7ADF\\uFF0C\\u524D\\u7AEF\\u7684\\u4E16\\u754C\\u91CC\\uFF0C\\u5751\\u591A\\u4E50\\u8DA3\\u4E5F\\u591A\\uFF0C\\u5BF9\\u5427\\uFF1F\"}),`\n`,(0,n.jsx)(e.hr,{})]})}function h(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,{...l,children:(0,n.jsx)(o,{...l})}):o(l)}return b(x);})();\n;return Component;"
  },
  "_id": "å‰ç«¯æŠ€æœ¯/å¦‚ä½•åœ¨Webå…³é—­é¡µé¢æ—¶å‘é€Ajaxè¯·æ±‚.mdx",
  "_raw": {
    "sourceFilePath": "å‰ç«¯æŠ€æœ¯/å¦‚ä½•åœ¨Webå…³é—­é¡µé¢æ—¶å‘é€Ajaxè¯·æ±‚.mdx",
    "sourceFileName": "å¦‚ä½•åœ¨Webå…³é—­é¡µé¢æ—¶å‘é€Ajaxè¯·æ±‚.mdx",
    "sourceFileDir": "å‰ç«¯æŠ€æœ¯",
    "contentType": "mdx",
    "flattenedPath": "å‰ç«¯æŠ€æœ¯/å¦‚ä½•åœ¨Webå…³é—­é¡µé¢æ—¶å‘é€Ajaxè¯·æ±‚"
  },
  "type": "Post",
  "url": "/blog/å‰ç«¯æŠ€æœ¯/å¦‚ä½•åœ¨Webå…³é—­é¡µé¢æ—¶å‘é€Ajaxè¯·æ±‚"
}