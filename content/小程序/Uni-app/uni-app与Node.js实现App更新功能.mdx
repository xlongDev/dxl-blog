---
title: "uni-app ä¸ Node.js å®ç° App æ›´æ–°åŠŸèƒ½çš„é‚£äº›äº‹å„¿"
date: "2023-04-11"
description: "ä»é›¶åˆ°ä¸€å¸¦ä½ æå®š uni-app çš„ App æ›´æ–°åŠŸèƒ½ï¼Œç»“åˆ Node.js åç«¯å®ç°ï¼Œæ·±å…¥åŸç†ï¼Œè¦†ç›– iOS å’Œ Android åŒå¹³å°ï¼Œé™„å¸¦å®æˆ˜ä»£ç ã€è¿›é˜¶ç©æ³•å’Œæœ€ä½³å®è·µã€‚"
keywords: "uni-app, Node.js, App æ›´æ–°, å‰ç«¯å¼€å‘, ç‰ˆæœ¬ç®¡ç†, iOS æ›´æ–°, Android æ›´æ–°, H5, å°ç¨‹åº, çƒ­æ›´æ–°, å¢é‡æ›´æ–°, æ€§èƒ½ä¼˜åŒ–"
author: "æ™“é¾™"
image: "/images/hero/uniapp-update.jpg"
tags: ["uni-app", "Node.js", "å‰ç«¯å¼€å‘", "App å¼€å‘", "iOS", "Android", "æ€§èƒ½ä¼˜åŒ–"]
category: "å°ç¨‹åº"
---

Heyï¼Œå‰ç«¯å…„å¼Ÿä»¬ï¼ä»Šå¤©å’±ä»¬èŠç‚¹ç¡¬æ ¸åˆæ¥åœ°æ°”çš„ä¸œè¥¿â€”â€”ç”¨ **uni-app** å’Œ **Node.js** å®ç° App æ›´æ–°åŠŸèƒ½ï¼Œè€Œä¸”è¦è¦†ç›– iOS å’Œ Android åŒå¹³å°ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å¼€å‘äº†ä¸€æ¬¾ Appï¼Œç”¨æˆ·é‡è¹­è¹­ä¸Šæ¶¨ï¼Œç»“æœä¸Šçº¿æ²¡å‡ å¤©å‘ç°ä¸ª bugï¼Œæˆ–è€…è€æ¿æ‹è„‘è¢‹è¦åŠ ä¸ªæ–°åŠŸèƒ½ï¼Œæ€»ä¸èƒ½æŒ‡æœ›ç”¨æˆ·å» App Store æˆ– Google Play æ‰‹åŠ¨æ›´æ–°å§ï¼Ÿé‚£ä½“éªŒå¾—æœ‰å¤šâ€œåŠé€€â€ï¼æ‰€ä»¥ï¼Œä»Šå¤©æˆ‘å¸¦ä½ ä»éœ€æ±‚åˆ†æåˆ°ä»£ç è½åœ°ï¼Œå†åˆ°åŒå¹³å°é€‚é…ã€è¿›é˜¶ç©æ³•å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œå½»åº•æŠŠ App æ›´æ–°è¿™ä»¶äº‹å„¿ç©è½¬ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿç³»å¥½å®‰å…¨å¸¦ï¼Œå’±ä»¬å¼€æ•´ ğŸš€ï¼

è¿™ç¯‡æ–‡ç« ä¼šä»â€œä¸ºä»€ä¹ˆè¦åšæ›´æ–°â€è®²èµ·ï¼Œé€æ­¥æ·±å…¥åˆ° uni-app å‰ç«¯çš„å®ç°ç»†èŠ‚ã€Node.js åç«¯çš„é€»è¾‘è®¾è®¡ï¼Œå†åˆ° iOS å’Œ Android çš„å·®å¼‚åŒ–å¤„ç†ï¼Œæœ€åèŠèŠç‰ˆæœ¬ç®¡ç†çš„â€œæ½œè§„åˆ™â€å’Œä¸€äº›â€œéªšæ“ä½œâ€ã€‚æˆ‘ä¼šå°½é‡ç”¨å¤§ç™½è¯æŠŠåº•å±‚åŸç†è®²é€ï¼Œé…ä¸Šä¸°å¯Œçš„ä»£ç ç¤ºä¾‹ã€ç±»æ¯”å’Œæœ€ä½³å®è·µï¼Œè¿˜ä¼šå¤¹æ‚ç‚¹å°å¹½é»˜ï¼ˆç»ä¸è€å¥—ï¼‰ï¼Œè®©ä½ è¯»å®Œæ—¢èƒ½åŠ¨æ‰‹å†™ä»£ç ï¼Œåˆèƒ½è·Ÿæœ‹å‹å¹ç‰›é€¼ã€‚ç›®æ ‡æ˜¯ï¼šæŠ€æœ¯ç¡¬æ ¸ï¼Œæ–‡é£è½»æ¾ï¼Œå®ç”¨æ€§æ‹‰æ»¡ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå’±ä»¬ç›´æ¥ä¸Šå¹²è´§ï¼

## ä¸ºä»€ä¹ˆéœ€è¦ App æ›´æ–°åŠŸèƒ½ï¼Ÿ

å…ˆæ¥ä¸ªçµé­‚æ‹·é—®ï¼šä¸ºå•¥ä¸ç›´æ¥ç”¨åº”ç”¨å•†åº—çš„æ›´æ–°æœºåˆ¶ï¼Ÿç­”æ¡ˆå¾ˆç°å®â€”â€”**ç”¨æˆ·æ‡’ï¼Œå•†åº—æ…¢ï¼Œå®¡æ ¸çƒ¦**ã€‚App Store å®¡æ ¸åŠ¨è¾„ä¸€å‘¨ï¼ŒGoogle Play è™½å¿«ç‚¹ä½†ä¹Ÿä¸å³æ—¶ï¼Œé‡åˆ°ç´§æ€¥ bug ä½ åªèƒ½å¹²çªçœ¼ã€‚æ›´åˆ«ææœ‰äº›ç”¨æˆ·å‹æ ¹ä¸çˆ±ç‚¹â€œæ›´æ–°â€æŒ‰é’®ï¼Œä½ çš„ App åœ¨ä»–ä»¬æ‰‹æœºé‡Œå°±åƒä¸ªâ€œè€å¤è‘£â€ï¼Œbug ç…§è·‘ï¼Œä½“éªŒç…§å´©ã€‚æ‰€ä»¥ï¼Œè‡ªç ”æ›´æ–°åŠŸèƒ½çš„å¥½å¤„ç®€ç›´ä¸è¦å¤ªæ˜æ˜¾ï¼š

1. **å³æ—¶æ€§**ï¼šä¿®å¤ bug æˆ–æ¨é€æ–°åŠŸèƒ½ï¼Œä¸ç”¨ç­‰å®¡æ ¸ï¼Œç›´æ¥æ¨ã€‚
2. **çµæ´»æ€§**ï¼šæ•´åŒ…æ›´æ–°ã€çƒ­æ›´æ–°ã€å¢é‡æ›´æ–°ï¼Œæƒ³æ€ä¹ˆç©å°±æ€ä¹ˆç©ã€‚
3. **ç”¨æˆ·ä½“éªŒ**ï¼šå¼¹ä¸ªæç¤ºæ¡†ï¼Œç‚¹ä¸€ä¸‹å°±æ›´æ–°ï¼Œæ¯”å•†åº—æ‰‹åŠ¨æ“ä½œä¸æ»‘å¤šäº†ã€‚
4. **æ§åˆ¶åŠ›**ï¼šä½ è¯´äº†ç®—ï¼Œä¸ç”¨çœ‹è‹¹æœè°·æ­Œçš„è„¸è‰²ã€‚

uni-app ä½œä¸ºè·¨ç«¯å¼€å‘çš„ç¥å™¨ï¼ˆH5ã€å°ç¨‹åºã€App é€šåƒï¼‰ï¼Œå¤©ç„¶æ”¯æŒè¿™ç§éœ€æ±‚ï¼Œè€Œ Node.js ä½œä¸ºåç«¯â€œä¸‡é‡‘æ²¹â€ï¼Œæ­£å¥½èƒ½æ­æŠŠæ‰‹ï¼Œç»„æˆä¸€å¥—â€œå‰åç«¯åŒäººèˆâ€ã€‚æ¥ä¸‹æ¥ï¼Œå’±ä»¬æŒ‰é€»è¾‘é“¾ä¸€æ­¥æ­¥æ‹†è§£å®ç°è¿‡ç¨‹ï¼Œé‡ç‚¹çªå‡º iOS å’Œ Android çš„å·®å¼‚ã€‚

## æ•´ä½“æ€è·¯ï¼šä»â€œä¾¦å¯Ÿâ€åˆ°â€œç­¾æ”¶â€

å®ç° App æ›´æ–°åŠŸèƒ½ï¼Œæ ¸å¿ƒé€»è¾‘ä¸å¤æ‚ï¼Œå¯ä»¥ç±»æ¯”æˆâ€œå¿«é€’ç‰©æµâ€ï¼š

1. **ç‰ˆæœ¬æ£€æµ‹ï¼ˆæŸ¥å•å·ï¼‰**ï¼šApp å¯åŠ¨æ—¶ï¼Œå‰ç«¯å‘åç«¯è¯·æ±‚æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯¹æ¯”æœ¬åœ°ç‰ˆæœ¬ã€‚
2. **æ›´æ–°å†³ç­–ï¼ˆæ´¾ä»¶é€šçŸ¥ï¼‰**ï¼šæ ¹æ®ç‰ˆæœ¬å·®å¼‚å’Œå¹³å°ç‰¹æ€§ï¼Œå†³å®šæ˜¯å¼ºåˆ¶æ›´æ–°ã€æç¤ºæ›´æ–°è¿˜æ˜¯å•¥ä¹Ÿä¸å¹²ã€‚
3. **ä¸‹è½½ä¸å®‰è£…ï¼ˆç­¾æ”¶åŒ…è£¹ï¼‰**ï¼šä»åç«¯ä¸‹è½½æ›´æ–°åŒ…ï¼Œå‰ç«¯å®Œæˆå®‰è£…ï¼ŒiOS å’Œ Android å„æœ‰é—¨é“ã€‚

æ•´ä¸ªæµç¨‹å°±åƒç”¨æˆ·åœ¨ App é‡Œâ€œæŸ¥å¿«é€’â€ï¼Œåç«¯è´Ÿè´£â€œå‘è´§â€ï¼Œå‰ç«¯è´Ÿè´£â€œç­¾æ”¶â€ã€‚ä¸‹é¢å’±ä»¬æŒ‰è¿™ä¸ªé“¾è·¯ï¼Œä»å‰ç«¯åˆ°åç«¯ï¼Œå†åˆ°åŒå¹³å°é€‚é…å’Œè¿›é˜¶ç©æ³•ï¼Œç»†ç»†å±•å¼€ã€‚

---

## å‰ç«¯å®ç°ï¼šuni-app çš„â€œä¾¦å¯Ÿå…µâ€è§’è‰²

uni-app çš„å‰ç«¯éƒ¨åˆ†æ˜¯æ•´ä¸ªæ›´æ–°åŠŸèƒ½çš„â€œä¾¦å¯Ÿå…µâ€ï¼Œè´Ÿè´£ç‰ˆæœ¬æ£€æµ‹ã€ç”¨æˆ·äº¤äº’å’Œæ›´æ–°æ‰§è¡Œã€‚iOS å’Œ Android çš„å®ç°æœ‰äº›å·®å¼‚ï¼Œå’±ä»¬é€ä¸€æ‹†è§£ã€‚

### 1. è·å–æœ¬åœ°ç‰ˆæœ¬å·

åœ¨ uni-app ä¸­ï¼Œè·å–å½“å‰ App çš„ç‰ˆæœ¬å·ç”¨ `plus.runtime.version`ï¼ŒåŒå¹³å°é€šç”¨ï¼š

```javascript
function getLocalVersion() {
  return new Promise((resolve) => {
    if (process.env.NODE_ENV === 'development') {
      resolve('1.0.0'); // å¼€å‘ç¯å¢ƒ mock ä¸€ä¸‹
    } else if (plus) {
      plus.runtime.getProperty(plus.runtime.appid, (info) => {
        resolve(info.version);
      });
    } else {
      resolve('1.0.0'); // H5 æˆ–å°ç¨‹åºç¯å¢ƒï¼Œé»˜è®¤å€¼
    }
  });
}
```

**iOS vs Android**ï¼š  
- **Android**ï¼š`plus.runtime.version` è¿”å›çš„æ˜¯ `AndroidManifest.xml` é‡Œçš„ `versionName`ã€‚
- **iOS**ï¼šè¿”å›çš„æ˜¯ `Info.plist` é‡Œçš„ `CFBundleShortVersionString`ã€‚

**Tips**:  
- ç‰ˆæœ¬å·å»ºè®®ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemVerï¼‰ï¼Œæ¯”å¦‚ `1.0.0`ï¼Œæ–¹ä¾¿æ¯”è¾ƒã€‚
- åŒå¹³å°æ‰“åŒ…æ—¶ç¡®ä¿ç‰ˆæœ¬å·ä¸€è‡´ï¼Œä¸ç„¶åç«¯å¯¹æ¯”ä¼šâ€œæ‡µâ€ã€‚
- åŠ ä¸ªæ—¥å¿—è®°å½•æœ¬åœ°ç‰ˆæœ¬å’Œå¹³å°ï¼Œè°ƒè¯•æ—¶èƒ½å¿«é€Ÿå®šä½ã€‚

### 2. è¯·æ±‚åç«¯ç‰ˆæœ¬ä¿¡æ¯

ç”¨ `uni.request` å‘ Node.js åç«¯å‘è¯·æ±‚ï¼Œå¸¦ä¸Šå¹³å°ä¿¡æ¯ï¼š

```javascript
async function checkUpdate() {
  const localVersion = await getLocalVersion();
  const platform = uni.getSystemInfoSync().platform.toLowerCase(); // 'ios' æˆ– 'android'
  try {
    const res = await uni.request({
      url: 'https://your-api.com/check-update',
      method: 'GET',
      data: { version: localVersion, platform },
      timeout: 5000, // 5ç§’è¶…æ—¶
    });
    if (res.statusCode !== 200) throw new Error('è¯·æ±‚å¤±è´¥');
    const { latestVersion, downloadUrl, forceUpdate, releaseNotes } = res.data;
    return { localVersion, latestVersion, downloadUrl, forceUpdate, releaseNotes, platform };
  } catch (err) {
    console.error('Check update failed:', err);
    uni.showToast({ title: 'æ£€æŸ¥æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', icon: 'none' });
    return null;
  }
}
```

**iOS vs Android**ï¼š  
- **Android**ï¼šåç«¯è¿”å› `.apk` æ–‡ä»¶é“¾æ¥ã€‚
- **iOS**ï¼šè¿”å› `.ipa` æ–‡ä»¶æˆ–è·³è½¬ App Store çš„é“¾æ¥ï¼ˆä¼ä¸šç­¾åé™¤å¤–ï¼‰ã€‚

**Tips**:  
- `platform` å‚æ•°å¿…ä¼ ï¼Œåç«¯å¾—æ ¹æ®è¿™ä¸ªè¿”å›å¯¹åº”æ–‡ä»¶ã€‚
- iOS æ›´æ–°å—é™ï¼Œåé¢ä¼šç»†è®²è§£å†³åŠæ³•ã€‚
- åŠ ä¸ª `timeout`ï¼Œç½‘ç»œå¡é¡¿æ—¶åˆ«è®©ç”¨æˆ·å¹²ç­‰ã€‚

### 3. ç‰ˆæœ¬å¯¹æ¯”ä¸æ›´æ–°æç¤º

ç‰ˆæœ¬å¯¹æ¯”é€»è¾‘åŒå¹³å°é€šç”¨ï¼Œä½†æç¤ºå’Œåç»­å¤„ç†å¾—åŒºåˆ†ï¼š

```javascript
function compareVersion(v1, v2) {
  const arr1 = v1.split('.').map(Number);
  const arr2 = v2.split('.').map(Number);
  const len = Math.max(arr1.length, arr2.length);
  for (let i = 0; i < len; i++) {
    const n1 = arr1[i] || 0;
    const n2 = arr2[i] || 0;
    if (n1 > n2) return 1;
    if (n1 < n2) return -1;
  }
  return 0;
}

async function handleUpdate() {
  const updateInfo = await checkUpdate();
  if (!updateInfo) return;

  const { localVersion, latestVersion, downloadUrl, forceUpdate, releaseNotes, platform } = updateInfo;
  if (compareVersion(latestVersion, localVersion) > 0) {
    const content = forceUpdate
      ? `å‘ç°æ–°ç‰ˆæœ¬ ${latestVersion}ï¼Œå¿…é¡»æ›´æ–°æ‰èƒ½ç»§ç»­ä½¿ç”¨ï¼\næ›´æ–°å†…å®¹ï¼š${releaseNotes}`
      : `å½“å‰ç‰ˆæœ¬ ${localVersion}ï¼Œæœ€æ–°ç‰ˆæœ¬ ${latestVersion}ï¼Œè¦ä¸è¦æ›´æ–°ä¸€ä¸‹ï¼Ÿ\næ›´æ–°å†…å®¹ï¼š${releaseNotes}`;
    uni.showModal({
      title: forceUpdate ? 'é‡è¦æ›´æ–°' : 'å‘ç°æ–°ç‰ˆæœ¬',
      content,
      showCancel: !forceUpdate,
      success: (res) => {
        if (res.confirm) {
          if (platform === 'android') {
            downloadAndInstallAndroid(downloadUrl);
          } else if (platform === 'ios') {
            handleIOSUpdate(downloadUrl);
          }
        } else if (forceUpdate) {
          plus.runtime.quit(); // å¼ºåˆ¶æ›´æ–°ä¸ç»™è·‘
        }
      },
    });
  } else {
    console.log('å·²ç»æ˜¯æœ€æ–°ç‰ˆæœ¬å•¦ï¼Œå®‰å¿ƒç”¨å§ ğŸ˜Š');
  }
}
```

**iOS vs Android**ï¼š  
- **Android**ï¼šç›´æ¥ä¸‹è½½ `.apk` å¹¶å®‰è£…ã€‚
- **iOS**ï¼šApp Store ç‰ˆåªèƒ½è·³è½¬å•†åº—ï¼Œä¼ä¸šç‰ˆæ‰èƒ½ä¸‹è½½ `.ipa`ã€‚

**Tips**:  
- å¼ºåˆ¶æ›´æ–°æ—¶å…³æ‰å–æ¶ˆæŒ‰é’®ï¼ŒiOS ç”¨æˆ·å¯èƒ½å¾—è·³è½¬å•†åº—ã€‚
- æ–‡æ¡ˆåŠ ç‚¹emojiï¼ˆğŸ˜ŠğŸš€ï¼‰ï¼ŒreleaseNotes å†™å¾—æœ‰è¶£ç‚¹ï¼Œç”¨æˆ·æ›´çˆ±ç‚¹ã€‚

### 4. ä¸‹è½½ä¸å®‰è£…ï¼ˆAndroidï¼‰

Android çš„æ›´æ–°ç®€å•ç²—æš´ï¼Œç›´æ¥ä¸‹è½½ `.apk` å¹¶å®‰è£…ï¼š

```javascript
function downloadAndInstallAndroid(url) {
  uni.showLoading({ title: 'ä¸‹è½½ä¸­...', mask: true });
  const downloadTask = uni.downloadFile({
    url,
    success: (res) => {
      if (res.statusCode === 200) {
        const filePath = res.tempFilePath;
        plus.runtime.install(filePath, { force: true }, () => {
          uni.hideLoading();
          uni.showToast({ title: 'æ›´æ–°æˆåŠŸï¼Œå³å°†é‡å¯' });
          setTimeout(() => plus.runtime.restart(), 1000);
        }, (err) => {
          uni.hideLoading();
          uni.showToast({ title: 'å®‰è£…å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none' });
          console.error('Android install failed:', err);
        });
      } else {
        throw new Error('ä¸‹è½½çŠ¶æ€ç å¼‚å¸¸');
      }
    },
    fail: (err) => {
      throw err;
    },
  });

  downloadTask.onProgressUpdate((res) => {
    uni.showLoading({ title: `ä¸‹è½½ä¸­ ${res.progress}%` });
  });

  downloadTask.catch((err) => {
    uni.hideLoading();
    uni.showToast({ title: 'ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', icon: 'none' });
    console.error('Android download failed:', err);
  });
}
```

**Android ç»†èŠ‚**ï¼š  
- éœ€è¦åœ¨ `AndroidManifest.xml` åŠ æƒé™ï¼š
  ```xml
  <uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
  ```
- Android 8.0+ éœ€è¦ç”³è¯·å®‰è£…æœªçŸ¥æ¥æºæƒé™ï¼š
  ```javascript
  if (plus.os.name === 'Android' && parseInt(plus.os.version) >= 8) {
    plus.runtime.requestPermissions(['android.permission.REQUEST_INSTALL_PACKAGES'], (res) => {
      if (res.granted) downloadAndInstallAndroid(url);
    });
  }
  ```

**Tips**:  
- åŠ è¿›åº¦æ¡ï¼Œç”¨æˆ·ä½“éªŒæ›´ä¸æ»‘ã€‚
- æ ¡éªŒæ–‡ä»¶ MD5ï¼Œç¡®ä¿ä¸‹è½½å®Œæ•´ã€‚
- Android 13+ å¯èƒ½éœ€è¦åŠ¨æ€æƒé™ï¼Œæµ‹è¯•æ—¶åˆ«æ¼äº†ã€‚

### 5. ä¸‹è½½ä¸å®‰è£…ï¼ˆiOSï¼‰

iOS æ›´æ–°éº»çƒ¦ç‚¹ï¼ŒApp Store ç‰ˆåªèƒ½è·³è½¬å•†åº—ï¼Œä¼ä¸šç‰ˆæ‰èƒ½ä¸‹è½½ `.ipa`ï¼š

```javascript
function handleIOSUpdate(url) {
  if (url.includes('itunes.apple.com') || url.includes('apps.apple.com')) {
    // App Store ç‰ˆï¼Œè·³è½¬å•†åº—
    plus.runtime.openURL(url, (err) => {
      uni.showToast({ title: 'è·³è½¬å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ›´æ–°', icon: 'none' });
      console.error('Open URL failed:', err);
    });
  } else {
    // ä¼ä¸šç‰ˆï¼Œä¸‹è½½ .ipa
    uni.showLoading({ title: 'ä¸‹è½½ä¸­...', mask: true });
    uni.downloadFile({
      url,
      success: (res) => {
        if (res.statusCode === 200) {
          plus.runtime.install(res.tempFilePath, {}, () => {
            uni.hideLoading();
            uni.showToast({ title: 'æ›´æ–°æˆåŠŸï¼Œå³å°†é‡å¯' });
            setTimeout(() => plus.runtime.restart(), 1000);
          }, (err) => {
            uni.hideLoading();
            uni.showToast({ title: 'å®‰è£…å¤±è´¥ï¼Œè¯·é‡è¯•', icon: 'none' });
            console.error('iOS install failed:', err);
          });
        }
      },
      fail: (err) => {
        uni.hideLoading();
        uni.showToast({ title: 'ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', icon: 'none' });
        console.error('iOS download failed:', err);
      },
    });
  }
}
```

**iOS ç»†èŠ‚**ï¼š  
- **App Store ç‰ˆ**ï¼šåªèƒ½ç”¨ `plus.runtime.openURL` è·³è½¬å•†åº—ï¼ŒURL æ ¼å¼å¦‚ `itms-apps://apps.apple.com/app/id123456789`ã€‚
- **ä¼ä¸šç‰ˆ**ï¼šéœ€è¦ä¼ä¸šç­¾åï¼ˆ`In-House` åˆ†å‘ï¼‰ï¼Œ`.ipa` æ–‡ä»¶å¾—ç”¨ `itms-services://?action=download-manifest&url=xxx.plist` å®‰è£…ï¼š
  ```javascript
  const plistUrl = 'https://your-server.com/app.plist';
  plus.runtime.openURL(`itms-services://?action=download-manifest&url=${plistUrl}`);
  ```

**Tips**:  
- ä¼ä¸šç‰ˆéœ€è¦ç”Ÿæˆ `manifest.plist`ï¼ŒåŒ…å« `.ipa` çš„ URL å’Œç­¾åä¿¡æ¯ã€‚
- App Store ç‰ˆè·³è½¬åæ²¡æ³•è‡ªåŠ¨é‡å¯ï¼Œæé†’ç”¨æˆ·æ‰‹åŠ¨æ“ä½œã€‚
- æµ‹è¯•æ—¶ç”¨çœŸæœºï¼Œæ¨¡æ‹Ÿå™¨è£…ä¸äº† `.ipa`ã€‚

### 6. å¼€æœºè‡ªæ£€

App å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œæ”¾åœ¨ `App.vue` çš„ `onLaunch`ï¼š

```javascript
onLaunch() {
  this.checkAppUpdate();
},
methods: {
  async checkAppUpdate() {
    await handleUpdate();
  },
}
```

**Tips**:  
- åŠ é˜²æŠ–ï¼Œé¿å…é¢‘ç¹è§¦å‘ã€‚
- iOS ä¼ä¸šç‰ˆæ£€æŸ¥ç­¾åæœ‰æ•ˆæœŸï¼Œè¿‡æœŸå¾—é‡æ–°ç­¾ã€‚

---

## åç«¯å®ç°ï¼šNode.js çš„â€œå¿«é€’å‘˜â€è§’è‰²

å‰ç«¯ä¾¦å¯Ÿå®Œï¼Œåç«¯å¾—æ¥æ£’ï¼Œæä¾›ç‰ˆæœ¬ä¿¡æ¯å’Œæ›´æ–°åŒ…ï¼ŒåŒå¹³å°å¾—åŒºåˆ«å¯¹å¾…ã€‚

### 1. æ­å»ºåŸºæœ¬æœåŠ¡

ç”¨ Express æ­ä¸ªåŸºç¡€è·¯ç”±ï¼š

```javascript
const express = require('express');
const app = express();

app.get('/check-update', (req, res) => {
  const { version, platform } = req.query;
  const latestVersion = '1.2.0';
  const downloadUrl = platform === 'android'
    ? `https://your-server.com/updates/app-${latestVersion}.apk`
    : `https://your-server.com/updates/app-${latestVersion}.ipa`; // ä¼ä¸šç‰ˆ
  const forceUpdate = version === '1.0.0';

  res.json({
    latestVersion,
    downloadUrl,
    forceUpdate,
    releaseNotes: 'ä¿®å¤äº†æ”¯ä»˜å´©æºƒé—®é¢˜ï¼Œæ–°å¢å¤œé—´æ¨¡å¼ï¼Œå¿«æ›´æ–°ä½“éªŒå§ï¼',
  });
});

app.listen(3000, () => console.log('Server running on port 3000'));
```

**iOS vs Android**ï¼š  
- **Android**ï¼šè¿”å› `.apk` æ–‡ä»¶é“¾æ¥ã€‚
- **iOS**ï¼šApp Store ç‰ˆè¿”å›å•†åº—é“¾æ¥ï¼Œä¼ä¸šç‰ˆè¿”å› `.ipa` æˆ– `.plist`ã€‚

**Tips**:  
- ç”¨ç¯å¢ƒå˜é‡ç®¡ç† URLï¼Œéƒ¨ç½²æ—¶æ”¹èµ·æ¥æ–¹ä¾¿ã€‚
- åŠ æ—¥å¿—ä¸­é—´ä»¶ï¼ˆ`morgan`ï¼‰ï¼Œæ’æŸ¥é—®é¢˜äº‹åŠåŠŸå€ã€‚

### 2. ç‰ˆæœ¬ç®¡ç†ä¸æ•°æ®åº“

ç”¨ MongoDB å­˜å‚¨ç‰ˆæœ¬ä¿¡æ¯ï¼š

```javascript
const mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/app-updates');

const UpdateSchema = new mongoose.Schema({
  version: { type: String, required: true },
  downloadUrl: { type: String, required: true },
  forceUpdate: Boolean,
  platform: { type: String, enum: ['android', 'ios'], required: true },
  releaseNotes: String,
  rolloutPercent: { type: Number, default: 100 },
  md5: String,
  createdAt: { type: Date, default: Date.now },
});

const Update = mongoose.model('Update', UpdateSchema);

app.get('/check-update', async (req, res) => {
  const { version, platform } = req.query;
  const latest = await Update.findOne({ platform, rolloutPercent: { $gte: Math.random() * 100 } })
    .sort({ version: -1 });
  if (!latest) return res.status(404).json({ message: 'æš‚æ— æ›´æ–°' });

  res.json({
    latestVersion: latest.version,
    downloadUrl: latest.downloadUrl,
    forceUpdate: latest.forceUpdate || compareVersion(latest.version, version) > 0,
    releaseNotes: latest.releaseNotes,
    md5: latest.md5,
  });
});
```

**iOS vs Android**ï¼š  
- **Android**ï¼š`downloadUrl` æŒ‡å‘ `.apk`ã€‚
- **iOS**ï¼šApp Store ç‰ˆæŒ‡å‘ `itms-apps://`ï¼Œä¼ä¸šç‰ˆæŒ‡å‘ `.plist`ã€‚

**Tips**:  
- åŠ  `md5` æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§ã€‚
- ç°åº¦å‘å¸ƒä»å°æ¯”ä¾‹å¼€å§‹ï¼ŒiOS ä¼ä¸šç‰ˆå°¤å…¶è°¨æ…ã€‚

### 3. æ–‡ä»¶å­˜å‚¨ä¸åˆ†å‘

æœ¬åœ°æˆ–äº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘ OSSï¼‰ï¼š

```javascript
const path = require('path');
app.use('/updates', express.static(path.join(__dirname, 'updates')));

// äº‘å­˜å‚¨ç¤ºä¾‹
const OSS = require('ali-oss');
const oss = new OSS({
  region: 'oss-cn-hangzhou',
  accessKeyId: process.env.OSS_KEY,
  accessKeySecret: process.env.OSS_SECRET,
  bucket: 'your-bucket',
});

app.get('/download', async (req, res) => {
  const { version, platform } = req.query;
  const file = platform === 'android'
    ? `updates/app-${version}.apk`
    : `updates/app-${version}.ipa`;
  const result = await oss.getStream(file);
  res.setHeader('Content-Disposition', `attachment; filename=${file}`);
  result.stream.pipe(res);
});
```

**iOS vs Android**ï¼š  
- **Android**ï¼šç›´æ¥ä¸‹ `.apk`ï¼Œç®€å•ç²—æš´ã€‚
- **iOS**ï¼šä¼ä¸šç‰ˆä¸‹ `.ipa` + `.plist`ï¼ŒApp Store ç‰ˆè·³è¿‡ä¸‹è½½ã€‚

**Tips**:  
- iOS ä¼ä¸šç‰ˆéœ€ç”Ÿæˆ `manifest.plist`ï¼š
  ```xml
  <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN">
  <plist version="1.0">
    <dict>
      <key>items</key>
      <array>
        <dict>
          <key>assets</key>
          <array>
            <dict>
              <key>kind</key>
              <string>software-package</string>
              <key>url</key>
              <string>https://your-server.com/app.ipa</string>
            </dict>
          </array>
          <key>metadata</key>
          <dict>
            <key>bundle-identifier</key>
            <string>com.your.app</string>
            <key>bundle-version</key>
            <string>1.2.0</string>
            <key>kind</key>
            <string>software</string>
            <key>title</key>
            <string>Your App</string>
          </dict>
        </dict>
      </array>
    </dict>
  </plist>
  ```

### 4. å®‰å…¨æ€§åŠ å›º

åŠ  JWT è®¤è¯ï¼š

```javascript
const jwt = require('jsonwebtoken');

app.use((req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1];
  if (!token || !jwt.verify(token, 'your-secret')) {
    return res.status(401).json({ message: 'è®¤è¯å¤±è´¥' });
  }
  next();
});
```

**Tips**:  
- iOS ä¼ä¸šç‰ˆåŠ ç­¾åæ ¡éªŒï¼Œé˜²æ­¢ç¯¡æ”¹ã€‚
- Android ç”¨ HTTPSï¼Œé˜²ä¸­é—´äººæ”»å‡»ã€‚

---

## è¿›é˜¶ç©æ³•ï¼šçƒ­æ›´æ–°ã€å¢é‡æ›´æ–°ä¸æ€§èƒ½ä¼˜åŒ–

### 1. çƒ­æ›´æ–°

åŒå¹³å°é€šç”¨ï¼Œæ‹‰ JS è¡¥ä¸ï¼š

```javascript
async function checkHotUpdate() {
  const res = await uni.request({ url: 'https://your-api.com/hot-update' });
  if (res.data.patch) {
    eval(res.data.patch.replace(/\s+/g, ''));
    uni.showToast({ title: 'çƒ­æ›´æ–°å®Œæˆï¼Œå¿«è¯•è¯•æ–°åŠŸèƒ½å§ï¼' });
  }
}
```

**iOS vs Android**ï¼š  
- **Android**ï¼šç›´æ¥ç”Ÿæ•ˆã€‚
- **iOS**ï¼šApp Store ç‰ˆå¯èƒ½è¢«æ‹’ï¼Œéœ€èµ°ä¼ä¸šç‰ˆã€‚

### 2. å¢é‡æ›´æ–°

ç”¨ `bsdiff` ç”Ÿæˆå·®åˆ†åŒ…ï¼š

```javascript
// Node.js
const bsdiff = require('bsdiff');
bsdiff.diff('old.apk', 'new.apk', 'patch.bin');

// å‰ç«¯ï¼ˆAndroidï¼‰
plus.runtime.applyPatch('old.apk', 'patch.bin', 'new.apk');
```

**iOS vs Android**ï¼š  
- **Android**ï¼šæ”¯æŒå¢é‡ï¼Œéœ€ native æ’ä»¶ã€‚
- **iOS**ï¼šä¼ä¸šç‰ˆå¯è¡Œï¼ŒApp Store ç‰ˆä¸è¡Œã€‚

### 3. æ€§èƒ½ä¼˜åŒ–

- **åˆ†ç‰‡ä¸‹è½½**ï¼š
  ```javascript
  async function downloadChunk(url, start, end) {
    const res = await uni.request({
      url,
      header: { Range: `bytes=${start}-${end}` },
      responseType: 'arraybuffer',
    });
    return res.data;
  }
  ```
- **iOS**ï¼šä¼ä¸šç‰ˆåˆ†ç‰‡ä¸‹è½½ `.ipa`ï¼ŒApp Store ç‰ˆè·³è¿‡ã€‚
- **Android**ï¼šåˆ†ç‰‡ä¸‹è½½ `.apk`ï¼Œå¤§æ–‡ä»¶å¿…å¤‡ã€‚

---

## æœ€ä½³å®è·µä¸è¸©å‘å¿ƒå¾—

1. **ç‰ˆæœ¬å·è§„èŒƒ**ï¼šç”¨ `x.y.z`ï¼ŒåŒå¹³å°ç»Ÿä¸€ã€‚
2. **ç°åº¦å‘å¸ƒ**ï¼šiOS ä¼ä¸šç‰ˆä» 5% å¼€å§‹ï¼ŒAndroid ä» 10%ã€‚
3. **é”™è¯¯å¤„ç†**ï¼šiOS è·³è½¬å¤±è´¥æç¤ºæ‰‹åŠ¨æ›´æ–°ï¼ŒAndroid é‡è¯• 3 æ¬¡ã€‚
4. **ç”¨æˆ·æ²Ÿé€š**ï¼šå†™æ¸…æ¥šæ›´æ–°å†…å®¹ï¼ŒiOS åŠ å•†åº—é“¾æ¥ã€‚
5. **ç­¾åç®¡ç†**ï¼šiOS ä¼ä¸šç‰ˆç­¾ååˆ«è¿‡æœŸï¼ŒAndroid ç”¨ keystore ç­¾ `.apk`ã€‚

**è¸©å‘è®°**ï¼š  
- iOS ä¼ä¸šç‰ˆç­¾åè¿‡æœŸï¼Œç”¨æˆ·è£…ä¸ä¸Šï¼Œå‡Œæ™¨é‡ç­¾æ•‘åœºã€‚  
- Android å¿˜äº†åŠ å®‰è£…æƒé™ï¼Œæ›´æ–°å¡æ­»ï¼Œè¡¥æƒé™æ‰æ´»è¿‡æ¥ã€‚

---

## æ€»ç»“ï¼šä»â€œå¿«é€’â€åˆ°â€œé—ªé€â€çš„è¿›åŒ–

ç”¨ uni-app å’Œ Node.js å®ç° App æ›´æ–°åŠŸèƒ½ï¼Œå°±åƒæŠŠâ€œæ™®é€šå¿«é€’â€å‡çº§æˆâ€œå³æ—¶é—ªé€â€ã€‚Android ç®€å•ç›´æ¥ï¼ŒiOS å¾—çœ‹åˆ†å‘æ–¹å¼ï¼Œé…åˆå¥½äº†ï¼ŒåŒå¹³å°ç”¨æˆ·ä½“éªŒéƒ½èƒ½èµ·é£ã€‚è¿™å¥—æ–¹æ¡ˆä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå¤Ÿä½ ç©è½¬æ›´æ–°åŠŸèƒ½äº†ï¼

èµ¶ç´§åŠ¨æ‰‹è¯•è¯•å§ï¼Œæœ‰é—®é¢˜ç•™è¨€ï¼Œå’±ä»¬ä¸€èµ·æå®šã€‚ä»£ç æ˜¯æ•²å‡ºæ¥çš„ï¼Œç»éªŒæ˜¯è¸©å‘è¸©å‡ºæ¥çš„ ğŸ˜„ã€‚Happy coding, folks! ğŸš€

---