---
type: "Post"
title: "Pinia ğŸï¼šè½»ç›ˆå¦‚é£çš„çŠ¶æ€ç®¡ç†è‰ºæœ¯ ğŸ¨"
date: "2022-02-20"
description: "æ·±å…¥æ¢è®¨ Pinia çš„è®¾è®¡å“²å­¦ã€æ ¸å¿ƒåŸç†ä¸æœ€ä½³å®è·µï¼Œå¸¦ä½ é¢†ç•¥ç°ä»£å‰ç«¯çŠ¶æ€ç®¡ç†çš„ä¼˜é›…ä¸åŠ›é‡ï¼Œé€‚åˆæ¸´æœ›æ·±åº¦ç†è§£çš„å‰ç«¯å¼€å‘è€…ã€‚"
keywords: "Pinia, Vue.js, çŠ¶æ€ç®¡ç†, å‰ç«¯å¼€å‘, å“åº”å¼, Vue 3, æ¶æ„è®¾è®¡, å¼€å‘å“²å­¦"
author: "æ™“é¾™"
image: "/images/hero/pinia-art.jpg"
tags: ["Pinia", "Vue.js", "çŠ¶æ€ç®¡ç†", "å‰ç«¯å¼€å‘"]
category: "Vue.js"
---

> â€œç®€å•æ˜¯å¤æ‚æ€§çš„ç»ˆæå½¢å¼ã€‚â€ â€”â€” è¾¾Â·èŠ¬å¥‡

åœ¨å‰ç«¯å¼€å‘çš„æµ©ç€šæ˜Ÿæµ·ä¸­ï¼ŒçŠ¶æ€ç®¡ç†å¦‚åŒé£å¸†ï¼Œå†³å®šäº†åº”ç”¨çš„èˆªè¡Œæ˜¯å¦é¡ºç•…ã€‚Piniaï¼Œä½œä¸º Vue 3 çš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œå®›å¦‚ä¸€ç¼•æ¸…é£ï¼Œè½»ç›ˆã€ä¼˜é›…ï¼Œå´è•´å«ç€å¼ºå¤§çš„åŠ›é‡ã€‚å®ƒä¸ä»…è§£å†³äº† Vuex çš„ç—›ç‚¹ï¼Œè¿˜ä»¥å…¶ç›´è§‚çš„ API å’Œå“åº”å¼ç³»ç»Ÿçš„æ·±åº¦æ•´åˆï¼Œé‡æ–°å®šä¹‰äº†ç°ä»£å‰ç«¯çŠ¶æ€ç®¡ç†çš„ç¾å­¦ã€‚

è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ æ·±å…¥ Pinia çš„ä¸–ç•Œï¼Œä»å®ƒçš„è®¾è®¡å“²å­¦åˆ°æ ¸å¿ƒåŸç†ï¼Œä»å®ç”¨æŠ€å·§åˆ°æ¶æ„å±‚é¢çš„æ€è€ƒã€‚æˆ‘ä»¬å°†ç©¿æ’ä»£ç ç¤ºä¾‹ã€ç±»æ¯”ã€å“²å­¦æ€è€ƒï¼Œç”šè‡³ä¸€ç‚¹é«˜çº§å¹½é»˜æ„Ÿï¼ˆç»ä¸è€å¥—ï¼ï¼‰ï¼Œè®©ä½ åœ¨é˜…è¯»ä¸­æ—¢èƒ½æ”¶è·å¹²è´§ï¼Œåˆèƒ½æ„Ÿå—åˆ°ç¼–ç¨‹çš„è¯—æ„ä¸ä¹è¶£ã€‚æ— è®ºä½ æ˜¯ Vue å¼€å‘è€…ï¼Œè¿˜æ˜¯å¯¹çŠ¶æ€ç®¡ç†æ„Ÿå…´è¶£çš„æ¢é™©å®¶ï¼Œè¿™ç¯‡æ–‡ç« éƒ½å°†æ˜¯ä¸€åœºæ€æƒ³ä¸å®è·µçš„ç››å®´ã€‚

---

## ç›®å½•ï¼šèˆªè¡Œè·¯çº¿å›¾ ğŸ—ºï¸

1. **Pinia çš„èµ·æºä¸å“²å­¦**ï¼šä» Vuex åˆ° Piniaï¼Œä¸ºä½•å®ƒå¦‚æ­¤è½»ç›ˆï¼Ÿ
2. **æ ¸å¿ƒæ¦‚å¿µæ‹†è§£**ï¼šStoreã€Stateã€Gettersã€Actions çš„é­”æ³•ã€‚
3. **å“åº”å¼ç³»ç»Ÿçš„æ·±åº¦è§£æ**ï¼šPinia å¦‚ä½•ä¸ Vue 3 çš„ reactivity å…±èˆï¼Ÿ
4. **æœ€ä½³å®è·µä¸ä»£ç ç¤ºä¾‹**ï¼šä»ç®€å•è®¡æ•°å™¨åˆ°å¤æ‚ç”µå•†ç³»ç»Ÿã€‚
5. **æ¶æ„å±‚é¢çš„æ€è€ƒ**ï¼šPinia åœ¨å¤§å‹é¡¹ç›®ä¸­çš„è®¾è®¡æ¨¡å¼ã€‚
6. **æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§**ï¼šè®© Pinia è·‘å¾—æ›´å¿«ï¼Œé£å¾—æ›´é«˜ã€‚
7. **å“²å­¦ä¸è‰ºæœ¯çš„å¯å‘**ï¼šä» Pinia çœ‹å‰ç«¯å¼€å‘çš„æ€ç»´æ–¹å¼ã€‚
8. **æœªæ¥å±•æœ›**ï¼šPinia çš„ç”Ÿæ€ä¸å¯èƒ½æ€§ã€‚

---

## 1. Pinia çš„èµ·æºä¸å“²å­¦ ğŸŒ±

### ä» Vuex åˆ° Piniaï¼šä¸€åœºä¼˜é›…çš„è¿›åŒ–

Vuex æ›¾æ˜¯ Vue 2 æ—¶ä»£çš„ç‹è€…ï¼Œä½†å®ƒçš„å¤æ‚æ€§å’Œå†—ä½™é…ç½®è®©å¼€å‘è€…ä»¬åœ¨å¤§å‹é¡¹ç›®ä¸­æ„Ÿåˆ°â€œè´Ÿé‡å‰è¡Œâ€ã€‚Pinia çš„è¯ç”Ÿï¼Œå°±åƒæ˜¯ä¸€åœºæ–‡è‰ºå¤å…´ï¼Œæ—¨åœ¨è®©çŠ¶æ€ç®¡ç†å›å½’ç®€å•ä¸ç›´è§‚ã€‚

- **Vuex çš„ç—›ç‚¹**ï¼šç¹ççš„æ¨¡å—åŒ–ã€Mutations çš„å¼ºåˆ¶æ€§ã€ä¸¥æ ¼çš„å•å‘æ•°æ®æµï¼Œè®©ä»£ç æ˜¾å¾—è‡ƒè‚¿ã€‚
- **Pinia çš„é©æ–°**ï¼š
  - æŠ›å¼ƒäº† Mutationsï¼Œç›´æ¥ä½¿ç”¨ Actionsï¼Œç®€åŒ–äº†æ•°æ®æµçš„å®šä¹‰ã€‚
  - å®Œå…¨æ”¯æŒ TypeScriptï¼Œç±»å‹æ¨å¯¼ä¸æ»‘å¦‚æµæ°´ã€‚
  - ä¸ Vue 3 çš„ Composition API æ— ç¼è¡”æ¥ï¼Œå“åº”å¼ç³»ç»Ÿæ·±åº¦æ•´åˆã€‚
  - æ¨¡å—åŒ–æ›´çµæ´»ï¼ŒStore ä¹‹é—´å¯ä»¥è‡ªç”±ç»„åˆï¼Œç”šè‡³æ”¯æŒåŠ¨æ€åŠ è½½ã€‚

Pinia çš„åå­—çµæ„Ÿæ¥æºäºè¥¿ç­ç‰™è¯­çš„â€œpiÃ±aâ€ï¼ˆè èï¼‰ï¼Œå¯“æ„â€œç”œç¾è€Œå¤šæ±â€ã€‚å®ƒçš„è®¾è®¡å“²å­¦å¯ä»¥ç”¨ä¸‰ä¸ªè¯æ¦‚æ‹¬ï¼š**ç®€æ´ã€çµæ´»ã€å¼ºå¤§**ã€‚æ­£å¦‚å»ºç­‘å¤§å¸ˆå¯†æ–¯Â·èŒƒå¾·ç½—æ‰€è¯´ï¼šâ€œå°‘å³æ˜¯å¤šã€‚â€Pinia é€šè¿‡å‡å°‘æ ·æ¿ä»£ç ï¼Œèµ‹äºˆå¼€å‘è€…æ›´å¤šçš„è‡ªç”±åº¦ï¼Œè®©çŠ¶æ€ç®¡ç†å˜å¾—åƒå‘¼å¸ä¸€æ ·è‡ªç„¶ã€‚

*Tipsï¼šPinia çš„è½»é‡è®¾è®¡å¹¶ä¸æ„å‘³ç€åŠŸèƒ½ç¼ºå¤±ï¼Œç›¸åï¼Œå®ƒé€šè¿‡åˆç†çš„æŠ½è±¡è®©ä½ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œéæ¡†æ¶æœ¬èº«ã€‚*

---

## 2. æ ¸å¿ƒæ¦‚å¿µæ‹†è§£ï¼šPinia çš„é­”æ³•å››ä»¶å¥— ğŸª„

Pinia çš„æ ¸å¿ƒç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼šStoreã€Stateã€Getters å’Œ Actionsã€‚å®ƒä»¬å°±åƒä¹å›¢ä¸­çš„å››ä½æ¼”å¥å®¶ï¼Œå„è‡ªç‹¬ç«‹ï¼Œå´åˆèƒ½åˆå¥å‡ºç¾å¦™çš„ä¹ç« ã€‚

### Storeï¼šçŠ¶æ€çš„å®¹å™¨

Store æ˜¯ Pinia çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ª Store éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çŠ¶æ€ç®¡ç†æ¨¡å—ã€‚ä½ å¯ä»¥æŠŠ Store æƒ³è±¡æˆä¸€ä¸ªâ€œé­”æ³•ç›’å­â€ï¼Œé‡Œé¢è£…ç€çŠ¶æ€ã€é€»è¾‘å’Œè®¡ç®—å±æ€§ã€‚

```javascript
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0
  }),
  getters: {
    doubleCount: (state) => state.count * 2
  },
  actions: {
    increment() {
      this.count++
    }
  }
})
```

*Tipsï¼šStore çš„å‘½åå»ºè®®ä»¥ `useXxxStore` çš„å½¢å¼ï¼Œä¿æŒä¸€è‡´æ€§ï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œä»£ç ç»´æŠ¤ã€‚*

### Stateï¼šæ•°æ®çš„çµé­‚

State æ˜¯ Store çš„æ ¸å¿ƒï¼Œå®šä¹‰äº†æ‰€æœ‰å“åº”å¼æ•°æ®ã€‚å¾—ç›Šäº Vue 3 çš„ `reactive` å’Œ `ref`ï¼ŒPinia çš„ State å¤©ç„¶æ”¯æŒå“åº”å¼ã€‚

```javascript
state: () => ({
  user: { name: 'æ™“é¾™', age: 25 },
  todos: []
})
```

ç±»æ¯”ï¼šState å°±åƒä¸€å¹…ç”»å¸ƒï¼Œä½ å¯ä»¥åœ¨ä¸Šé¢ç»˜åˆ¶ä»»ä½•å›¾æ¡ˆï¼Œè€Œ Pinia ç¡®ä¿æ¯æ¬¡â€œç¬”è§¦â€éƒ½ä¼šè‡ªåŠ¨è§¦å‘è§†å›¾æ›´æ–°ã€‚

*Tipsï¼šå°½é‡å°† State è®¾è®¡ä¸ºæ‰å¹³åŒ–ç»“æ„ï¼Œé¿å…è¿‡æ·±çš„åµŒå¥—ï¼Œä»¥æé«˜å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚*

### Gettersï¼šè®¡ç®—çš„é­”æ³•

Getters æ˜¯ Store çš„è®¡ç®—å±æ€§ï¼Œç±»ä¼¼äº Vue çš„ `computed`ã€‚å®ƒä»¬å¯ä»¥åŸºäº State è¿›è¡Œæ´¾ç”Ÿè®¡ç®—ï¼Œå¹¶ä¸”æ˜¯å“åº”å¼çš„ã€‚

```javascript
getters: {
  fullName: (state) => `${state.user.name} The Developer`,
  completedTodos: (state) => state.todos.filter(todo => todo.completed)
}
```

å¹½é»˜æ’æ›²ï¼šGetters å°±åƒæ˜¯ä½ é‚£ä½æ°¸è¿œèƒ½ä»å†°ç®±é‡Œå˜å‡ºç¾é£Ÿçš„æœ‹å‹â€”â€”å®ƒæ€»èƒ½ä»ç°æœ‰æ•°æ®ä¸­â€œçƒ¹é¥ªâ€å‡ºä½ æƒ³è¦çš„ç»“æœï¼

*Tipsï¼šGetters åº”ä¿æŒçº¯å‡½æ•°ç‰¹æ€§ï¼Œé¿å…å‰¯ä½œç”¨ï¼Œä»¥ç¡®ä¿å¯é¢„æµ‹æ€§å’Œå¯æµ‹è¯•æ€§ã€‚*

### Actionsï¼šé€»è¾‘çš„æŒ‡æŒ¥å®¶

Actions æ˜¯ Store çš„æ–¹æ³•ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ã€‚æ— è®ºæ˜¯åŒæ­¥æ“ä½œè¿˜æ˜¯å¼‚æ­¥è¯·æ±‚ï¼ŒActions éƒ½èƒ½èƒœä»»ã€‚

```javascript
actions: {
  async fetchTodos() {
    const response = await fetch('/api/todos')
    this.todos = await response.json()
  }
}
```

ç±»æ¯”ï¼šActions å°±åƒä¸€ä½ç»éªŒä¸°å¯Œçš„å¯¼æ¼”ï¼ŒæŒ‡æŒ¥ç€æ•°æ®çš„æµåŠ¨å’Œå˜åŒ–ï¼Œç¡®ä¿æ¯ä¸€åœºâ€œæˆâ€éƒ½ç²¾å½©çº·å‘ˆã€‚

*Tipsï¼šå¼‚æ­¥ Actions ä¸­ä½¿ç”¨ try-catch æ•è·é”™è¯¯ï¼Œå¹¶æä¾›ç”¨æˆ·å‹å¥½çš„æç¤ºï¼Œæå‡åº”ç”¨å¥å£®æ€§ã€‚*

---

## 3. å“åº”å¼ç³»ç»Ÿçš„æ·±åº¦è§£æï¼šPinia ä¸ Vue 3 çš„å…±èˆ ğŸ’ƒ

Pinia çš„çµé­‚åœ¨äºå®ƒä¸ Vue 3 å“åº”å¼ç³»ç»Ÿçš„æ·±åº¦æ•´åˆã€‚Vue 3 çš„ `reactive` å’Œ `ref` è®© Pinia çš„çŠ¶æ€ç®¡ç†å˜å¾—å¼‚å¸¸ä¼˜é›…ã€‚

### å“åº”å¼åŸç†ç®€æ

Vue 3 çš„å“åº”å¼ç³»ç»ŸåŸºäº ES6 çš„ Proxyã€‚å½“ä½ è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ª `reactive` å¯¹è±¡çš„å±æ€§æ—¶ï¼ŒProxy ä¼šæ‹¦æˆªæ“ä½œï¼Œè§¦å‘ä¾èµ–æ”¶é›†å’Œè§†å›¾æ›´æ–°ã€‚Pinia çš„ State é»˜è®¤ä½¿ç”¨ `reactive` åŒ…è£…ï¼Œç¡®ä¿æ‰€æœ‰çŠ¶æ€å˜åŒ–éƒ½èƒ½è‡ªåŠ¨åæ˜ åˆ° UIã€‚

```javascript
const store = useCounterStore()
store.count++ // è‡ªåŠ¨è§¦å‘è§†å›¾æ›´æ–°
```

### Pinia å¦‚ä½•åˆ©ç”¨å“åº”å¼ï¼Ÿ

1. **State çš„å“åº”å¼**ï¼šPinia é€šè¿‡ `reactive` åŒ…è£… State å¯¹è±¡ï¼Œç¡®ä¿æ‰€æœ‰å±æ€§å˜åŒ–éƒ½èƒ½è¢«è¿½è¸ªã€‚
2. **Getters çš„ç¼“å­˜**ï¼šGetters åŸºäº `computed`ï¼Œå…·æœ‰æƒ°æ€§æ±‚å€¼å’Œç¼“å­˜ç‰¹æ€§ï¼Œåªæœ‰å½“ä¾èµ–çš„æ•°æ®å˜åŒ–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—ã€‚
3. **Actions çš„è‡ªç”±åº¦**ï¼šActions ä¸å¼ºåˆ¶å“åº”å¼ï¼Œä½†å¯ä»¥é€šè¿‡ `this` è®¿é—®å“åº”å¼ Stateï¼Œçµæ´»å¤„ç†é€»è¾‘ã€‚

ç±»æ¯”ï¼šPinia çš„å“åº”å¼ç³»ç»Ÿå°±åƒä¸€æ£µå¤§æ ‘ï¼ŒState æ˜¯æ ¹ï¼ŒGetters æ˜¯æå¶ï¼ŒActions æ˜¯é£ï¼Œå…±åŒæ„æˆäº†ä¸€ä¸ªç”Ÿæœºå‹ƒå‹ƒçš„ç”Ÿæ€ç³»ç»Ÿã€‚

*Tipsï¼šé¿å…åœ¨ Getters ä¸­ç›´æ¥ä¿®æ”¹ Stateï¼Œè¿™ä¼šç ´åå“åº”å¼ç³»ç»Ÿçš„å•å‘æ•°æ®æµã€‚*

---

## 4. æœ€ä½³å®è·µä¸ä»£ç ç¤ºä¾‹ï¼šä»ç®€å•åˆ°å¤æ‚ ğŸš€

è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªç¤ºä¾‹ï¼Œä»ç®€å•åˆ°å¤æ‚ï¼Œå±•ç¤º Pinia çš„å¼ºå¤§èƒ½åŠ›ã€‚

### ç¤ºä¾‹ 1ï¼šç®€å•çš„è®¡æ•°å™¨

```javascript
// stores/counter.js
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0
  }),
  getters: {
    isEven: (state) => state.count % 2 === 0
  },
  actions: {
    increment() {
      this.count++
    },
    decrement() {
      this.count--
    }
  }
})
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```javascript
<script setup>
import { useCounterStore } from '@/stores/counter'

const counter = useCounterStore()
</script>

<template>
  <div>
    <p>Count: {{ counter.count }}</p>
    <p>Is Even? {{ counter.isEven }}</p>
    <button @click="counter.increment">+1</button>
    <button @click="counter.decrement">-1</button>
  </div>
</template>
```

*Tipsï¼šä½¿ç”¨ `<script setup>` èƒ½è®©ä»£ç æ›´ç®€æ´ï¼Œæ­é… Pinia çš„å“åº”å¼ APIï¼Œå¼€å‘ä½“éªŒå¦‚ä¸èˆ¬é¡ºæ»‘ã€‚*

### ç¤ºä¾‹ 2ï¼šç”µå•†è´­ç‰©è½¦

```javascript
// stores/cart.js
import { defineStore } from 'pinia'

export const useCartStore = defineStore('cart', {
  state: () => ({
    items: [],
    isCheckout: false
  }),
  getters: {
    totalPrice: (state) => {
      return state.items.reduce((total, item) => total + item.price * item.quantity, 0)
    },
    itemCount: (state) => state.items.length
  },
  actions: {
    addItem(item) {
      const existingItem = this.items.find(i => i.id === item.id)
      if (existingItem) {
        existingItem.quantity++
      } else {
        this.items.push({ ...item, quantity: 1 })
      }
    },
    removeItem(itemId) {
      this.items = this.items.filter(item => item.id !== itemId)
    },
    async checkout() {
      try {
        this.isCheckout = true
        await api.post('/checkout', this.items)
        this.items = []
      } catch (error) {
        console.error('Checkout failed:', error)
      } finally {
        this.isCheckout = false
      }
    }
  }
})
```

ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```javascript
<script setup>
import { useCartStore } from '@/stores/cart'

const cart = useCartStore()
</script>

<template>
  <div>
    <h2>è´­ç‰©è½¦</h2>
    <ul>
      <li v-for="item in cart.items" :key="item.id">
        {{ item.name }} - Â¥{{ item.price }} x {{ item.quantity }}
        <button @click="cart.removeItem(item.id)">ç§»é™¤</button>
      </li>
    </ul>
    <p>æ€»ä»·ï¼šÂ¥{{ cart.totalPrice }}</p>
    <button :disabled="cart.isCheckout" @click="cart.checkout">
      {{ cart.isCheckout ? 'ç»“ç®—ä¸­...' : 'å»ç»“ç®—' }}
    </button>
  </div>
</template>
```

*Tipsï¼šåœ¨å¤æ‚ Store ä¸­ï¼Œä½¿ç”¨ `try-catch` å¤„ç†å¼‚æ­¥é”™è¯¯ï¼Œå¹¶é€šè¿‡çŠ¶æ€ï¼ˆå¦‚ `isCheckout`ï¼‰æ§åˆ¶ UI äº¤äº’ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚*

---

## 5. æ¶æ„å±‚é¢çš„æ€è€ƒï¼šPinia åœ¨å¤§å‹é¡¹ç›®ä¸­çš„è®¾è®¡æ¨¡å¼ ğŸ›ï¸

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒPinia çš„çµæ´»æ€§ä½¿å…¶æˆä¸ºæ¶æ„è®¾è®¡çš„åˆ©å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é«˜çº§è®¾è®¡æ¨¡å¼ï¼š

### æ¨¡å—åŒ– Store

å°† Store æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ï¼Œä¾‹å¦‚ `userStore`ã€`cartStore`ã€`productStore`ï¼Œå¹¶é€šè¿‡ `useStore` ç»„åˆä½¿ç”¨ã€‚

```javascript
// stores/index.js
import { createPinia } from 'pinia'
import { useUserStore } from './user'
import { useCartStore } from './cart'

export const pinia = createPinia()

export const useStores = () => ({
  user: useUserStore(),
  cart: useCartStore()
})
```

*Tipsï¼šé€šè¿‡ `useStores` ç»„åˆ Storeï¼Œå‡å°‘ç»„ä»¶å¯¹å…·ä½“ Store çš„ç›´æ¥ä¾èµ–ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚*

### è·¨ Store é€šä¿¡

Store ä¹‹é—´å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨å®ç°é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œ`cartStore` å¯ä»¥è°ƒç”¨ `userStore` çš„æ–¹æ³•ã€‚

```javascript
// stores/cart.js
import { useUserStore } from './user'

export const useCartStore = defineStore('cart', {
  actions: {
    checkout() {
      const user = useUserStore()
      if (!user.isLoggedIn) {
        throw new Error('è¯·å…ˆç™»å½•')
      }
      // ç»§ç»­ç»“ç®—é€»è¾‘
    }
  }
})
```

*Tipsï¼šé¿å… Store é—´çš„å¾ªç¯ä¾èµ–ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿æˆ–ä¸­é—´å±‚è§£è€¦å¤æ‚é€»è¾‘ã€‚*

### åŠ¨æ€ Store

Pinia æ”¯æŒåŠ¨æ€åˆ›å»º Storeï¼Œé€‚åˆéœ€è¦æŒ‰éœ€åŠ è½½çš„åœºæ™¯ï¼Œå¦‚å¤šç§Ÿæˆ·ç³»ç»Ÿã€‚

```javascript
import { defineStore } from 'pinia'

export const createTenantStore = (tenantId) => defineStore(`tenant-${tenantId}`, {
  state: () => ({
    data: {}
  }),
  actions: {
    async fetchTenantData() {
      this.data = await api.get(`/tenants/${tenantId}`)
    }
  }
})
```

*Tipsï¼šåŠ¨æ€ Store çš„ ID å¿…é¡»å”¯ä¸€ï¼Œå»ºè®®ä½¿ç”¨å‰ç¼€ï¼ˆå¦‚ `tenant-`ï¼‰é¿å…å†²çªã€‚*

---

## 6. æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§ï¼šè®© Pinia é£å¾—æ›´é«˜ ğŸš€

### æ€§èƒ½ä¼˜åŒ–

1. **é¿å…è¿‡åº¦å“åº”å¼**ï¼šåªå¯¹éœ€è¦å“åº”å¼çš„æ•°æ®ä½¿ç”¨ `reactive` æˆ– `ref`ï¼Œé™æ€æ•°æ®å¯ä»¥ç”¨æ™®é€šå¯¹è±¡ã€‚
2. **ç¼“å­˜ Getters**ï¼šGetters é»˜è®¤ç¼“å­˜ï¼Œå°½é‡å¤ç”¨ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
3. **æ‰¹é‡æ›´æ–°**ï¼šåœ¨æ‰¹é‡ä¿®æ”¹ State æ—¶ï¼Œä½¿ç”¨ `store.$patch` å‡å°‘å“åº”å¼å¼€é”€ã€‚

```javascript
store.$patch({
  count: store.count + 10,
  items: [...store.items, newItem]
})
```

*Tipsï¼šä½¿ç”¨ `$patch` å¯ä»¥æ˜¾è‘—å‡å°‘å“åº”å¼ç³»ç»Ÿçš„è§¦å‘æ¬¡æ•°ï¼Œé€‚åˆé«˜é¢‘æ›´æ–°åœºæ™¯ã€‚*

### è°ƒè¯•æŠ€å·§

1. **Pinia Devtools**ï¼šå®‰è£… Vue Devtoolsï¼ŒPinia æä¾›æ—¶é—´æ—…è¡Œè°ƒè¯•åŠŸèƒ½ï¼ŒæŸ¥çœ‹çŠ¶æ€å˜åŒ–å†å²ã€‚
2. **æ—¥å¿—ä¸­é—´ä»¶**ï¼šè‡ªå®šä¹‰ä¸­é—´ä»¶è®°å½• Store çš„æ“ä½œã€‚

```javascript
pinia.use(({ store }) => {
  store.$onAction(({ name, args }) => {
    console.log(`Action ${name} called with`, args)
  })
})
```

*Tipsï¼šè°ƒè¯•æ—¶å¼€å¯ Pinia çš„ `devtools` æ”¯æŒï¼Œç”Ÿäº§ç¯å¢ƒå…³é—­ä»¥æå‡æ€§èƒ½ã€‚*

---

## 7. å“²å­¦ä¸è‰ºæœ¯çš„å¯å‘ï¼šä» Pinia çœ‹å‰ç«¯å¼€å‘çš„æ€ç»´æ–¹å¼ ğŸŒŒ

Pinia çš„è®¾è®¡å“²å­¦ä¸ä»…å…³ä¹ä»£ç ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„ä½“ç°ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬ï¼š**ç®€å•æ˜¯å¤æ‚æ€§çš„è§£è¯ï¼Œçµæ´»æ˜¯åˆ›æ–°çš„æºæ³‰**ã€‚

### ç¼–ç¨‹å¦‚è‰ºæœ¯

Pinia çš„ API è®¾è®¡å¦‚åŒå°è±¡æ´¾ç”»ä½œï¼Œå¯¥å¯¥å‡ ç¬”ï¼Œå´èƒ½å‹¾å‹’å‡ºä¸°å¯Œçš„ç”»é¢ã€‚å†™ä»£ç å°±åƒä½œç”»ï¼Œå¥½çš„ä»£ç ä¸ä»…è¦åŠŸèƒ½æ­£ç¡®ï¼Œè¿˜è¦ä¼˜é›…ã€æ˜“è¯»ã€æœ‰çµé­‚ã€‚

> â€œä»£ç æ˜¯å†™ç»™äººè¯»çš„ï¼Œé¡ºä¾¿è®©æœºå™¨æ‰§è¡Œã€‚â€ â€”â€” å”çº³å¾·Â·å…‹åŠªç‰¹

### æ¶æ„å¦‚äººç”Ÿ

Pinia çš„æ¨¡å—åŒ–è®¾è®¡å¯å‘æˆ‘ä»¬ï¼šåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œåˆ†è§£å¤æ‚æ€§ã€ä¿æŒçµæ´»æ€§æ˜¯æˆåŠŸçš„å…³é”®ã€‚è¿™ä½•å°ä¸æ˜¯äººç”Ÿçš„æ™ºæ…§ï¼Ÿé¢å¯¹å¤æ‚é—®é¢˜ï¼Œæ‹†è§£ã€ä¸“æ³¨ã€è¿­ä»£ï¼Œæ€»èƒ½æ‰¾åˆ°å‡ºè·¯ã€‚

*Tipsï¼šå®šæœŸåæ€ä»£ç çš„æ¶æ„ï¼Œå°±åƒåæ€äººç”Ÿç›®æ ‡ï¼Œä¿æŒæ¸…æ™°çš„æ–¹å‘æ„Ÿã€‚*

---

## 8. æœªæ¥å±•æœ›ï¼šPinia çš„ç”Ÿæ€ä¸å¯èƒ½æ€§ ğŸŒŸ

Pinia ä½œä¸º Vue 3 çš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œæœªæ¥å°†ç»§ç»­ä¸ Vue ç”Ÿæ€æ·±åº¦æ•´åˆã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„è¶‹åŠ¿ï¼š

- **ä¸ Nuxt 3 çš„æ·±åº¦é›†æˆ**ï¼šPinia åœ¨ Nuxt 3 ä¸­å·²æˆä¸ºé»˜è®¤çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œæœªæ¥å¯èƒ½æ¨å‡ºæ›´å¤šä¸“å±æ’ä»¶ã€‚
- **Server-Side Store**ï¼šæ”¯æŒæœåŠ¡ç«¯çŠ¶æ€ç®¡ç†ï¼Œä¼˜åŒ– SSR å’Œ SSG åœºæ™¯ã€‚
- **ç”Ÿæ€æ‰©å±•**ï¼šæ›´å¤šå›´ç»• Pinia çš„å·¥å…·å’Œåº“ï¼Œä¾‹å¦‚æŒä¹…åŒ–æ’ä»¶ã€æµ‹è¯•å·¥å…·ç­‰ã€‚

Pinia çš„æœªæ¥ï¼Œå°±åƒä¸€é¢—å†‰å†‰å‡èµ·çš„æ˜Ÿæ˜Ÿï¼Œæ³¨å®šåœ¨å‰ç«¯å¼€å‘çš„å¤œç©ºä¸­ç† ç† ç”Ÿè¾‰ã€‚

*Tipsï¼šå…³æ³¨ Pinia çš„å®˜æ–¹ä»“åº“ï¼ŒåŠæ—¶äº†è§£æ–°ç‰¹æ€§å’Œç¤¾åŒºåŠ¨æ€ï¼Œä¿æŒæŠ€æœ¯æ•é”åº¦ã€‚*

---

## æ€»ç»“ï¼šPiniaï¼ŒçŠ¶æ€ç®¡ç†çš„è¯—ä¸è¿œæ–¹ âœï¸

Pinia ä¸ä»…æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼Œæ›´æ˜¯ä¸€ç§è®¾è®¡å“²å­¦çš„ä½“ç°ã€‚å®ƒä»¥ç®€æ´çš„ APIã€å¼ºå¤§çš„å“åº”å¼ç³»ç»Ÿå’Œçµæ´»çš„æ¶æ„ï¼Œé‡æ–°å®šä¹‰äº†å‰ç«¯çŠ¶æ€ç®¡ç†çš„ç¾å­¦ã€‚æ— è®ºæ˜¯ç®€å•çš„è®¡æ•°å™¨ï¼Œè¿˜æ˜¯å¤æ‚çš„ç”µå•†ç³»ç»Ÿï¼ŒPinia éƒ½èƒ½è®©ä½ ä»¥ä¼˜é›…çš„æ–¹å¼é©¾é©­çŠ¶æ€ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä» Pinia çš„èµ·æºåˆ°æ ¸å¿ƒåŸç†ï¼Œä»æœ€ä½³å®è·µåˆ°æ¶æ„æ€è€ƒï¼Œè¯•å›¾ä¸ºä½ å‘ˆç°ä¸€å¹…å®Œæ•´çš„ç”»å·ã€‚å¸Œæœ›ä½ åœ¨é˜…è¯»ä¸­ï¼Œä¸ä»…æ”¶è·äº†æŠ€æœ¯å¹²è´§ï¼Œè¿˜æ„Ÿå—åˆ°ç¼–ç¨‹çš„è¯—æ„ä¸ä¹è¶£ã€‚

> â€œå¥½çš„ä»£ç å°±åƒä¸€é¦–è¯—ï¼Œç®€æ´å´æ„å‘³æ·±é•¿ã€‚â€ â€”â€” åŒ¿åç¨‹åºå‘˜

æ„¿ä½ åœ¨ Pinia çš„ä¸–ç•Œé‡Œï¼Œæ‰¾åˆ°å±äºè‡ªå·±çš„çŠ¶æ€ç®¡ç†ä¹‹é“ï¼Œä¹˜é£ç ´æµªï¼Œä¹¦å†™å±äºä½ çš„å‰ç«¯ä¼ å¥‡ï¼ ğŸš¢

---