---
title: "å¤§è è (Pinia)ğŸ ä½ å¤ªä¼˜ç§€ï¼šè§£é”çŠ¶æ€ç®¡ç†çš„ä¼˜é›…ä¸å“²å­¦"
date: "2023-03-20"
description: "æ·±å…¥è§£æ Pinia çš„æ ¸å¿ƒåŸç†ã€å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µï¼Œå¸¦ä½ é¢†ç•¥çŠ¶æ€ç®¡ç†çš„ä¼˜é›…ä¸å“²å­¦ï¼Œé€‚åˆå‰ç«¯å¼€å‘è€…æ·±åº¦å­¦ä¹ ã€‚"
keywords: "Pinia, Vue, çŠ¶æ€ç®¡ç†, å‰ç«¯å¼€å‘, Vue 3, JavaScript, å“åº”å¼ç¼–ç¨‹"
author: "æ™“é¾™"
image: "/images/hero/pinia-pineapple.jpg"
tags: ["Pinia", "Vue", "å‰ç«¯å¼€å‘", "çŠ¶æ€ç®¡ç†"]
category: "Vue.js"
---

> â€œç®€å•æ˜¯å¤æ‚æ€§çš„ç»ˆæå½¢å¼ã€‚â€ â€”â€” è±æ˜‚çº³å¤šÂ·è¾¾Â·èŠ¬å¥‡

åœ¨å‰ç«¯å¼€å‘çš„æµ©ç€šæ˜Ÿæµ·ä¸­ï¼ŒçŠ¶æ€ç®¡ç†å¦‚åŒå®‡å®™ä¸­çš„å¼•åŠ›ï¼Œæ‚„æ— å£°æ¯å´æ— å¤„ä¸åœ¨ã€‚Vue ç”Ÿæ€ä¸­çš„ Piniaï¼Œå®›å¦‚ä¸€é¢—é—ªè€€çš„ğŸï¼Œä»¥å…¶è½»é‡ã€ç›´è§‚å’Œå¼ºå¤§çš„ç‰¹æ€§ï¼Œæˆä¸º Vue 3 æ—¶ä»£çŠ¶æ€ç®¡ç†çš„é¦–é€‰å·¥å…·ã€‚å®ƒä¸ä»…è§£å†³äº† Vuex çš„å†—ä½™ä¸å¤æ‚ï¼Œè¿˜å¸¦æ¥äº†ä»¤äººæ‹æ¡ˆå«ç»çš„å¼€å‘ä½“éªŒã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥ Pinia çš„æ ¸å¿ƒï¼Œæ¢ç´¢å®ƒçš„åŸç†ã€æŠ€å·§ä¸å“²å­¦ï¼Œå¸¦ä½ ä»â€œä¼šç”¨â€åˆ°â€œç²¾é€šâ€ï¼Œç”šè‡³çª¥è§çŠ¶æ€ç®¡ç†èƒŒåçš„å®‡å®™çœŸç†ã€‚

è¿™ç¯‡æ–‡ç« é¢å‘æ‰€æœ‰å‰ç«¯å¼€å‘è€…ï¼Œå°¤å…¶æ˜¯é‚£äº›æ¸´æœ›åœ¨ Vue ç”Ÿæ€ä¸­ä¼˜é›…ç®¡ç†çŠ¶æ€çš„ä½ ã€‚æ— è®ºä½ æ˜¯æ–°æ‰‹è¿˜æ˜¯è€å¸æœºï¼Œè¿™é‡Œéƒ½æœ‰å¹²è´§ã€ç¬‘æ–™å’Œå¯å‘ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·å’¬ä¸€å£è¿™é¢—â€œå¤§è èâ€ğŸï¼

## ç›®å½•ï¼šæ€ç»´é“¾è·¯å¯¼èˆª

1. **Pinia æ˜¯ä»€ä¹ˆï¼Ÿä» Vuex åˆ°å¤§è èçš„è¿›åŒ–å²**
2. **æ ¸å¿ƒåŸç†ï¼šå“åº”å¼é­”æ³•ä¸ Store çš„çµé­‚**
3. **æ ¸å¿ƒ API è¯¦è§£ï¼šä» setup åˆ° map å®¶æ—**
4. **æœ€ä½³å®è·µï¼šä¼˜é›…ä»£ç çš„è‰ºæœ¯**
5. **é«˜çº§æŠ€å·§ï¼šæ’ä»¶ã€æŒä¹…åŒ–ä¸æ¨¡å—åŒ–**
6. **ä¸ Vue ç”Ÿæ€çš„åŒ–å­¦ååº”**
7. **æ€§èƒ½ä¼˜åŒ–ï¼šè®© Pinia é£èµ·æ¥**
8. **å“²å­¦æ€è€ƒï¼šçŠ¶æ€ç®¡ç†ä¸äººç”Ÿ**
9. **æ€»ç»“ï¼šä¸ºä»€ä¹ˆ Pinia æ˜¯ä½ çš„â€œçœŸå‘½å¤©å­â€**

---

## 1. Pinia æ˜¯ä»€ä¹ˆï¼Ÿä» Vuex åˆ°å¤§è èçš„è¿›åŒ–å²

Pinia æ˜¯ Vue 3 ç”Ÿæ€ä¸­çš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œç”± Vuex çš„åˆ›é€ è€…ä¹‹ä¸€ Eduardo San Martin å¼€å‘ã€‚å®ƒçš„åå­—â€œPiniaâ€æºè‡ªè¥¿ç­ç‰™è¯­â€œpiÃ±aâ€ï¼ˆè èï¼‰ï¼Œè±¡å¾ç€ç”œç¾ã€æ¸…æ–°å’Œå¤šæ±çš„å¼€å‘ä½“éªŒã€‚ç›¸æ¯” Vuexï¼ŒPinia æ›´è½»é‡ã€æ›´ç›´è§‚ï¼Œå®Œç¾é€‚é… Vue 3 çš„ Composition APIï¼ŒåŒæ—¶æ”¯æŒ TypeScript å’Œ DevToolsã€‚

### 1.1 Vuex çš„â€œæ—§ä¸–ç•Œâ€ä¸ Pinia çš„â€œæ–°å¤§é™†â€

Vuex æ›¾æ˜¯ Vue 2 æ—¶ä»£çš„ç‹è€…ï¼Œä½†å®ƒçš„æ¨¡å—åŒ–é…ç½®ç¹çï¼Œmutations å’Œ actions çš„åˆ†ç¦»è®©ä»£ç æ˜¾å¾—è‡ƒè‚¿ã€‚å°±åƒä¸€ä¸ªç©¿ç€ç›”ç”²çš„éª‘å£«ï¼ŒVuex è™½ç„¶å¼ºå¤§ï¼Œå´ä¸å¤Ÿçµæ´»ã€‚è€Œ Pinia åƒæ˜¯è„±ä¸‹ç›”ç”²çš„ä¾ å®¢ï¼ŒåŠ¨ä½œè½»ç›ˆï¼Œæ‹›å¼ç®€æ´ã€‚

| ç‰¹æ€§             | Vuex                              | Pinia                              |
|------------------|-----------------------------------|------------------------------------|
| **API é£æ ¼**     | Options APIï¼Œmutations/actions åˆ†ç¦» | Composition APIï¼Œç»Ÿä¸€ store æ–¹æ³•   |
| **æ¨¡å—åŒ–**       | éœ€æ‰‹åŠ¨æ³¨å†Œæ¨¡å—ï¼Œç¹ç              | åŠ¨æ€æ¨¡å—ï¼Œæ— éœ€æ³¨å†Œ                 |
| **TypeScript**   | æ”¯æŒæœ‰é™                          | åŸç”Ÿæ”¯æŒï¼Œç±»å‹æ¨å¯¼ä¸€æµ             |
| **DevTools**     | æ”¯æŒ                              | å¢å¼ºæ”¯æŒï¼Œæ—¶é—´æ—…è¡Œè°ƒè¯•             |
| **ä½“ç§¯**         | è¾ƒé‡                              | è½»é‡ï¼Œä»…çº¦ 1KB                     |

*Tips: å¦‚æœä½ è¿˜åœ¨ç”¨ Vuexï¼Œä¸å¦¨è¯•è¯• Piniaã€‚å®ƒå°±åƒä»è€å¼è¯ºåŸºäºšæ¢åˆ°æ™ºèƒ½æ‰‹æœºï¼Œä½“éªŒå®Œå…¨ä¸åŒï¼*

### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹© Piniaï¼Ÿ

Pinia çš„ä¼˜åŠ¿å¯ä»¥ç”¨â€œç®€ã€å¼ºã€çµâ€ä¸‰ä¸ªå­—æ¦‚æ‹¬ï¼š
- **ç®€**ï¼šAPI ç›´è§‚ï¼Œæ— éœ€ç¹ççš„ boilerplate ä»£ç ã€‚
- **å¼º**ï¼šä¸ Vue 3 çš„å“åº”å¼ç³»ç»Ÿæ— ç¼é›†æˆï¼ŒTypeScript æ”¯æŒä¸€æµã€‚
- **çµ**ï¼šæ”¯æŒåŠ¨æ€æ¨¡å—ã€æ’ä»¶æ‰©å±•ï¼Œé€‚åº”å„ç§å¤æ‚åœºæ™¯ã€‚

> â€œå¤§é“è‡³ç®€ã€‚â€ â€”â€” è€å­

Pinia çš„è®¾è®¡å“²å­¦æ­£æ˜¯å¦‚æ­¤ï¼šç”¨æœ€å°‘çš„ä»£ç ï¼Œè§£å†³æœ€å¤æ‚çš„é—®é¢˜ã€‚

---

## 2. æ ¸å¿ƒåŸç†ï¼šå“åº”å¼é­”æ³•ä¸ Store çš„çµé­‚

è¦çœŸæ­£æŒæ¡ Piniaï¼Œç†è§£å®ƒçš„æ ¸å¿ƒåŸç†è‡³å…³é‡è¦ã€‚Pinia çš„æ ¸å¿ƒæ˜¯ Vue 3 çš„**å“åº”å¼ç³»ç»Ÿ**ï¼Œå®ƒé€šè¿‡ `reactive` å’Œ `ref` æ„å»ºäº†ä¸€ä¸ªçµæ´»çš„çŠ¶æ€ç®¡ç†æ¡†æ¶ã€‚

### 2.1 Store çš„æœ¬è´¨ï¼šä¸€ä¸ªå“åº”å¼å¯¹è±¡

æ¯ä¸ª Pinia store éƒ½æ˜¯ä¸€ä¸ª `reactive` å¯¹è±¡ï¼ŒåŒ…å« stateã€getters å’Œ actionsã€‚å®ƒçš„æ ¸å¿ƒä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š

```javascript
import { reactive, computed } from 'vue';

function defineStore(id, setup) {
  const state = reactive(setup.state?.() || {});
  const getters = {};
  const actions = setup.actions || {};

  for (const key in setup.getters || {}) {
    getters[key] = computed(() => setup.getters[key].call(state, state));
  }

  return {
    $id: id,
    ...state,
    ...getters,
    ...actions,
  };
}
```

è¿™ä¸ªç®€åŒ–çš„å®ç°æ­ç¤ºäº† Pinia çš„é­”æ³•ï¼š
- **State**ï¼šé€šè¿‡ `reactive` åŒ…è£…ï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šè§¦å‘è§†å›¾æ›´æ–°ã€‚
- **Getters**ï¼šé€šè¿‡ `computed` å®ç°ï¼Œç¼“å­˜è®¡ç®—ç»“æœã€‚
- **Actions**ï¼šæ™®é€šæ–¹æ³•ï¼Œå°è£…ä¸šåŠ¡é€»è¾‘ã€‚

*Tips: ç†è§£ Pinia çš„å“åº”å¼æœ¬è´¨ï¼Œèƒ½è®©ä½ å†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚å°½é‡é¿å…ç›´æ¥æ“ä½œåŸå§‹å¯¹è±¡ï¼Œå§‹ç»ˆé€šè¿‡ store æ–¹æ³•ä¿®æ”¹çŠ¶æ€ã€‚*

### 2.2 å“åº”å¼ç³»ç»Ÿçš„â€œè´è¶æ•ˆåº”â€

Pinia çš„å“åº”å¼ç³»ç»Ÿå°±åƒä¸€åœºç²¾å¿ƒç¼–æ’çš„äº¤å“ä¹ï¼šå½“ state å˜åŒ–æ—¶ï¼Œgetters è‡ªåŠ¨æ›´æ–°ï¼Œè§†å›¾éšä¹‹åˆ·æ–°ã€‚è¿™ç§â€œè´è¶æ•ˆåº”â€è®©å¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç®¡ç†ä¾èµ–å…³ç³»ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡æ•°å™¨ storeï¼š

```javascript
import { defineStore } from 'pinia';

export const useCounterStore = defineStore('counter', {
  state: () => ({
    count: 0,
  }),
  getters: {
    doubleCount: (state) => state.count * 2,
  },
  actions: {
    increment() {
      this.count++;
    },
  },
});
```

å½“ä½ è°ƒç”¨ `increment()`ï¼Œ`count` å˜åŒ–ï¼Œ`doubleCount` è‡ªåŠ¨æ›´æ–°ï¼Œè§†å›¾ä¹Ÿä¼šåŒæ­¥åˆ·æ–°ã€‚è¿™ä¸€åˆ‡éƒ½å½’åŠŸäº Vue çš„å“åº”å¼ç³»ç»Ÿã€‚

*Tips: åœ¨ getters ä¸­é¿å…å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œå¿…è¦æ—¶å°†é€»è¾‘ç§»åˆ° actions ä¸­ï¼Œä»¥ä¿æŒæ€§èƒ½ã€‚*

---

## 3. æ ¸å¿ƒ API è¯¦è§£ï¼šä» setup åˆ° map å®¶æ—

Pinia æä¾›äº†ä¸¤ç§ä¸»è¦çš„ä½¿ç”¨æ–¹å¼ï¼š**Options API** å’Œ **Setup API**ï¼Œä»¥åŠä¸€ç»„è¾…åŠ©å‡½æ•°ï¼ˆå¦‚ `mapStores`ã€`mapState` ç­‰ï¼‰ã€‚è®©æˆ‘ä»¬é€ä¸€æ‹†è§£ã€‚

### 3.1 Options APIï¼šç»å…¸è€Œç›´è§‚

Options API æ˜¯æœ€å¸¸è§çš„å†™æ³•ï¼Œé€‚åˆå¿«é€Ÿä¸Šæ‰‹ï¼š

```javascript
import { defineStore } from 'pinia';

export const useTodoStore = defineStore('todo', {
  state: () => ({
    todos: [],
    filter: 'all',
  }),
  getters: {
    filteredTodos(state) {
      if (this.filter === 'completed') return state.todos.filter(t => t.completed);
      if (this.filter === 'active') return state.todos.filter(t => !t.completed);
      return state.todos;
    },
  },
  actions: {
    addTodo(text) {
      this.todos.push({ text, completed: false, id: Date.now() });
    },
    toggleTodo(id) {
      const todo = this.todos.find(t => t.id === id);
      if (todo) todo.completed = !todo.completed;
    },
  },
});
```

*Tips: Options API é€‚åˆä¸­å°å‹é¡¹ç›®ï¼Œä½†å¦‚æœéœ€è¦æ›´çµæ´»çš„é€»è¾‘ç»„ç»‡ï¼Œè€ƒè™‘ Setup APIã€‚*

### 3.2 Setup APIï¼šçµæ´»ä¸ç°ä»£

Setup API å…è®¸ä½ åœ¨ store ä¸­ä½¿ç”¨ Composition API çš„å®Œæ•´èƒ½åŠ›ï¼Œé€‚åˆå¤æ‚åœºæ™¯ï¼š

```javascript
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';

export const useUserStore = defineStore('user', () => {
  const user = ref(null);
  const isLoggedIn = computed(() => !!user.value);
  const login = async (credentials) => {
    // æ¨¡æ‹Ÿ API è°ƒç”¨
    user.value = { id: 1, name: credentials.username };
  };
  const logout = () => {
    user.value = null;
  };

  return { user, isLoggedIn, login, logout };
});
```

Setup API çš„ä¼˜åŠ¿åœ¨äºï¼š
- **çµæ´»æ€§**ï¼šå¯ä»¥è‡ªç”±ç»„åˆ `ref`ã€`reactive` å’Œ `computed`ã€‚
- **å¯è¯»æ€§**ï¼šé€»è¾‘æ›´æ¥è¿‘ç»„ä»¶çš„å†™æ³•ï¼Œæ˜“äºç»´æŠ¤ã€‚

*Tips: åœ¨ Setup API ä¸­ï¼Œå–„ç”¨ `ref` å’Œ `computed` çš„è§£æ„ç‰¹æ€§ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚*

### 3.3 Map å®¶æ—ï¼šç®€åŒ–ç»„ä»¶ä½¿ç”¨

Pinia æä¾›äº† `mapStores`ã€`mapState` å’Œ `mapActions`ï¼Œè®©ç»„ä»¶ä¸­çš„ store ä½¿ç”¨æ›´ä¾¿æ·ï¼š

```html
<script>
import { mapState, mapActions } from 'pinia';
import { useTodoStore } from './stores/todo';

export default {
  computed: {
    ...mapState(useTodoStore, ['filteredTodos']),
  },
  methods: {
    ...mapActions(useTodoStore, ['addTodo', 'toggleTodo']),
  },
};
</script>

<template>
  <div>
    <input v-model="newTodo" @keyup.enter="addTodo(newTodo); newTodo = ''" />
    <ul>
      <li v-for="todo in filteredTodos" :key="todo.id" @click="toggleTodo(todo.id)">
        {{ todo.text }} - {{ todo.completed ? 'âœ…' : 'â¬œ' }}
      </li>
    </ul>
  </div>
</template>
```

*Tips: Map è¾…åŠ©å‡½æ•°é€‚åˆå¿«é€Ÿå¼€å‘ï¼Œä½†åœ¨å¤§è§„æ¨¡é¡¹ç›®ä¸­ï¼Œæ˜¾å¼è°ƒç”¨ store æ–¹æ³•ä¼šæ›´æ˜“äºç»´æŠ¤ã€‚*

---

## 4. æœ€ä½³å®è·µï¼šä¼˜é›…ä»£ç çš„è‰ºæœ¯

Pinia çš„å¼ºå¤§ä¸ä»…åœ¨äºå…¶ APIï¼Œè¿˜åœ¨äºå¦‚ä½•ä¼˜é›…åœ°ä½¿ç”¨å®ƒã€‚ä»¥ä¸‹æ˜¯ 10 æ¡æœ€ä½³å®è·µï¼ŒåŠ©ä½ å†™å‡ºâ€œäººè§äººçˆ±â€çš„ä»£ç ã€‚

### 4.1 å‘½åè§„èŒƒï¼šæ¸…æ™°èƒœäºä¸€åˆ‡

- **Store å‘½å**ï¼šä»¥ `useXxxStore` å‘½åï¼Œå¦‚ `useAuthStore`ã€`useCartStore`ã€‚
- **State å‘½å**ï¼šä½¿ç”¨åè¯ï¼Œå¦‚ `items`ã€`userInfo`ã€‚
- **Getters å‘½å**ï¼šæè¿°æ€§å‘½åï¼Œå¦‚ `filteredItems`ã€`totalPrice`ã€‚
- **Actions å‘½å**ï¼šåŠ¨è¯å¼€å¤´ï¼Œå¦‚ `fetchData`ã€`updateUser`ã€‚

*Tips: å¥½çš„å‘½åå°±åƒä¸€æ¯å¥½å’–å•¡ â˜•ï¼Œèƒ½è®©äººä¸€ç§’è¿›å…¥çŠ¶æ€ã€‚*

### 4.2 æ¨¡å—åŒ–ï¼šåˆ†è€Œæ²»ä¹‹

å°†å¤§å‹ store æ‹†åˆ†ä¸ºå¤šä¸ªå° storeï¼ŒæŒ‰åŠŸèƒ½åˆ’åˆ†ã€‚ä¾‹å¦‚ï¼Œç”µå•†é¡¹ç›®å¯ä»¥æœ‰ `useCartStore`ã€`useProductStore` å’Œ `useUserStore`ã€‚

```javascript
import { defineStore } from 'pinia';

export const useCartStore = defineStore('cart', {
  state: () => ({
    items: [],
  }),
  getters: {
    totalPrice: (state) => state.items.reduce((sum, item) => sum + item.price, 0),
  },
  actions: {
    addItem(item) {
      this.items.push(item);
    },
  },
});
```

*Tips: æ¨¡å—åŒ–å°±åƒæ•´ç†æˆ¿é—´ï¼Œåˆ†é—¨åˆ«ç±»æ‰èƒ½äº‹åŠåŠŸå€ã€‚*

### 4.3 é¿å…è¿‡åº¦å“åº”å¼

Pinia çš„å“åº”å¼ç³»ç»Ÿå¾ˆå¼ºå¤§ï¼Œä½†æ»¥ç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œé¿å…å°†å¤§å‹å¯¹è±¡æ•´ä¸ªè®¾ä¸º `reactive`ï¼š

```javascript
// ä¸å¥½
state: () => ({
  hugeData: reactive({ /* è¶…å¤§å¯¹è±¡ */ }),
})

// æ›´å¥½
state: () => ({
  hugeData: { /* æ™®é€šå¯¹è±¡ */ },
})
```

*Tips: å“åº”å¼æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œç”¨å¯¹æ˜¯é­”æ³•ï¼Œç”¨é”™æ˜¯è´Ÿæ‹…ã€‚*

### 4.4 ä½¿ç”¨ TypeScript å¢å¼ºç±»å‹å®‰å…¨

Pinia å¯¹ TypeScript çš„æ”¯æŒå ªç§°ä¸€æµã€‚å®šä¹‰ store æ—¶ï¼Œæ˜¾å¼å£°æ˜ç±»å‹å¯ä»¥é¿å…å¾ˆå¤šè¿è¡Œæ—¶é”™è¯¯ï¼š

```typescript
import { defineStore } from 'pinia';

interface User {
  id: number;
  name: string;
}

export const useUserStore = defineStore('user', {
  state: () => ({
    user: null as User | null,
  }),
  actions: {
    setUser(user: User) {
      this.user = user;
    },
  },
});
```

*Tips: TypeScript å°±åƒä»£ç çš„â€œä½“æ£€æŠ¥å‘Šâ€ï¼Œæå‰å‘ç°é—®é¢˜ã€‚*

### 4.5 é”™è¯¯å¤„ç†ï¼šé˜²æ‚£äºæœªç„¶

åœ¨ actions ä¸­å§‹ç»ˆå¤„ç†å¯èƒ½çš„é”™è¯¯ï¼š

```javascript
async fetchData() {
  try {
    const response = await api.getData();
    this.data = response;
  } catch (error) {
    console.error('Fetch failed:', error);
    this.error = 'Failed to load data';
  }
}
```

*Tips: é”™è¯¯å¤„ç†å°±åƒä¹°ä¿é™©ï¼Œå¹³æ—¶ä¸èµ·çœ¼ï¼Œå…³é”®æ—¶åˆ»æ•‘å‘½ã€‚*

---

## 5. é«˜çº§æŠ€å·§ï¼šæ’ä»¶ã€æŒä¹…åŒ–ä¸æ¨¡å—åŒ–

Pinia çš„æ‰©å±•èƒ½åŠ›è®©å®ƒåœ¨å¤æ‚é¡¹ç›®ä¸­å¦‚é±¼å¾—æ°´ã€‚ä»¥ä¸‹æ˜¯ä¸‰ç§é«˜çº§æŠ€å·§ã€‚

### 5.1 è‡ªå®šä¹‰æ’ä»¶ï¼šæ‰©å±• Pinia çš„è¶…èƒ½åŠ›

Pinia æ”¯æŒæ’ä»¶æœºåˆ¶ï¼Œå¯ä»¥ä¸º store æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªæ—¥å¿—æ’ä»¶ï¼š

```javascript
export function loggerPlugin({ store }) {
  store.$subscribe((mutation, state) => {
    console.log(`Store ${store.$id} updated:`, mutation, state);
  });
}

// ä½¿ç”¨æ’ä»¶
import { createPinia } from 'pinia';
const pinia = createPinia();
pinia.use(loggerPlugin);
```

*Tips: æ’ä»¶å°±åƒç»™ Pinia è£…ä¸Šâ€œæ¶¡è½®å¢å‹â€ï¼Œè®©å®ƒè·‘å¾—æ›´å¿«æ›´è¿œã€‚*

### 5.2 çŠ¶æ€æŒä¹…åŒ–ï¼šè®©æ•°æ®â€œæ°¸ç”Ÿâ€

é€šè¿‡æ’ä»¶å®ç°çŠ¶æ€æŒä¹…åŒ–ï¼Œå¸¸è§æ–¹å¼æ˜¯ç»“åˆ `localStorage`ï¼š

```javascript
export function persistPlugin({ store }) {
  const savedState = localStorage.getItem(`pinia-${store.$id}`);
  if (savedState) {
    store.$patch(JSON.parse(savedState));
  }
  store.$subscribe((_, state) => {
    localStorage.setItem(`pinia-${store.$id}`, JSON.stringify(state));
  });
}
```

*Tips: æŒä¹…åŒ–å°±åƒç»™çŠ¶æ€åŠ ä¸ªâ€œä¿é™©ç®±â€ï¼Œæ–­ç”µä¹Ÿä¸æ€•ã€‚*

### 5.3 åŠ¨æ€æ¨¡å—ï¼šæŒ‰éœ€åŠ è½½

Pinia æ”¯æŒåŠ¨æ€æ³¨å†Œ storeï¼Œé€‚åˆå¤§å‹é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œå»¶è¿ŸåŠ è½½æŸäº› storeï¼š

```javascript
import { useSomeStore } from './stores/someStore';

export function loadStore() {
  const store = useSomeStore();
  // ä½¿ç”¨ store
}
```

*Tips: åŠ¨æ€æ¨¡å—å°±åƒæŒ‰éœ€ç‚¹èœï¼ŒèŠ‚çœèµ„æºåˆé«˜æ•ˆã€‚*

---

## 6. ä¸ Vue ç”Ÿæ€çš„åŒ–å­¦ååº”

Pinia ä¸ä»…æ˜¯çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œè¿˜ä¸ Vue ç”Ÿæ€çš„å…¶ä»–æˆå‘˜ï¼ˆå¦‚ Vue Routerã€Vue DevToolsï¼‰æ— ç¼åä½œã€‚

### 6.1 ä¸ Vue Router çš„é…åˆ

åœ¨è·¯ç”±å®ˆå«ä¸­ä½¿ç”¨ Pinia éªŒè¯ç”¨æˆ·çŠ¶æ€ï¼š

```javascript
import { createRouter } from 'vue-router';
import { useAuthStore } from './stores/auth';

const router = createRouter({
  routes: [
    { path: '/dashboard', component: Dashboard, meta: { requiresAuth: true } },
  ],
});

router.beforeEach((to, from, next) => {
  const authStore = useAuthStore();
  if (to.meta.requiresAuth && !authStore.isLoggedIn) {
    next('/login');
  } else {
    next();
  }
});
```

*Tips: Pinia å’Œ Vue Router å°±åƒâ€œé»„é‡‘æ­æ¡£â€ï¼Œä¸€ä¸ªç®¡çŠ¶æ€ï¼Œä¸€ä¸ªç®¡å¯¼èˆªï¼Œé…åˆæ— é—´ã€‚*

### 6.2 ä¸ Vue DevTools çš„â€œæ—¶é—´æ—…è¡Œâ€

Pinia å†…ç½®å¯¹ Vue DevTools çš„æ”¯æŒï¼Œå¯ç”¨åå¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰ store çš„çŠ¶æ€ã€‚
- è°ƒè¯•çŠ¶æ€å˜åŒ–å†å²ï¼ˆæ—¶é—´æ—…è¡Œï¼‰ã€‚
- æ‰‹åŠ¨è§¦å‘ actionsã€‚

*Tips: DevTools å°±åƒçŠ¶æ€ç®¡ç†çš„â€œæ˜¾å¾®é•œâ€ï¼Œè®©ä½ ä¸€è§ˆæ— ä½™ã€‚*

---

## 7. æ€§èƒ½ä¼˜åŒ–ï¼šè®© Pinia é£èµ·æ¥

Pinia æœ¬èº«å·²ç»å¾ˆè½»é‡ï¼Œä½†åœ¨å¤§è§„æ¨¡åº”ç”¨ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–ä»ç„¶ä¸å¯å¿½è§†ã€‚

### 7.1 æŒ‰éœ€è§£æ„ Store

ç›´æ¥è§£æ„ store ä¼šå¯¼è‡´å“åº”å¼ä¸¢å¤±ï¼Œæ­£ç¡®åšæ³•æ˜¯ä½¿ç”¨ `storeToRefs`ï¼š

```javascript
import { storeToRefs } from 'pinia';
import { useCounterStore } from './stores/counter';

export default {
  setup() {
    const counterStore = useCounterStore();
    const { count, doubleCount } = storeToRefs(counterStore);
    const { increment } = counterStore;

    return { count, doubleCount, increment };
  },
};
```

*Tips: `storeToRefs` å°±åƒçŠ¶æ€çš„â€œæ¬è¿å·¥â€ï¼Œç¡®ä¿å“åº”å¼ä¸ä¸¢å¤±ã€‚*

### 7.2 æ‰¹é‡æ›´æ–°çŠ¶æ€

ä½¿ç”¨ `$patch` è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œå‡å°‘å“åº”å¼å¼€é”€ï¼š

```javascript
this.$patch({
  count: this.count + 1,
  status: 'updated',
});
```

*Tips: `$patch` å°±åƒâ€œä¸€é”®è£…ä¿®â€ï¼Œä¸€æ¬¡æå®šæ‰€æœ‰æ”¹åŠ¨ã€‚*

### 7.3 é¿å…ä¸å¿…è¦çš„ Getters

Getters æ˜¯ computed å±æ€§ï¼Œæ»¥ç”¨ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä»…åœ¨éœ€è¦ç¼“å­˜è®¡ç®—ç»“æœæ—¶ä½¿ç”¨ã€‚

*Tips: Getters è™½å¥½ï¼Œä½†åˆ«è´ªæ¯ï¼Œå¿…è¦æ—¶ç”¨ actions æ›¿ä»£ã€‚*

---

## 8. å“²å­¦æ€è€ƒï¼šçŠ¶æ€ç®¡ç†ä¸äººç”Ÿ

çŠ¶æ€ç®¡ç†ä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯ä¸€ç§å“²å­¦æ€è€ƒã€‚Pinia çš„è®¾è®¡ç†å¿µâ€”â€”ç®€æ´ã€çµæ´»ã€å“åº”å¼â€”â€”ä¸äººç”Ÿçš„æ™ºæ…§ä¸è°‹è€Œåˆã€‚

### 8.1 ç®€æ´ï¼šå°‘å³æ˜¯å¤š

Pinia ç”¨æœ€å°‘çš„ API è§£å†³äº†å¤æ‚çš„é—®é¢˜ï¼Œè¿™ä¸â€œæ–­èˆç¦»â€çš„äººç”Ÿå“²å­¦å¦‚å‡ºä¸€è¾™ã€‚å­¦ä¼šæ”¾å¼ƒå†—ä½™ï¼Œæ‰èƒ½æ‹¥æŠ±ä¼˜é›…ã€‚

> â€œæˆ‘ä»¬æ‹¥æœ‰çš„è¶Šå¤šï¼Œå¤±å»çš„å°±è¶Šå¤šã€‚â€ â€”â€” ã€Šæå‡»ä¿±ä¹éƒ¨ã€‹

### 8.2 å“åº”å¼ï¼šæ‹¥æŠ±å˜åŒ–

Pinia çš„å“åº”å¼ç³»ç»Ÿè®©æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨ç®¡ç†ä¾èµ–ï¼Œè¿™å¯ç¤ºæˆ‘ä»¬ï¼šä¸å…¶æŠ—æ‹’å˜åŒ–ï¼Œä¸å¦‚å­¦ä¼šé€‚åº”ã€‚

> â€œå”¯ä¸€ä¸å˜çš„æ˜¯å˜åŒ–æœ¬èº«ã€‚â€ â€”â€” èµ«æ‹‰å…‹åˆ©ç‰¹

### 8.3 æ¨¡å—åŒ–ï¼šåˆ†è€Œæ²»ä¹‹

Pinia çš„æ¨¡å—åŒ–è®¾è®¡è®©æˆ‘ä»¬å°†å¤æ‚é—®é¢˜æ‹†åˆ†ä¸ºå°å—ï¼Œè¿™ä¸äººç”Ÿä¸­çš„â€œåŒ–æ•´ä¸ºé›¶â€ç­–ç•¥å¼‚æ›²åŒå·¥ã€‚

*Tips: æ— è®ºæ˜¯ä»£ç è¿˜æ˜¯ç”Ÿæ´»ï¼Œåˆ†è§£é—®é¢˜æ€»èƒ½è®©äº‹æƒ…æ›´ç®€å•ã€‚*

---

## 9. æ€»ç»“ï¼šä¸ºä»€ä¹ˆ Pinia æ˜¯ä½ çš„â€œçœŸå‘½å¤©å­â€

Pinia ä¸ä»…æ˜¯ä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ï¼Œæ›´æ˜¯ä¸€ç§å¼€å‘å“²å­¦çš„ä½“ç°ã€‚å®ƒçš„è½»é‡ã€ç›´è§‚å’Œå¼ºå¤§ï¼Œè®©å‰ç«¯å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºåˆ›é€ ï¼Œè€Œä¸æ˜¯è¢«ç¹ççš„é…ç½®æ‹–ç´¯ã€‚ä»å“åº”å¼ç³»ç»Ÿçš„é­”æ³•åˆ°æ’ä»¶æ‰©å±•çš„çµæ´»æ€§ï¼ŒPinia ä¸º Vue ç”Ÿæ€æ³¨å…¥äº†æ–°çš„æ´»åŠ›ã€‚

æ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯èµ„æ·±å¼€å‘è€…ï¼ŒPinia éƒ½èƒ½æˆä¸ºä½ çš„å¾—åŠ›åŠ©æ‰‹ã€‚å®ƒçš„è®¾è®¡è®©æˆ‘ä»¬æƒ³èµ·ä¸€å¥åè¨€ï¼š

> â€œå¥½çš„å·¥å…·æ˜¯æˆåŠŸçš„ä¸€åŠã€‚â€ â€”â€” ä½šå

æ‰€ä»¥ï¼Œæ‹¿èµ·è¿™é¢—â€œå¤§è èâ€ğŸï¼Œè®©å®ƒå¸¦ä½ é£å‘çŠ¶æ€ç®¡ç†çš„å·…å³°å§ï¼

---

å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½ä¸ºä½ çš„ Pinia ä¹‹æ—…ç‚¹äº®ä¸€ç›æ˜ç¯ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼ğŸ˜„

---