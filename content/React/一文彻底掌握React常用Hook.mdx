---
title: "ä¸€æ–‡å½»åº•æŒæ¡ React å¸¸ç”¨ Hookï¼šä»å…¥é—¨åˆ°æºç ï¼Œè§£é”å‰ç«¯å“²å­¦ ğŸš€"
date: "2023-09-16"
description: "å…¨é¢è§£æ React å¸¸ç”¨ Hook çš„åŸç†ã€å®è·µä¸å“²å­¦ï¼ŒåŒ…å«æ¸…æ™°è¡¨æ ¼ã€ä¸°å¯Œç¤ºä¾‹å’Œæœ€ä½³å®è·µï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘è€…ä»å…¥é—¨åˆ°ç²¾é€šã€‚"
keywords: "React Hooks, useState, useEffect, useContext, useReducer, useCallback, useMemo, useRef, å‰ç«¯å¼€å‘, React æºç "
author: "æ™“é¾™"
image: "/images/hero/react_hooks.jpg"
tags: ["React", "Hooks", "å‰ç«¯å¼€å‘", "JavaScript"]
category: "React"
---

> â€œä»£ç æ˜¯è¯—ï¼ŒHook æ˜¯éŸµè„šï¼›æŒæ¡å®ƒï¼Œä½ å°†è°±å†™å‰ç«¯çš„å²è¯—ã€‚â€ â€”â€” æŸä¸çŸ¥åå‰ç«¯å“²å­¦å®¶

React Hooks è‡ª 2018 å¹´æ¨ªç©ºå‡ºä¸–ä»¥æ¥ï¼Œå½»åº•æ”¹å˜äº†æˆ‘ä»¬ç¼–å†™ React ç»„ä»¶çš„æ–¹å¼ã€‚å®ƒä¸ä»…è®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰äº†ç±»ç»„ä»¶çš„å…¨éƒ¨èƒ½åŠ›ï¼Œè¿˜ä»¥æ›´ä¼˜é›…ã€æ›´ç›´è§‚çš„æ–¹å¼ç®¡ç†çŠ¶æ€å’Œå‰¯ä½œç”¨ã€‚ğŸ­ å¦‚æœè¯´ React æ˜¯å‰ç«¯çš„â€œå¤ªææ‹³â€ï¼Œé‚£ä¹ˆ Hooks å°±æ˜¯å…¶ä¸­çš„â€œæ‹›å¼ç²¾é«“â€ï¼Œè®©ä½ ä»¥æœ€å°çš„å¿ƒåŠ›æ’¬åŠ¨æœ€å¤§çš„åŠŸèƒ½ã€‚

æœ¬æ–‡å°†å¸¦ä½ ä» **åŸºç¡€ä½¿ç”¨** åˆ° **æ·±å…¥åŸç†**ï¼Œå†åˆ° **æœ€ä½³å®è·µ**ï¼Œå½»åº•æŒæ¡ React çš„å¸¸ç”¨ Hookã€‚æˆ‘ä»¬ä¸ä»…ä¼šå‰–ææ¯ä¸ª Hook çš„ç”¨æ³•ï¼Œè¿˜ä¼šæ·±å…¥æºç ï¼ŒæŒ–æ˜å…¶èƒŒåçš„è®¾è®¡å“²å­¦ï¼Œç”šè‡³ä¸Šå‡åˆ°äººç”Ÿä¸ä»£ç çš„å…±é¸£ã€‚ğŸ’¡ æ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯èµ„æ·±å¼€å‘è€…ï¼Œè¿™ç¯‡ 18000+ å­—çš„æ·±åº¦é•¿æ–‡éƒ½å°†æ˜¯ä½  React è¿›é˜¶è·¯ä¸Šçš„â€œè‘µèŠ±å®å…¸â€ã€‚

## æ–‡ç« ç»“æ„ï¼šæ€ç»´é“¾å¯¼èˆª ğŸ—ºï¸

ä¸ºäº†è®©è¿™åœº Hook ä¹‹æ—…æ¸…æ™°ä¸”æœ‰æ¡ç†ï¼Œæˆ‘ä»¬çš„ç»“æ„å¦‚ä¸‹ï¼š

1. **Hook æ€»è§ˆ**ï¼šè®¤è¯† React Hooks çš„å…¨è²Œï¼ŒåŒ…å«ä¸€å¼ æ¸…æ™°çš„è¡¨æ ¼æ€»ç»“ã€‚
2. **æ ¸å¿ƒ Hook é€ä¸ªå‡»ç ´**ï¼šæ·±å…¥è®²è§£ `useState`ã€`useEffect`ã€`useContext`ã€`useReducer`ã€`useCallback`ã€`useMemo`ã€`useRef`ï¼Œæ¯ä¸ª Hook åŒ…å«ï¼š
   - åŸºæœ¬ç”¨æ³•
   - å¸¸è§åœºæ™¯ä¸ç¤ºä¾‹
   - æºç è§£æï¼ˆé€‚åº¦æ·±å…¥ï¼‰
   - æœ€ä½³å®è·µä¸å° Tips
3. **é«˜çº§ Hook æ¢ç§˜**ï¼šä»‹ç» `useLayoutEffect`ã€`useTransition` ç­‰é«˜çº§ Hookã€‚
4. **è‡ªå®šä¹‰ Hook**ï¼šå¦‚ä½•æ‰“é€ è‡ªå·±çš„ Hookï¼Œé™„å¸¦å®ç”¨æ¡ˆä¾‹ã€‚
5. **Hook çš„å“²å­¦æ€è€ƒ**ï¼šä»ä»£ç åˆ°äººç”Ÿï¼ŒHook å¸¦ç»™æˆ‘ä»¬çš„å¯ç¤ºã€‚
6. **æ€»ç»“ä¸æœªæ¥å±•æœ›**ï¼šHook çš„æ¼”è¿›ä¸å‰ç«¯å¼€å‘çš„æœªæ¥ã€‚

å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºâ€œHook å®‡å®™â€çš„æ¢é™©å§ï¼ğŸŒŒ

---

## 1. Hook æ€»è§ˆï¼šä¸€è§ˆä¼—å±±å° ğŸ”ï¸

React Hooks æ˜¯ React 16.8 å¼•å…¥çš„ä¸€å¥— APIï¼Œå…è®¸å‡½æ•°ç»„ä»¶ç®¡ç†çŠ¶æ€ã€å¤„ç†å‰¯ä½œç”¨ã€å¤ç”¨é€»è¾‘ç­‰ã€‚å®ƒä»¬çš„æ ¸å¿ƒç†å¿µæ˜¯ **â€œé€»è¾‘å¤ç”¨â€** å’Œ **â€œå‡½æ•°å¼ç¼–ç¨‹â€**ï¼Œè®©ç»„ä»¶ä»£ç æ›´ç®€æ´ã€æ›´æ˜“æµ‹è¯•ã€‚

ä»¥ä¸‹æ˜¯å¸¸ç”¨ Hook çš„æ€»ç»“è¡¨æ ¼ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿå®šä½ï¼š

| Hook                | ç”¨é€”                              | å¸¸è§åœºæ™¯                          | æ³¨æ„äº‹é¡¹                              |
|---------------------|----------------------------------|----------------------------------|--------------------------------------|
| `useState`          | ç®¡ç†ç»„ä»¶çŠ¶æ€                     | è¡¨å•è¾“å…¥ã€è®¡æ•°å™¨                 | é¿å…ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œæ€»æ˜¯ä½¿ç”¨ set å‡½æ•°   |
| `useEffect`         | å¤„ç†å‰¯ä½œç”¨ï¼ˆå¦‚æ•°æ®è·å–ã€è®¢é˜…ï¼‰    | API è°ƒç”¨ã€DOM æ“ä½œ               | æ³¨æ„æ¸…ç†å‰¯ä½œç”¨ä»¥é˜²å†…å­˜æ³„æ¼           |
| `useContext`        | è®¿é—® React Context              | ä¸»é¢˜åˆ‡æ¢ã€ç”¨æˆ·è®¤è¯               | ç¡®ä¿ Context æä¾›é»˜è®¤å€¼              |
| `useReducer`        | ç®¡ç†å¤æ‚çŠ¶æ€é€»è¾‘                 | å¤æ‚è¡¨å•ã€çŠ¶æ€æœº                 | é€‚åˆæ›¿ä»£å¤šä¸ª useState çš„åœºæ™¯         |
| `useCallback`       | ç¼“å­˜å‡½æ•°ï¼Œä¼˜åŒ–æ€§èƒ½               | ä¼ é€’ç»™å­ç»„ä»¶çš„å›è°ƒ               | ä¾èµ–æ•°ç»„éœ€è°¨æ…è®¾ç½®                   |
| `useMemo`           | ç¼“å­˜è®¡ç®—ç»“æœï¼Œä¼˜åŒ–æ€§èƒ½           | å¤æ‚è®¡ç®—ã€åˆ—è¡¨æ’åº               | ä»…åœ¨æ€§èƒ½ç“¶é¢ˆæ—¶ä½¿ç”¨                   |
| `useRef`            | æŒä¹…åŒ–å¼•ç”¨ï¼Œè®¿é—® DOM æˆ–ä¿å­˜å€¼     | DOM æ“ä½œã€ä¿å­˜ä¸Šä¸€æ¬¡çŠ¶æ€         | ä¸ä¼šè§¦å‘é‡æ¸²æŸ“                       |
| `useLayoutEffect`   | åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆDOM å˜æ›´åï¼‰      | æµ‹é‡ DOM å¸ƒå±€                    | å¯èƒ½é˜»å¡æ¸²æŸ“ï¼Œè°¨æ…ä½¿ç”¨               |
| `useTransition`     | ç®¡ç†çŠ¶æ€è¿‡æ¸¡ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ        | å»¶è¿ŸåŠ è½½ã€å¤æ‚äº¤äº’               | React 18+ï¼Œéœ€æƒè¡¡ä¼˜å…ˆçº§             |

*Tipsï¼šåˆå­¦è€…å¯ä»¥å…ˆæŒæ¡ `useState` å’Œ `useEffect`ï¼Œå®ƒä»¬æ˜¯ Hook çš„â€œå…¥é—¨åŒé›„â€ã€‚è¿›é˜¶åå†æ¢ç´¢æ€§èƒ½ä¼˜åŒ–å’Œé«˜çº§ Hookã€‚*

---

## 2. æ ¸å¿ƒ Hook é€ä¸ªå‡»ç ´ ğŸ”

### 2.1 useStateï¼šçŠ¶æ€çš„â€œé­”æ³•æ£’â€ ğŸª„

#### åŸºæœ¬ç”¨æ³•
`useState` æ˜¯æœ€åŸºç¡€çš„ Hookï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¸­ç®¡ç†çŠ¶æ€ã€‚å®ƒè¿”å›ä¸€ä¸ªçŠ¶æ€å€¼å’Œä¸€ä¸ªæ›´æ–°çŠ¶æ€çš„å‡½æ•°ï¼š

```jsx
const [state, setState] = useState(initialState);
```

**ç¤ºä¾‹ï¼šè®¡æ•°å™¨**

```jsx
import React, { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>ä½ ç‚¹å‡»äº† {count} æ¬¡ï¼</p>
      <button onClick={() => setCount(count + 1)}>ç‚¹å‡»æˆ‘</button>
    </div>
  );
}
```

#### æ·±å…¥åŸç†
`useState` çš„èƒŒåæ˜¯ React çš„ **Fiber æ¶æ„** å’Œ **Hook é“¾è¡¨**ã€‚æ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact é€šè¿‡ Fiber èŠ‚ç‚¹çš„ `memoizedState` ä¿å­˜ Hook çŠ¶æ€ã€‚è°ƒç”¨ `setState` ä¼šè§¦å‘è°ƒåº¦æ›´æ–°ï¼ŒReact æ¯”è¾ƒæ–°æ—§çŠ¶æ€ï¼Œå†³å®šæ˜¯å¦é‡æ¸²æŸ“ã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useState(initialState) {
  const hook = mountState(initialState); // åˆ›å»º Hook å¯¹è±¡
  const setState = (newState) => {
    hook.memoizedState = newState; // æ›´æ–°çŠ¶æ€
    scheduleUpdate(); // è§¦å‘æ›´æ–°
  };
  return [hook.memoizedState, setState];
}
```

ç±»æ¯”ï¼š`useState` å°±åƒä½ å®¶é‡Œçš„å†°ç®±ï¼Œ`state` æ˜¯é‡Œé¢çš„é£Ÿæï¼Œ`setState` æ˜¯ä½ å¾€å†°ç®±é‡Œæ”¾æ–°é£Ÿæçš„åŠ¨ä½œã€‚æ¯æ¬¡æ”¾ä¸œè¥¿ï¼ŒReact éƒ½ä¼šæ£€æŸ¥å†°ç®±é‡Œçš„å˜åŒ–ï¼Œå†³å®šæ˜¯å¦â€œåšé¡¿æ–°èœâ€ï¼ˆé‡æ¸²æŸ“ï¼‰ã€‚

#### å¸¸è§åœºæ™¯
1. **è¡¨å•è¾“å…¥**ï¼š

```jsx
function Form() {
  const [name, setName] = useState('');

  return (
    <input
      value={name}
      onChange={(e) => setName(e.target.value)}
      placeholder="è¯·è¾“å…¥å§“å"
    />
  );
}
```

2. **åˆ‡æ¢çŠ¶æ€ï¼ˆå¦‚ä¸»é¢˜ï¼‰**ï¼š

```jsx
function ThemeToggler() {
  const [theme, setTheme] = useState('light');

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      åˆ‡æ¢åˆ° {theme === 'light' ? 'æš—é»‘' : 'æ˜äº®'} æ¨¡å¼
    </button>
  );
}
```

#### æœ€ä½³å®è·µ
- **ä¸è¦ç›´æ¥ä¿®æ”¹çŠ¶æ€**ï¼š`setState` æ˜¯ä¸å¯å˜çš„ï¼Œæ€»æ˜¯ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼ã€‚
- **å‡½æ•°å¼æ›´æ–°**ï¼šå½“æ–°çŠ¶æ€ä¾èµ–æ—§çŠ¶æ€æ—¶ï¼Œä½¿ç”¨å‡½æ•°å½¢å¼ï¼š

```jsx
setCount((prevCount) => prevCount + 1);
```

- **åˆå§‹å€¼æƒ°æ€§è®¡ç®—**ï¼šå¦‚æœåˆå§‹çŠ¶æ€éœ€è¦å¤æ‚è®¡ç®—ï¼Œå¯ä»¥ä¼ å…¥å‡½æ•°ï¼š

```jsx
const [state, setState] = useState(() => expensiveComputation());
```

*Tipsï¼šé¿å…åœ¨å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ `useState`ï¼Œå¦åˆ™ä¼šç ´å Hook çš„è°ƒç”¨é¡ºåºï¼Œå¯¼è‡´ React æ— æ³•æ­£ç¡®ç®¡ç†çŠ¶æ€ã€‚*

---

### 2.2 useEffectï¼šå‰¯ä½œç”¨çš„â€œé­”æ³•å¸ˆâ€ ğŸ§™â€â™‚ï¸

#### åŸºæœ¬ç”¨æ³•
`useEffect` ç”¨äºå¤„ç†å‰¯ä½œç”¨ï¼Œå¦‚æ•°æ®è·å–ã€è®¢é˜…ã€DOM æ“ä½œç­‰ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¾èµ–æ•°ç»„ï¼š

```jsx
useEffect(() => {
  // å‰¯ä½œç”¨é€»è¾‘
  return () => {
    // æ¸…ç†é€»è¾‘
  };
}, [dependencies]);
```

**ç¤ºä¾‹ï¼šè·å–ç”¨æˆ·æ•°æ®**

```jsx
import React, { useState, useEffect } from 'react';

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);

  useEffect(() => {
    async function fetchUser() {
      const response = await fetch(`/api/users/${userId}`);
      const data = await response.json();
      setUser(data);
    }
    fetchUser();
  }, [userId]);

  return <div>{user ? user.name : 'åŠ è½½ä¸­...'}</div>;
}
```

#### æ·±å…¥åŸç†
`useEffect` çš„æ ¸å¿ƒæ˜¯ **è°ƒåº¦ä¸æ¸…ç†**ã€‚React åœ¨æ¯æ¬¡æ¸²æŸ“åæ¯”è¾ƒä¾èµ–æ•°ç»„çš„å˜åŒ–ï¼Œå†³å®šæ˜¯å¦æ‰§è¡Œå‰¯ä½œç”¨ã€‚æ¸…ç†å‡½æ•°åœ¨ç»„ä»¶å¸è½½æˆ–ä¾èµ–å˜æ›´å‰è¿è¡Œï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useEffect(callback, deps) {
  const hook = mountEffect(callback, deps);
  if (depsChanged(hook.deps, deps)) {
    hook.callback = callback; // æ›´æ–°å›è°ƒ
    scheduleEffect(hook); // è°ƒåº¦å‰¯ä½œç”¨
  }
}
```

ç±»æ¯”ï¼š`useEffect` å°±åƒä½ å…»äº†ä¸€åªçŒ«ï¼ˆç»„ä»¶ï¼‰ï¼Œæ¯æ¬¡å®ƒé¥¿äº†ï¼ˆä¾èµ–å˜åŒ–ï¼‰ï¼Œä½ å¾—å–‚é£Ÿï¼ˆæ‰§è¡Œå‰¯ä½œç”¨ï¼‰ã€‚ä½†å¦‚æœä½ æ¬å®¶äº†ï¼ˆç»„ä»¶å¸è½½ï¼‰ï¼Œå¾—å…ˆæ¸…ç†çŒ«ç ‚ç›†ï¼ˆæ¸…ç†å‡½æ•°ï¼‰ã€‚

#### å¸¸è§åœºæ™¯
1. **è®¢é˜…äº‹ä»¶**ï¼š

```jsx
useEffect(() => {
  const handleResize = () => console.log(window.innerWidth);
  window.addEventListener('resize', handleResize);
  return () => window.removeEventListener('resize', handleResize);
}, []);
```

2. **å®šæ—¶å™¨**ï¼š

```jsx
function Timer() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setSeconds((prev) => prev + 1);
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  return <div>å·²è¿è¡Œ {seconds} ç§’</div>;
}
```

#### æœ€ä½³å®è·µ
- **å•ä¸€èŒè´£**ï¼šä¸€ä¸ª `useEffect` åªå¤„ç†ä¸€ç§å‰¯ä½œç”¨ï¼Œä¿æŒä»£ç æ¸…æ™°ã€‚
- **ä¾èµ–æ•°ç»„å®Œæ•´æ€§**ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½åˆ—å…¥æ•°ç»„ï¼Œé¿å…æ„å¤–è¡Œä¸ºã€‚
- **é¿å…ä¸å¿…è¦çš„å‰¯ä½œç”¨**ï¼šç”¨ `useMemo` æˆ– `useCallback` ä¼˜åŒ–ä¾èµ–ã€‚

*Tipsï¼šè°ƒè¯• `useEffect` æ—¶ï¼Œå¯ä»¥åœ¨å›è°ƒä¸­æ‰“å°ä¾èµ–å€¼ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚*

---

### 2.3 useContextï¼šå…¨å±€çŠ¶æ€çš„â€œä¼ å£°ç­’â€ ğŸ“¡

#### åŸºæœ¬ç”¨æ³•
`useContext` ç”¨äºè®¿é—® React Contextï¼Œé€‚åˆè·¨ç»„ä»¶å…±äº«æ•°æ®ï¼Œå¦‚ä¸»é¢˜ã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼š

```jsx
const value = useContext(MyContext);
```

**ç¤ºä¾‹ï¼šä¸»é¢˜åˆ‡æ¢**

```jsx
import React, { useContext, createContext } from 'react';

const ThemeContext = createContext('light');

function App() {
  return (
    <ThemeContext.Provider value="dark">
      <Toolbar />
    </ThemeContext.Provider>
  );
}

function Toolbar() {
  const theme = useContext(ThemeContext);
  return <div>å½“å‰ä¸»é¢˜ï¼š{theme}</div>;
}
```

#### æ·±å…¥åŸç†
`useContext` è¯»å–æœ€è¿‘çš„ `Provider` çš„ `value`ï¼ŒåŸºäº React çš„ **ä¸Šä¸‹æ–‡æ ˆ** å®ç°ã€‚æºç ä¸­ï¼Œå®ƒé€šè¿‡ `currentValue` ç›´æ¥è®¿é—® Context å¯¹è±¡ã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useContext(context) {
  return context._currentValue; // è¯»å–ä¸Šä¸‹æ–‡å€¼
}
```

ç±»æ¯”ï¼š`useContext` å°±åƒåŠå…¬å®¤çš„å¹¿æ’­ç³»ç»Ÿï¼Œé¢†å¯¼ï¼ˆProviderï¼‰å–Šä¸€å¥ï¼Œæ‰€æœ‰å‘˜å·¥ï¼ˆç»„ä»¶ï¼‰éƒ½èƒ½å¬åˆ°ã€‚

#### å¸¸è§åœºæ™¯
1. **ç”¨æˆ·è®¤è¯**ï¼š

```jsx
const AuthContext = createContext(null);

function LoginButton() {
  const { user, login } = useContext(AuthContext);
  return <button onClick={login}>{user ? 'é€€å‡º' : 'ç™»å½•'}</button>;
}
```

2. **å¤šè¯­è¨€æ”¯æŒ**ï¼š

```jsx
const LanguageContext = createContext('en');

function Greeting() {
  const lang = useContext(LanguageContext);
  return <div>{lang === 'en' ? 'Hello' : 'Bonjour'}</div>;
}
```

#### æœ€ä½³å®è·µ
- **æä¾›é»˜è®¤å€¼**ï¼šç¡®ä¿ Context æœ‰åˆç†çš„é»˜è®¤å€¼ã€‚
- **é¿å…è¿‡åº¦ä½¿ç”¨**ï¼šContext é€‚åˆå…¨å±€æ•°æ®ï¼Œå±€éƒ¨çŠ¶æ€ç”¨ `useState` æˆ– `useReducer`ã€‚
- **ç»“åˆ TypeScript**ï¼šä¸º Context å®šä¹‰ç±»å‹ï¼Œæå‡ä»£ç å¥å£®æ€§ã€‚

*Tipsï¼šContext å˜åŒ–ä¼šå¯¼è‡´æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶é‡æ¸²æŸ“ï¼Œè€ƒè™‘ç”¨ `useMemo` ä¼˜åŒ– Provider çš„ valueã€‚*

---

### 2.4 useReducerï¼šå¤æ‚çŠ¶æ€çš„â€œå¯¼æ¼”â€ ğŸ¬

#### åŸºæœ¬ç”¨æ³•
`useReducer` é€‚åˆç®¡ç†å¤æ‚çŠ¶æ€é€»è¾‘ï¼Œç±»ä¼¼ Redux çš„ reducer æ¨¡å¼ï¼š

```jsx
const [state, dispatch] = useReducer(reducer, initialState);
```

**ç¤ºä¾‹ï¼šTodo åˆ—è¡¨**

```jsx
import React, { useReducer } from 'react';

const initialState = { todos: [] };

function reducer(state, action) {
  switch (action.type) {
    case 'ADD_TODO':
      return { todos: [...state.todos, action.payload] };
    case 'REMOVE_TODO':
      return { todos: state.todos.filter((_, i) => i !== action.payload) };
    default:
      return state;
  }
}

function TodoApp() {
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <div>
      <button
        onClick={() => dispatch({ type: 'ADD_TODO', payload: 'æ–°ä»»åŠ¡' })}
      >
        æ·»åŠ ä»»åŠ¡
      </button>
      {state.todos.map((todo, index) => (
        <div key={index}>
          {todo}
          <button
            onClick={() => dispatch({ type: 'REMOVE_TODO', payload: index })}
          >
            åˆ é™¤
          </button>
        </div>
      ))}
    </div>
  );
}
```

#### æ·±å…¥åŸç†
`useReducer` æ˜¯ `useState` çš„â€œåŠ å¼ºç‰ˆâ€ï¼Œé€šè¿‡ reducer å‡½æ•°é›†ä¸­ç®¡ç†çŠ¶æ€æ›´æ–°ã€‚React ç»´æŠ¤ä¸€ä¸ª `memoizedState` å’Œ `dispatch` å‡½æ•°ï¼Œ`dispatch` æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šå› æ¸²æŸ“å˜åŒ–ã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useReducer(reducer, initialState) {
  const [state, setState] = useState(initialState);
  const dispatch = (action) => {
    const newState = reducer(state, action);
    setState(newState);
  };
  return [state, dispatch];
}
```

ç±»æ¯”ï¼š`useReducer` å°±åƒä¸€éƒ¨ç”µå½±çš„å¯¼æ¼”ï¼ˆreducerï¼‰ï¼Œæ¼”å‘˜ï¼ˆçŠ¶æ€ï¼‰æŒ‰å‰§æœ¬ï¼ˆactionï¼‰è¡¨æ¼”ï¼Œå‘ˆç°æœ€ç»ˆç”»é¢ã€‚

#### å¸¸è§åœºæ™¯
1. **å¤æ‚è¡¨å•**ï¼š

```jsx
function formReducer(state, action) {
  switch (action.type) {
    case 'UPDATE_FIELD':
      return { ...state, [action.field]: action.value };
    default:
      return state;
  }
}

function Form() {
  const [form, dispatch] = useReducer(formReducer, { name: '', email: '' });

  return (
    <div>
      <input
        value={form.name}
        onChange={(e) =>
          dispatch({ type: 'UPDATE_FIELD', field: 'name', value: e.target.value })
        }
      />
    </div>
  );
}
```

2. **çŠ¶æ€æœº**ï¼š

```jsx
function trafficLightReducer(state, action) {
  switch (action.type) {
    case 'NEXT':
      return state === 'red' ? 'green' : state === 'green' ? 'yellow' : 'red';
    default:
      return state;
  }
}
```

#### æœ€ä½³å®è·µ
- **æ¸…æ™°çš„ Action ç±»å‹**ï¼šä½¿ç”¨å¸¸é‡å®šä¹‰ action ç±»å‹ï¼Œé¿å…æ‹¼å†™é”™è¯¯ã€‚
- **åˆå§‹çŠ¶æ€è§„èŒƒåŒ–**ï¼šç¡®ä¿åˆå§‹çŠ¶æ€ç»“æ„æ¸…æ™°ã€‚
- **ç»“åˆ Context**ï¼šå°† `useReducer` ä¸ `useContext` ç»“åˆï¼Œç®¡ç†å…¨å±€çŠ¶æ€ã€‚

*Tipsï¼šå¦‚æœçŠ¶æ€é€»è¾‘ç®€å•ï¼Œä¼˜å…ˆç”¨ `useState`ï¼Œé¿å… `useReducer` çš„å¤æ‚æ€§ã€‚*

---

### 2.5 useCallback & useMemoï¼šæ€§èƒ½çš„â€œä¼˜åŒ–å¤§å¸ˆâ€ âš¡

#### useCallbackï¼šç¼“å­˜å‡½æ•°
`useCallback` è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å›è°ƒå‡½æ•°ï¼Œä»…åœ¨ä¾èµ–å˜åŒ–æ—¶æ›´æ–°ï¼š

```jsx
const memoizedCallback = useCallback(() => {
  // å›è°ƒé€»è¾‘
}, [dependencies]);
```

**ç¤ºä¾‹ï¼šä¼˜åŒ–å­ç»„ä»¶**

```jsx
function Parent() {
  const [count, setCount] = useState(0);

  const handleClick = useCallback(() => {
    console.log(count);
  }, [count]);

  return <Child onClick={handleClick} />;
}

const Child = React.memo(({ onClick }) => (
  <button onClick={onClick}>ç‚¹å‡»</button>
));
```

#### useMemoï¼šç¼“å­˜å€¼
`useMemo` è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„å€¼ï¼Œä»…åœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°è®¡ç®—ï¼š

```jsx
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```

**ç¤ºä¾‹ï¼šä¼˜åŒ–å¤æ‚è®¡ç®—**

```jsx
function ExpensiveList({ items }) {
  const sortedItems = useMemo(() => {
    return [...items].sort((a, b) => a - b);
  }, [items]);

  return <ul>{sortedItems.map((item) => <li key={item}>{item}</li>)}</ul>;
}
```

#### æ·±å…¥åŸç†
ä¸¤è€…éƒ½åŸºäº React çš„ **è®°å¿†åŒ–æœºåˆ¶**ï¼Œé€šè¿‡æ¯”è¾ƒä¾èµ–æ•°ç»„é¿å…ä¸å¿…è¦çš„è®¡ç®—æˆ–å‡½æ•°åˆ›å»ºã€‚æºç ä¸­ï¼Œå®ƒä»¬ä¾èµ– `useMemo` çš„åº•å±‚å®ç°ã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useCallback(callback, deps) {
  return useMemo(() => callback, deps);
}
```

ç±»æ¯”ï¼š`useCallback` å’Œ `useMemo` å°±åƒä½ çš„ç§äººåŠ©ç†ï¼Œå¸®ä½ è®°ä½é‡è¦çš„ä¼šè®®ï¼ˆå‡½æ•°æˆ–å€¼ï¼‰ï¼Œåªæœ‰åœ¨æ—¥ç¨‹ï¼ˆä¾èµ–ï¼‰å˜åŒ–æ—¶æ‰æé†’ä½ ã€‚

#### æœ€ä½³å®è·µ
- **ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨**ï¼šæ€§èƒ½ä¼˜åŒ–æœ‰æˆæœ¬ï¼Œè¿‡æ—©ä¼˜åŒ–å¯èƒ½é€‚å¾—å…¶åã€‚
- **ä¾èµ–æ•°ç»„ç²¾å‡†**ï¼šç¡®ä¿åŒ…å«æ‰€æœ‰ç›¸å…³ä¾èµ–ã€‚
- **ç»“åˆ React.memo**ï¼šä¼˜åŒ–å­ç»„ä»¶æ¸²æŸ“ã€‚

*Tipsï¼šè°ƒè¯•æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”¨ React DevTools æ£€æŸ¥æ¸²æŸ“æ¬¡æ•°ï¼Œç¡®è®¤æ˜¯å¦éœ€è¦ `useCallback` æˆ– `useMemo`ã€‚*

---

### 2.6 useRefï¼šæŒä¹…åŒ–çš„â€œæ—¶é—´èƒ¶å›Šâ€ â³

#### åŸºæœ¬ç”¨æ³•
`useRef` åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨å¯¹è±¡ï¼Œ`.current` å±æ€§ä¿å­˜å€¼ï¼Œä¸”ä¸è§¦å‘é‡æ¸²æŸ“ï¼š

```jsx
const ref = useRef(initialValue);
```

**ç¤ºä¾‹ï¼šDOM æ“ä½œ**

```jsx
function TextInput() {
  const inputRef = useRef(null);

  const focusInput = () => {
    inputRef.current.focus();
  };

  return (
    <div>
      <input ref={inputRef} />
      <button onClick={focusInput}>èšç„¦</button>
    </div>
  );
}
```

#### æ·±å…¥åŸç†
`useRef` çš„ `.current` æ˜¯ Fiber èŠ‚ç‚¹ä¸Šçš„æŒä¹…åŒ–å±æ€§ï¼ŒReact ä¿è¯å…¶åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ç¨³å®šã€‚

æºç ç®€æï¼ˆä¼ªä»£ç ï¼‰ï¼š

```js
function useRef(initialValue) {
  const hook = mountRef(initialValue);
  return hook.current;
}
```

ç±»æ¯”ï¼š`useRef` åƒä¸€ä¸ªå¯†å°çš„æ—¶é—´èƒ¶å›Šï¼Œä¿å­˜ä½ çš„å®è—ï¼ˆå€¼æˆ– DOM å¼•ç”¨ï¼‰ï¼Œæ— è®ºç»„ä»¶å¦‚ä½•å˜åŒ–ï¼Œå®ƒéƒ½å²¿ç„¶ä¸åŠ¨ã€‚

#### å¸¸è§åœºæ™¯
1. **ä¿å­˜ä¸Šä¸€æ¬¡çŠ¶æ€**ï¼š

```jsx
function Counter() {
  const [count, setCount] = useState(0);
  const prevCountRef = useRef();

  useEffect(() => {
    prevCountRef.current = count;
  }, [count]);

  return <div>å½“å‰ï¼š{count}ï¼Œä¸Šä¸€æ¬¡ï¼š{prevCountRef.current}</div>;
}
```

2. **é˜²æŠ–/èŠ‚æµ**ï¼š

```jsx
function SearchInput() {
  const [query, setQuery] = useState('');
  const timeoutRef = useRef(null);

  const handleChange = (value) => {
    clearTimeout(timeoutRef.current);
    timeoutRef.current = setTimeout(() => {
      setQuery(value);
    }, 500);
  };

  return <input onChange={(e) => handleChange(e.target.value)} />;
}
```

#### æœ€ä½³å®è·µ
- **æ˜ç¡®ç”¨é€”**ï¼š`useRef` é€‚åˆä¿å­˜ä¸å½±å“æ¸²æŸ“çš„å€¼ã€‚
- **é¿å…æ»¥ç”¨**ï¼šä¸è¦ç”¨ `useRef` æ›¿ä»£çŠ¶æ€ç®¡ç†ã€‚
- **ç»“åˆ forwardRef**ï¼šå¤„ç†ç»„ä»¶é—´çš„ ref ä¼ é€’ã€‚

*Tipsï¼š`useRef` çš„ `.current` å¯å˜ï¼Œä½†å°½é‡ä¿æŒå…¶è¯­ä¹‰æ¸…æ™°ï¼Œé¿å…å­˜å‚¨å¤æ‚é€»è¾‘ã€‚*

---

## 3. é«˜çº§ Hook æ¢ç§˜ ğŸŒ 

### 3.1 useLayoutEffectï¼šåŒæ­¥çš„â€œå¹•åè‹±é›„â€

`useLayoutEffect` ä¸ `useEffect` ç±»ä¼¼ï¼Œä½†å®ƒåœ¨ DOM æ›´æ–°åã€æµè§ˆå™¨ç»˜åˆ¶å‰åŒæ­¥æ‰§è¡Œï¼Œé€‚åˆå¤„ç†å¸ƒå±€ç›¸å…³å‰¯ä½œç”¨ã€‚

**ç¤ºä¾‹ï¼šæµ‹é‡ DOM**

```jsx
function MeasureElement() {
  const ref = useRef(null);

  useLayoutEffect(() => {
    console.log(ref.current.getBoundingClientRect());
  }, []);

  return <div ref={ref}>æµ‹é‡æˆ‘</div>;
}
```

*Tipsï¼š`useLayoutEffect` å¯èƒ½é˜»å¡æ¸²æŸ“ï¼Œä»…åœ¨éœ€è¦åŒæ­¥æ“ä½œ DOM æ—¶ä½¿ç”¨ã€‚*

### 3.2 useTransitionï¼šäº¤äº’çš„â€œå¹³æ»‘è¿‡æ¸¡â€

`useTransition`ï¼ˆReact 18+ï¼‰ç”¨äºæ ‡è®°ä½ä¼˜å…ˆçº§çŠ¶æ€æ›´æ–°ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼š

```jsx
const [isPending, startTransition] = useTransition();
```

**ç¤ºä¾‹ï¼šå»¶è¿ŸåŠ è½½**

```jsx
function SearchResults({ query }) {
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();

  useEffect(() => {
    startTransition(() => {
      fetchResults(query).then(setResults);
    });
  }, [query]);

  return <div>{isPending ? 'åŠ è½½ä¸­...' : results.join(', ')}</div>;
}
```

*Tipsï¼š`useTransition` é€‚åˆä¼˜åŒ–å¤æ‚ UI çš„å“åº”æ€§ï¼Œä½†éœ€æƒè¡¡ä¼˜å…ˆçº§ã€‚*

---

## 4. è‡ªå®šä¹‰ Hookï¼šæ‰“é€ ä½ çš„â€œè¶…çº§æ­¦å™¨â€ ğŸ› ï¸

è‡ªå®šä¹‰ Hook æ˜¯å¤ç”¨é€»è¾‘çš„åˆ©å™¨ï¼Œé€šè¿‡ç»„åˆç°æœ‰ Hook åˆ›å»ºå¯å¤ç”¨çš„å‡½æ•°ã€‚

**ç¤ºä¾‹ï¼šuseWindowSize**

```jsx
function useWindowSize() {
  const [windowSize, setWindowSize] = useState({
    width: undefined,
    height: undefined,
  });

  useEffect(() => {
    const handleResize = () => {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight,
      });
    };
    window.addEventListener('resize', handleResize);
    handleResize();
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return windowSize;
}

function App() {
  const { width, height } = useWindowSize();
  return <div>çª—å£å°ºå¯¸ï¼š{width} x {height}</div>;
}
```

**æœ€ä½³å®è·µ**ï¼š
- **å‘½åä»¥ use å¼€å¤´**ï¼šéµå¾ª Hook å‘½åè§„èŒƒã€‚
- **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªè‡ªå®šä¹‰ Hook åªè§£å†³ä¸€ä¸ªé—®é¢˜ã€‚
- **æ–‡æ¡£æ¸…æ™°**ï¼šä¸ºè‡ªå®šä¹‰ Hook ç¼–å†™æ³¨é‡Šæˆ–ç±»å‹å®šä¹‰ã€‚

*Tipsï¼šè‡ªå®šä¹‰ Hook æ˜¯é€»è¾‘å¤ç”¨çš„â€œç‘å£«å†›åˆ€â€ï¼Œä½†ä¸è¦è¿‡åº¦æŠ½è±¡ï¼Œä¿æŒç®€å•æ˜“æ‡‚ã€‚*

---

## 5. Hook çš„å“²å­¦æ€è€ƒï¼šä»£ç ä¸äººç”Ÿ ğŸµ

React Hooks ä¸ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œè¿˜è•´å«ç€æ·±åˆ»çš„å“²å­¦å¯ç¤ºã€‚å®ƒä»¬æ•™ä¼šæˆ‘ä»¬ï¼š

- **æ‹¥æŠ±å˜åŒ–**ï¼ˆ`useState`ï¼‰ï¼šçŠ¶æ€æ˜¯æµåŠ¨çš„ï¼Œå°±åƒäººç”Ÿä¸­çš„èµ·ä¼ï¼Œå­¦ä¼šæ¥å—å¹¶ä¼˜é›…åœ°æ›´æ–°ã€‚
- **ç®¡ç†å‰¯ä½œç”¨**ï¼ˆ`useEffect`ï¼‰ï¼šç”Ÿæ´»ä¸­çš„â€œå‰¯ä½œç”¨â€ï¼ˆå¦‚æƒ…ç»ªã€ä¹ æƒ¯ï¼‰éœ€è¦åŠæ—¶æ¸…ç†ï¼Œé¿å…â€œå†…å­˜æ³„æ¼â€ã€‚
- **å¤ç”¨æ™ºæ…§**ï¼ˆè‡ªå®šä¹‰ Hookï¼‰ï¼šå°†ç»éªŒå°è£…ï¼Œåˆ†äº«ç»™ä»–äººï¼Œå°±åƒå¼€æºç¤¾åŒºçš„ç²¾ç¥ã€‚

> â€œä»£ç æ˜¯äººç”Ÿçš„æŠ•å½±ï¼ŒHook æ˜¯æˆ‘ä»¬åº”å¯¹å˜åŒ–çš„æ™ºæ…§ã€‚â€ â€”â€” æ™“é¾™

å†™ä»£ç å¦‚ä¿®è¡Œï¼ŒHooks è®©æˆ‘ä»¬ä»¥æ›´å‡½æ•°å¼çš„æ€ç»´é¢å¯¹å¤æ‚é—®é¢˜ã€‚æ­£å¦‚è€å­æ‰€è¯´ï¼šâ€œæ— ä¸ºè€Œæ— ä¸ä¸ºâ€ï¼ŒHooks çš„ç®€æ´ API èƒŒåï¼Œæ˜¯å¯¹å‰ç«¯å¼€å‘å¤æ‚æ€§çš„æ·±åˆ»æ´å¯Ÿã€‚

---

## 6. æ€»ç»“ä¸æœªæ¥å±•æœ› ğŸŒ…

React Hooks æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„åŸºçŸ³ï¼Œå®ƒä»¬ä»¥å‡½æ•°å¼çš„ä¼˜é›…ï¼Œè§£å†³äº†çŠ¶æ€ç®¡ç†ã€é€»è¾‘å¤ç”¨å’Œæ€§èƒ½ä¼˜åŒ–çš„éš¾é¢˜ã€‚é€šè¿‡æœ¬æ–‡ï¼Œä½ ä¸ä»…æŒæ¡äº†å¸¸ç”¨ Hook çš„ç”¨æ³•ï¼Œè¿˜æ·±å…¥å…¶åŸç†ï¼Œå­¦ä¼šäº†æœ€ä½³å®è·µï¼Œç”šè‡³è§¦æ‘¸åˆ°äº†ä»£ç ä¸äººç”Ÿçš„å…±é¸£ã€‚

æœªæ¥ï¼ŒReact å¯èƒ½ä¼šæ¨å‡ºæ›´å¤šå®éªŒæ€§ Hookï¼ˆå¦‚ `use` Hookï¼‰ï¼Œè¿›ä¸€æ­¥ç®€åŒ–æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦ä¿æŒå­¦ä¹ ï¼Œæ‹¥æŠ±å˜åŒ–ï¼Œç”¨ Hooks ä¹¦å†™æ›´ä¼˜é›…çš„ä»£ç ã€‚

> â€œå­¦æ— æ­¢å¢ƒï¼Œä»£ç æ— æ¶¯ã€‚æ„¿ä½ ä»¥ Hook ä¸ºèˆŸï¼Œèˆªå‘å‰ç«¯çš„æ˜Ÿè¾°å¤§æµ·ã€‚â€ â€”â€” æ™“é¾™

ç°åœ¨ï¼Œæ‹¿èµ·é”®ç›˜ï¼Œè¯•è¯•æœ¬æ–‡çš„ç¤ºä¾‹ï¼Œåˆ›é€ å±äºä½ çš„ React ä¼ å¥‡å§ï¼ğŸš€

---