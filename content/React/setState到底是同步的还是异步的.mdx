---
title: "setStateåˆ°åº•æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼ŸğŸ¤”"
date: "2023-12-09"
description: "æ·±å…¥å‰–æ React ä¸­ setState çš„å·¥ä½œæœºåˆ¶ï¼Œæ­ç§˜å…¶åŒæ­¥ä¸å¼‚æ­¥çš„æœ¬è´¨ï¼Œç»“åˆåŸç†ã€ç¤ºä¾‹å’Œæœ€ä½³å®è·µï¼ŒåŠ©ä½ å½»åº•æŒæ¡è¿™ä¸€æ ¸å¿ƒæ¦‚å¿µã€‚"
keywords: "React, setState, åŒæ­¥, å¼‚æ­¥, çŠ¶æ€ç®¡ç†, å‰ç«¯å¼€å‘, JavaScript, React åŸç†"
author: "æ™“é¾™"
image: "/images/hero/setstate.jpg"
tags: ["React", "JavaScript", "å‰ç«¯å¼€å‘"]
category: "React"
---

ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼ŒReact çš„ `setState` å¯èƒ½æ˜¯ä½ æ¯å¤©éƒ½è¦æ‰“äº¤é“çš„â€œè€æœ‹å‹â€ã€‚ä½†è¿™ä¸ªæœ‹å‹æœ‰æ—¶å€™æœ‰ç‚¹â€œæ‰æ‘¸ä¸é€â€ï¼šå®ƒåˆ°åº•æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿè¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œå´è¶³ä»¥è®©åˆå­¦è€…æŒ å¤´ï¼Œç”šè‡³è®©ä¸€äº›è€æ‰‹åœ¨æŸäº›åœºæ™¯ä¸‹ç¿»è½¦ã€‚ç½‘ä¸Šå…³äºè¿™ä¸ªè¯é¢˜çš„è®¨è®ºå¤šå¦‚ç‰›æ¯›ï¼Œä½†ç­”æ¡ˆå¾€å¾€æ¨¡æ£±ä¸¤å¯ï¼Œç”šè‡³äº’ç›¸çŸ›ç›¾ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥ä¸€æ¬¡å½»åº•çš„â€œè§£å‰–â€ï¼Œä» React çš„åº•å±‚åŸç†åˆ°å®é™…ä»£ç ç¤ºä¾‹ï¼Œå†åˆ°æœ€ä½³å®è·µï¼Œå¸¦ä½ æŠŠ `setState` çš„â€œçœŸé¢ç›®â€çœ‹å¾—æ¸…æ¸…æ¥šæ¥šï¼ğŸš€

è¿™ç¯‡æ–‡ç« çš„ç›®æ ‡ä¸ä»…æ˜¯å›ç­”â€œåŒæ­¥è¿˜æ˜¯å¼‚æ­¥â€ï¼Œè€Œæ˜¯è®©ä½ ç†è§£ **ä¸ºä»€ä¹ˆ** ä¼šè¿™æ ·ï¼Œä»¥åŠå¦‚ä½•åœ¨å®é™…å¼€å‘ä¸­ä¼˜é›…åœ°é©¾é©­å®ƒã€‚æˆ‘ä»¬ä¼šç”¨ç±»æ¯”ã€å¹½é»˜ã€ä»£ç å’Œå®è·µæ¥è®©å†…å®¹ç”ŸåŠ¨æœ‰è¶£ï¼ŒåŒæ—¶ä¿æŒè¶³å¤Ÿçš„æ·±åº¦ï¼Œé€‚åˆä» React æ–°æ‰‹åˆ°èµ„æ·±å¼€å‘è€…ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºâ€œçŠ¶æ€ç®¡ç†æ¢ç§˜ä¹‹æ—…â€å§ï¼ğŸ—ºï¸

## æ–‡ç« ç»“æ„ï¼šæ€ç»´å¯¼å›¾ ğŸ§ 

ä¸ºäº†è®©è¿™ç¯‡ 8000+ å­—çš„é•¿æ–‡æ¸…æ™°æ˜“è¯»ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹ç»“æ„ï¼Œå°±åƒç»™æ¢é™©ç”»ä¸€å¼ åœ°å›¾ï¼š

1. **é—®é¢˜çš„èµ·æº**ï¼šä¸ºä»€ä¹ˆ `setState` çš„åŒæ­¥/å¼‚æ­¥é—®é¢˜è®©äººå›°æƒ‘ï¼Ÿ
2. **React çš„çŠ¶æ€ç®¡ç†åŸºç¡€**ï¼šå¿«é€Ÿå›é¡¾ `setState` çš„ä½œç”¨å’ŒåŸºæœ¬ç”¨æ³•ã€‚
3. **åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿæ ¸å¿ƒå‰–æ**ï¼š
   - React çš„äº‹ä»¶å¤„ç†æœºåˆ¶
   - `setState` çš„æ‰¹é‡æ›´æ–°
   - Fiber æ¶æ„çš„å½±å“
4. **æ·±å…¥åŸç†**ï¼šä»è°ƒç”¨æ ˆåˆ°è°ƒåº¦å™¨çš„å¹•åæ•…äº‹ã€‚
5. **å¸¸è§åœºæ™¯ä¸ä»£ç ç¤ºä¾‹**ï¼šé€šè¿‡æ¡ˆä¾‹çœ‹ `setState` çš„è¡¨ç°ã€‚
6. **è¯¯åŒºä¸é™·é˜±**ï¼šé‚£äº›è®©ä½ ç¿»è½¦çš„â€œå‘â€ã€‚
7. **æœ€ä½³å®è·µ**ï¼šå¦‚ä½•ä¼˜é›…åœ°ä½¿ç”¨ `setState`ã€‚
8. **æœªæ¥å±•æœ›**ï¼šReact 18+ ä¸­ `setState` çš„å˜åŒ–ã€‚
9. **æ€»ç»“**ï¼šä¸€å¼ å›¾å›é¡¾æ ¸å¿ƒè¦ç‚¹ã€‚

å¥½äº†ï¼Œåœ°å›¾ç”»å¥½ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä¸€èŠ‚ä¸€èŠ‚åœ°â€œå¼€è’â€ï¼

---

## 1. é—®é¢˜çš„èµ·æºï¼šä¸ºä»€ä¹ˆ `setState` è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Ÿ ğŸ˜µ

å¦‚æœä½ åˆšå¼€å§‹å­¦ Reactï¼Œå¯èƒ½ä¼šè§‰å¾— `setState` å¾ˆç®€å•ï¼šè°ƒç”¨å®ƒï¼ŒçŠ¶æ€æ›´æ–°ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå®Œäº‹å„¿ï¼ä½†å¾ˆå¿«ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„ä»£ç ï¼š

```javascript
handleClick() {
  this.setState({ count: this.state.count + 1 });
  console.log(this.state.count); // å’¦ï¼Ÿæ€ä¹ˆæ²¡å˜ï¼Ÿ
}
```

ä½ æ»¡å¿ƒæœŸå¾… `console.log` è¾“å‡ºæ–°çš„ `count`ï¼Œç»“æœå´å‘ç°å®ƒè¿˜æ˜¯è€æ ·å­ã€‚éš¾é“ `setState` æ²¡èµ·ä½œç”¨ï¼Ÿè¿˜æ˜¯æˆ‘å“ªé‡Œå†™é”™äº†ï¼Ÿå†è¯•è¯•è¿™æ ·ï¼š

```javascript
handleClick() {
  this.setState({ count: this.state.count + 1 });
  this.setState({ count: this.state.count + 1 });
  console.log(this.state.count); // è¿˜æ˜¯æ²¡å˜ï¼Ÿï¼
}
```

è¿™ä¸‹æ›´æ‡µäº†ï¼šè°ƒç”¨äº†ä¸¤æ¬¡ `setState`ï¼Œä½†çŠ¶æ€ä¼¼ä¹åªæ›´æ–°äº†ä¸€æ¬¡ï¼Ÿæ­¤æ—¶ï¼Œä½ çš„å†…å¿ƒå¯èƒ½å·²ç»å¼€å§‹æ€€ç–‘äººç”Ÿï¼š`setState` åˆ°åº•æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿä¸ºä»€ä¹ˆå®ƒçš„è¡Œä¸ºè¿™ä¹ˆâ€œé£˜å¿½ä¸å®šâ€ï¼Ÿ

å…¶å®ï¼Œè¿™ç§å›°æƒ‘çš„æ ¹æºåœ¨äº **React å¯¹çŠ¶æ€æ›´æ–°çš„è®¾è®¡å“²å­¦**ã€‚React å¹¶ä¸æ˜¯ç®€å•åœ°â€œæ”¹ä¸ªå˜é‡â€ï¼Œè€Œæ˜¯æœ‰ä¸€å¥—å¤æ‚çš„è°ƒåº¦æœºåˆ¶æ¥ç¡®ä¿æ€§èƒ½å’Œä¸€è‡´æ€§ã€‚`setState` çš„â€œåŒæ­¥è¿˜æ˜¯å¼‚æ­¥â€å¹¶ä¸æ˜¯ä¸€ä¸ªéé»‘å³ç™½çš„é—®é¢˜ï¼Œè€Œæ˜¯ **å–å†³äºä¸Šä¸‹æ–‡**ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šä¸€æ­¥æ­¥æ­å¼€å®ƒçš„ç¥ç§˜é¢çº±ã€‚

> *å° Tipsï¼šå½“ä½ å¯¹ `setState` çš„è¡Œä¸ºæ„Ÿåˆ°å›°æƒ‘æ—¶ï¼Œè¯•ç€åœ¨ä»£ç ä¸­åŠ å…¥ `console.log` æ¥è·Ÿè¸ªçŠ¶æ€å˜åŒ–ï¼Œä½†åˆ«å¿˜äº†ï¼Œ`console.log` æœ¬èº«å¯èƒ½ä¹Ÿä¼šâ€œæ¬ºéª—â€ä½ ï¼Œå› ä¸ºå®ƒæ•è·çš„æ˜¯æŸä¸€æ—¶åˆ»çš„å¿«ç…§ã€‚*

---

## 2. React çš„çŠ¶æ€ç®¡ç†åŸºç¡€ï¼šè®¤è¯† `setState` ğŸ“

åœ¨æ·±å…¥æ¢è®¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¸©ä¹ ä¸€ä¸‹ `setState` çš„åŸºæœ¬çŸ¥è¯†ï¼Œç¡®ä¿å¤§å®¶ç«™åœ¨åŒä¸€èµ·è·‘çº¿ä¸Šã€‚

### 2.1 `setState` æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

`setState` æ˜¯ React ç±»ç»„ä»¶ï¼ˆä»¥åŠéƒ¨åˆ† hooks åœºæ™¯ï¼‰ä¸­ç”¨æ¥æ›´æ–°ç»„ä»¶çŠ¶æ€çš„æ ¸å¿ƒ APIã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼š

1. **æ›´æ–°çŠ¶æ€**ï¼šä¿®æ”¹ `this.state` ä¸­çš„å€¼ã€‚
2. **è§¦å‘é‡æ¸²æŸ“**ï¼šé€šçŸ¥ React éœ€è¦é‡æ–°è®¡ç®—è™šæ‹Ÿ DOM å¹¶æ›´æ–° UIã€‚
3. **ä¿æŒå•å‘æ•°æ®æµ**ï¼šç¡®ä¿çŠ¶æ€å˜åŒ–å¯é¢„æµ‹ã€å¯è¿½æº¯ã€‚

åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```javascript
class Counter extends React.Component {
  state = { count: 0 };

  handleClick = () => {
    this.setState({ count: this.state.count + 1 });
  };

  render() {
    return <button onClick={this.handleClick}>{this.state.count}</button>;
  }
}
```

æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œ`count` å¢åŠ  1ï¼ŒUI éšä¹‹æ›´æ–°ã€‚ç®€å•æ˜äº†ï¼Œå¯¹å§ï¼Ÿ

### 2.2 `setState` çš„ä¸¤ç§ç”¨æ³•

`setState` æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹å¼ï¼Œè¿™å¯¹ç†è§£å®ƒçš„è¡Œä¸ºå¾ˆé‡è¦ï¼š

1. **ç›´æ¥ä¼ é€’å¯¹è±¡**ï¼š
   ```javascript
   this.setState({ count: this.state.count + 1 });
   ```
   è¿™ç§æ–¹å¼æœ€å¸¸è§ï¼Œä½†æœ‰å±€é™æ€§ï¼ˆç¨åä¼šè®²ï¼‰ã€‚

2. **ä¼ é€’å‡½æ•°**ï¼š
   ```javascript
   this.setState((prevState) => ({ count: prevState.count + 1 }));
   ```
   å‡½æ•°å¼æ›´æ–°å¯ä»¥è®¿é—®ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œé€‚åˆéœ€è¦åŸºäºå½“å‰çŠ¶æ€è®¡ç®—æ–°çŠ¶æ€çš„åœºæ™¯ã€‚

### 2.3 ä¸ºä»€ä¹ˆä¸ç”¨ `this.state.count++`ï¼Ÿ

React çš„çŠ¶æ€æ˜¯â€œä¸å¯å˜â€çš„ï¼Œç›´æ¥ä¿®æ”¹ `this.state` ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œä¹Ÿä¼šç ´å React çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ã€‚`setState` æ˜¯å”¯ä¸€åˆæ³•çš„ä¿®æ”¹çŠ¶æ€çš„é€”å¾„ã€‚

> *å° Tipsï¼šæ°¸è¿œä¸è¦ç›´æ¥ä¿®æ”¹ `this.state`ï¼Œå¦åˆ™ React ä¼šâ€œå†·æ¼ åœ°æ— è§†â€ä½ çš„å˜åŒ–ï¼Œå¯¼è‡´ UI å’ŒçŠ¶æ€ä¸åŒæ­¥ã€‚*

---

## 3. åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿæ ¸å¿ƒå‰–æ ğŸ”

å¥½äº†ï¼Œé‡å¤´æˆæ¥äº†ï¼`setState` åˆ°åº•æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼š**æ—¢ä¸æ˜¯ç»å¯¹çš„åŒæ­¥ï¼Œä¹Ÿä¸æ˜¯ç»å¯¹çš„å¼‚æ­¥ï¼Œè€Œæ˜¯å–å†³äºä¸Šä¸‹æ–‡**ã€‚ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥ React çš„äº‹ä»¶å¤„ç†å’Œæ›´æ–°æœºåˆ¶ã€‚

### 3.1 React çš„äº‹ä»¶å¤„ç†æœºåˆ¶

React çš„äº‹ä»¶ç³»ç»Ÿæ˜¯åˆæˆäº‹ä»¶ï¼ˆSynthetic Eventï¼‰çš„åŒ…è£…ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»‘å®šæµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶ã€‚å½“ä½ ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®è§¦å‘ `onClick` æ—¶ï¼ŒReact ä¼šæ•è·äº‹ä»¶å¹¶å°†å…¶æ”¾å…¥è‡ªå·±çš„äº‹ä»¶é˜Ÿåˆ—ä¸­å¤„ç†ã€‚è¿™æ„å‘³ç€ï¼š

- React çš„äº‹ä»¶å¤„ç†æ˜¯ **æ‰¹é‡æ‰§è¡Œ** çš„ã€‚
- åœ¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œæ‰€æœ‰çš„ `setState` è°ƒç”¨ä¼šè¢«æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€åœ¨äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ª tick å¤„ç†ã€‚

æ¥çœ‹ä¸€ä¸ªç»å…¸ä¾‹å­ï¼š

```javascript
handleClick = () => {
  this.setState({ count: this.state.count + 1 });
  console.log(this.state.count); // è¾“å‡ºæ—§å€¼
};
```

ä¸ºä»€ä¹ˆ `console.log` è¾“å‡ºçš„æ˜¯æ—§å€¼ï¼Ÿå› ä¸º `setState` å¹¶æ²¡æœ‰ç«‹åˆ»æ›´æ–° `this.state`ï¼Œè€Œæ˜¯å°†æ›´æ–°è¯·æ±‚æ”¾å…¥äº† React çš„æ›´æ–°é˜Ÿåˆ—ï¼Œç­‰å¾…äº‹ä»¶å¤„ç†å®Œæ¯•åç»Ÿä¸€æ‰§è¡Œã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå¼‚æ­¥â€è¡Œä¸ºã€‚

### 3.2 æ‰¹é‡æ›´æ–°ï¼šReact çš„æ€§èƒ½é­”æ³• âœ¨

React ä¹‹æ‰€ä»¥ä¸ç«‹å³æ›´æ–°çŠ¶æ€ï¼Œæ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¯æ¬¡ `setState` éƒ½ç«‹åˆ»è§¦å‘é‡æ¸²æŸ“ï¼Œå¤šæ¬¡è°ƒç”¨ `setState` ä¼šå¯¼è‡´å¤šæ¬¡æ¸²æŸ“ï¼Œæ€§èƒ½ä¼šåƒâ€œè¿‡å±±è½¦â€ä¸€æ ·ç›´çº¿ä¸‹é™ã€‚React çš„è§£å†³æ–¹æ¡ˆæ˜¯ **æ‰¹é‡æ›´æ–°**ï¼ˆbatchingï¼‰ã€‚

å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```javascript
handleClick = () => {
  this.setState({ count: this.state.count + 1 });
  this.setState({ count: this.state.count + 1 });
  this.setState({ count: this.state.count + 1 });
};
```

ä½ å¯èƒ½ä»¥ä¸º `count` ä¼šå¢åŠ  3ï¼Œä½†å®é™…ä¸Šåªå¢åŠ  1ï¼ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º React åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ä¼šåˆå¹¶å¤šæ¬¡ `setState` è°ƒç”¨ï¼Œåªä¿ç•™æœ€åçš„çŠ¶æ€æ›´æ–°ã€‚æœ€ç»ˆæ•ˆæœç­‰ä»·äºï¼š

```javascript
this.setState({ count: this.state.count + 1 });
```

è¿™ç§æ‰¹é‡æ›´æ–°æœºåˆ¶æ˜¯ React é«˜æ€§èƒ½çš„ç§˜è¯€ä¹‹ä¸€ï¼Œä½†ä¹Ÿå¯¼è‡´äº†åˆå­¦è€…çš„å›°æƒ‘ã€‚

### 3.3 Fiber æ¶æ„çš„å½±å“

ä» React 16 å¼€å§‹ï¼ŒReact å¼•å…¥äº† Fiber æ¶æ„ï¼Œè¿™è¿›ä¸€æ­¥å¤æ‚åŒ–äº† `setState` çš„è¡Œä¸ºã€‚Fiber å…è®¸ React å°†æ›´æ–°ä»»åŠ¡æ‹†åˆ†æˆå°å—ï¼Œä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚ç”¨æˆ·äº¤äº’ï¼‰ï¼Œè€Œå°†ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆæ¯”å¦‚æ•°æ®è¯·æ±‚åçš„çŠ¶æ€æ›´æ–°ï¼‰æ¨è¿Ÿæ‰§è¡Œã€‚

è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½ åœ¨æŸäº›åœºæ™¯ä¸‹è°ƒç”¨ `setState`ï¼ŒReact å¯èƒ½ä¼šé€‰æ‹©â€œç¨åå†æ›´æ–°â€ï¼Œè¿›ä¸€æ­¥åŠ å‰§äº†â€œå¼‚æ­¥â€çš„æ„Ÿè§‰ã€‚

### 3.4 åŒæ­¥çš„ä¾‹å¤–æƒ…å†µ

è™½ç„¶ `setState` åœ¨ React çš„äº‹ä»¶å¤„ç†ä¸­é€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œå®ƒä¼šè¡¨ç°å¾—åƒåŒæ­¥çš„ã€‚æ¯”å¦‚ï¼š

- **é React äº‹ä»¶ä¸Šä¸‹æ–‡**ï¼šåœ¨ `setTimeout`ã€`setInterval` æˆ–åŸç”Ÿ DOM äº‹ä»¶ä¸­ï¼Œ`setState` ä¼šç«‹å³æ›´æ–°çŠ¶æ€ã€‚

```javascript
handleClick = () => {
  setTimeout(() => {
    this.setState({ count: this.state.count + 1 });
    console.log(this.state.count); // è¾“å‡ºæ–°å€¼ï¼
  }, 0);
};
```

- **React çš„ `unstable_batchedUpdates`**ï¼šé€šè¿‡æ‰‹åŠ¨è°ƒç”¨è¿™ä¸ªå†…éƒ¨ APIï¼Œå¯ä»¥å¼ºåˆ¶æ‰¹é‡æ›´æ–°ã€‚

è¿™äº›ä¾‹å¤–æƒ…å†µè¡¨æ˜ï¼Œ`setState` çš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯ JavaScript è¿è¡Œæ—¶çš„å¼‚æ­¥ï¼ˆæ¯”å¦‚ Promiseï¼‰ï¼Œè€Œæ˜¯ React è‡ªå·±çš„è°ƒåº¦æœºåˆ¶ã€‚

> *å° Tipsï¼šå¦‚æœä½ éœ€è¦åœ¨ `setState` åç«‹å³è·å–æœ€æ–°çŠ¶æ€ï¼Œè€ƒè™‘ä½¿ç”¨å›è°ƒå‡½æ•°æˆ–å‡½æ•°å¼æ›´æ–°ï¼Œè€Œä¸æ˜¯ä¾èµ– `this.state` çš„å³æ—¶å€¼ã€‚*

---

## 4. æ·±å…¥åŸç†ï¼šä»è°ƒç”¨æ ˆåˆ°è°ƒåº¦å™¨ ğŸ› ï¸

ä¸ºäº†æ›´å½»åº•åœ°ç†è§£ `setState`ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹ React çš„å†…éƒ¨å®ç°ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šå°½é‡ç”¨é€šä¿—çš„è¯­è¨€å’Œç±»æ¯”æ¥è§£é‡Šï¼

### 4.1 `setState` çš„è°ƒç”¨æµç¨‹

å½“ä½ è°ƒç”¨ `setState` æ—¶ï¼ŒReact å¤§è‡´ä¼šç»å†ä»¥ä¸‹æ­¥éª¤ï¼š

1. **åˆ›å»ºæ›´æ–°å¯¹è±¡**ï¼šReact ä¼šå°†ä½ çš„çŠ¶æ€æ›´æ–°ï¼ˆå¯¹è±¡æˆ–å‡½æ•°ï¼‰å°è£…æˆä¸€ä¸ªæ›´æ–°å¯¹è±¡ï¼Œæ”¾å…¥æ›´æ–°é˜Ÿåˆ—ã€‚
2. **æ ‡è®°ç»„ä»¶ä¸ºâ€œè„â€**ï¼šReact æ ‡è®°è°ƒç”¨ `setState` çš„ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ã€‚
3. **è°ƒåº¦æ›´æ–°**ï¼šReact çš„è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰å†³å®šä½•æ—¶å¤„ç†è¿™äº›æ›´æ–°ã€‚
4. **æ‰¹é‡å¤„ç†**ï¼šåœ¨äº‹ä»¶å¾ªç¯ç»“æŸæ—¶ï¼ŒReact åˆå¹¶æ‰€æœ‰æ›´æ–°ï¼Œè®¡ç®—æ–°çš„çŠ¶æ€ã€‚
5. **è§¦å‘æ¸²æŸ“**ï¼šæ›´æ–°è™šæ‹Ÿ DOMï¼Œæ¯”è¾ƒå·®å¼‚ï¼Œåº”ç”¨åˆ°çœŸå® DOMã€‚

è¿™å°±åƒä½ åœ¨é¤å…ç‚¹èœï¼šä½ å‘Šè¯‰æœåŠ¡å‘˜ï¼ˆ`setState`ï¼‰æƒ³è¦ä»€ä¹ˆèœï¼ˆæ–°çŠ¶æ€ï¼‰ï¼ŒæœåŠ¡å‘˜æŠŠè®¢å•è®°ä¸‹æ¥ï¼ˆæ›´æ–°é˜Ÿåˆ—ï¼‰ï¼Œä½†å¨æˆ¿ï¼ˆReact è°ƒåº¦å™¨ï¼‰ä¼šç­‰æ‰€æœ‰è®¢å•æ”¶é›†é½äº†å†ç»Ÿä¸€å¤„ç†ï¼Œè€Œä¸æ˜¯ä½ ç‚¹ä¸€é“èœå°±ç«‹åˆ»å»åšã€‚

### 4.2 Fiber ä¸ä¼˜å…ˆçº§è°ƒåº¦

åœ¨ Fiber æ¶æ„ä¸‹ï¼ŒReact å°†æ›´æ–°ä»»åŠ¡åˆ†é…äº†ä¼˜å…ˆçº§ã€‚æ¯”å¦‚ï¼š

- ç”¨æˆ·ç‚¹å‡»æŒ‰é’®è§¦å‘çš„ `setState` æ˜¯é«˜ä¼˜å…ˆçº§ï¼Œç«‹å³å¤„ç†ã€‚
- æ•°æ®è¯·æ±‚åçš„ `setState` æ˜¯ä½ä¼˜å…ˆçº§ï¼Œå¯èƒ½è¢«æ¨è¿Ÿã€‚

è¿™ç§ä¼˜å…ˆçº§æœºåˆ¶è®© React çš„ UI å“åº”æ›´å¿«ï¼Œä½†ä¹Ÿè®© `setState` çš„æ‰§è¡Œæ—¶æœºæ›´éš¾ä»¥é¢„æµ‹ã€‚

### 4.3 æ‰¹é‡æ›´æ–°çš„å¹•å

React çš„æ‰¹é‡æ›´æ–°ä¾èµ–äºä¸€ä¸ªå«åš `batchedUpdates` çš„å†…éƒ¨å‡½æ•°ã€‚åœ¨ React çš„äº‹ä»¶å¤„ç†ä¸­ï¼Œæ‰€æœ‰ `setState` è°ƒç”¨éƒ½ä¼šè¢« `batchedUpdates` åŒ…è£¹ï¼Œåˆå¹¶æˆä¸€æ¬¡æ›´æ–°ã€‚è¿™å°±åƒæŠŠä¸€å †å¿«é€’åŒ…è£¹æ‰“åŒ…æˆä¸€ä¸ªå¤§ç®±å­ï¼Œç»Ÿä¸€é€è´§ï¼Œçœæ—¶çœåŠ›ã€‚

> *å° Tipsï¼šå¦‚æœä½ åœ¨å¼‚æ­¥ä»£ç ä¸­éœ€è¦å¼ºåˆ¶åŒæ­¥æ›´æ–°ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ `ReactDOM.flushSync`ï¼Œä½†è¦è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚*

---

## 5. å¸¸è§åœºæ™¯ä¸ä»£ç ç¤ºä¾‹ ğŸ“

ç†è®ºè®²äº†ä¸€å †ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡å®é™…ä»£ç æ¥çœ‹ `setState` åœ¨ä¸åŒåœºæ™¯ä¸‹çš„è¡¨ç°ã€‚

### 5.1 åœºæ™¯ 1ï¼šå¤šæ¬¡è°ƒç”¨ `setState`

```javascript
handleClick = () => {
  this.setState({ count: this.state.count + 1 });
  this.setState({ count: this.state.count + 1 });
  console.log(this.state.count); // è¾“å‡ºæ—§å€¼
};
```

**ç°è±¡**ï¼š`count` åªå¢åŠ  1ã€‚

**åŸå› **ï¼šReact åˆå¹¶äº†ä¸¤æ¬¡ `setState`ï¼Œåªåº”ç”¨äº†æœ€åçš„çŠ¶æ€ã€‚

**è§£å†³åŠæ³•**ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼š

```javascript
handleClick = () => {
  this.setState((prevState) => ({ count: prevState.count + 1 }));
  this.setState((prevState) => ({ count: prevState.count + 1 }));
};
```

è¿™æ ·æ¯æ¬¡æ›´æ–°éƒ½ä¼šåŸºäºä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œ`count` ä¼šæ­£ç¡®å¢åŠ  2ã€‚

### 5.2 åœºæ™¯ 2ï¼šå¼‚æ­¥ä»£ç ä¸­çš„ `setState`

```javascript
handleClick = () => {
  setTimeout(() => {
    this.setState({ count: this.state.count + 1 });
    console.log(this.state.count); // è¾“å‡ºæ–°å€¼
  }, 0);
};
```

**ç°è±¡**ï¼š`console.log` è¾“å‡ºæ–°å€¼ã€‚

**åŸå› **ï¼š`setTimeout` è„±ç¦»äº† React çš„äº‹ä»¶ç³»ç»Ÿï¼Œ`setState` å˜æˆäº†â€œåŒæ­¥â€æ‰§è¡Œã€‚

### 5.3 åœºæ™¯ 3ï¼šå›è°ƒå‡½æ•°

å¦‚æœä½ éœ€è¦åœ¨çŠ¶æ€æ›´æ–°åæ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `setState` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰ï¼š

```javascript
handleClick = () => {
  this.setState(
    { count: this.state.count + 1 },
    () => {
      console.log(this.state.count); // è¾“å‡ºæ–°å€¼
    }
  );
};
```

**ç°è±¡**ï¼šå›è°ƒå‡½æ•°åœ¨çŠ¶æ€æ›´æ–°åæ‰§è¡Œï¼Œä¿è¯è·å–æœ€æ–°çŠ¶æ€ã€‚

> *å° Tipsï¼šå›è°ƒå‡½æ•°æ˜¯å¤„ç†çŠ¶æ€æ›´æ–°åé€»è¾‘çš„å¥½æ–¹æ³•ï¼Œä½†å¦‚æœé€»è¾‘å¤æ‚ï¼Œè€ƒè™‘å°†å®ƒæŠ½å–åˆ° `componentDidUpdate` ä¸­ã€‚*

---

## 6. è¯¯åŒºä¸é™·é˜± âš ï¸

`setState` çš„å¤æ‚æ€§è®©å®ƒæˆä¸ºâ€œç¿»è½¦â€é‡ç¾åŒºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§è¯¯åŒºå’Œåº”å¯¹æ–¹æ³•ï¼š

### 6.1 è¯¯åŒº 1ï¼šè®¤ä¸º `setState` æ€»æ˜¯å¼‚æ­¥

å¾ˆå¤šäººä»¥ä¸º `setState` æ°¸è¿œæ˜¯å¼‚æ­¥çš„ï¼Œä½†å¦‚å‰æ‰€è¿°ï¼Œåœ¨ `setTimeout` æˆ–åŸç”Ÿäº‹ä»¶ä¸­å®ƒæ˜¯åŒæ­¥çš„ã€‚è¿‡åº¦ä¾èµ–â€œå¼‚æ­¥â€å‡è®¾å¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯ã€‚

### 6.2 è¯¯åŒº 2ï¼šç›´æ¥ä¾èµ– `this.state`

```javascript
handleClick = () => {
  this.setState({ count: this.state.count + 1 });
  if (this.state.count > 5) {
    // å¯èƒ½æ°¸è¿œä¸ä¼šè§¦å‘
    console.log("Count exceeded 5!");
  }
};
```

**é—®é¢˜**ï¼š`this.state.count` è¿˜æ˜¯æ—§å€¼ï¼Œé€»è¾‘å¤±æ•ˆã€‚

**è§£å†³åŠæ³•**ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°æˆ–å›è°ƒã€‚

### 6.3 è¯¯åŒº 3ï¼šå¿½ç•¥æ‰¹é‡æ›´æ–°

å¤šæ¬¡è°ƒç”¨ `setState` å¹¶ä¸ä¸€å®šå¤šæ¬¡æ›´æ–°ï¼Œæ‰¹é‡æ›´æ–°å¯èƒ½â€œåæ‰â€ä½ çš„æ„å›¾ã€‚

> *å° Tipsï¼šå…»æˆä½¿ç”¨å‡½æ•°å¼æ›´æ–°çš„ä¹ æƒ¯ï¼Œå°¤å…¶æ˜¯åœ¨å¾ªç¯æˆ–è¿ç»­çŠ¶æ€æ›´æ–°ä¸­ï¼Œå®ƒèƒ½æ•‘ä½ äºæ°´ç«ã€‚*

---

## 7. æœ€ä½³å®è·µï¼šä¼˜é›…é©¾é©­ `setState` ğŸŒŸ

ä¸ºäº†è®©ä½ çš„ä»£ç æ›´å¥å£®ã€æ›´å¯ç»´æŠ¤ï¼Œè¿™é‡Œæ€»ç»“äº†ä¸€äº› `setState` çš„æœ€ä½³å®è·µï¼Œæ¯æ¡éƒ½å¸¦ç‚¹â€œé«˜çº§å¹½é»˜æ„Ÿâ€ã€‚

### 7.1 å®è·µ 1ï¼šä¼˜å…ˆä½¿ç”¨å‡½æ•°å¼æ›´æ–°

ä¸å…¶è®© React çš„æ‰¹é‡æ›´æ–°â€œå·è¢­â€ä½ ï¼Œä¸å¦‚ä¸»åŠ¨å‡ºå‡»ï¼Œç”¨å‡½æ•°å¼æ›´æ–°ç¡®ä¿çŠ¶æ€å¯é¢„æµ‹ã€‚

```javascript
this.setState((prevState) => ({ count: prevState.count + 1 }));
```

*å°±åƒåœ¨ä¸‹æ£‹æ—¶é¢„åˆ¤å¯¹æ‰‹ä¸‰æ­¥ï¼Œå‡½æ•°å¼æ›´æ–°è®©ä½ æ°¸è¿œé¢†å…ˆ React ä¸€æ‰‹ï¼*

> *å° Tipsï¼šå‡½æ•°å¼æ›´æ–°ä¸ä»…æ›´å®‰å…¨ï¼Œè¿˜èƒ½è®©ä»£ç çœ‹èµ·æ¥æ›´â€œé«˜é›…â€ï¼Œåƒä¸ªçŠ¶æ€ç®¡ç†çš„è‰ºæœ¯å®¶ã€‚*

### 7.2 å®è·µ 2ï¼šå–„ç”¨å›è°ƒå‡½æ•°

éœ€è¦çŠ¶æ€æ›´æ–°åå¹²ç‚¹å•¥ï¼Ÿåˆ«ç¡¬ç­‰ï¼Œç”¨å›è°ƒå‡½æ•°ï¼

```javascript
this.setState({ count: this.state.count + 1 }, () => {
  this.notifyServer();
});
```

*å›è°ƒå‡½æ•°å°±åƒä½ çš„ç§äººåŠ©ç†ï¼ŒçŠ¶æ€æ›´æ–°å¥½äº†ç«‹åˆ»æé†’ä½ å¼€å·¥ï¼*

> *å° Tipsï¼šå›è°ƒå‡½æ•°é€‚åˆç®€å•çš„åç»­é€»è¾‘ï¼Œå¦‚æœé€»è¾‘å¤æ‚ï¼Œè€ƒè™‘ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æˆ– hooksã€‚*

### 7.3 å®è·µ 3ï¼šé¿å…åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ `setState`

æ„é€ å‡½æ•°æ˜¯ç”¨æ¥åˆå§‹åŒ–çŠ¶æ€çš„ï¼Œè°ƒç”¨ `setState` å°±åƒåœ¨æˆ¿å­è¿˜æ²¡ç›–å¥½æ—¶å°±è£…ä¿®ï¼Œçº¯å±ç»™è‡ªå·±æ‰¾éº»çƒ¦ã€‚

```javascript
constructor(props) {
  super(props);
  this.state = { count: 0 };
  // åˆ«è¿™æ ·åšï¼
  this.setState({ count: 1 });
}
```

*æˆ¿å­æ²¡å»ºå¥½å°±åˆ·å¢™ï¼ŒReact ä¼šç»™ä½ ä¸€ä¸ªâ€œç™½çœ¼â€ã€‚*

> *å° Tipsï¼šåˆå§‹åŒ–çŠ¶æ€ç›´æ¥ç”¨ `this.state = {...}`ï¼Œç®€å•åˆé«˜æ•ˆã€‚*

### 7.4 å®è·µ 4ï¼šå°å¿ƒå¼‚æ­¥åœºæ™¯

åœ¨ `setTimeout` æˆ– Promise ä¸­ï¼Œ`setState` æ˜¯åŒæ­¥çš„ï¼Œåˆ«è¢«å®ƒçš„â€œå‡é¢â€è¿·æƒ‘ã€‚

```javascript
handleClick = () => {
  Promise.resolve().then(() => {
    this.setState({ count: this.state.count + 1 });
    console.log(this.state.count); // æ–°å€¼ï¼
  });
};
```

*å¼‚æ­¥åœºæ™¯å°±åƒ React å¸ä¸‹â€œå¼‚æ­¥ä¼ªè£…â€ï¼Œéœ²å‡ºåŒæ­¥çœŸé¢ç›®ï¼ŒæŠ“ä½å®ƒï¼*

> *å° Tipsï¼šåœ¨å¼‚æ­¥ä»£ç ä¸­ï¼Œå§‹ç»ˆæ˜ç¡®ä½ çš„çŠ¶æ€ä¾èµ–ï¼Œé¿å…é€»è¾‘æ··ä¹±ã€‚*

---

## 8. æœªæ¥å±•æœ›ï¼šReact 18+ ä¸­çš„ `setState` ğŸ”®

React 18 å¼•å…¥äº†å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰ï¼Œè¿›ä¸€æ­¥å¢å¼ºäº† `setState` çš„çµæ´»æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å€¼å¾—å…³æ³¨çš„å˜åŒ–ï¼š

- **è‡ªåŠ¨æ‰¹é‡æ›´æ–°**ï¼šReact 18 é»˜è®¤åœ¨æ›´å¤šåœºæ™¯ä¸‹ï¼ˆåŒ…æ‹¬ Promise å’Œ setTimeoutï¼‰å¯ç”¨æ‰¹é‡æ›´æ–°ï¼Œå‡å°‘æ„å¤–çš„åŒæ­¥è¡Œä¸ºã€‚
- **è¿‡æ¸¡æ›´æ–°**ï¼šé€šè¿‡ `startTransition` APIï¼Œä½ å¯ä»¥æ ‡è®°ä½ä¼˜å…ˆçº§çš„çŠ¶æ€æ›´æ–°ï¼Œè®© UI æ›´æµç•…ã€‚
- **Suspense é›†æˆ**ï¼šçŠ¶æ€æ›´æ–°ä¸æ•°æ®è·å–ç»“åˆæ›´ç´§å¯†ï¼Œ`setState` çš„è°ƒåº¦æ›´åŠ æ™ºèƒ½ã€‚

è¿™äº›å˜åŒ–è®© `setState` çš„è¡Œä¸ºæ›´å¯é¢„æµ‹ï¼Œä½†ä¹Ÿè¦æ±‚å¼€å‘è€…æ›´ç†Ÿæ‚‰ React çš„å¹¶å‘ç‰¹æ€§ã€‚

> *å° Tipsï¼šå‡çº§åˆ° React 18 æ—¶ï¼Œé‡æ–°æµ‹è¯•ä½ çš„ `setState` é€»è¾‘ï¼Œç¡®ä¿æ‰¹é‡æ›´æ–°ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½ã€‚*

---

## 9. æ€»ç»“ï¼šä¸€å¼ å›¾å›é¡¾æ ¸å¿ƒè¦ç‚¹ ğŸ–¼ï¸

ç»è¿‡è¿™è¶Ÿâ€œæ¢ç§˜ä¹‹æ—…â€ï¼Œæˆ‘ä»¬ç»ˆäºæŠŠ `setState` çš„â€œçœŸé¢ç›®â€çœ‹æ¸…æ¥šäº†ï¼ä»¥ä¸‹æ˜¯ä¸€å¼ æ€»ç»“å›¾ï¼Œå¸®ä½ å¿«é€Ÿå›é¡¾ï¼š

```plaintext
setState çš„çœŸç›¸
â”œâ”€â”€ æ˜¯å¦åŒæ­¥ï¼Ÿ
â”‚   â”œâ”€â”€ React äº‹ä»¶ä¸­ â†’ å¼‚æ­¥ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰
â”‚   â”œâ”€â”€ setTimeout/Promise â†’ åŒæ­¥ï¼ˆæ— æ‰¹é‡ï¼‰
â”‚   â””â”€â”€ åŸç”Ÿäº‹ä»¶ â†’ åŒæ­¥
â”œâ”€â”€ æ ¸å¿ƒæœºåˆ¶
â”‚   â”œâ”€â”€ æ‰¹é‡æ›´æ–° â†’ æ€§èƒ½ä¼˜åŒ–
â”‚   â”œâ”€â”€ Fiber è°ƒåº¦ â†’ ä¼˜å…ˆçº§ç®¡ç†
â”‚   â””â”€â”€ æ›´æ–°é˜Ÿåˆ— â†’ çŠ¶æ€åˆå¹¶
â”œâ”€â”€ æœ€ä½³å®è·µ
â”‚   â”œâ”€â”€ å‡½æ•°å¼æ›´æ–° â†’ ç¡®ä¿çŠ¶æ€å‡†ç¡®
â”‚   â”œâ”€â”€ å›è°ƒå‡½æ•° â†’ å¤„ç†åç»­é€»è¾‘
â”‚   â””â”€â”€ é¿å…æ»¥ç”¨ â†’ ä¿æŒä»£ç æ¸…æ™°
â””â”€â”€ æœªæ¥è¶‹åŠ¿
    â”œâ”€â”€ React 18 â†’ è‡ªåŠ¨æ‰¹é‡
    â””â”€â”€ å¹¶å‘æ¸²æŸ“ â†’ æ›´æ™ºèƒ½è°ƒåº¦
```

`setState` æ—¢ä¸æ˜¯ç»å¯¹çš„åŒæ­¥ï¼Œä¹Ÿä¸æ˜¯ç»å¯¹çš„å¼‚æ­¥ï¼Œå®ƒæ˜¯ React ç²¾å¿ƒè®¾è®¡çš„äº§ç‰©ï¼Œå¹³è¡¡äº†æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚ç†è§£å®ƒçš„æœ¬è´¨åï¼Œä½ ä¼šå‘ç°å®ƒå…¶å®æ˜¯ä¸ªâ€œå¬è¯çš„å¥½æœ‹å‹â€ï¼Œåªè¦ä½ çŸ¥é“æ€ä¹ˆè·Ÿå®ƒç›¸å¤„ï¼ğŸ˜‰

å¸Œæœ›è¿™ç¯‡æ–‡ç« ä¸ä»…è§£ç­”äº†ä½ çš„ç–‘æƒ‘ï¼Œè¿˜è®©ä½ å¯¹ React çš„çŠ¶æ€ç®¡ç†æœ‰äº†æ›´æ·±çš„æ´å¯Ÿã€‚ä¸‹æ¬¡å†™ä»£ç æ—¶ï¼Œé¢å¯¹ `setState`ï¼Œä½ æ˜¯ä¸æ˜¯æ›´æœ‰åº•æ°”äº†ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒæˆ–ç–‘é—®ï¼Œå’±ä»¬ä¸€èµ·â€œæŠ˜è…¾â€ React çš„å¥‡å¦™ä¸–ç•Œï¼ğŸš€

> *å° Tipsï¼šæŠŠè¿™ç¯‡æ–‡ç« æ”¶è—èµ·æ¥ï¼Œä¸‹æ¬¡é‡åˆ° `setState` çš„â€œå‘â€ï¼Œéšæ—¶ç¿»å‡ºæ¥æ•‘æ€¥ï¼*

---