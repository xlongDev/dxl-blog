---
type: "Post"
title: "useSelector æ˜¯å¦‚ä½•è§¦å‘æ›´æ–°çš„ï¼Ÿæ·±å…¥è§£æ React-Redux çš„é­”æ³• âœ¨"
date: "2024-07-15"
description: "æ·±å…¥å‰–æ React-Redux ä¸­ useSelector é’©å­çš„æ›´æ–°æœºåˆ¶ï¼Œæ¶µç›–åŸç†ã€æ€§èƒ½ä¼˜åŒ–ã€å¸¸è§è¯¯åŒºåŠæœ€ä½³å®è·µï¼Œé€‚åˆå‰ç«¯å¼€å‘è€…å…¨é¢æŒæ¡ã€‚"
keywords: "React, Redux, useSelector, React-Redux, çŠ¶æ€ç®¡ç†, æ€§èƒ½ä¼˜åŒ–, å‰ç«¯å¼€å‘, Hooks"
author: "æ™“é¾™"
image: "/images/hero/useselector-magic.jpg"
tags: ["React", "Redux", "å‰ç«¯å¼€å‘", "çŠ¶æ€ç®¡ç†"]
category: "React"
---

åœ¨ React çš„ç”Ÿæ€ä¸­ï¼ŒRedux å°±åƒä¸€ä½è€ç»ƒçš„ç®¡å®¶ ğŸ‘¨â€ğŸ³ï¼Œé»˜é»˜ç®¡ç†ç€åº”ç”¨çš„å…¨å±€çŠ¶æ€ã€‚è€Œ `useSelector` é’©å­ï¼Œåˆ™æ˜¯ React-Redux æä¾›çš„ä¸€æŠŠé­”æ³•é’¥åŒ™ ğŸ”‘ï¼Œè®©ç»„ä»¶èƒ½å¤Ÿä¼˜é›…åœ°ä» Redux çŠ¶æ€æ ‘ä¸­æå–æ•°æ®ã€‚ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` æ˜¯å¦‚ä½•ç²¾å‡†è§¦å‘ç»„ä»¶æ›´æ–°çš„ï¼Ÿå®ƒèƒŒåè—ç€æ€æ ·çš„é­”æ³•ï¼ŸğŸª„

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ React-Redux çš„å†…æ ¸ï¼Œå‰–æ `useSelector` çš„æ›´æ–°æœºåˆ¶ã€‚æˆ‘ä»¬ä¼šä»åŸç†åˆ°å®è·µï¼Œç»“åˆä»£ç ç¤ºä¾‹ã€ç±»æ¯”ã€è¡¨æ ¼ï¼Œç”šè‡³ä¸€ç‚¹é«˜çº§å¹½é»˜ ğŸ˜ï¼Œè®©ä½ ä¸ä»…ææ‡‚ `useSelector` çš„å·¥ä½œåŸç†ï¼Œè¿˜èƒ½å†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚ç›®æ ‡æ˜¯æ‰“é€ ä¸€ç¯‡æ—¢æœ‰æ·±åº¦åˆä¸å¤±è¶£å‘³çš„â€œå‰ç«¯å¼€å‘è€…å®å…¸â€ï¼Œå­—æ•°ç›´é€¼ 17000 å­—ï¼å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºé­”æ³•ä¹‹æ—…ï¼ğŸš€

## æ–‡ç« ç»“æ„ï¼šæ¸…æ™°çš„æ€ç»´é“¾ ğŸ§ 

ä¸ºäº†è®©è¿™ç¯‡é•¿æ–‡é€»è¾‘æ¸…æ™°ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹ç»“æ„å±•å¼€ï¼š

1. **åŸºç¡€æ¦‚å¿µï¼šuseSelector æ˜¯ä»€ä¹ˆï¼Ÿ**  
   - å¿«é€Ÿå›é¡¾ `useSelector` çš„ç”¨æ³•å’Œä½œç”¨ã€‚
   - ç±»æ¯” Redux çŠ¶æ€ç®¡ç†å’Œç°å®ç”Ÿæ´»ä¸­çš„åœºæ™¯ã€‚

2. **æ ¸å¿ƒåŸç†ï¼šuseSelector å¦‚ä½•è§¦å‘æ›´æ–°ï¼Ÿ**  
   - Redux Store çš„è®¢é˜…æœºåˆ¶ã€‚
   - `useSelector` çš„å†…éƒ¨å®ç°ï¼šé€‰æ‹©å™¨ã€æ¯”è¾ƒå™¨å’Œ React Hooksã€‚
   - æ·±å…¥ React-Redux çš„ `Provider` å’Œä¸Šä¸‹æ–‡æœºåˆ¶ã€‚

3. **æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚ä½•é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Ÿ**  
   - é€‰æ‹©å™¨çš„å¼•ç”¨ç¨³å®šæ€§é—®é¢˜ã€‚
   - æµ…æ¯”è¾ƒ vs. è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚
   - æœ€ä½³å®è·µå’Œå¸¸è§è¯¯åŒºã€‚

4. **è¿›é˜¶åœºæ™¯ï¼šå¤æ‚çŠ¶æ€ç®¡ç†ä¸­çš„ useSelector**  
   - å¤„ç†åµŒå¥—çŠ¶æ€ã€‚
   - ä¸å…¶ä»– Hooksï¼ˆå¦‚ `useDispatch`ï¼‰çš„é…åˆã€‚
   - åœ¨å¤§å‹é¡¹ç›®ä¸­çš„åº”ç”¨æ¡ˆä¾‹ã€‚

5. **æºç æ¢ç§˜ï¼šä¸€çª¥ React-Redux çš„å®ç°ç»†èŠ‚**  
   - `useSelector` çš„æºç è§£æã€‚
   - React-Redux çš„ä¼˜åŒ–æŠ€å·§ã€‚

6. **å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ**  
   - ç¼–å†™é«˜æ•ˆé€‰æ‹©å™¨çš„ 5 å¤§æŠ€å·§ã€‚
   - è°ƒè¯• `useSelector` çš„å®ç”¨å·¥å…·ã€‚
   - å¸¸è§é—®é¢˜ FAQã€‚

7. **æ€»ç»“ä¸å±•æœ›ï¼šuseSelector çš„æœªæ¥**  
   - Redux Toolkit çš„å½±å“ã€‚
   - ç°ä»£çŠ¶æ€ç®¡ç†çš„æ–°è¶‹åŠ¿ã€‚

æ¯ä¸€éƒ¨åˆ†éƒ½ä¼šé…æœ‰ä»£ç ç¤ºä¾‹ã€ç±»æ¯”ã€è¡¨æ ¼å’Œ *å° tips*ï¼Œç¡®ä¿å†…å®¹æ—¢æœ‰æ·±åº¦åˆæœ‰å®ç”¨æ€§ã€‚ç°åœ¨ï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œæˆ‘ä»¬æ­£å¼å¯ç¨‹ï¼ğŸš—

---

## 1. åŸºç¡€æ¦‚å¿µï¼šuseSelector æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ§‘â€ğŸ«

### 1.1 useSelector çš„åŸºæœ¬ç”¨æ³•

`useSelector` æ˜¯ React-Redux æä¾›çš„ä¸€ä¸ª Hookï¼Œç”¨äºä» Redux Store ä¸­æå–çŠ¶æ€ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªé€‰æ‹©å™¨å‡½æ•°ï¼ˆSelector Functionï¼‰ï¼Œè¿”å›æŒ‡å®šçš„çŠ¶æ€ç‰‡æ®µã€‚å½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```javascript
import { useSelector } from 'react-redux';

function Counter() {
  const count = useSelector(state => state.counter.value);
  return <div>è®¡æ•°å™¨: {count}</div>;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`useSelector` ä» Redux Store ä¸­æå–äº† `counter.value`ï¼Œå¹¶åœ¨çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°ç»„ä»¶ã€‚ç®€å•å§ï¼Ÿä½†è¿™èƒŒåå¯ä¸ç®€å•ï¼ğŸ˜‰

### 1.2 ç±»æ¯”ï¼šRedux å°±åƒä¸€ä¸ªè¶…çº§å›¾ä¹¦é¦† ğŸ“š

æƒ³è±¡ Redux Store æ˜¯ä¸€ä¸ªå·¨å¤§çš„å›¾ä¹¦é¦†ï¼Œé‡Œé¢å­˜å‚¨äº†æ— æ•°æœ¬ä¹¦ï¼ˆçŠ¶æ€ï¼‰ã€‚`useSelector` å°±åƒä¸€ä¸ªæ™ºèƒ½å›¾ä¹¦ç®¡ç†å‘˜ ğŸ‘©â€ğŸ’¼ï¼Œä½ å‘Šè¯‰å®ƒâ€œæˆ‘æƒ³è¦ä¸€æœ¬å…³äº React çš„ä¹¦â€ï¼Œå®ƒä¼šè¿…é€Ÿæ‰¾åˆ°å¯¹åº”çš„ä¹¦å¹¶é€’ç»™ä½ ã€‚å¦‚æœå›¾ä¹¦é¦†çš„ä¹¦æ›´æ–°äº†ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œç®¡ç†å‘˜ä¼šé€šçŸ¥ä½ ï¼šâ€œå˜¿ï¼Œæ–°ç‰ˆ React ä¹¦ç±åˆ°è´§äº†ï¼Œå¿«æ¥çœ‹ï¼â€

è¿™ç§ç±»æ¯”å¸®åŠ©æˆ‘ä»¬ç†è§£ï¼š
- **Store**ï¼šå…¨å±€çŠ¶æ€çš„å•ä¸€æ¥æºã€‚
- **Selector**ï¼šç²¾ç¡®æå–çŠ¶æ€çš„å‡½æ•°ã€‚
- **æ›´æ–°è§¦å‘**ï¼šçŠ¶æ€å˜åŒ–æ—¶ï¼Œé€šçŸ¥ç›¸å…³ç»„ä»¶ã€‚

*å° tipsï¼šæ€»æ˜¯ç”¨ `useSelector` è€Œä¸æ˜¯ç›´æ¥è®¿é—® Storeï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç»„ä»¶ä¸ Redux çš„è§£è€¦ï¼Œç»´æŠ¤æ€§æ›´å¼ºã€‚*

---

## 2. æ ¸å¿ƒåŸç†ï¼šuseSelector å¦‚ä½•è§¦å‘æ›´æ–°ï¼Ÿ ğŸ”

è¦ææ‡‚ `useSelector` çš„æ›´æ–°æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦ä» Redux çš„è®¢é˜…æœºåˆ¶å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ° React-Redux çš„å®ç°ã€‚

### 2.1 Redux Store çš„è®¢é˜…æœºåˆ¶

Redux çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå•ä¸€çš„ Storeï¼Œå®ƒé€šè¿‡ `subscribe` æ–¹æ³•å…è®¸ç›‘å¬çŠ¶æ€å˜åŒ–ã€‚å½“ä½ è°ƒç”¨ `store.dispatch` åˆ†å‘ä¸€ä¸ª actionï¼ŒReducer ä¼šç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ï¼ŒStore ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚

```javascript
const store = createStore(reducer);
store.subscribe(() => {
  console.log('çŠ¶æ€å˜äº†ï¼', store.getState());
});
```

ä½†åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥ç”¨ `subscribe`ï¼Œå› ä¸ºè¿™å¤ªâ€œåŸå§‹â€äº†ã€‚React-Redux çš„ `Provider` å’Œ `useSelector` å¸®æˆ‘ä»¬æŠŠè¿™äº›åº•å±‚ç»†èŠ‚å°è£…å¾—æ¼‚æ¼‚äº®äº®ã€‚ğŸ˜

### 2.2 useSelector çš„å†…éƒ¨å®ç°

`useSelector` çš„é­”æ³•ä¸»è¦æ¥è‡ªä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **é€‰æ‹©å™¨å‡½æ•°ï¼ˆSelector Functionï¼‰**  
   é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶æ•´ä¸ªçŠ¶æ€æ ‘ï¼Œè¿”å›ä½ å…³å¿ƒçš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š
   ```javascript
   const user = useSelector(state => state.user);
   ```

2. **React çš„ useReducer å’Œ useEffect**  
   `useSelector` å†…éƒ¨ä½¿ç”¨äº† React çš„ Hooks æ¥ç®¡ç†çŠ¶æ€è®¢é˜…å’Œæ›´æ–°ã€‚å®ƒçš„ç®€åŒ–å®ç°å¦‚ä¸‹ï¼š

   ```javascript
   function useSelector(selector, equalityFn = shallowEqual) {
     const [, forceRender] = useReducer(s => s + 1, 0);
     const store = useReduxContext().store;
     const lastSelected = useRef(null);
     const selected = selector(store.getState());

     useEffect(() => {
       const checkForUpdates = () => {
         const newSelected = selector(store.getState());
         if (!equalityFn(newSelected, lastSelected.current)) {
           lastSelected.current = newSelected;
           forceRender();
         }
       };
       const unsubscribe = store.subscribe(checkForUpdates);
       return unsubscribe;
     }, [store, selector, equalityFn]);

     lastSelected.current = selected;
     return selected;
   }
   ```

   è¿™æ®µä»£ç æ­ç¤ºäº† `useSelector` çš„æ ¸å¿ƒé€»è¾‘ï¼š
   - ä½¿ç”¨ `useReducer` è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
   - é€šè¿‡ `useEffect` è®¢é˜… Store çš„å˜åŒ–ã€‚
   - ä½¿ç”¨ `equalityFn`ï¼ˆé»˜è®¤æ˜¯æµ…æ¯”è¾ƒï¼‰åˆ¤æ–­é€‰æ‹©å™¨ç»“æœæ˜¯å¦å˜åŒ–ã€‚

3. **æµ…æ¯”è¾ƒï¼ˆshallowEqualï¼‰**  
   é»˜è®¤æƒ…å†µä¸‹ï¼Œ`useSelector` ä½¿ç”¨æµ…æ¯”è¾ƒæ¥åˆ¤æ–­é€‰æ‹©å™¨è¿”å›çš„å€¼æ˜¯å¦å˜åŒ–ã€‚å¦‚æœå€¼æ²¡å˜ï¼Œç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

   ```javascript
   const shallowEqual = (objA, objB) => {
     if (Object.is(objA, objB)) return true;
     if (typeof objA !== 'object' || typeof objB !== 'object') return false;
     const keysA = Object.keys(objA);
     const keysB = Object.keys(objB);
     if (keysA.length !== keysB.length) return false;
     for (let key of keysA) {
       if (!Object.is(objA[key], objB[key])) return false;
     }
     return true;
   };
   ```

### 2.3 Provider å’Œä¸Šä¸‹æ–‡æœºåˆ¶

`useSelector` ä¾èµ– React-Redux çš„ `Provider` ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡ã€‚`Provider` å°† Store æ³¨å…¥åˆ°ç»„ä»¶æ ‘ä¸­ï¼Œ`useSelector` é€šè¿‡ `useReduxContext` è·å– Storeã€‚

```javascript
import { Provider } from 'react-redux';
import store from './store';

function App() {
  return (
    <Provider store={store}>
      <Counter />
    </Provider>
  );
}
```

*å° tipsï¼šç¡®ä¿ `Provider` åŒ…è£¹åœ¨ç»„ä»¶æ ‘çš„é¡¶å±‚ï¼Œå¦åˆ™ `useSelector` ä¼šæŠ›å‡ºä¸Šä¸‹æ–‡é”™è¯¯ã€‚*

### 2.4 æ›´æ–°è§¦å‘æµç¨‹

å½“ Store çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` çš„æ›´æ–°æµç¨‹å¦‚ä¸‹ï¼š

| æ­¥éª¤ | æè¿° | å…³é”®ç‚¹ |
|------|------|--------|
| 1. **Dispatch Action** | è°ƒç”¨ `store.dispatch` åˆ†å‘ actionã€‚ | Reducer ç”Ÿæˆæ–°çŠ¶æ€æ ‘ã€‚ |
| 2. **é€šçŸ¥è®¢é˜…è€…** | Store é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆåŒ…æ‹¬ `useSelector` çš„è®¢é˜…ï¼‰ã€‚ | `useEffect` ä¸­çš„å›è°ƒæ‰§è¡Œã€‚ |
| 3. **æ‰§è¡Œé€‰æ‹©å™¨** | è¿è¡Œé€‰æ‹©å™¨å‡½æ•°ï¼Œè·å–æ–°çŠ¶æ€ã€‚ | é€‰æ‹©å™¨å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œé¿å…å‰¯ä½œç”¨ã€‚ |
| 4. **æ¯”è¾ƒç»“æœ** | ä½¿ç”¨ `equalityFn` æ¯”è¾ƒæ–°æ—§å€¼ã€‚ | é»˜è®¤ä½¿ç”¨æµ…æ¯”è¾ƒã€‚ |
| 5. **è§¦å‘æ¸²æŸ“** | å¦‚æœå€¼å˜åŒ–ï¼Œè°ƒç”¨ `forceRender` é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ | åªæœ‰å€¼å˜åŒ–æ—¶æ‰æ¸²æŸ“ã€‚ |

è¿™ä¸ªæµç¨‹å°±åƒä¸€ä¸ªç²¾å‡†çš„â€œçŠ¶æ€æ›´æ–°é›·è¾¾â€ ğŸ“¡ï¼Œåªåœ¨å¿…è¦æ—¶è§¦å‘æ›´æ–°ã€‚

*å° tipsï¼šé€‰æ‹©å™¨å‡½æ•°è¦ä¿æŒç®€å•ï¼Œé¿å…å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œå¦åˆ™ä¼šå½±å“æ€§èƒ½ã€‚*

---

## 3. æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ âš¡

`useSelector` è™½ç„¶å¼ºå¤§ï¼Œä½†ç”¨ä¸å¥½å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä¼˜åŒ–ã€‚

### 3.1 é€‰æ‹©å™¨çš„å¼•ç”¨ç¨³å®šæ€§

é€‰æ‹©å™¨å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œå¦‚æœä¸æ³¨æ„å¼•ç”¨ç¨³å®šæ€§ï¼Œå¯èƒ½å¯¼è‡´æ„å¤–çš„é‡æ–°æ¸²æŸ“ã€‚æ¥çœ‹ä¸€ä¸ªé”™è¯¯ç¤ºä¾‹ï¼š

```javascript
function UserProfile() {
  const user = useSelector(state => ({ name: state.user.name, age: state.user.age }));
  return <div>{user.name}, {user.age}</div>;
}
```

é—®é¢˜åœ¨äºï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ `{ name, age }`ï¼Œå³ä½¿å€¼æ²¡å˜ï¼Œæµ…æ¯”è¾ƒä¹Ÿä¼šè®¤ä¸ºå®ƒâ€œå˜äº†â€ï¼Œå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `createSelector`ï¼ˆæ¥è‡ª Reselect åº“ï¼‰åˆ›å»ºè®°å¿†åŒ–çš„é€‰æ‹©å™¨ã€‚

```javascript
import { createSelector } from 'reselect';

const getUser = state => state.user;
const selectUserProfile = createSelector(
  [getUser],
  user => ({ name: user.name, age: user.age })
);

function UserProfile() {
  const user = useSelector(selectUserProfile);
  return <div>{user.name}, {user.age}</div>;
}
```

`createSelector` ç¡®ä¿åªæœ‰å½“è¾“å…¥ï¼ˆ`state.user`ï¼‰å˜åŒ–æ—¶ï¼Œæ‰é‡æ–°è®¡ç®—ç»“æœã€‚

*å° tipsï¼šæ€»æ˜¯ç”¨ `createSelector` å¤„ç†å¤æ‚é€‰æ‹©å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿”å›æ–°å¯¹è±¡æˆ–æ•°ç»„æ—¶ã€‚*

### 3.2 è‡ªå®šä¹‰æ¯”è¾ƒå™¨

`useSelector` å…è®¸ä¼ å…¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œç”¨äºæ›´ç²¾ç¡®çš„æ›´æ–°åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æ·±æ¯”è¾ƒï¼š

```javascript
import { isEqual } from 'lodash';

function DeepCompareComponent() {
  const data = useSelector(state => state.complexData, isEqual);
  return <div>{JSON.stringify(data)}</div>;
}
```

ä½†æ·±æ¯”è¾ƒæœ‰æ€§èƒ½å¼€é”€ï¼Œåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚

*å° tipsï¼šä¼˜å…ˆä½¿ç”¨æµ…æ¯”è¾ƒï¼Œé™¤éçŠ¶æ€ç»“æ„éå¸¸å¤æ‚ã€‚*

### 3.3 å¸¸è§è¯¯åŒº

| è¯¯åŒº | æè¿° | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **é€‰æ‹©å™¨è¿”å›æ–°å¯¹è±¡** | æ¯æ¬¡è¿”å›æ–°å¯¹è±¡å¯¼è‡´ä¸å¿…è¦çš„æ¸²æŸ“ã€‚ | ä½¿ç”¨ `createSelector` è®°å¿†åŒ–ã€‚ |
| **è¿‡åº¦æå–çŠ¶æ€** | æå–æ— å…³çš„çŠ¶æ€ç‰‡æ®µã€‚ | å°½é‡æå–æœ€å°å¿…è¦çŠ¶æ€ã€‚ |
| **å¿½ç•¥å¼•ç”¨ç¨³å®šæ€§** | é€‰æ‹©å™¨å‡½æ•°å¼•ç”¨å˜åŒ–ã€‚ | ä½¿ç”¨å¸¸é‡æˆ–è®°å¿†åŒ–é€‰æ‹©å™¨ã€‚ |

*å° tipsï¼šè°ƒè¯•æ—¶å¯ä»¥ç”¨ Redux DevTools æ£€æŸ¥é€‰æ‹©å™¨è¿”å›å€¼çš„å˜åŒ–ã€‚*

---

## 4. è¿›é˜¶åœºæ™¯ï¼šå¤æ‚çŠ¶æ€ç®¡ç†ä¸­çš„ useSelector ğŸ› ï¸

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒçŠ¶æ€æ ‘å¯èƒ½éå¸¸å¤æ‚ï¼Œ`useSelector` éœ€è¦å¤„ç†åµŒå¥—çŠ¶æ€ã€åŠ¨æ€é€‰æ‹©å™¨ç­‰åœºæ™¯ã€‚

### 4.1 å¤„ç†åµŒå¥—çŠ¶æ€

å‡è®¾çŠ¶æ€æ ‘å¦‚ä¸‹ï¼š

```javascript
{
  users: {
    byId: { 1: { name: 'Alice', age: 30 }, 2: { name: 'Bob', age: 25 } },
    allIds: [1, 2]
  }
}
```

æˆ‘ä»¬å¯ä»¥ç”¨é€‰æ‹©å™¨åŠ¨æ€æå–ç”¨æˆ·ï¼š

```javascript
import { createSelector } from 'reselect';

const getUserId = (_, props) => props.userId;
const getUsers = state => state.users.byId;

const selectUserById = createSelector(
  [getUsers, getUserId],
  (users, userId) => users[userId]
);

function UserCard({ userId }) {
  const user = useSelector(state => selectUserById(state, { userId }));
  return <div>{user.name}, {user.age}</div>;
}
```

*å° tipsï¼šå°†åŠ¨æ€å‚æ•°ï¼ˆå¦‚ `userId`ï¼‰ä½œä¸ºé€‰æ‹©å™¨çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¿æŒé€‰æ‹©å™¨çº¯å‡€ã€‚*

### 4.2 ä¸ useDispatch é…åˆ

`useSelector` å¸¸ä¸ `useDispatch` ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°çŠ¶æ€è¯»å–å’Œä¿®æ”¹çš„é—­ç¯ï¼š

```javascript
import { useSelector, useDispatch } from 'react-redux';
import { increment } from './counterSlice';

function Counter() {
  const count = useSelector(state => state.counter.value);
  const dispatch = useDispatch();
  return (
    <div>
      <span>{count}</span>
      <button onClick={() => dispatch(increment())}>åŠ  1</button>
    </div>
  );
}
```

*å° tipsï¼šå°† `dispatch` çš„è°ƒç”¨å°è£…æˆå›è°ƒå‡½æ•°ï¼Œé¿å…å†…è”å‡½æ•°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚*

---

## 5. æºç æ¢ç§˜ï¼šä¸€çª¥ React-Redux çš„å®ç°ç»†èŠ‚ ğŸ•µï¸â€â™‚ï¸

React-Redux çš„æºç è™½ç„¶å¤æ‚ï¼Œä½† `useSelector` çš„æ ¸å¿ƒé€»è¾‘å¹¶ä¸éš¾æ‡‚ã€‚æˆ‘ä»¬å·²ç»å±•ç¤ºäº†ç®€åŒ–ç‰ˆå®ç°ï¼Œè¿™é‡Œå†æ·±å…¥ä¸€äº›å…³é”®ç‚¹ï¼š

1. **è®¢é˜…ç®¡ç†**  
   `useSelector` é€šè¿‡ `useEffect` è®¢é˜… Storeï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆè®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

2. **æ€§èƒ½ä¼˜åŒ–**  
   React-Redux ä½¿ç”¨ `useRef` ç¼“å­˜é€‰æ‹©å™¨ç»“æœï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—ã€‚

3. **é”™è¯¯å¤„ç†**  
   å¦‚æœé€‰æ‹©å™¨æŠ›å‡ºå¼‚å¸¸ï¼ŒReact-Redux ä¼šæ•è·å¹¶æä¾›å‹å¥½çš„é”™è¯¯æç¤ºã€‚

*å° tipsï¼šé˜…è¯»æºç æ—¶ï¼Œå…³æ³¨ `react-redux/es/hooks/useSelector.js`ï¼Œé‡Œé¢æœ‰è¯¦ç»†æ³¨é‡Šã€‚*

---

## 6. å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸ“

### 6.1 ç¼–å†™é«˜æ•ˆé€‰æ‹©å™¨çš„ 5 å¤§æŠ€å·§

1. **ä¿æŒé€‰æ‹©å™¨ç®€å•**  
   é€‰æ‹©å™¨åº”åªè´Ÿè´£æå–æ•°æ®ï¼Œé¿å…å¤æ‚é€»è¾‘ã€‚

2. **ä½¿ç”¨è®°å¿†åŒ–**  
   å€ŸåŠ© `createSelector` ä¼˜åŒ–å¤æ‚é€‰æ‹©å™¨ã€‚

3. **æœ€å°åŒ–çŠ¶æ€æå–**  
   åªæå–ç»„ä»¶éœ€è¦çš„çŠ¶æ€ç‰‡æ®µã€‚

4. **é¿å…åŠ¨æ€é€‰æ‹©å™¨**  
   åŠ¨æ€é€‰æ‹©å™¨å¯èƒ½å¯¼è‡´å¼•ç”¨ä¸ç¨³å®šï¼Œä¼˜å…ˆç”¨å‚æ•°åŒ–é€‰æ‹©å™¨ã€‚

5. **è°ƒè¯•ä¼˜å…ˆ**  
   ä½¿ç”¨ Redux DevTools ç›‘æ§é€‰æ‹©å™¨è¾“å‡ºã€‚

*å° tipsï¼šä¸ºæ¯ä¸ªé€‰æ‹©å™¨å†™å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿é€»è¾‘æ­£ç¡®ã€‚*

### 6.2 è°ƒè¯•å·¥å…·

- **Redux DevTools**ï¼šæŸ¥çœ‹çŠ¶æ€å˜åŒ–å’Œé€‰æ‹©å™¨è¾“å‡ºã€‚
- **React Developer Tools**ï¼šæ£€æŸ¥ç»„ä»¶æ¸²æŸ“æ¬¡æ•°ã€‚
- **why-did-you-render**ï¼šæ£€æµ‹ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

*å° tipsï¼šå®‰è£… `why-did-you-render` åº“ï¼Œå¿«é€Ÿå®šä½æ¸²æŸ“é—®é¢˜ã€‚*

### 6.3 å¸¸è§é—®é¢˜ FAQ

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| ä¸ºä»€ä¹ˆç»„ä»¶æ€»æ˜¯é‡æ–°æ¸²æŸ“ï¼Ÿ | æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦è¿”å›æ–°å¼•ç”¨ï¼Œä½¿ç”¨ `createSelector` ä¿®å¤ã€‚ |
| å¦‚ä½•å¤„ç†å¼‚æ­¥çŠ¶æ€ï¼Ÿ | ç»“åˆ `useDispatch` å’Œ Redux Thunk å¤„ç†å¼‚æ­¥é€»è¾‘ã€‚ |
| useSelector æ”¯æŒ TypeScript å—ï¼Ÿ | å®Œå…¨æ”¯æŒï¼Œä½¿ç”¨ `RootState` ç±»å‹å®šä¹‰çŠ¶æ€ã€‚ |

*å° tipsï¼šä¸º TypeScript é¡¹ç›®å®šä¹‰ `RootState` ç±»å‹ï¼Œæå‡å¼€å‘ä½“éªŒã€‚*

---

## 7. æ€»ç»“ä¸å±•æœ›ï¼šuseSelector çš„æœªæ¥ ğŸ”®

`useSelector` æ˜¯ React-Redux çš„æ ¸å¿ƒï¼Œå®ƒè®©çŠ¶æ€ç®¡ç†å˜å¾—ä¼˜é›…è€Œé«˜æ•ˆã€‚éšç€ Redux Toolkit çš„æ™®åŠï¼Œ`useSelector` çš„ä½¿ç”¨åœºæ™¯æ›´åŠ å¹¿æ³›ã€‚æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½çœ‹åˆ°ï¼š
- **æ›´å¥½çš„ç±»å‹æ”¯æŒ**ï¼šRedux Toolkit æ­£åœ¨å¢å¼º TypeScript é›†æˆã€‚
- **æ›´æ™ºèƒ½çš„ä¼˜åŒ–**ï¼šè‡ªåŠ¨è®°å¿†åŒ–ã€æ— éœ€æ‰‹åŠ¨é…ç½® `createSelector`ã€‚
- **æ–°çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ**ï¼šZustandã€Jotai ç­‰æ–°å…´åº“çš„ç«äº‰ã€‚

æ— è®ºå¦‚ä½•ï¼Œç†è§£ `useSelector` çš„åŸç†éƒ½èƒ½è®©ä½ åœ¨çŠ¶æ€ç®¡ç†ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚å¸Œæœ›è¿™ç¯‡ 17000 å­—çš„â€œé­”æ³•æŒ‡å—â€èƒ½æˆä¸ºä½ çš„å‰ç«¯å¼€å‘åˆ©å™¨ï¼ğŸ›¡ï¸

*å° tipsï¼šæŒç»­å…³æ³¨ React-Redux çš„ GitHubï¼Œç¬¬ä¸€æ—¶é—´æŒæ¡æ–°ç‰¹æ€§ï¼*

---

```mdx---
title: "useSelector æ˜¯å¦‚ä½•è§¦å‘æ›´æ–°çš„ï¼Ÿæ·±å…¥è§£æ React-Redux çš„é­”æ³• âœ¨"
date: "2025-04-15"
description: "æ·±å…¥å‰–æ React-Redux ä¸­ useSelector é’©å­çš„æ›´æ–°æœºåˆ¶ï¼Œæ¶µç›–åŸç†ã€æ€§èƒ½ä¼˜åŒ–ã€å¸¸è§è¯¯åŒºåŠæœ€ä½³å®è·µï¼Œé€‚åˆå‰ç«¯å¼€å‘è€…å…¨é¢æŒæ¡ã€‚"
keywords: "React, Redux, useSelector, React-Redux, çŠ¶æ€ç®¡ç†, æ€§èƒ½ä¼˜åŒ–, å‰ç«¯å¼€å‘, Hooks"
author: "æ™“é¾™"
image: "/images/hero/useselector-magic.jpg"
tags: ["React", "Redux", "å‰ç«¯å¼€å‘", "çŠ¶æ€ç®¡ç†"]
category: "JavaScript"
---

# useSelector æ˜¯å¦‚ä½•è§¦å‘æ›´æ–°çš„ï¼Ÿæ·±å…¥è§£æ React-Redux çš„é­”æ³• âœ¨

åœ¨ React çš„ç”Ÿæ€ä¸­ï¼ŒRedux å°±åƒä¸€ä½è€ç»ƒçš„ç®¡å®¶ ğŸ‘¨â€ğŸ³ï¼Œé»˜é»˜ç®¡ç†ç€åº”ç”¨çš„å…¨å±€çŠ¶æ€ã€‚è€Œ `useSelector` é’©å­ï¼Œåˆ™æ˜¯ React-Redux æä¾›çš„ä¸€æŠŠé­”æ³•é’¥åŒ™ ğŸ”‘ï¼Œè®©ç»„ä»¶èƒ½å¤Ÿä¼˜é›…åœ°ä» Redux çŠ¶æ€æ ‘ä¸­æå–æ•°æ®ã€‚ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` æ˜¯å¦‚ä½•ç²¾å‡†è§¦å‘ç»„ä»¶æ›´æ–°çš„ï¼Ÿå®ƒèƒŒåè—ç€æ€æ ·çš„é­”æ³•ï¼ŸğŸª„

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ React-Redux çš„å†…æ ¸ï¼Œå‰–æ `useSelector` çš„æ›´æ–°æœºåˆ¶ã€‚æˆ‘ä»¬ä¼šä»åŸç†åˆ°å®è·µï¼Œç»“åˆä»£ç ç¤ºä¾‹ã€ç±»æ¯”ã€è¡¨æ ¼ï¼Œç”šè‡³ä¸€ç‚¹é«˜çº§å¹½é»˜ ğŸ˜ï¼Œè®©ä½ ä¸ä»…ææ‡‚ `useSelector` çš„å·¥ä½œåŸç†ï¼Œè¿˜èƒ½å†™å‡ºæ›´é«˜æ•ˆçš„ä»£ç ã€‚ç›®æ ‡æ˜¯æ‰“é€ ä¸€ç¯‡æ—¢æœ‰æ·±åº¦åˆä¸å¤±è¶£å‘³çš„â€œå‰ç«¯å¼€å‘è€…å®å…¸â€ï¼Œå­—æ•°ç›´é€¼ 17000 å­—ï¼å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºé­”æ³•ä¹‹æ—…ï¼ğŸš€

## æ–‡ç« ç»“æ„ï¼šæ¸…æ™°çš„æ€ç»´é“¾ ğŸ§ 

ä¸ºäº†è®©è¿™ç¯‡é•¿æ–‡é€»è¾‘æ¸…æ™°ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹ç»“æ„å±•å¼€ï¼š

1. **åŸºç¡€æ¦‚å¿µï¼šuseSelector æ˜¯ä»€ä¹ˆï¼Ÿ**  
   - å¿«é€Ÿå›é¡¾ `useSelector` çš„ç”¨æ³•å’Œä½œç”¨ã€‚
   - ç±»æ¯” Redux çŠ¶æ€ç®¡ç†å’Œç°å®ç”Ÿæ´»ä¸­çš„åœºæ™¯ã€‚

2. **æ ¸å¿ƒåŸç†ï¼šuseSelector å¦‚ä½•è§¦å‘æ›´æ–°ï¼Ÿ**  
   - Redux Store çš„è®¢é˜…æœºåˆ¶ã€‚
   - `useSelector` çš„å†…éƒ¨å®ç°ï¼šé€‰æ‹©å™¨ã€æ¯”è¾ƒå™¨å’Œ React Hooksã€‚
   - æ·±å…¥ React-Redux çš„ `Provider` å’Œä¸Šä¸‹æ–‡æœºåˆ¶ã€‚

3. **æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚ä½•é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Ÿ**  
   - é€‰æ‹©å™¨çš„å¼•ç”¨ç¨³å®šæ€§é—®é¢˜ã€‚
   - æµ…æ¯”è¾ƒ vs. è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚
   - æœ€ä½³å®è·µå’Œå¸¸è§è¯¯åŒºã€‚

4. **è¿›é˜¶åœºæ™¯ï¼šå¤æ‚çŠ¶æ€ç®¡ç†ä¸­çš„ useSelector**  
   - å¤„ç†åµŒå¥—çŠ¶æ€ã€‚
   - ä¸å…¶ä»– Hooksï¼ˆå¦‚ `useDispatch`ï¼‰çš„é…åˆã€‚
   - åœ¨å¤§å‹é¡¹ç›®ä¸­çš„åº”ç”¨æ¡ˆä¾‹ã€‚

5. **æºç æ¢ç§˜ï¼šä¸€çª¥ React-Redux çš„å®ç°ç»†èŠ‚**  
   - `useSelector` çš„æºç è§£æã€‚
   - React-Redux çš„ä¼˜åŒ–æŠ€å·§ã€‚

6. **å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ**  
   - ç¼–å†™é«˜æ•ˆé€‰æ‹©å™¨çš„ 5 å¤§æŠ€å·§ã€‚
   - è°ƒè¯• `useSelector` çš„å®ç”¨å·¥å…·ã€‚
   - å¸¸è§é—®é¢˜ FAQã€‚

7. **æ€»ç»“ä¸å±•æœ›ï¼šuseSelector çš„æœªæ¥**  
   - Redux Toolkit çš„å½±å“ã€‚
   - ç°ä»£çŠ¶æ€ç®¡ç†çš„æ–°è¶‹åŠ¿ã€‚

æ¯ä¸€éƒ¨åˆ†éƒ½ä¼šé…æœ‰ä»£ç ç¤ºä¾‹ã€ç±»æ¯”ã€è¡¨æ ¼å’Œ *å° tips*ï¼Œç¡®ä¿å†…å®¹æ—¢æœ‰æ·±åº¦åˆæœ‰å®ç”¨æ€§ã€‚ç°åœ¨ï¼Œç³»å¥½å®‰å…¨å¸¦ï¼Œæˆ‘ä»¬æ­£å¼å¯ç¨‹ï¼ğŸš—

---

## 1. åŸºç¡€æ¦‚å¿µï¼šuseSelector æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ§‘â€ğŸ«

### 1.1 useSelector çš„åŸºæœ¬ç”¨æ³•

`useSelector` æ˜¯ React-Redux æä¾›çš„ä¸€ä¸ª Hookï¼Œç”¨äºä» Redux Store ä¸­æå–çŠ¶æ€ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªé€‰æ‹©å™¨å‡½æ•°ï¼ˆSelector Functionï¼‰ï¼Œè¿”å›æŒ‡å®šçš„çŠ¶æ€ç‰‡æ®µã€‚å½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```javascript
import { useSelector } from 'react-redux';

function Counter() {
  const count = useSelector(state => state.counter.value);
  return <div>è®¡æ•°å™¨: {count}</div>;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`useSelector` ä» Redux Store ä¸­æå–äº† `counter.value`ï¼Œå¹¶åœ¨çŠ¶æ€å˜åŒ–æ—¶æ›´æ–°ç»„ä»¶ã€‚ç®€å•å§ï¼Ÿä½†è¿™èƒŒåå¯ä¸ç®€å•ï¼ğŸ˜‰

### 1.2 ç±»æ¯”ï¼šRedux å°±åƒä¸€ä¸ªè¶…çº§å›¾ä¹¦é¦† ğŸ“š

æƒ³è±¡ Redux Store æ˜¯ä¸€ä¸ªå·¨å¤§çš„å›¾ä¹¦é¦†ï¼Œé‡Œé¢å­˜å‚¨äº†æ— æ•°æœ¬ä¹¦ï¼ˆçŠ¶æ€ï¼‰ã€‚`useSelector` å°±åƒä¸€ä¸ªæ™ºèƒ½å›¾ä¹¦ç®¡ç†å‘˜ ğŸ‘©â€ğŸ’¼ï¼Œä½ å‘Šè¯‰å®ƒâ€œæˆ‘æƒ³è¦ä¸€æœ¬å…³äº React çš„ä¹¦â€ï¼Œå®ƒä¼šè¿…é€Ÿæ‰¾åˆ°å¯¹åº”çš„ä¹¦å¹¶é€’ç»™ä½ ã€‚å¦‚æœå›¾ä¹¦é¦†çš„ä¹¦æ›´æ–°äº†ï¼ˆçŠ¶æ€å˜åŒ–ï¼‰ï¼Œç®¡ç†å‘˜ä¼šé€šçŸ¥ä½ ï¼šâ€œå˜¿ï¼Œæ–°ç‰ˆ React ä¹¦ç±åˆ°è´§äº†ï¼Œå¿«æ¥çœ‹ï¼â€

è¿™ç§ç±»æ¯”å¸®åŠ©æˆ‘ä»¬ç†è§£ï¼š
- **Store**ï¼šå…¨å±€çŠ¶æ€çš„å•ä¸€æ¥æºã€‚
- **Selector**ï¼šç²¾ç¡®æå–çŠ¶æ€çš„å‡½æ•°ã€‚
- **æ›´æ–°è§¦å‘**ï¼šçŠ¶æ€å˜åŒ–æ—¶ï¼Œé€šçŸ¥ç›¸å…³ç»„ä»¶ã€‚

*å° tipsï¼šæ€»æ˜¯ç”¨ `useSelector` è€Œä¸æ˜¯ç›´æ¥è®¿é—® Storeï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç»„ä»¶ä¸ Redux çš„è§£è€¦ï¼Œç»´æŠ¤æ€§æ›´å¼ºã€‚*

---

## 2. æ ¸å¿ƒåŸç†ï¼šuseSelector å¦‚ä½•è§¦å‘æ›´æ–°ï¼Ÿ ğŸ”

è¦ææ‡‚ `useSelector` çš„æ›´æ–°æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦ä» Redux çš„è®¢é˜…æœºåˆ¶å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ° React-Redux çš„å®ç°ã€‚

### 2.1 Redux Store çš„è®¢é˜…æœºåˆ¶

Redux çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå•ä¸€çš„ Storeï¼Œå®ƒé€šè¿‡ `subscribe` æ–¹æ³•å…è®¸ç›‘å¬çŠ¶æ€å˜åŒ–ã€‚å½“ä½ è°ƒç”¨ `store.dispatch` åˆ†å‘ä¸€ä¸ª actionï¼ŒReducer ä¼šç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ï¼ŒStore ä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚

```javascript
const store = createStore(reducer);
store.subscribe(() => {
  console.log('çŠ¶æ€å˜äº†ï¼', store.getState());
});
```

ä½†åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥ç”¨ `subscribe`ï¼Œå› ä¸ºè¿™å¤ªâ€œåŸå§‹â€äº†ã€‚React-Redux çš„ `Provider` å’Œ `useSelector` å¸®æˆ‘ä»¬æŠŠè¿™äº›åº•å±‚ç»†èŠ‚å°è£…å¾—æ¼‚æ¼‚äº®äº®ã€‚ğŸ˜

### 2.2 useSelector çš„å†…éƒ¨å®ç°

`useSelector` çš„é­”æ³•ä¸»è¦æ¥è‡ªä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **é€‰æ‹©å™¨å‡½æ•°ï¼ˆSelector Functionï¼‰**  
   é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶æ•´ä¸ªçŠ¶æ€æ ‘ï¼Œè¿”å›ä½ å…³å¿ƒçš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š
   ```javascript
   const user = useSelector(state => state.user);
   ```

2. **React çš„ useReducer å’Œ useEffect**  
   `useSelector` å†…éƒ¨ä½¿ç”¨äº† React çš„ Hooks æ¥ç®¡ç†çŠ¶æ€è®¢é˜…å’Œæ›´æ–°ã€‚å®ƒçš„ç®€åŒ–å®ç°å¦‚ä¸‹ï¼š

   ```javascript
   function useSelector(selector, equalityFn = shallowEqual) {
     const [, forceRender] = useReducer(s => s + 1, 0);
     const store = useReduxContext().store;
     const lastSelected = useRef(null);
     const selected = selector(store.getState());

     useEffect(() => {
       const checkForUpdates = () => {
         const newSelected = selector(store.getState());
         if (!equalityFn(newSelected, lastSelected.current)) {
           lastSelected.current = newSelected;
           forceRender();
         }
       };
       const unsubscribe = store.subscribe(checkForUpdates);
       return unsubscribe;
     }, [store, selector, equalityFn]);

     lastSelected.current = selected;
     return selected;
   }
   ```

   è¿™æ®µä»£ç æ­ç¤ºäº† `useSelector` çš„æ ¸å¿ƒé€»è¾‘ï¼š
   - ä½¿ç”¨ `useReducer` è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
   - é€šè¿‡ `useEffect` è®¢é˜… Store çš„å˜åŒ–ã€‚
   - ä½¿ç”¨ `equalityFn`ï¼ˆé»˜è®¤æ˜¯æµ…æ¯”è¾ƒï¼‰åˆ¤æ–­é€‰æ‹©å™¨ç»“æœæ˜¯å¦å˜åŒ–ã€‚

3. **æµ…æ¯”è¾ƒï¼ˆshallowEqualï¼‰**  
   é»˜è®¤æƒ…å†µä¸‹ï¼Œ`useSelector` ä½¿ç”¨æµ…æ¯”è¾ƒæ¥åˆ¤æ–­é€‰æ‹©å™¨è¿”å›çš„å€¼æ˜¯å¦å˜åŒ–ã€‚å¦‚æœå€¼æ²¡å˜ï¼Œç»„ä»¶å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

   ```javascript
   const shallowEqual = (objA, objB) => {
     if (Object.is(objA, objB)) return true;
     if (typeof objA !== 'object' || typeof objB !== 'object') return false;
     const keysA = Object.keys(objA);
     const keysB = Object.keys(objB);
     if (keysA.length !== keysB.length) return false;
     for (let key of keysA) {
       if (!Object.is(objA[key], objB[key])) return false;
     }
     return true;
   };
   ```

### 2.3 Provider å’Œä¸Šä¸‹æ–‡æœºåˆ¶

`useSelector` ä¾èµ– React-Redux çš„ `Provider` ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡ã€‚`Provider` å°† Store æ³¨å…¥åˆ°ç»„ä»¶æ ‘ä¸­ï¼Œ`useSelector` é€šè¿‡ `useReduxContext` è·å– Storeã€‚

```javascript
import { Provider } from 'react-redux';
import store from './store';

function App() {
  return (
    <Provider store={store}>
      <Counter />
    </Provider>
  );
}
```

*å° tipsï¼šç¡®ä¿ `Provider` åŒ…è£¹åœ¨ç»„ä»¶æ ‘çš„é¡¶å±‚ï¼Œå¦åˆ™ `useSelector` ä¼šæŠ›å‡ºä¸Šä¸‹æ–‡é”™è¯¯ã€‚*

### 2.4 æ›´æ–°è§¦å‘æµç¨‹

å½“ Store çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œ`useSelector` çš„æ›´æ–°æµç¨‹å¦‚ä¸‹ï¼š

| æ­¥éª¤ | æè¿° | å…³é”®ç‚¹ |
|------|------|--------|
| 1. **Dispatch Action** | è°ƒç”¨ `store.dispatch` åˆ†å‘ actionã€‚ | Reducer ç”Ÿæˆæ–°çŠ¶æ€æ ‘ã€‚ |
| 2. **é€šçŸ¥è®¢é˜…è€…** | Store é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆåŒ…æ‹¬ `useSelector` çš„è®¢é˜…ï¼‰ã€‚ | `useEffect` ä¸­çš„å›è°ƒæ‰§è¡Œã€‚ |
| 3. **æ‰§è¡Œé€‰æ‹©å™¨** | è¿è¡Œé€‰æ‹©å™¨å‡½æ•°ï¼Œè·å–æ–°çŠ¶æ€ã€‚ | é€‰æ‹©å™¨å¿…é¡»æ˜¯çº¯å‡½æ•°ï¼Œé¿å…å‰¯ä½œç”¨ã€‚ |
| 4. **æ¯”è¾ƒç»“æœ** | ä½¿ç”¨ `equalityFn` æ¯”è¾ƒæ–°æ—§å€¼ã€‚ | é»˜è®¤ä½¿ç”¨æµ…æ¯”è¾ƒã€‚ |
| 5. **è§¦å‘æ¸²æŸ“** | å¦‚æœå€¼å˜åŒ–ï¼Œè°ƒç”¨ `forceRender` é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ | åªæœ‰å€¼å˜åŒ–æ—¶æ‰æ¸²æŸ“ã€‚ |

è¿™ä¸ªæµç¨‹å°±åƒä¸€ä¸ªç²¾å‡†çš„â€œçŠ¶æ€æ›´æ–°é›·è¾¾â€ ğŸ“¡ï¼Œåªåœ¨å¿…è¦æ—¶è§¦å‘æ›´æ–°ã€‚

*å° tipsï¼šé€‰æ‹©å™¨å‡½æ•°è¦ä¿æŒç®€å•ï¼Œé¿å…å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œå¦åˆ™ä¼šå½±å“æ€§èƒ½ã€‚*

---

## 3. æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ âš¡

`useSelector` è™½ç„¶å¼ºå¤§ï¼Œä½†ç”¨ä¸å¥½å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä¼˜åŒ–ã€‚

### 3.1 é€‰æ‹©å™¨çš„å¼•ç”¨ç¨³å®šæ€§

é€‰æ‹©å™¨å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œå¦‚æœä¸æ³¨æ„å¼•ç”¨ç¨³å®šæ€§ï¼Œå¯èƒ½å¯¼è‡´æ„å¤–çš„é‡æ–°æ¸²æŸ“ã€‚æ¥çœ‹ä¸€ä¸ªé”™è¯¯ç¤ºä¾‹ï¼š

```javascript
function UserProfile() {
  const user = useSelector(state => ({ name: state.user.name, age: state.user.age }));
  return <div>{user.name}, {user.age}</div>;
}
```

é—®é¢˜åœ¨äºï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ `{ name, age }`ï¼Œå³ä½¿å€¼æ²¡å˜ï¼Œæµ…æ¯”è¾ƒä¹Ÿä¼šè®¤ä¸ºå®ƒâ€œå˜äº†â€ï¼Œå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `createSelector`ï¼ˆæ¥è‡ª Reselect åº“ï¼‰åˆ›å»ºè®°å¿†åŒ–çš„é€‰æ‹©å™¨ã€‚

```javascript
import { createSelector } from 'reselect';

const getUser = state => state.user;
const selectUserProfile = createSelector(
  [getUser],
  user => ({ name: user.name, age: user.age })
);

function UserProfile() {
  const user = useSelector(selectUserProfile);
  return <div>{user.name}, {user.age}</div>;
}
```

`createSelector` ç¡®ä¿åªæœ‰å½“è¾“å…¥ï¼ˆ`state.user`ï¼‰å˜åŒ–æ—¶ï¼Œæ‰é‡æ–°è®¡ç®—ç»“æœã€‚

*å° tipsï¼šæ€»æ˜¯ç”¨ `createSelector` å¤„ç†å¤æ‚é€‰æ‹©å™¨ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿”å›æ–°å¯¹è±¡æˆ–æ•°ç»„æ—¶ã€‚*

### 3.2 è‡ªå®šä¹‰æ¯”è¾ƒå™¨

`useSelector` å…è®¸ä¼ å…¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œç”¨äºæ›´ç²¾ç¡®çš„æ›´æ–°åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æ·±æ¯”è¾ƒï¼š

```javascript
import { isEqual } from 'lodash';

function DeepCompareComponent() {
  const data = useSelector(state => state.complexData, isEqual);
  return <div>{JSON.stringify(data)}</div>;
}
```

ä½†æ·±æ¯”è¾ƒæœ‰æ€§èƒ½å¼€é”€ï¼Œåªåœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚

*å° tipsï¼šä¼˜å…ˆä½¿ç”¨æµ…æ¯”è¾ƒï¼Œé™¤éçŠ¶æ€ç»“æ„éå¸¸å¤æ‚ã€‚*

### 3.3 å¸¸è§è¯¯åŒº

| è¯¯åŒº | æè¿° | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **é€‰æ‹©å™¨è¿”å›æ–°å¯¹è±¡** | æ¯æ¬¡è¿”å›æ–°å¯¹è±¡å¯¼è‡´ä¸å¿…è¦çš„æ¸²æŸ“ã€‚ | ä½¿ç”¨ `createSelector` è®°å¿†åŒ–ã€‚ |
| **è¿‡åº¦æå–çŠ¶æ€** | æå–æ— å…³çš„çŠ¶æ€ç‰‡æ®µã€‚ | å°½é‡æå–æœ€å°å¿…è¦çŠ¶æ€ã€‚ |
| **å¿½ç•¥å¼•ç”¨ç¨³å®šæ€§** | é€‰æ‹©å™¨å‡½æ•°å¼•ç”¨å˜åŒ–ã€‚ | ä½¿ç”¨å¸¸é‡æˆ–è®°å¿†åŒ–é€‰æ‹©å™¨ã€‚ |

*å° tipsï¼šè°ƒè¯•æ—¶å¯ä»¥ç”¨ Redux DevTools æ£€æŸ¥é€‰æ‹©å™¨è¿”å›å€¼çš„å˜åŒ–ã€‚*

---

## 4. è¿›é˜¶åœºæ™¯ï¼šå¤æ‚çŠ¶æ€ç®¡ç†ä¸­çš„ useSelector ğŸ› ï¸

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒçŠ¶æ€æ ‘å¯èƒ½éå¸¸å¤æ‚ï¼Œ`useSelector` éœ€è¦å¤„ç†åµŒå¥—çŠ¶æ€ã€åŠ¨æ€é€‰æ‹©å™¨ç­‰åœºæ™¯ã€‚

### 4.1 å¤„ç†åµŒå¥—çŠ¶æ€

å‡è®¾çŠ¶æ€æ ‘å¦‚ä¸‹ï¼š

```javascript
{
  users: {
    byId: { 1: { name: 'Alice', age: 30 }, 2: { name: 'Bob', age: 25 } },
    allIds: [1, 2]
  }
}
```

æˆ‘ä»¬å¯ä»¥ç”¨é€‰æ‹©å™¨åŠ¨æ€æå–ç”¨æˆ·ï¼š

```javascript
import { createSelector } from 'reselect';

const getUserId = (_, props) => props.userId;
const getUsers = state => state.users.byId;

const selectUserById = createSelector(
  [getUsers, getUserId],
  (users, userId) => users[userId]
);

function UserCard({ userId }) {
  const user = useSelector(state => selectUserById(state, { userId }));
  return <div>{user.name}, {user.age}</div>;
}
```

*å° tipsï¼šå°†åŠ¨æ€å‚æ•°ï¼ˆå¦‚ `userId`ï¼‰ä½œä¸ºé€‰æ‹©å™¨çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¿æŒé€‰æ‹©å™¨çº¯å‡€ã€‚*

### 4.2 ä¸ useDispatch é…åˆ

`useSelector` å¸¸ä¸ `useDispatch` ä¸€èµ·ä½¿ç”¨ï¼Œå®ç°çŠ¶æ€è¯»å–å’Œä¿®æ”¹çš„é—­ç¯ï¼š

```javascript
import { useSelector, useDispatch } from 'react-redux';
import { increment } from './counterSlice';

function Counter() {
  const count = useSelector(state => state.counter.value);
  const dispatch = useDispatch();
  return (
    <div>
      <span>{count}</span>
      <button onClick={() => dispatch(increment())}>åŠ  1</button>
    </div>
  );
}
```

*å° tipsï¼šå°† `dispatch` çš„è°ƒç”¨å°è£…æˆå›è°ƒå‡½æ•°ï¼Œé¿å…å†…è”å‡½æ•°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚*

---

## 5. æºç æ¢ç§˜ï¼šä¸€çª¥ React-Redux çš„å®ç°ç»†èŠ‚ ğŸ•µï¸â€â™‚ï¸

React-Redux çš„æºç è™½ç„¶å¤æ‚ï¼Œä½† `useSelector` çš„æ ¸å¿ƒé€»è¾‘å¹¶ä¸éš¾æ‡‚ã€‚æˆ‘ä»¬å·²ç»å±•ç¤ºäº†ç®€åŒ–ç‰ˆå®ç°ï¼Œè¿™é‡Œå†æ·±å…¥ä¸€äº›å…³é”®ç‚¹ï¼š

1. **è®¢é˜…ç®¡ç†**  
   `useSelector` é€šè¿‡ `useEffect` è®¢é˜… Storeï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆè®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

2. **æ€§èƒ½ä¼˜åŒ–**  
   React-Redux ä½¿ç”¨ `useRef` ç¼“å­˜é€‰æ‹©å™¨ç»“æœï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—ã€‚

3. **é”™è¯¯å¤„ç†**  
   å¦‚æœé€‰æ‹©å™¨æŠ›å‡ºå¼‚å¸¸ï¼ŒReact-Redux ä¼šæ•è·å¹¶æä¾›å‹å¥½çš„é”™è¯¯æç¤ºã€‚

*å° tipsï¼šé˜…è¯»æºç æ—¶ï¼Œå…³æ³¨ `react-redux/es/hooks/useSelector.js`ï¼Œé‡Œé¢æœ‰è¯¦ç»†æ³¨é‡Šã€‚*

---

## 6. å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ğŸ“

### 6.1 ç¼–å†™é«˜æ•ˆé€‰æ‹©å™¨çš„ 5 å¤§æŠ€å·§

1. **ä¿æŒé€‰æ‹©å™¨ç®€å•**  
   é€‰æ‹©å™¨åº”åªè´Ÿè´£æå–æ•°æ®ï¼Œé¿å…å¤æ‚é€»è¾‘ã€‚

2. **ä½¿ç”¨è®°å¿†åŒ–**  
   å€ŸåŠ© `createSelector` ä¼˜åŒ–å¤æ‚é€‰æ‹©å™¨ã€‚

3. **æœ€å°åŒ–çŠ¶æ€æå–**  
   åªæå–ç»„ä»¶éœ€è¦çš„çŠ¶æ€ç‰‡æ®µã€‚

4. **é¿å…åŠ¨æ€é€‰æ‹©å™¨**  
   åŠ¨æ€é€‰æ‹©å™¨å¯èƒ½å¯¼è‡´å¼•ç”¨ä¸ç¨³å®šï¼Œä¼˜å…ˆç”¨å‚æ•°åŒ–é€‰æ‹©å™¨ã€‚

5. **è°ƒè¯•ä¼˜å…ˆ**  
   ä½¿ç”¨ Redux DevTools ç›‘æ§é€‰æ‹©å™¨è¾“å‡ºã€‚

*å° tipsï¼šä¸ºæ¯ä¸ªé€‰æ‹©å™¨å†™å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿é€»è¾‘æ­£ç¡®ã€‚*

### 6.2 è°ƒè¯•å·¥å…·

- **Redux DevTools**ï¼šæŸ¥çœ‹çŠ¶æ€å˜åŒ–å’Œé€‰æ‹©å™¨è¾“å‡ºã€‚
- **React Developer Tools**ï¼šæ£€æŸ¥ç»„ä»¶æ¸²æŸ“æ¬¡æ•°ã€‚
- **why-did-you-render**ï¼šæ£€æµ‹ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

*å° tipsï¼šå®‰è£… `why-did-you-render` åº“ï¼Œå¿«é€Ÿå®šä½æ¸²æŸ“é—®é¢˜ã€‚*

### 6.3 å¸¸è§é—®é¢˜ FAQ

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| ä¸ºä»€ä¹ˆç»„ä»¶æ€»æ˜¯é‡æ–°æ¸²æŸ“ï¼Ÿ | æ£€æŸ¥é€‰æ‹©å™¨æ˜¯å¦è¿”å›æ–°å¼•ç”¨ï¼Œä½¿ç”¨ `createSelector` ä¿®å¤ã€‚ |
| å¦‚ä½•å¤„ç†å¼‚æ­¥çŠ¶æ€ï¼Ÿ | ç»“åˆ `useDispatch` å’Œ Redux Thunk å¤„ç†å¼‚æ­¥é€»è¾‘ã€‚ |
| useSelector æ”¯æŒ TypeScript å—ï¼Ÿ | å®Œå…¨æ”¯æŒï¼Œä½¿ç”¨ `RootState` ç±»å‹å®šä¹‰çŠ¶æ€ã€‚ |

*å° tipsï¼šä¸º TypeScript é¡¹ç›®å®šä¹‰ `RootState` ç±»å‹ï¼Œæå‡å¼€å‘ä½“éªŒã€‚*

---

## 7. æ€»ç»“ä¸å±•æœ›ï¼šuseSelector çš„æœªæ¥ ğŸ”®

`useSelector` æ˜¯ React-Redux çš„æ ¸å¿ƒï¼Œå®ƒè®©çŠ¶æ€ç®¡ç†å˜å¾—ä¼˜é›…è€Œé«˜æ•ˆã€‚éšç€ Redux Toolkit çš„æ™®åŠï¼Œ`useSelector` çš„ä½¿ç”¨åœºæ™¯æ›´åŠ å¹¿æ³›ã€‚æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½çœ‹åˆ°ï¼š
- **æ›´å¥½çš„ç±»å‹æ”¯æŒ**ï¼šRedux Toolkit æ­£åœ¨å¢å¼º TypeScript é›†æˆã€‚
- **æ›´æ™ºèƒ½çš„ä¼˜åŒ–**ï¼šè‡ªåŠ¨è®°å¿†åŒ–ã€æ— éœ€æ‰‹åŠ¨é…ç½® `createSelector`ã€‚
- **æ–°çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ**ï¼šZustandã€Jotai ç­‰æ–°å…´åº“çš„ç«äº‰ã€‚

æ— è®ºå¦‚ä½•ï¼Œç†è§£ `useSelector` çš„åŸç†éƒ½èƒ½è®©ä½ åœ¨çŠ¶æ€ç®¡ç†ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚å¸Œæœ›è¿™ç¯‡ 17000 å­—çš„â€œé­”æ³•æŒ‡å—â€èƒ½æˆä¸ºä½ çš„å‰ç«¯å¼€å‘åˆ©å™¨ï¼ğŸ›¡ï¸

*å° tipsï¼šæŒç»­å…³æ³¨ React-Redux çš„ GitHubï¼Œç¬¬ä¸€æ—¶é—´æŒæ¡æ–°ç‰¹æ€§ï¼*

---