---
type: "Post"
title: "æ­ç§˜ useEffectï¼šReact æ ¸å¿ƒé’©å­ä½¿ç”¨æŠ€å·§ä¸é¿å‘å…¨æ”»ç•¥ ğŸš€"
date: "2024-08-03"
description: "æ·±å…¥å‰–æ React useEffect é’©å­çš„æ ¸å¿ƒä½¿ç”¨æŠ€å·§ã€å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µï¼Œæ¶µç›–åŸç†ã€ç¤ºä¾‹å’Œå®ç”¨å»ºè®®ï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘è€…å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ã€‚"
keywords: "React, useEffect, React Hooks, å‰ç«¯å¼€å‘, å‰¯ä½œç”¨ç®¡ç†, æ€§èƒ½ä¼˜åŒ–, æœ€ä½³å®è·µ"
author: "æ™“é¾™"
image: "/images/hero/useeffect-guide.jpg"
tags: ["React", "Frontend", "JavaScript", "Hooks"]
category: "React"
---

> â€œä»£ç æ˜¯è¯—ï¼Œå‰¯ä½œç”¨æ˜¯éŸµå¾‹ï¼Œ`useEffect` æ˜¯é‚£æ”¯è°ƒéŸ³çš„æŒ‡æŒ¥æ£’ã€‚â€

ä½œä¸º React å¼€å‘è€…ï¼Œ`useEffect` å¯èƒ½æ˜¯ä½ æœ€å¸¸æ‰“äº¤é“çš„é’©å­ä¹‹ä¸€ã€‚å®ƒåƒä¸€ä¸ªâ€œé­”æ³•å¸ˆâ€ï¼Œå¸®ä½ åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ç®¡ç†å‰¯ä½œç”¨ï¼Œä½†ç¨ä¸ç•™ç¥ï¼Œå®ƒä¹Ÿå¯èƒ½å˜æˆâ€œæ£è›‹é¬¼â€ï¼Œè®©ä½ çš„ä»£ç é™·å…¥æ··ä¹±ã€‚ğŸ”¥ æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ `useEffect` çš„æ ¸å¿ƒï¼Œæ­å¼€å®ƒçš„ç¥ç§˜é¢çº±ï¼Œä»åŸç†åˆ°å®è·µï¼Œä»æŠ€å·§åˆ°é¿å‘ï¼Œå…¨é¢è§£æå¦‚ä½•ä¼˜é›…åœ°é©¾é©­è¿™ä¸ª React æ ¸å¿ƒé’©å­ã€‚

è¿™ä¸ä»…æ˜¯ä¸€ç¯‡æŠ€æœ¯æŒ‡å—ï¼Œæ›´æ˜¯ä¸€åœºå…³äºä»£ç å“²å­¦ã€æ€ç»´æ–¹å¼å’Œå®è·µæ™ºæ…§çš„æ¢ç´¢ã€‚æ— è®ºä½ æ˜¯ React æ–°æ‰‹è¿˜æ˜¯è€å…µï¼Œè¿™ç¯‡æ–‡ç« éƒ½ä¼šè®©ä½ æœ‰æ‰€æ”¶è·ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœº `useEffect` çš„å†’é™©å§ï¼ğŸ§™â€â™‚ï¸

---

## ä»€ä¹ˆæ˜¯ useEffectï¼Ÿä»å“²å­¦åˆ°æœ¬è´¨

åœ¨æ·±å…¥æŠ€å·§ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠ `useEffect` çš„â€œçµé­‚â€ã€‚React çš„è®¾è®¡å“²å­¦æ˜¯ **å£°æ˜å¼ç¼–ç¨‹**ï¼Œå¼ºè°ƒâ€œæè¿°çŠ¶æ€ï¼ŒReact å¸®ä½ æ¸²æŸ“ UIâ€ã€‚ä½†ç°å®ä¸–ç•Œä¸­ï¼ŒUI ä¹‹å¤–è¿˜æœ‰è®¸å¤šâ€œå‰¯ä½œç”¨â€ï¼ˆSide Effectsï¼‰ï¼Œæ¯”å¦‚ï¼š

- å‘èµ·ç½‘ç»œè¯·æ±‚
- æ“ä½œ DOM
- è®¢é˜…äº‹ä»¶
- è®¾ç½®å®šæ—¶å™¨

è¿™äº›æ“ä½œä¸åœ¨ React çš„â€œçº¯å‡½æ•°â€ç®¡è¾–èŒƒå›´å†…ï¼Œäºæ˜¯ `useEffect` åº”è¿è€Œç”Ÿã€‚å®ƒæ˜¯ React æä¾›çš„ä¸€ä¸ªâ€œå‰¯ä½œç”¨å®¹å™¨â€ï¼Œè®©ä½ åœ¨ç»„ä»¶æ¸²æŸ“åå®‰å…¨åœ°æ‰§è¡Œè¿™äº›â€œæ‚äº‹â€ã€‚

### useEffect çš„æ ¸å¿ƒç­¾å

```jsx
useEffect(() => {
  // å‰¯ä½œç”¨é€»è¾‘
  return () => {
    // æ¸…ç†é€»è¾‘
  };
}, [dependencies]);
```

- **ç¬¬ä¸€ä¸ªå‚æ•°**ï¼šå‰¯ä½œç”¨å‡½æ•°ï¼ŒåŒ…å«ä½ æƒ³åœ¨æ¸²æŸ“åæ‰§è¡Œçš„é€»è¾‘ã€‚
- **ç¬¬äºŒä¸ªå‚æ•°**ï¼šä¾èµ–æ•°ç»„ï¼Œæ§åˆ¶å‰¯ä½œç”¨ä½•æ—¶è¿è¡Œã€‚
- **è¿”å›å€¼**ï¼ˆå¯é€‰ï¼‰ï¼šæ¸…ç†å‡½æ•°ï¼Œåœ¨ç»„ä»¶å¸è½½æˆ–ä¾èµ–å˜æ›´å‰è¿è¡Œã€‚

ç±»æ¯”ä¸€ä¸‹ï¼Œ`useEffect` å°±åƒä½ å®¶é‡Œçš„æ™ºèƒ½æ‰«åœ°æœºå™¨äºº ğŸ¤–ï¼šå®ƒä¼šåœ¨ä½ æŒ‡å®šçš„æ—¶é—´ï¼ˆä¾èµ–å˜æ›´ï¼‰æ‰“æ‰«æˆ¿é—´ï¼ˆæ‰§è¡Œå‰¯ä½œç”¨ï¼‰ï¼Œè¿˜èƒ½åœ¨ç¦»å¼€å‰æ”¶æ‹¾å¥½ï¼ˆæ¸…ç†é€»è¾‘ï¼‰ã€‚

> **å° Tips**ï¼š*å§‹ç»ˆæ˜ç¡®ä½ çš„å‰¯ä½œç”¨ç›®æ ‡ï¼Œé¿å…åœ¨ `useEffect` ä¸­å †ç Œè¿‡å¤šé€»è¾‘ï¼Œå¦åˆ™ä»£ç ä¼šåƒâ€œæ‚ç‰©é—´â€ä¸€æ ·éš¾ä»¥ç»´æŠ¤ã€‚*

---

## useEffect çš„è¿è¡Œæœºåˆ¶ï¼šæ·±å…¥åŸç†

è¦çœŸæ­£æŒæ¡ `useEffect`ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒçš„è¿è¡Œæœºåˆ¶ã€‚React çš„æ¸²æŸ“æµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

1. **Render é˜¶æ®µ**ï¼šReact æ ¹æ®çŠ¶æ€å’Œ props ç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOMã€‚
2. **Commit é˜¶æ®µ**ï¼šå°†è™šæ‹Ÿ DOM åº”ç”¨åˆ°çœŸå® DOMã€‚
3. **å‰¯ä½œç”¨é˜¶æ®µ**ï¼šæ‰§è¡Œ `useEffect` å’Œå…¶ä»–å‰¯ä½œç”¨é€»è¾‘ã€‚

`useEffect` æ€»æ˜¯åœ¨ **Commit é˜¶æ®µ** åè¿è¡Œï¼Œç¡®ä¿ DOM å·²æ›´æ–°ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒé€‚åˆå¤„ç† DOM æ“ä½œæˆ–å¼‚æ­¥è¯·æ±‚ã€‚

### ä¾èµ–æ•°ç»„çš„ç§˜å¯†

ä¾èµ–æ•°ç»„æ˜¯ `useEffect` çš„â€œé¥æ§å™¨â€ã€‚React ä¼šæ¯”è¾ƒæ–°æ—§ä¾èµ–æ•°ç»„çš„æ¯ä¸€é¡¹ï¼ˆä½¿ç”¨ `Object.is` è¿›è¡Œæµ…æ¯”è¾ƒï¼‰ï¼Œå†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚

- **ç©ºæ•°ç»„ `[]`**ï¼šå‰¯ä½œç”¨åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œç±»ä¼¼ `componentDidMount`ã€‚
- **éç©ºæ•°ç»„ `[dep1, dep2]`**ï¼šå½“æ•°ç»„ä¸­çš„ä»»æ„ä¾èµ–å˜æ›´æ—¶ï¼Œå‰¯ä½œç”¨é‡æ–°è¿è¡Œã€‚
- **æ— ä¾èµ–æ•°ç»„**ï¼šæ¯æ¬¡æ¸²æŸ“åéƒ½è¿è¡Œå‰¯ä½œç”¨ï¼ˆè°¨æ…ä½¿ç”¨ï¼âš ï¸ï¼‰ã€‚

> **å° Tips**ï¼š*ä¾èµ–æ•°ç»„ä¸­çš„å€¼åº”è¯¥æ˜¯åŸå§‹å€¼æˆ–ç¨³å®šå¼•ç”¨ï¼Œé¿å…ä½¿ç”¨å¯¹è±¡æˆ–å‡½æ•°ä½œä¸ºä¾èµ–ï¼Œé™¤éå®ƒä»¬è¢« `useMemo` æˆ– `useCallback` åŒ…è£¹ã€‚*

### æ¸…ç†å‡½æ•°çš„å“²å­¦

`useEffect` çš„æ¸…ç†å‡½æ•°å°±åƒæ˜¯å‰¯ä½œç”¨çš„â€œå–„åä¸“å®¶â€ã€‚å®ƒåœ¨ä»¥ä¸‹åœºæ™¯è¿è¡Œï¼š

- ç»„ä»¶å¸è½½æ—¶ï¼ˆç±»ä¼¼ `componentWillUnmount`ï¼‰ã€‚
- ä¾èµ–å˜æ›´æ—¶ï¼Œåœ¨æ–°çš„å‰¯ä½œç”¨æ‰§è¡Œå‰ã€‚

æ¸…ç†å‡½æ•°çš„å­˜åœ¨ä½“ç°äº† React çš„ **èµ„æºç®¡ç†å“²å­¦**ï¼šæ¯åˆ†é…ä¸€ä¸ªèµ„æºï¼ˆè®¢é˜…ã€å®šæ—¶å™¨ï¼‰ï¼Œå°±å¿…é¡»æä¾›ä¸€ç§å›æ”¶æ–¹å¼ã€‚è¿™ç§è®¾è®¡é¿å…äº†å†…å­˜æ³„æ¼å’ŒçŠ¶æ€ç«äº‰ã€‚

---

## useEffect çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯

`useEffect` çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§åœºæ™¯åŠå…¶æœ€ä½³å®è·µã€‚

### 1. æ•°æ®è·å–ï¼ˆData Fetchingï¼‰

æ•°æ®è·å–æ˜¯ `useEffect` çš„ç»å…¸ç”¨ä¾‹ã€‚å‡è®¾æˆ‘ä»¬è¦ä» API è·å–ç”¨æˆ·åˆ—è¡¨ï¼š

```jsx
import { useState, useEffect } from 'react';

function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    let isMounted = true; // é¿å…å†…å­˜æ³„æ¼
    const fetchUsers = async () => {
      try {
        setLoading(true);
        const response = await fetch('https://api.example.com/users');
        const data = await response.json();
        if (isMounted) {
          setUsers(data);
          setLoading(false);
        }
      } catch (err) {
        if (isMounted) {
          setError(err.message);
          setLoading(false);
        }
      }
    };

    fetchUsers();

    return () => {
      isMounted = false; // æ¸…ç†æ ‡å¿—
    };
  }, []);

  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯ï¼š{error}</div>;
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}

export default UserList;
```

**æœ€ä½³å®è·µ**ï¼š
- ä½¿ç”¨ `isMounted` æ ‡å¿—é˜²æ­¢ç»„ä»¶å¸è½½åæ›´æ–°çŠ¶æ€ã€‚
- å§‹ç»ˆå¤„ç†åŠ è½½å’Œé”™è¯¯çŠ¶æ€ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚
- é¿å…åœ¨ `useEffect` ä¸­ç›´æ¥ä½¿ç”¨ async å‡½æ•°ï¼ˆReact ä¸æ”¯æŒç›´æ¥è¿”å› Promiseï¼‰ã€‚

> **å° Tips**ï¼š*å°†æ•°æ®è·å–é€»è¾‘æŠ½å–ä¸ºè‡ªå®šä¹‰ Hookï¼ˆå¦‚ `useFetch`ï¼‰ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œå¯è¯»æ€§ã€‚*

### 2. äº‹ä»¶è®¢é˜…ï¼ˆEvent Subscriptionï¼‰

`useEffect` éå¸¸é€‚åˆç®¡ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œæ¯”å¦‚ç›‘å¬çª—å£çš„ `resize` äº‹ä»¶ï¼š

```jsx
import { useState, useEffect } from 'react';

function WindowSize() {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight,
  });

  useEffect(() => {
    const handleResize = () => {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight,
      });
    };

    window.addEventListener('resize', handleResize);

    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  return (
    <div>
      çª—å£å¤§å°ï¼š{windowSize.width} x {windowSize.height}
    </div>
  );
}

export default WindowSize;
```

**æœ€ä½³å®è·µ**ï¼š
- å§‹ç»ˆåœ¨æ¸…ç†å‡½æ•°ä¸­ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚
- ä½¿ç”¨é˜²æŠ–ï¼ˆdebounceï¼‰æˆ–èŠ‚æµï¼ˆthrottleï¼‰ä¼˜åŒ–é¢‘ç¹è§¦å‘çš„äº‹ä»¶ã€‚

> **å° Tips**ï¼š*å°†äº‹ä»¶å¤„ç†é€»è¾‘å°è£…ä¸ºè‡ªå®šä¹‰ Hookï¼ˆå¦‚ `useWindowSize`ï¼‰ï¼Œè®©ä»£ç æ›´æ¨¡å—åŒ–ã€‚*

### 3. å®šæ—¶å™¨ç®¡ç†

å®šæ—¶å™¨ï¼ˆå¦‚ `setInterval`ï¼‰æ˜¯ `useEffect` çš„å¦ä¸€ä¸ªå¸¸è§åœºæ™¯ï¼š

```jsx
import { useState, useEffect } from 'react';

function Timer() {
  const [seconds, setSeconds] = useState(0);

  useEffect(() => {
    const intervalId = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);

    return () => clearInterval(intervalId);
  }, []);

  return <div>å·²è¿è¡Œ {seconds} ç§’</div>;
}

export default Timer;
```

**æœ€ä½³å®è·µ**ï¼š
- å§‹ç»ˆåœ¨æ¸…ç†å‡½æ•°ä¸­æ¸…é™¤å®šæ—¶å™¨ã€‚
- å¦‚æœéœ€è¦åŠ¨æ€æ›´æ–°å®šæ—¶å™¨é—´éš”ï¼Œä½¿ç”¨ `useRef` å­˜å‚¨ `intervalId`ã€‚

> **å° Tips**ï¼š*é¿å…åœ¨ä¾èµ–æ•°ç»„ä¸­æ”¾å…¥çŠ¶æ€æ›´æ–°å‡½æ•°ï¼ˆå¦‚ `setSeconds`ï¼‰ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„é‡æ¸²æŸ“ã€‚*

---

## useEffect çš„å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—

`useEffect` è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿå®¹æ˜“è¸©å‘ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§è¯¯åŒºåŠå…¶è§£å†³æ–¹æ¡ˆï¼Œé…ä»¥å¹½é»˜çš„ç±»æ¯”å’Œå®ç”¨å»ºè®®ã€‚

### è¯¯åŒº 1ï¼šä¾èµ–æ•°ç»„é—æ¼

**é—®é¢˜**ï¼šé—æ¼ä¾èµ–æ•°ç»„ä¸­çš„å˜é‡ä¼šå¯¼è‡´å‰¯ä½œç”¨è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸã€‚ä¾‹å¦‚ï¼š

```jsx
function Counter({ step }) {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(count + step); // é”™è¯¯ï¼šstep æœªåœ¨ä¾èµ–æ•°ç»„ä¸­
    }, 1000);
    return () => clearInterval(id);
  }, [count]); // é—æ¼äº† step

  return <div>{count}</div>;
}
```

**åæœ**ï¼š`step` å˜åŒ–æ—¶ï¼Œ`useEffect` ä¸ä¼šé‡æ–°è¿è¡Œï¼Œå¯¼è‡´è®¡æ•°å™¨è¡Œä¸ºå¼‚å¸¸ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ä¾èµ–æ•°ç»„åŒ…å«æ‰€æœ‰å‰¯ä½œç”¨ä¸­ä½¿ç”¨çš„å¤–éƒ¨å˜é‡ã€‚ESLint çš„ `react-hooks/exhaustive-deps` è§„åˆ™æ˜¯ä½ çš„å¥½å¸®æ‰‹ã€‚

**ä¿®å¤ä»£ç **ï¼š

```jsx
useEffect(() => {
  const id = setInterval(() => {
    setCount(prev => prev + step); // ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
  }, 1000);
  return () => clearInterval(id);
}, [step]); // æ­£ç¡®åŒ…å« step
```

**ç±»æ¯”**ï¼šä¾èµ–æ•°ç»„å°±åƒä½ çš„è´­ç‰©æ¸…å• ğŸ›’ï¼Œæ¼å†™ä¸€ä¸ªé£Ÿæï¼Œä½ çš„èœè‚´å°±ä¼šå‘³é“ä¸å¯¹ã€‚

> **å° Tips**ï¼š*å®‰è£… `eslint-plugin-react-hooks`ï¼Œè®© ESLint å¸®ä½ è‡ªåŠ¨æ£€æµ‹ä¾èµ–æ•°ç»„é—®é¢˜ã€‚*

### è¯¯åŒº 2ï¼šæ— é™å¾ªç¯

**é—®é¢˜**ï¼šåœ¨ `useEffect` ä¸­æ›´æ–°çŠ¶æ€ï¼Œä¸”çŠ¶æ€åœ¨ä¾èµ–æ•°ç»„ä¸­ï¼Œå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ï¼š

```jsx
function BadCounter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    setCount(count + 1); // æ¯æ¬¡æ¸²æŸ“éƒ½æ›´æ–° count
  }, [count]); // count å˜åŒ–è§¦å‘é‡æ¸²æŸ“

  return <div>{count}</div>;
}
```

**åæœ**ï¼šç»„ä»¶é™·å…¥æ— é™é‡æ¸²æŸ“ï¼Œæµè§ˆå™¨ç›´æ¥â€œå´©æºƒâ€ ğŸ˜µã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥å‰¯ä½œç”¨é€»è¾‘ï¼Œé¿å…ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°ã€‚å¦‚æœéœ€è¦ç´¯åŠ è®¡æ•°ï¼Œä½¿ç”¨å‡½æ•°å¼æ›´æ–°æˆ–æ¡ä»¶é€»è¾‘ï¼š

```jsx
useEffect(() => {
  if (count < 10) {
    setCount(count + 1); // é™åˆ¶æ›´æ–°æ¬¡æ•°
  }
}, [count]);
```

**ç±»æ¯”**ï¼šè¿™å°±åƒä½ ä¸åœåœ°å¾€å’–å•¡é‡ŒåŠ ç³– â˜•ï¼Œç»“æœç”œåˆ°æ— æ³•å…¥å£ã€‚

> **å° Tips**ï¼š*åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ React DevTools ç›‘æ§æ¸²æŸ“æ¬¡æ•°ï¼Œå¿«é€Ÿå®šä½æ— é™å¾ªç¯é—®é¢˜ã€‚*

### è¯¯åŒº 3ï¼šæ¸…ç†å‡½æ•°ç¼ºå¤±

**é—®é¢˜**ï¼šæœªæä¾›æ¸…ç†å‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼š

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    const socket = new WebSocket(`wss://example.com/${roomId}`);
    socket.onmessage = (msg) => console.log(msg);
    // ç¼ºå°‘æ¸…ç†å‡½æ•°
  }, [roomId]);

  return <div>èŠå¤©å®¤ï¼š{roomId}</div>;
}
```

**åæœ**ï¼šå½“ `roomId` å˜åŒ–æˆ–ç»„ä»¶å¸è½½æ—¶ï¼Œæ—§çš„ WebSocket è¿æ¥æœªå…³é—­ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šå§‹ç»ˆè¿”å›æ¸…ç†å‡½æ•°ï¼š

```jsx
useEffect(() => {
  const socket = new WebSocket(`wss://example.com/${roomId}`);
  socket.onmessage = (msg) => console.log(msg);

  return () => {
    socket.close();
  };
}, [roomId]);
```

**ç±»æ¯”**ï¼šä¸æ¸…ç†å°±åƒä½ ç¦»å¼€å®¶æ—¶å¿˜äº†å…³æ°´é¾™å¤´ ğŸš°ï¼Œè¿Ÿæ—©ä¼šâ€œæ°´æ¼«é‡‘å±±â€ã€‚

> **å° Tips**ï¼š*å°†æ¸…ç†é€»è¾‘ä¸åˆ›å»ºé€»è¾‘å¯¹ç§°ç¼–å†™ï¼Œå…»æˆâ€œæœ‰å€Ÿæœ‰è¿˜â€çš„ç¼–ç ä¹ æƒ¯ã€‚*

---

## useEffect æœ€ä½³å®è·µä¸€è§ˆè¡¨

ä»¥ä¸‹æ˜¯ `useEffect` çš„æœ€ä½³å®è·µæ€»ç»“ï¼Œä¾›å¿«é€Ÿå‚è€ƒï¼š

| **å®è·µ** | **æè¿°** | **ç¤ºä¾‹** | **æ³¨æ„äº‹é¡¹** |
|----------|----------|----------|--------------|
| **æ˜ç¡®ä¾èµ–æ•°ç»„** | ç¡®ä¿æ‰€æœ‰å‰¯ä½œç”¨ä¸­ä½¿ç”¨çš„å˜é‡éƒ½åœ¨ä¾èµ–æ•°ç»„ä¸­ã€‚ | `useEffect(() => { fetchData(id); }, [id]);` | ä½¿ç”¨ ESLint æ’ä»¶æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§ã€‚ |
| **é¿å…æ— é™å¾ªç¯** | é¿å…åœ¨å‰¯ä½œç”¨ä¸­ç›´æ¥æ›´æ–°ä¾èµ–çŠ¶æ€ã€‚ | `setCount(prev => prev + 1);` | ä½¿ç”¨å‡½æ•°å¼æ›´æ–°æˆ–æ¡ä»¶é€»è¾‘ã€‚ |
| **å§‹ç»ˆæ¸…ç†èµ„æº** | è¿”å›æ¸…ç†å‡½æ•°ï¼Œé‡Šæ”¾è®¢é˜…ã€å®šæ—¶å™¨ç­‰èµ„æºã€‚ | `return () => clearInterval(id);` | ç¡®ä¿æ¸…ç†é€»è¾‘ä¸åˆ›å»ºé€»è¾‘å¯¹ç§°ã€‚ |
| **æŠ½å–è‡ªå®šä¹‰ Hook** | å°†å¤æ‚å‰¯ä½œç”¨é€»è¾‘å°è£…ä¸ºå¯å¤ç”¨çš„ Hookã€‚ | `useFetch(url)` | æé«˜ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ |
| **ä¼˜åŒ–æ€§èƒ½** | ä½¿ç”¨ `useMemo` æˆ– `useCallback` ç¨³å®šä¾èµ–ã€‚ | `const memoizedCallback = useCallback(() => {}, []);` | é¿å…ä¸å¿…è¦çš„å‰¯ä½œç”¨é‡è¿è¡Œã€‚ |
| **å¤„ç†å¼‚æ­¥é€»è¾‘** | é¿å…ç›´æ¥åœ¨ `useEffect` ä¸­ä½¿ç”¨ async å‡½æ•°ã€‚ | ä½¿ç”¨å†…éƒ¨ async å‡½æ•°å¹¶è°ƒç”¨ã€‚ | ç¡®ä¿æ¸…ç†å¼‚æ­¥æ“ä½œã€‚ |

> **å° Tips**ï¼š*å°†æ­¤è¡¨æ ¼æ‰“å°å‡ºæ¥ï¼Œè´´åœ¨æ˜¾ç¤ºå™¨æ—ï¼Œæ¯æ¬¡å†™ `useEffect` æ—¶å¿«é€Ÿæ ¸å¯¹ï¼*

---

## é«˜çº§æŠ€å·§ï¼šè§£é” useEffect çš„éšè—æ½œåŠ›

`useEffect` ä¸ä»…èƒ½å¤„ç†åŸºç¡€å‰¯ä½œç”¨ï¼Œè¿˜èƒ½å®ç°ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å‡ ç§è¿›é˜¶ç”¨æ³•ï¼Œå¸¦ä½ ç©è½¬ `useEffect`ã€‚

### 1. æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸæ–¹æ³•

è™½ç„¶ Hooks å–ä»£äº†ç±»ç»„ä»¶ï¼Œä½†ä½ å¯ä»¥ç”¨ `useEffect` æ¨¡æ‹Ÿä¼ ç»Ÿç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š

- **componentDidMount**ï¼šç©ºä¾èµ–æ•°ç»„ã€‚
- **componentDidUpdate**ï¼šæŒ‡å®šä¾èµ–æ•°ç»„ã€‚
- **componentWillUnmount**ï¼šæ¸…ç†å‡½æ•°ã€‚

ç¤ºä¾‹ï¼š

```jsx
useEffect(() => {
  console.log('ç»„ä»¶æŒ‚è½½');
  return () => console.log('ç»„ä»¶å¸è½½');
}, []); // æ¨¡æ‹Ÿ componentDidMount å’Œ componentWillUnmount

useEffect(() => {
  console.log('ä¾èµ–æ›´æ–°ï¼š', someProp);
}, [someProp]); // æ¨¡æ‹Ÿ componentDidUpdate
```

> **å° Tips**ï¼š*å°†å¤šä¸ªç›¸å…³å‰¯ä½œç”¨åˆå¹¶åˆ°ä¸€ä¸ª `useEffect` ä¸­ï¼Œå‡å°‘ä»£ç åˆ†æ•£ã€‚*

### 2. å»¶è¿Ÿæ‰§è¡Œå‰¯ä½œç”¨

æœ‰æ—¶ï¼Œä½ éœ€è¦åœ¨æ¸²æŸ“åå»¶è¿Ÿæ‰§è¡Œå‰¯ä½œç”¨ï¼Œæ¯”å¦‚æ˜¾ç¤ºæç¤ºæ¡†ï¼š

```jsx
import { useEffect } from 'react';

function Notification() {
  useEffect(() => {
    const timeoutId = setTimeout(() => {
      alert('æ¬¢è¿å›æ¥ï¼');
    }, 2000);

    return () => clearTimeout(timeoutId);
  }, []);

  return <div>é€šçŸ¥ç»„ä»¶</div>;
}

export default Notification;
```

> **å° Tips**ï¼š*ä½¿ç”¨ `setTimeout` æ—¶ï¼Œç¡®ä¿æ¸…ç†å®šæ—¶å™¨ï¼Œé¿å…é‡å¤è§¦å‘ã€‚*

### 3. åŒæ­¥çŠ¶æ€ä¸å¤–éƒ¨ç³»ç»Ÿ

`useEffect` å¯ä»¥ç”¨æ¥åŒæ­¥ React çŠ¶æ€ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚æœ¬åœ°å­˜å‚¨ï¼‰ï¼š

```jsx
import { useState, useEffect } from 'react';

function ThemeToggle() {
  const [theme, setTheme] = useState(() => localStorage.getItem('theme') || 'light');

  useEffect(() => {
    localStorage.setItem('theme', theme);
    document.body.className = theme;
  }, [theme]);

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      åˆ‡æ¢åˆ° {theme === 'light' ? 'æš—é»‘' : 'æ˜äº®'} æ¨¡å¼
    </button>
  );
}

export default ThemeToggle;
```

> **å° Tips**ï¼š*åœ¨åŒæ­¥å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œç¡®ä¿å‰¯ä½œç”¨é€»è¾‘å¹‚ç­‰ï¼Œé¿å…é‡å¤æ“ä½œã€‚*

---

## useEffect çš„è®¾è®¡å“²å­¦ä¸æ„Ÿæ‚Ÿ

`useEffect` ä¸ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œæ›´æ˜¯ React å“²å­¦çš„ä½“ç°ã€‚å®ƒé¼“åŠ±å¼€å‘è€…ä»¥ **å£°æ˜å¼** å’Œ **æ¨¡å—åŒ–** çš„æ–¹å¼ç®¡ç†å‰¯ä½œç”¨ã€‚è¿™ç§è®¾è®¡è®©æˆ‘æƒ³èµ·ã€Šç¦…ä¸æ‘©æ‰˜è½¦ç»´ä¿®è‰ºæœ¯ã€‹ä¸­çš„ä¸€å¥è¯ï¼š

> â€œæŠ€æœ¯å¹¶éå†·å†°å†°çš„å·¥å…·ï¼Œå®ƒæ˜¯äººç±»åˆ›é€ åŠ›çš„å»¶ä¼¸ã€‚â€

`useEffect` çš„ç¾åœ¨äºå®ƒçš„çµæ´»æ€§å’Œçº¦æŸæ€§å¹¶å­˜ã€‚å®ƒç»™ä½ è‡ªç”±å»å¤„ç†å‰¯ä½œç”¨ï¼Œä½†é€šè¿‡ä¾èµ–æ•°ç»„å’Œæ¸…ç†å‡½æ•°æé†’ä½ ï¼š**è‡ªç”±éœ€è¦çºªå¾‹**ã€‚è¿™å°±åƒå†™ä½œï¼šä½ å¯ä»¥å¤©é©¬è¡Œç©ºï¼Œä½†ç»“æ„å’Œé€»è¾‘æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚

åœ¨å®è·µä¸­ï¼Œæˆ‘å‘ç° `useEffect` æ•™ä¼šäº†æˆ‘ä¸€ç§æ€ç»´æ–¹å¼ï¼š**åˆ†è§£é—®é¢˜ï¼Œä¸“æ³¨æœ¬è´¨**ã€‚æ¯æ¬¡å†™ `useEffect`ï¼Œæˆ‘éƒ½ä¼šé—®è‡ªå·±ï¼š

- è¿™ä¸ªå‰¯ä½œç”¨çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ
- å®ƒä¾èµ–å“ªäº›å˜é‡ï¼Ÿ
- å¦‚ä½•ä¼˜é›…åœ°æ¸…ç†ï¼Ÿ

è¿™ç§æ€ç»´ä¸ä»…é€‚ç”¨äºä»£ç ï¼Œä¹Ÿé€‚ç”¨äºç”Ÿæ´»ã€‚æ¯”å¦‚ï¼Œç®¡ç†æ—¶é—´å°±åƒç®¡ç†å‰¯ä½œç”¨ï¼šæ˜ç¡®ç›®æ ‡ï¼ˆä¾èµ–ï¼‰ï¼Œæ‰§è¡Œä»»åŠ¡ï¼ˆå‰¯ä½œç”¨ï¼‰ï¼Œå¹¶åœ¨åˆ‡æ¢æ—¶æ¸…ç†ï¼ˆæ”¾ä¸‹ï¼‰ã€‚

---

## ç»“è¯­ï¼šä¼˜é›…é©¾é©­ useEffect

`useEffect` æ˜¯ React å¼€å‘è€…çš„â€œç‘å£«å†›åˆ€â€ï¼Œæ—¢å¼ºå¤§åˆå±é™©ã€‚é€šè¿‡æœ¬æ–‡çš„å…¨é¢è§£æï¼Œä½ åº”è¯¥å¯¹å®ƒçš„åŸç†ã€ä½¿ç”¨æŠ€å·§å’Œé¿å‘æ–¹æ³•æœ‰äº†æ·±å…¥äº†è§£ã€‚ä»¥ä¸‹æ˜¯å‡ æ¡æ ¸å¿ƒå»ºè®®ï¼Œé€ç»™æ¯ä½ React å¼€å‘è€…ï¼š

1. **ä¿æŒç®€å•**ï¼šä¸€ä¸ª `useEffect` åªåšä¸€ä»¶äº‹ã€‚
2. **ä¾èµ–æ¸…æ™°**ï¼šä¾èµ–æ•°ç»„æ˜¯ä½ çš„â€œå¥‘çº¦â€ï¼Œä¸è¦è¿èƒŒã€‚
3. **æ¸…ç†å½»åº•**ï¼šåƒæ”¶æ‹¾æˆ¿é—´ä¸€æ ·ï¼Œç¦»å¼€å‰æ¸…ç†å¹²å‡€ã€‚
4. **æ‹¥æŠ±å·¥å…·**ï¼šå–„ç”¨ ESLint å’Œ React DevToolsã€‚
5. **æŒç»­å­¦ä¹ **ï¼šå¤šè¯»æºç ï¼Œå¤šå†™ä»£ç ï¼Œå¤šåæ€ã€‚

æ­£å¦‚ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹ä¸­æ‰€è¯´ï¼š

> â€œç¼–ç¨‹æ˜¯ä¸€ç§è‰ºæœ¯ï¼Œä½ éœ€è¦ç”¨ä»£ç è¡¨è¾¾ä½ çš„æ€æƒ³ã€‚â€

å¸Œæœ›è¿™ç¯‡é•¿æ–‡èƒ½æˆä¸ºä½  React ä¹‹æ—…ä¸­çš„ä¸€ç›æ˜ç¯ï¼Œè®©ä½ åœ¨ `useEffect` çš„ä¸–ç•Œé‡Œæ¸¸åˆƒæœ‰ä½™ã€‚âœ¨ å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®æˆ–æƒ³åˆ†äº«è‡ªå·±çš„ `useEffect` æ•…äº‹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼è®©æˆ‘ä»¬ä¸€èµ·å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼Œåˆ›é€ æ›´ç¾å¥½çš„ Web ä¸–ç•Œï¼ğŸŒ

---