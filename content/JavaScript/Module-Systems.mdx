---
title: "ç°ä»£ JavaScript æ¨¡å—åŒ–æŒ‡å—"
date: "2024-01-15"
description: "æ·±å…¥æ¢è®¨ç°ä»£ JavaScript æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œé‡ç‚¹ä»‹ç» ES Modules åŠå…¶åœ¨å®é™…é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µã€‚"
tags: ["JavaScript", "ES Modules", "æ¨¡å—åŒ–", "å‰ç«¯å·¥ç¨‹åŒ–"]
category: "JavaScript"
---

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæŠŠ JavaScript ä»£ç æ¯”ä½œä¹é«˜ç§¯æœ¨ ğŸ§±ï¼Œé‚£ä¹ˆæ¨¡å—åŒ–å°±æ˜¯è¿™äº›ç§¯æœ¨çš„æ ‡å‡†æ¥å£ç³»ç»Ÿã€‚æ¯ä¸ªæ¨¡å—å°±åƒä¸€ä¸ªç‹¬ç‰¹çš„ä¹é«˜ç§¯æœ¨ï¼Œé€šè¿‡æ ‡å‡†çš„å‡¸èµ·å’Œå‡¹æ§½ï¼ˆå³å¯¼å…¥å¯¼å‡ºæ¥å£ï¼‰å®Œç¾åœ°ç»„åˆåœ¨ä¸€èµ·ï¼Œæ„å»ºå‡ºå¼ºå¤§çš„åº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£è¿™ä¸ªç¥å¥‡çš„æ¨¡å—åŒ–ä¸–ç•Œï¼

## ES Modulesï¼šç°ä»£ JavaScript çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿ ğŸŒŸ

### 1. åŸºç¡€è¯­æ³•

å°±åƒä¹é«˜ç§¯æœ¨éœ€è¦è¯´æ˜ä¹¦ä¸€æ ·ï¼Œè¿™é‡Œæ˜¯ ESM çš„åŸºç¡€ç”¨æ³•ï¼š

```javascript
// å¯¼å‡ºæ¨¡å—ï¼ˆmath.jsï¼‰
export const add = (a, b) => a + b;
export const multiply = (a, b) => a * b;

// é»˜è®¤å¯¼å‡º
export default class Calculator {
  // ç±»å®ç°
}

// å¯¼å…¥æ¨¡å—ï¼ˆapp.jsï¼‰
import { add, multiply } from "./math.js";
import Calculator from "./math.js";

// é‡å‘½åå¯¼å…¥
import { add as addNumbers } from "./math.js";

// å¯¼å…¥æ‰€æœ‰å¯¼å‡º
import * as MathUtils from "./math.js";
```

### 2. ESM çš„æ ¸å¿ƒç‰¹æ€§ âš¡

- **é™æ€åˆ†æ**ï¼šå°±åƒæå‰è§„åˆ’ä¹é«˜ä½œå“ä¸€æ ·ï¼ŒESM åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¾èµ–å…³ç³»
- **å®æ—¶ç»‘å®š**ï¼šæ¨¡å—é—´çš„è¿æ¥æ˜¯åŠ¨æ€çš„ï¼Œå°±åƒç£é“èˆ¬å®æ—¶åŒæ­¥
- **ä¸¥æ ¼æ¨¡å¼**ï¼šè‡ªåŠ¨å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå°±åƒç»™ä¹é«˜ç§¯æœ¨åŠ ä¸Šå®‰å…¨é”
- **é¡¶å±‚ await**ï¼šæ”¯æŒå¼‚æ­¥æ“ä½œï¼Œå°±åƒç­‰å¾…ç‰¹æ®Šç§¯æœ¨çš„åˆ°æ¥

## åŠ¨æ€å¯¼å…¥å’Œä»£ç åˆ†å‰² ğŸš€

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸€æ¬¡æ€§æ­å»ºæ‰€æœ‰ç§¯æœ¨ï¼Œå¯ä»¥æŒ‰éœ€ç»„è£…ï¼š

```javascript
// æŒ‰éœ€åŠ è½½æ¨¡å—
const loadModule = async () => {
  try {
    const { default: Chart } = await import("./chart.js");
    const chart = new Chart();
    chart.render();
  } catch (error) {
    console.error("æ¨¡å—åŠ è½½å¤±è´¥:", error);
  }
};

// æ¡ä»¶å¯¼å…¥
if (process.env.NODE_ENV === "development") {
  const { enableDebug } = await import("./debug-tools.js");
  enableDebug();
}
```

## æ¨¡å—åŒ–æœ€ä½³å®è·µ ğŸ’¡

### 1. å¯¼å‡ºè®¾è®¡

å°±åƒè®¾è®¡ä¹é«˜å¥—è£…ä¸€æ ·ï¼Œå¥½çš„æ¨¡å—è®¾è®¡å¾ˆé‡è¦ï¼š

```javascript
// ğŸ‘ ä¸æ¨èï¼šé›¶æ•£çš„ç§¯æœ¨
export const config = {};
export function helper() {}
export class Service {}

// ğŸ‘ æ¨èï¼šç²¾å¿ƒç»„ç»‡çš„å¥—è£…
const config = {};
function helper() {}
class Service {}

export const API = {
  config,
  helper,
  Service,
};
```

### 2. è·¯å¾„åˆ«å

ä¸ºå¸¸ç”¨æ¨¡å—åˆ›å»ºå¿«æ·æ–¹å¼ï¼Œå°±åƒç»™ç§¯æœ¨åˆ†ç±»ï¼š

```javascript
// vite.config.js
export default {
  resolve: {
    alias: {
      "@": "/src",
      "@components": "/src/components",
    },
  },
};

// ä½¿ç”¨åˆ«åå¯¼å…¥
import { Button } from "@components/Button";
```

### 3. å¾ªç¯ä¾èµ–å¤„ç† ğŸ”„

é¿å…æ¨¡å—é—´çš„ç›¸äº’ä¾èµ–ï¼Œå°±åƒé¿å…ç§¯æœ¨ä¹‹é—´çš„æ­»é”ï¼š

```javascript
// ğŸ‘ é¿å…å¾ªç¯ä¾èµ–
// a.js
import { b } from "./b.js";
export const a = 1;

// b.js
import { a } from "./a.js";
export const b = a + 1;

// ğŸ‘ é‡æ„ä¸ºå•å‘ä¾èµ–
// shared.js
export const base = 1;

// a.js
import { base } from "./shared.js";
export const a = base;

// b.js
import { base } from "./shared.js";
export const b = base + 1;
```

## æ–°ç‰¹æ€§ï¼šImport Maps ğŸ—ºï¸

ç°ä»£æµè§ˆå™¨æ”¯æŒ Import Mapsï¼Œè®©æ¨¡å—è·¯å¾„ç®¡ç†æ›´çµæ´»ï¼š

```html
<script type="importmap">
  {
    "imports": {
      "lodash": "/node_modules/lodash-es/lodash.js",
      "react": "https://esm.sh/react"
    }
  }
</script>

<script type="module">
  import { map } from "lodash";
  import React from "react";
</script>
```

## å¾®å‰ç«¯ä¸­çš„æ¨¡å—åŠ è½½ ğŸ—ï¸

åœ¨å¾®å‰ç«¯æ¶æ„ä¸­ï¼Œæ¨¡å—åŒ–æ›´æ˜¾é‡è¦ï¼š

```javascript
// ä¸»åº”ç”¨
const loadRemoteModule = async (url) => {
  const module = await import(/* @vite-ignore */ url);
  return module.default;
};

// åŠ è½½å­åº”ç”¨
const SubApp = await loadRemoteModule("http://localhost:3001/remoteEntry.js");
```

## æ€§èƒ½ä¼˜åŒ– âš¡

### 1. Tree Shaking

å°±åƒåªä½¿ç”¨éœ€è¦çš„ç§¯æœ¨ï¼š

```javascript
// utils.js
export const format = (date) => {}; // ä½¿ç”¨åˆ°çš„ï¼Œä¼šè¢«ä¿ç•™
export const parse = (str) => {}; // æœªä½¿ç”¨ï¼Œä¼šè¢«ç§»é™¤

// app.js
import { format } from "./utils.js"; // åªå¯¼å…¥éœ€è¦çš„å‡½æ•°
```

### 2. é¢„åŠ è½½å…³é”®æ¨¡å—

æå‰å‡†å¤‡å¥½å¸¸ç”¨çš„ç§¯æœ¨ï¼š

```html
<link rel="modulepreload" href="/js/critical-module.js" />
```

## å†å²æ¨¡å—åŒ–æ–¹æ¡ˆ ğŸ“š

### CommonJSï¼ˆNode.jsï¼‰

```javascript
// å¯¼å‡º
module.exports = {
  add: (a, b) => a + b,
};

// å¯¼å…¥
const { add } = require("./math");
```

### AMDï¼ˆæµè§ˆå™¨ï¼‰

```javascript
define(["dependency"], function (dependency) {
  return {
    method: function () {},
  };
});
```

### UMDï¼ˆé€šç”¨ï¼‰

```javascript
(function (root, factory) {
  if (typeof define === "function" && define.amd) {
    define([], factory);
  } else if (typeof exports === "object") {
    module.exports = factory();
  } else {
    root.myModule = factory();
  }
})(this, function () {
  return {};
});
```

## æ€»ç»“ ğŸ¯

ES Modules å°±åƒç°ä»£ä¹é«˜ç³»ç»Ÿï¼Œæä¾›äº†æ ‡å‡†ã€çµæ´»ä¸”é«˜æ•ˆçš„æ¨¡å—åŒ–æ–¹æ¡ˆã€‚é€šè¿‡åˆç†è¿ç”¨ ESM çš„ç‰¹æ€§ï¼Œç»“åˆæ–°çš„æŠ€æœ¯å¦‚ Import Maps å’Œå¾®å‰ç«¯æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºæ›´åŠ æ¨¡å—åŒ–ã€å¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚è®°ä½ï¼Œå¥½çš„æ¨¡å—åŒ–è®¾è®¡å°±åƒç²¾å¿ƒè®¾è®¡çš„ä¹é«˜å¥—è£…ï¼Œæ¯ä¸ªéƒ¨ä»¶éƒ½æœ‰å…¶ä½ç½®ï¼Œå…±åŒæ„å»ºå‡ºä»¤äººæƒŠå¹çš„ä½œå“ã€‚
