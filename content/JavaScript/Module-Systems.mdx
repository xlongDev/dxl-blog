---
title: "ç°ä»£ JavaScript æ¨¡å—åŒ–æŒ‡å—"
date: "2024-01-15"
description: "æ·±å…¥æ¢è®¨ç°ä»£ JavaScript æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œé‡ç‚¹ä»‹ç» ES Modules åŠå…¶åœ¨å®é™…é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µã€‚"
tags: ["JavaScript", "ES Modules", "æ¨¡å—åŒ–", "å‰ç«¯å·¥ç¨‹åŒ–"]
category: "JavaScript"
---

æ¨¡å—åŒ–æ˜¯ç°ä»£ JavaScript å¼€å‘çš„åŸºçŸ³ï¼Œå®ƒä¸ä»…æä¾›äº†ä»£ç ç»„ç»‡å’Œå¤ç”¨çš„æ–¹æ¡ˆï¼Œæ›´æ˜¯å‰ç«¯å·¥ç¨‹åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ¬æ–‡å°†é‡ç‚¹ä»‹ç» ES Modulesï¼ˆESMï¼‰åŠå…¶æœ€ä½³å®è·µï¼ŒåŒæ—¶å›é¡¾å…¶ä»–æ¨¡å—åŒ–æ–¹æ¡ˆçš„æ¼”è¿›å†ç¨‹ã€‚

## ES Modulesï¼šç°ä»£ JavaScript çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿ

### 1. åŸºç¡€è¯­æ³•

```javascript
// å¯¼å‡ºæ¨¡å—ï¼ˆmath.jsï¼‰
export const add = (a, b) => a + b;
export const multiply = (a, b) => a * b;

// é»˜è®¤å¯¼å‡º
export default class Calculator {
  // ç±»å®ç°
}

// å¯¼å…¥æ¨¡å—ï¼ˆapp.jsï¼‰
import { add, multiply } from "./math.js";
import Calculator from "./math.js";

// é‡å‘½åå¯¼å…¥
import { add as addNumbers } from "./math.js";

// å¯¼å…¥æ‰€æœ‰å¯¼å‡º
import * as MathUtils from "./math.js";
```

### 2. ESM çš„æ ¸å¿ƒç‰¹æ€§

- **é™æ€åˆ†æ**ï¼šç¼–è¯‘æ—¶ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ”¯æŒ Tree Shaking
- **å®æ—¶ç»‘å®š**ï¼šå¯¼å‡ºå€¼çš„å¼•ç”¨ï¼Œè€Œéæ‹·è´
- **ä¸¥æ ¼æ¨¡å¼**ï¼šæ¨¡å—è‡ªåŠ¨è¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹
- **é¡¶å±‚ await**ï¼šæ”¯æŒåœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ await

## åŠ¨æ€å¯¼å…¥å’Œä»£ç åˆ†å‰²

```javascript
// æŒ‰éœ€åŠ è½½æ¨¡å—
const loadModule = async () => {
  try {
    const { default: Chart } = await import("./chart.js");
    const chart = new Chart();
    chart.render();
  } catch (error) {
    console.error("æ¨¡å—åŠ è½½å¤±è´¥:", error);
  }
};

// æ¡ä»¶å¯¼å…¥
if (process.env.NODE_ENV === "development") {
  const { enableDebug } = await import("./debug-tools.js");
  enableDebug();
}
```

## æ¨¡å—åŒ–æœ€ä½³å®è·µ

### 1. å¯¼å‡ºè®¾è®¡

```javascript
// ğŸ‘ ä¸æ¨è
export const config = {};
export function helper() {}
export class Service {}

// ğŸ‘ æ¨èï¼šä½¿ç”¨å‘½åç©ºé—´å¯¼å‡º
const config = {};
function helper() {}
class Service {}

export const API = {
  config,
  helper,
  Service,
};
```

### 2. è·¯å¾„åˆ«å

```javascript
// vite.config.js
export default {
  resolve: {
    alias: {
      "@": "/src",
      "@components": "/src/components",
    },
  },
};

// ä½¿ç”¨åˆ«åå¯¼å…¥
import { Button } from "@components/Button";
```

### 3. å¾ªç¯ä¾èµ–å¤„ç†

```javascript
// ğŸ‘ é¿å…å¾ªç¯ä¾èµ–
// a.js
import { b } from "./b.js";
export const a = 1;

// b.js
import { a } from "./a.js";
export const b = a + 1;

// ğŸ‘ é‡æ„ä¸ºå•å‘ä¾èµ–
// shared.js
export const base = 1;

// a.js
import { base } from "./shared.js";
export const a = base;

// b.js
import { base } from "./shared.js";
export const b = base + 1;
```

## æ€§èƒ½ä¼˜åŒ–

### 1. Tree Shaking

```javascript
// utils.js
export const format = (date) => {}; // ä½¿ç”¨åˆ°çš„ï¼Œä¼šè¢«ä¿ç•™
export const parse = (str) => {}; // æœªä½¿ç”¨ï¼Œä¼šè¢«ç§»é™¤

// app.js
import { format } from "./utils.js"; // åªå¯¼å…¥éœ€è¦çš„å‡½æ•°
```

### 2. é¢„åŠ è½½å…³é”®æ¨¡å—

```html
<link rel="modulepreload" href="/js/critical-module.js" />
```

## å†å²æ¨¡å—åŒ–æ–¹æ¡ˆ

### CommonJSï¼ˆNode.jsï¼‰

```javascript
// å¯¼å‡º
module.exports = {
  add: (a, b) => a + b,
};

// å¯¼å…¥
const { add } = require("./math");
```

### AMDï¼ˆæµè§ˆå™¨ï¼‰

```javascript
define(["dependency"], function (dependency) {
  return {
    method: function () {},
  };
});
```

### UMDï¼ˆé€šç”¨ï¼‰

```javascript
(function (root, factory) {
  if (typeof define === "function" && define.amd) {
    define([], factory);
  } else if (typeof exports === "object") {
    module.exports = factory();
  } else {
    root.myModule = factory();
  }
})(this, function () {
  return {};
});
```

## æ€»ç»“

ES Modules ä½œä¸º JavaScript å®˜æ–¹æ¨¡å—åŒ–è§„èŒƒï¼Œå·²ç»æˆä¸ºç°ä»£å‰ç«¯å¼€å‘çš„æ ‡å‡†ã€‚å®ƒä¸ä»…æä¾›äº†æ¸…æ™°çš„æ¨¡å—åŒ–è¯­æ³•ï¼Œè¿˜æ”¯æŒé™æ€åˆ†æå’Œ Tree Shaking ç­‰ä¼˜åŒ–ç‰¹æ€§ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†è¿ç”¨ ESM çš„ç‰¹æ€§ï¼Œç»“åˆæ„å»ºå·¥å…·çš„ä¼˜åŒ–èƒ½åŠ›ï¼Œå¯ä»¥æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½å’Œå¼€å‘æ•ˆç‡ã€‚
