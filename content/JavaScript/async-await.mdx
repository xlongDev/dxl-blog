---
title: "æ·±å…¥è§£æ JavaScript çš„ async/await"
date: "2022-03-16"
description: "è¯¦ç»†ä»‹ç» JavaScript ä¸­ async/await çš„å·¥ä½œåŸç†ã€ä½¿ç”¨æ–¹æ³•ä»¥åŠå¸¸è§åº”ç”¨åœºæ™¯ã€‚"
keywords: "async, await, JavaScript, å¼‚æ­¥ç¼–ç¨‹, Promise, å¼‚å¸¸å¤„ç†"
author: "æ™“é¾™"
image: "/images/hero/async-await.jpg"
tags: ["JavaScript", "å¼‚æ­¥ç¼–ç¨‹", "å‰ç«¯å¼€å‘"]
category: "JavaScript"
---

ä½œä¸ºå‰ç«¯å¼€å‘ä¸­çš„"å¼‚æ­¥ä»»åŠ¡æŒ‡æŒ¥å®˜"ğŸ®ï¼Œ`async/await` è®©æˆ‘ä»¬å‘Šåˆ«äº†å›è°ƒåœ°ç‹±ï¼Œå¼€å¯äº†ä¼˜é›…å¤„ç†å¼‚æ­¥æ“ä½œçš„æ–°çºªå…ƒã€‚è¿™å¯¹äºæ„å»ºç°ä»£åŒ–çš„ Web åº”ç”¨æ¥è¯´ç®€ç›´å°±æ˜¯ä¸€åœºé©å‘½ â€”â€” å®ƒä¸ä»…è®©ä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“ç»´æŠ¤ï¼Œè¿˜å¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¼ ç»Ÿçš„å›è°ƒå‡½æ•°æ˜¯åœ¨è¿·å®«ä¸­é ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æŒ‡ç¤ºç‰Œå‰è¿›ï¼Œé‚£ä¹ˆ `async/await` å°±åƒæ˜¯æ‹¿åˆ°äº†æ•´ä¸ªè¿·å®«çš„åœ°å›¾ï¼Œè®©ä½ å¯ä»¥ä¸€çœ¼çœ‹æ¸…å‰è¿›çš„è·¯çº¿ã€‚ğŸ—ºï¸

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥æ¢ç´¢ `async/await` çš„å·¥ä½œåŸç†ï¼Œå¹¶ç»“åˆå®é™…å¼€å‘ä¸­çš„å…¸å‹åœºæ™¯ï¼Œåˆ†äº«ä¸€äº›å®ç”¨çš„æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€‚æ— è®ºä½ æ˜¯åˆšæ¥è§¦å¼‚æ­¥ç¼–ç¨‹çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³è¿›ä¸€æ­¥æå‡æŠ€èƒ½çš„è€æ‰‹ï¼Œè¿™ç¯‡æ–‡ç« éƒ½å€¼å¾—ä¸€è¯»ã€‚

## 1. å¼‚æ­¥ç¼–ç¨‹ç®€ä»‹

åœ¨ä¼ ç»Ÿçš„ JavaScript ç¼–ç¨‹ä¸­ï¼Œå¼‚æ­¥æ“ä½œï¼ˆå¦‚æ–‡ä»¶è¯»å–ã€HTTP è¯·æ±‚ç­‰ï¼‰é€šå¸¸ä¼šé€šè¿‡å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰æ¥å¤„ç†ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰é—®é¢˜ä½¿å¾—ä»£ç ç»“æ„å˜å¾—éå¸¸å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚

éšç€ Promise çš„å¼•å…¥ï¼Œå¼‚æ­¥æ“ä½œå˜å¾—æ›´åŠ å¯æ§ã€‚Promise ä¸ºå¼‚æ­¥æ“ä½œæä¾›äº†ä¸€ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œä½†å¯¹äºä¸€äº›å¤æ‚çš„å¼‚æ­¥é€»è¾‘ï¼Œä»£ç ä»ç„¶å¯èƒ½å˜å¾—è¾ƒä¸ºå†—é•¿ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES2017 å¼•å…¥äº† `async/await` è¯­æ³•ï¼Œä½¿å¾—å¼‚æ­¥æ“ä½œçš„ç¼–å†™æ›´åŠ ç›´è§‚ã€‚

## 2. `async` å‡½æ•°

`async` æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒç”¨äºå£°æ˜ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°å£°æ˜ä¸º `async` å‡½æ•°ï¼ŒJavaScript å¼•æ“å°†è‡ªåŠ¨æŠŠè¯¥å‡½æ•°åŒ…è£…æˆä¸€ä¸ªè¿”å› `Promise` å¯¹è±¡çš„å‡½æ•°ã€‚æ— è®ºè¯¥å‡½æ•°å†…éƒ¨æ˜¯å¦æœ‰å¼‚æ­¥æ“ä½œï¼Œå®ƒéƒ½ä¼šè¿”å›ä¸€ä¸ª `Promise`ã€‚

### ç¤ºä¾‹ 1ï¼šå£°æ˜ä¸€ä¸ª `async` å‡½æ•°

```javascript
async function sayHello() {
  return "Hello, world!";
}

sayHello().then((message) => {
  console.log(message); // è¾“å‡º "Hello, world!"
});
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`sayHello` å‡½æ•°è™½ç„¶æ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨ `Promise`ï¼Œä½†ç”±äºå®ƒæ˜¯ä¸€ä¸ª `async` å‡½æ•°ï¼Œè¿”å›å€¼å®é™…ä¸Šæ˜¯ä¸€ä¸ª `Promise` å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `.then()` æ–¹æ³•æ¥è·å–å®ƒçš„è¿”å›å€¼ã€‚

## 3. `await` å…³é”®å­—

`await` æ˜¯ä¸ `async` æ­é…ä½¿ç”¨çš„å…³é”®å­—ï¼Œç”¨äºç­‰å¾…ä¸€ä¸ª `Promise` è¢«è§£å†³ï¼ˆresolvedï¼‰æˆ–æ‹’ç»ï¼ˆrejectedï¼‰ã€‚`await` å¯ä»¥ä½¿å¾—å¼‚æ­¥ä»£ç çš„ä¹¦å†™æ›´åƒåŒæ­¥ä»£ç ï¼Œé¿å…äº†å›è°ƒå‡½æ•°æˆ– `.then()` é“¾å¼è°ƒç”¨çš„ç¹çã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ `async` å‡½æ•°æ˜¯ä¸€ä½æŒ‡æŒ¥å®¶ ğŸ­ï¼Œé‚£ä¹ˆ `await` å°±æ˜¯ä»–æ‰‹ä¸­çš„æŒ‡æŒ¥æ£’ï¼Œå®ƒå‘Šè¯‰ä¹å›¢ä¸­çš„æŸä¸ªä¹å™¨ï¼ˆå¼‚æ­¥æ“ä½œï¼‰ï¼š"è¯·æ¼”å¥ä½ çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éƒ½åœ¨ç­‰ä½ å®Œæˆã€‚"

`await` åªèƒ½åœ¨ `async` å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚å®ƒä¼šæš‚åœå‡½æ•°çš„æ‰§è¡Œï¼Œç›´åˆ° `Promise` è¢«è§£å†³æˆ–æ‹’ç»ï¼Œç„¶åè¿”å› `Promise` çš„ç»“æœã€‚è¿™ç§"æš‚åœ"å¹¶ä¸ä¼šé˜»å¡æ•´ä¸ªç¨‹åºï¼ŒJavaScript å¼•æ“ä¼šç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œç›´åˆ°è¢«ç­‰å¾…çš„ Promise å®Œæˆã€‚

### ç¤ºä¾‹ 2ï¼šä½¿ç”¨ `await` å¤„ç†å¼‚æ­¥æ“ä½œ

```javascript
async function fetchData() {
  let response = await fetch("https://jsonplaceholder.typicode.com/todos/1");
  let data = await response.json();
  return data;
}

fetchData().then((data) => {
  console.log(data); // è¾“å‡ºä» API è·å–çš„æ•°æ®
});
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`fetchData` å‡½æ•°ä¼šç­‰å¾… `fetch` è¯·æ±‚å®Œæˆåï¼Œå†è§£æå“åº”å¹¶è¿”å›æ•°æ®ã€‚ä½¿ç”¨ `await` ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ï¼Œå¹¶ä¸”é¿å…äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚

## 4. é”™è¯¯å¤„ç†

åœ¨ä½¿ç”¨ `async/await` æ—¶ï¼Œå¼‚å¸¸å¤„ç†å˜å¾—æ›´åŠ ç›´è§‚ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `try/catch` è¯­å¥æ¥æ•è·å¼‚æ­¥æ“ä½œä¸­çš„é”™è¯¯ï¼Œè¿™æ ·çš„è¯­æ³•ç±»ä¼¼äºåŒæ­¥ä»£ç ä¸­çš„é”™è¯¯å¤„ç†ã€‚

è¿™å°±åƒæ˜¯ç»™ä½ çš„å¼‚æ­¥æ“ä½œç©¿ä¸Šäº†ä¸€ä»¶"å®‰å…¨èƒŒå¿ƒ"ğŸ›¡ï¸ â€”â€” æ— è®ºé€”ä¸­é‡åˆ°ä»€ä¹ˆæ„å¤–æƒ…å†µï¼Œä½ éƒ½èƒ½ä¼˜é›…åœ°å¤„ç†å®ƒï¼Œè€Œä¸æ˜¯è®©æ•´ä¸ªåº”ç”¨å´©æºƒã€‚

### ç¤ºä¾‹ 3ï¼šä½¿ç”¨ `try/catch` å¤„ç†å¼‚å¸¸

```javascript
async function fetchData() {
  try {
    let response = await fetch(
      "https://jsonplaceholder.typicode.com/todos/invalid"
    );
    let data = await response.json();
    return data;
  } catch (error) {
    console.error("Error occurred:", error);
  }
}

fetchData(); // è¾“å‡ºé”™è¯¯ä¿¡æ¯
```

å¦‚æœ `fetch` è¯·æ±‚å¤±è´¥ï¼ˆå¦‚ URL æ— æ•ˆæˆ–ç½‘ç»œé”™è¯¯ï¼‰ï¼Œ`catch` è¯­å¥å°†æ•è·åˆ°å¼‚å¸¸ï¼Œå¹¶è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚

## 5. `async/await` ä¸ Promise çš„å…³ç³»

`async/await` æ˜¯åŸºäº `Promise` çš„è¯­æ³•ç³–ã€‚æ¯ä¸ª `async` å‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ª `Promise`ï¼Œè€Œ `await` ç­‰å¾…çš„æ˜¯ä¸€ä¸ª `Promise`ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ `async/await` çœ‹ä½œæ˜¯å¯¹ `Promise` çš„å°è£…ï¼Œç®€åŒ–äº†å¼‚æ­¥ä»£ç çš„ä¹¦å†™ã€‚

### ç¤ºä¾‹ 4ï¼šæ‰‹åŠ¨å¤„ç† `Promise` ä¸ `async/await` çš„å¯¹æ¯”

```javascript
// ä½¿ç”¨ Promise
function fetchDataWithPromise() {
  return fetch("https://jsonplaceholder.typicode.com/todos/1")
    .then((response) => response.json())
    .then((data) => data)
    .catch((error) => console.error("Error:", error));
}

// ä½¿ç”¨ async/await
async function fetchDataWithAsync() {
  try {
    let response = await fetch("https://jsonplaceholder.typicode.com/todos/1");
    let data = await response.json();
    return data;
  } catch (error) {
    console.error("Error:", error);
  }
}

fetchDataWithPromise().then((data) => console.log(data));
fetchDataWithAsync().then((data) => console.log(data));
```

ä¸¤ç§å†™æ³•éƒ½èƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œ`async/await` çš„å†™æ³•æ›´åŠ ç®€æ´å’Œæ˜“è¯»ã€‚

## 6. å¸¸è§åº”ç”¨åœºæ™¯

### 6.1 ä¸²è¡Œå¼‚æ­¥æ“ä½œ

å¦‚æœä½ éœ€è¦ä¾æ¬¡æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œ`async/await` å¯ä»¥è®©ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥æ‰§è¡Œä¸€æ ·ã€‚

```javascript
async function getUserData(userId) {
  let user = await fetch(
    `https://jsonplaceholder.typicode.com/users/${userId}`
  ).then((res) => res.json());
  let posts = await fetch(
    `https://jsonplaceholder.typicode.com/posts?userId=${userId}`
  ).then((res) => res.json());
  return { user, posts };
}

getUserData(1).then((data) => console.log(data));
```

### 6.2 å¹¶è¡Œå¼‚æ­¥æ“ä½œ

å¦‚æœä½ æœ‰å¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”è¿™äº›æ“ä½œæ˜¯ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ `Promise.all` å’Œ `await` æ¥å¹¶è¡Œæ‰§è¡Œå®ƒä»¬ï¼Œä»¥æé«˜æ•ˆç‡ã€‚

è¿™å°±åƒæ˜¯æ´¾å‡ºå¤šä¸ªå¿«é€’å‘˜ ğŸšš åŒæ—¶é€ä¸åŒçš„åŒ…è£¹ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªå¿«é€’å‘˜æŒ¨ä¸ªé€å®Œæ‰€æœ‰åŒ…è£¹ã€‚å½“æ‰€æœ‰å¿«é€’å‘˜éƒ½å®Œæˆä»»åŠ¡åï¼Œä½ ä¸€æ¬¡æ€§æ”¶åˆ°æ‰€æœ‰åŒ…è£¹ã€‚

```javascript
async function fetchData() {
  let [user, posts] = await Promise.all([
    fetch("https://jsonplaceholder.typicode.com/users/1").then((res) =>
      res.json()
    ),
    fetch("https://jsonplaceholder.typicode.com/posts?userId=1").then((res) =>
      res.json()
    ),
  ]);
  return { user, posts };
}

fetchData().then((data) => console.log(data));
```

## 7. å®æˆ˜åº”ç”¨ä¸æ€§èƒ½ä¼˜åŒ–

### 7.1 React ä¸­çš„å¼‚æ­¥çŠ¶æ€ç®¡ç†

åœ¨ React é¡¹ç›®ä¸­ï¼Œ`async/await` ç»å¸¸ç”¨äºå¤„ç†æ•°æ®è·å–å’ŒçŠ¶æ€æ›´æ–°ï¼š

```javascript
const UserProfile = () => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUser = async () => {
      try {
        setLoading(true);
        const response = await fetch("/api/user");
        const data = await response.json();
        setUser(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchUser();
  }, []);

  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;
  return <UserInfo user={user} />;
};
```

### 7.2 å¹¶å‘æ§åˆ¶ä¸æ€§èƒ½ä¼˜åŒ–

åœ¨å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼š

```javascript
async function batchRequest(urls, maxConcurrent = 5) {
  const results = [];
  const chunks = urls.reduce((acc, url, i) => {
    const chunkIndex = Math.floor(i / maxConcurrent);
    acc[chunkIndex] = (acc[chunkIndex] || []).concat(url);
    return acc;
  }, []);

  for (const chunk of chunks) {
    const chunkResults = await Promise.all(
      chunk.map((url) => fetch(url).then((res) => res.json()))
    );
    results.push(...chunkResults);
  }

  return results;
}
```

### 7.3 é”™è¯¯é‡è¯•æœºåˆ¶

åœ¨ç½‘ç»œä¸ç¨³å®šçš„ç¯å¢ƒä¸‹ï¼Œä¸ºå¼‚æ­¥æ“ä½œæ·»åŠ é‡è¯•æœºåˆ¶æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼š

```javascript
async function fetchWithRetry(url, retries = 3, delay = 1000) {
  for (let i = 0; i < retries; i++) {
    try {
      return await fetch(url);
    } catch (err) {
      if (i === retries - 1) throw err;
      await new Promise((resolve) =>
        setTimeout(resolve, delay * Math.pow(2, i))
      );
      console.log(`Retrying... Attempt ${i + 2}/${retries}`);
    }
  }
}
```

### 7.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é¿å…ä¸²è¡Œç­‰å¾…**ï¼šå½“å¤šä¸ªå¼‚æ­¥æ“ä½œä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ `Promise.all` æˆ– `Promise.allSettled` å¹¶è¡Œæ‰§è¡Œã€‚

2. **åˆç†ä½¿ç”¨ `Promise.race`**ï¼šåœ¨éœ€è¦è®¾ç½®è¶…æ—¶å¤„ç†çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥é…åˆ `Promise.race` å®ç°ï¼š

```javascript
async function fetchWithTimeout(url, timeout = 5000) {
  const controller = new AbortController();
  const timeoutPromise = new Promise((_, reject) => {
    setTimeout(() => {
      controller.abort();
      reject(new Error("Request timeout"));
    }, timeout);
  });

  return Promise.race([
    fetch(url, { signal: controller.signal }),
    timeoutPromise,
  ]);
}
```

3. **ç¼“å­˜å¼‚æ­¥ç»“æœ**ï¼šå¯¹äºçŸ­æ—¶é—´å†…å¯èƒ½é‡å¤çš„å¼‚æ­¥æ“ä½œï¼Œè€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼š

```javascript
const memoizedFetch = (() => {
  const cache = new Map();
  return async (url, ttl = 60000) => {
    if (cache.has(url)) {
      const { data, timestamp } = cache.get(url);
      if (Date.now() - timestamp < ttl) return data;
    }
    const response = await fetch(url);
    const data = await response.json();
    cache.set(url, { data, timestamp: Date.now() });
    return data;
  };
})();
```

## 8. å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹ âš ï¸

åœ¨ä½¿ç”¨ `async/await` çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›å¸¸è§çš„é™·é˜±éœ€è¦æˆ‘ä»¬æ³¨æ„ï¼š

### 8.1 å¿˜è®°ä½¿ç”¨ await

è¿™æ˜¯æœ€å¸¸è§çš„é”™è¯¯ä¹‹ä¸€ã€‚å¦‚æœä½ åœ¨ `async` å‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œä½†å¿˜è®°ä½¿ç”¨ `await`ï¼Œé‚£ä¹ˆä½ å°†å¾—åˆ°ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œä¸æ˜¯ Promise è§£æåçš„å€¼ã€‚

```javascript
async function getData() {
  // é”™è¯¯ï¼šå¿˜è®°ä½¿ç”¨ await
  const data = fetch("https://api.example.com/data");
  console.log(data); // è¾“å‡º Promise å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ•°æ®

  // æ­£ç¡®ï¼šä½¿ç”¨ await
  const correctData = await fetch("https://api.example.com/data");
  console.log(correctData); // è¾“å‡ºè·å–åˆ°çš„æ•°æ®
}
```

### 8.2 é”™è¯¯ä¼ æ’­

åœ¨ `async` å‡½æ•°ä¸­ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ `try/catch` æ•è·é”™è¯¯ï¼Œé‚£ä¹ˆé”™è¯¯ä¼šè¢«åŒ…è£…åœ¨è¿”å›çš„ Promise ä¸­ã€‚è°ƒç”¨è€…éœ€è¦ä½¿ç”¨ `.catch()` æˆ– `try/catch` é…åˆ `await` æ¥æ•è·è¿™äº›é”™è¯¯ã€‚

```javascript
async function riskyOperation() {
  throw new Error("Something went wrong");
}

// æ–¹æ³•1ï¼šä½¿ç”¨ .catch()
riskyOperation().catch((error) => console.error(error));

// æ–¹æ³•2ï¼šä½¿ç”¨ try/catch é…åˆ await
async function handleError() {
  try {
    await riskyOperation();
  } catch (error) {
    console.error(error);
  }
}
```

### 8.3 await åœ¨å¾ªç¯ä¸­çš„ä½¿ç”¨

åœ¨å¾ªç¯ä¸­ä½¿ç”¨ `await` æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚å¦‚æœä½ æƒ³ä¸²è¡Œæ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `for` å¾ªç¯ï¼›å¦‚æœæƒ³å¹¶è¡Œæ‰§è¡Œï¼Œåº”è¯¥ä½¿ç”¨ `Promise.all` é…åˆ `map`ã€‚

```javascript
// ä¸²è¡Œæ‰§è¡Œï¼ˆæ¯æ¬¡è¯·æ±‚ç­‰å¾…å‰ä¸€ä¸ªå®Œæˆï¼‰
async function serialFetch(urls) {
  const results = [];
  for (const url of urls) {
    const result = await fetch(url).then((r) => r.json());
    results.push(result);
  }
  return results;
}

// å¹¶è¡Œæ‰§è¡Œï¼ˆæ‰€æœ‰è¯·æ±‚åŒæ—¶å‘èµ·ï¼‰
async function parallelFetch(urls) {
  const promises = urls.map((url) => fetch(url).then((r) => r.json()));
  return await Promise.all(promises);
}
```

### 8.4 é¡¶å±‚ await

åœ¨ ES2022 ä¹‹å‰ï¼Œ`await` åªèƒ½åœ¨ `async` å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚ç°åœ¨ï¼Œé¡¶å±‚ `await` å…è®¸åœ¨æ¨¡å—çš„é¡¶å±‚ä½¿ç”¨ `await`ï¼Œè¿™åœ¨å¯¼å…¥åŠ¨æ€å†…å®¹æˆ–æ¡ä»¶æ€§åŠ è½½æ¨¡å—æ—¶éå¸¸æœ‰ç”¨ã€‚

```javascript
// ç°ä»£æµè§ˆå™¨å’Œ Node.js 14+ æ”¯æŒé¡¶å±‚ await
const response = await fetch("https://api.example.com/data");
const data = await response.json();

export { data };
```

## 9. æ€»ç»“ ğŸ¯

å›é¡¾æ•´ä¸ª `async/await` çš„å‘å±•å†ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•ä¼˜é›…åœ°è§£å†³äº† JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸­çš„ç—›ç‚¹ã€‚ä»æœ€åˆçš„å›è°ƒå‡½æ•°ï¼Œåˆ° Promise çš„é“¾å¼è°ƒç”¨ï¼Œå†åˆ°ç°åœ¨çš„ `async/await`ï¼Œæ¯ä¸€æ¬¡æ¼”è¿›éƒ½è®©å¼‚æ­¥ç¼–ç¨‹å˜å¾—æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆã€‚

åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†è¿ç”¨ `async/await` ä¸ä»…èƒ½æå‡ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜èƒ½å¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´åŠ å¥å£®çš„åº”ç”¨ã€‚è®°ä½ä»¥ä¸‹å‡ ç‚¹å»ºè®®ï¼š

- ä½¿ç”¨ `try/catch` è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œä¸è¦è®©å¼‚å¸¸æ— å£°æ— æ¯åœ°å‘ç”Ÿ ğŸ›¡ï¸
- æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©ä¸²è¡Œæˆ–å¹¶è¡Œæ‰§è¡Œï¼Œé¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸå¤± âš¡
- åœ¨å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚æ—¶ï¼Œæ³¨æ„æ§åˆ¶å¹¶å‘æ•°é‡ ğŸš¦
- ä¸ºå…³é”®çš„å¼‚æ­¥æ“ä½œæ·»åŠ è¶…æ—¶å¤„ç†å’Œé‡è¯•æœºåˆ¶ â±ï¸
- åˆç†åˆ©ç”¨ç¼“å­˜ï¼Œé¿å…é‡å¤çš„å¼‚æ­¥è¯·æ±‚ ğŸ’¾
- æ³¨æ„å¸¸è§é™·é˜±ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾ªç¯ä¸­ä½¿ç”¨ await å’Œé”™è¯¯å¤„ç†æ–¹é¢ ğŸš§

æœ€åï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« ä¸ä»…å¸®åŠ©ä½ ç†è§£äº† `async/await` çš„å·¥ä½œåŸç†ï¼Œæ›´èƒ½æŒ‡å¯¼ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´å¥½åœ°è¿ç”¨è¿™ä¸€å¼ºå¤§ç‰¹æ€§ã€‚è®°ä½ï¼Œç¼–å†™å¼‚æ­¥ä»£ç ä¸ä»…æ˜¯ä¸€é—¨æŠ€æœ¯ï¼Œæ›´æ˜¯ä¸€é—¨è‰ºæœ¯ â€”â€” åœ¨è¿½æ±‚åŠŸèƒ½å®ç°çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘ä»£ç çš„ä¼˜é›…æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

ç¥ä½ çš„å¼‚æ­¥ä»£ç æ°¸è¿œé¡ºç•…ï¼Œæ²¡æœ‰å›è°ƒåœ°ç‹±çš„å›°æ‰°ï¼ğŸš€
