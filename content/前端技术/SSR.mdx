---
title: "SSR (æœåŠ¡ç«¯æ¸²æŸ“) è¯¦è§£ï¼šæ¦‚å¿µã€ä¼˜åŠ¿ä¸å®è·µ"
date: "2022-12-02"
description: "æœ¬æ–‡å…¨é¢ä»‹ç»äº†æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„æ¦‚å¿µã€ä¼˜åŠ¿ã€å®ç°æ–¹æ³•åŠæœ€ä½³å®è·µï¼Œå¸¦ä½ æ·±å…¥äº†è§£ SSR åœ¨ç°ä»£ Web å¼€å‘ä¸­çš„åº”ç”¨ä¸æŒ‘æˆ˜ã€‚"
keywords: "SSR, æœåŠ¡ç«¯æ¸²æŸ“, React, Vue, Next.js, Nuxt.js, æ€§èƒ½ä¼˜åŒ–, å‰ç«¯å¼€å‘"
author: "æ™“é¾™"
image: "/images/hero/ssr-introduction.jpg"
tags: ["SSR", "å‰ç«¯å¼€å‘", "React", "Vue", "æ€§èƒ½ä¼˜åŒ–"]
category: "å‰ç«¯æŠ€æœ¯"
---

åœ¨æˆ‘å¤šå¹´çš„å‰ç«¯å¼€å‘ç”Ÿæ¶¯ä¸­ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¸€ç›´æ˜¯ä¸€ä¸ªæ—¢è®©äººå…´å¥‹åˆå……æ»¡æŒ‘æˆ˜çš„æŠ€æœ¯ã€‚å®ƒä¸ä»…èƒ½æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½ï¼Œè¿˜èƒ½è§£å†³ SEO çš„ç—›ç‚¹ã€‚æœ¬æ–‡å°†ç»“åˆæˆ‘çš„å®æˆ˜ç»éªŒï¼Œæ·±å…¥æ¢è®¨ SSR çš„åº”ç”¨åœºæ™¯ã€å®ç°æ–¹æ¡ˆå’Œä¼˜åŒ–æŠ€å·§ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ SSRï¼Ÿ

è¿˜è®°å¾—æˆ‘ç¬¬ä¸€æ¬¡æ¥æ‰‹ä¸€ä¸ªç”µå•†é¡¹ç›®æ—¶ï¼Œé¢ä¸´ç€ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼šé¦–å±åŠ è½½éœ€è¦ 3s+ï¼Œæœç´¢å¼•æ“æ— æ³•æŠ“å–å•†å“ä¿¡æ¯ï¼Œç”¨æˆ·ä½“éªŒå’Œè½¬åŒ–ç‡éƒ½ä¸ç†æƒ³ã€‚é€šè¿‡å¼•å…¥ SSRï¼Œæˆ‘ä»¬å®ç°äº†ä»¥ä¸‹æ”¹è¿›ï¼š

- é¦–å±åŠ è½½æ—¶é—´é™è‡³ 800ms
- æœç´¢å¼•æ“æ”¶å½•é‡æå‡ 300%
- ç§»åŠ¨ç«¯è½¬åŒ–ç‡æå‡ 25%

è¿™è®©æˆ‘æ·±åˆ»ç†è§£äº† SSR çš„ä»·å€¼ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢è®¨å¦‚ä½•å®ç°è¿™äº›æ”¹è¿›ã€‚

## SSR vs CSRï¼šå®æˆ˜å¯¹æ¯”

| ç‰¹æ€§       | æœåŠ¡ç«¯æ¸²æŸ“ (SSR) | å®¢æˆ·ç«¯æ¸²æŸ“ (CSR) |
| ---------- | ---------------- | ---------------- |
| é¦–å±æ—¶é—´   | 0.8s - 1.5s      | 2s - 4s          |
| æœåŠ¡å™¨å‹åŠ› | è¾ƒé«˜             | è¾ƒä½             |
| SEO æ•ˆæœ   | ä¼˜ç§€             | è¾ƒå·®             |
| å¼€å‘å¤æ‚åº¦ | ä¸­ç­‰             | ä½               |
| ç»´æŠ¤æˆæœ¬   | è¾ƒé«˜             | è¾ƒä½             |

> ğŸ’¡ æ•°æ®æ¥æºï¼šæŸç”µå•†å¹³å°åœ¨åŒ 11 æœŸé—´çš„æ€§èƒ½ç›‘æ§æ•°æ®

## SSR å®æˆ˜æœ€ä½³å®è·µ

### 1. Next.js æœåŠ¡ç«¯æ¸²æŸ“å®è·µ

åœ¨ä¸€ä¸ªå¤§å‹ä¼ä¸šå®˜ç½‘é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Next.js å®ç°äº†é«˜æ€§èƒ½çš„ SSR æ–¹æ¡ˆï¼š

```javascript
// pages/products/[category].js
import { useEffect, useState } from "react";
import { getProductList, getCategories } from "@/api/products";

export default function ProductList({ initialData, category }) {
  const [products, setProducts] = useState(initialData);
  const [loading, setLoading] = useState(false);

  // å®¢æˆ·ç«¯æ•°æ®æ›´æ–°
  useEffect(() => {
    const updateProducts = async () => {
      setLoading(true);
      try {
        const freshData = await getProductList(category);
        setProducts(freshData);
      } catch (error) {
        console.error("Failed to fetch products:", error);
      }
      setLoading(false);
    };

    // å®šæœŸæ›´æ–°å•†å“æ•°æ®
    const timer = setInterval(updateProducts, 30000);
    return () => clearInterval(timer);
  }, [category]);

  return (
    <div className="product-list">
      <h1>{category} äº§å“åˆ—è¡¨</h1>
      {loading && <LoadingSpinner />}
      <div className="grid grid-cols-3 gap-4">
        {products.map((product) => (
          <ProductCard key={product.id} {...product} />
        ))}
      </div>
    </div>
  );
}

// SSR æ•°æ®é¢„å–
export async function getServerSideProps({ params, req, res }) {
  // å®ç°ç¼“å­˜ç­–ç•¥
  res.setHeader(
    "Cache-Control",
    "public, s-maxage=10, stale-while-revalidate=59"
  );

  try {
    const initialData = await getProductList(params.category);
    return {
      props: {
        initialData,
        category: params.category,
      },
    };
  } catch (error) {
    console.error("SSR data fetching failed:", error);
    return {
      notFound: true,
    };
  }
}
```

### 2. Nuxt.js æ€§èƒ½ä¼˜åŒ–å®è·µ

åœ¨å¦ä¸€ä¸ªæ–°é—»èµ„è®¯ç½‘ç«™é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Nuxt.js å®ç°äº†é«˜æ•ˆçš„ SSRï¼š

```javascript
// pages/news/_id.vue
<template>
  <div class="news-detail">
    <article v-if="news">
      <h1>{{ news.title }}</h1>
      <div class="metadata">
        <span>{{ formatDate(news.publishDate) }}</span>
        <span>{{ news.author }}</span>
      </div>
      <div v-html="news.content" class="content"></div>
      <RelatedNews :tags="news.tags" />
    </article>
    <ErrorPage v-else />
  </div>
</template>

<script>
import { defineComponent } from 'vue';
import { useAsyncData, useFetch } from '@nuxtjs/composition-api';

export default defineComponent({
  name: 'NewsDetail',

  async asyncData({ params, $axios, error }) {
    try {
      // ä½¿ç”¨ Redis ç¼“å­˜çƒ­é—¨æ–°é—»
      const cacheKey = `news:${params.id}`;
      const cached = await $axios.$get(`/api/cache/${cacheKey}`);

      if (cached) {
        return { news: cached };
      }

      const news = await $axios.$get(`/api/news/${params.id}`);

      // ç¼“å­˜çƒ­é—¨æ–°é—»
      if (news.viewCount > 1000) {
        await $axios.$post(`/api/cache/${cacheKey}`, news);
      }

      return { news };
    } catch (err) {
      error({ statusCode: 404, message: 'æ–°é—»ä¸å­˜åœ¨' });
    }
  },

  head() {
    return {
      title: this.news?.title,
      meta: [
        {
          hid: 'description',
          name: 'description',
          content: this.news?.summary
        }
      ]
    };
  }
});
</script>
```

## SSR æ€§èƒ½ä¼˜åŒ–å®æˆ˜

### 1. æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–

åœ¨ä¸€ä¸ªé«˜å¹¶å‘æ–°é—»ç½‘ç«™ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ä¼˜åŒ– SSR æ€§èƒ½ï¼š

```javascript
// server/cache.js
import Redis from "ioredis";
import LRU from "lru-cache";

// å¤šçº§ç¼“å­˜ç­–ç•¥
const redis = new Redis();
const pageCache = new LRU({
  max: 100, // æœ€å¤šç¼“å­˜100ä¸ªé¡µé¢
  maxAge: 1000 * 60 * 5, // 5åˆ†é’Ÿè¿‡æœŸ
});

export async function cacheMiddleware(req, res, next) {
  const key = `page:${req.url}`;

  // 1. æ£€æŸ¥å†…å­˜ç¼“å­˜
  const cached = pageCache.get(key);
  if (cached) {
    return res.send(cached);
  }

  // 2. æ£€æŸ¥Redisç¼“å­˜
  const redisCache = await redis.get(key);
  if (redisCache) {
    pageCache.set(key, redisCache);
    return res.send(redisCache);
  }

  // 3. æ¸²æŸ“é¡µé¢å¹¶ç¼“å­˜
  res.originalSend = res.send;
  res.send = function (html) {
    pageCache.set(key, html);
    redis.set(key, html, "EX", 300); // 5åˆ†é’Ÿè¿‡æœŸ
    res.originalSend(html);
  };

  next();
}
```

### 2. å®¢æˆ·ç«¯æ€§èƒ½ä¼˜åŒ–

```javascript
// utils/hydration.js
export function progressiveHydration(component) {
  if (typeof window === "undefined") return;

  // 1. å»¶è¿Ÿéå…³é”®ç»„ä»¶çš„hydration
  if (component.priority === "low") {
    return new Promise((resolve) => {
      requestIdleCallback(() => {
        resolve(component);
      });
    });
  }

  // 2. å¯è§†åŒºåŸŸä¼˜å…ˆhydration
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          component.hydrate();
          observer.disconnect();
        }
      });
    },
    { rootMargin: "50px" }
  );

  observer.observe(component.el);
}
```

## è¸©å‘è®°å½•ä¸è§£å†³æ–¹æ¡ˆ

### 1. å†…å­˜æ³„æ¼é—®é¢˜

åœ¨ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ SSR åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å‘ç°æœåŠ¡å™¨å†…å­˜å ç”¨æŒç»­å¢é•¿ã€‚æ’æŸ¥åå‘ç°æ˜¯å…¨å±€çŠ¶æ€æœªåŠæ—¶æ¸…ç†å¯¼è‡´çš„ï¼š

```javascript
// store/cleanup.js
export function setupStoreCleanup(store) {
  if (process.server) {
    // æ¯ä¸ªè¯·æ±‚ç»“æŸåæ¸…ç†çŠ¶æ€
    return () => {
      store.dispatch("resetState");
      global.__INITIAL_STATE__ = undefined;
    };
  }
}
```

### 2. æœåŠ¡ç«¯æ•°æ®é¢„å–è¶…æ—¶

è§£å†³æ–¹æ¡ˆï¼šå®ç°è¯·æ±‚è¶…æ—¶æ§åˆ¶å’Œé™çº§ç­–ç•¥

```javascript
// utils/fetch.js
export async function fetchWithTimeout(url, timeout = 3000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);

  try {
    const response = await fetch(url, {
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    if (error.name === "AbortError") {
      // é™çº§ä¸ºå®¢æˆ·ç«¯æ¸²æŸ“
      return {
        props: {
          fallback: true,
          error: "è¯·æ±‚è¶…æ—¶",
        },
      };
    }
    throw error;
  }
}
```

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¼˜åŒ–

åœ¨å®é™…éƒ¨ç½²ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹ç­–ç•¥æ¥ä¼˜åŒ– SSR åº”ç”¨çš„å¯ç”¨æ€§ï¼š

1. **è´Ÿè½½å‡è¡¡**ï¼šä½¿ç”¨ Nginx å®ç°å¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡
2. **ç›‘æ§å‘Šè­¦**ï¼šæ¥å…¥ Prometheus + Grafana ç›‘æ§ç³»ç»Ÿ
3. **æ—¥å¿—åˆ†æ**ï¼šä½¿ç”¨ ELK æ ˆè¿›è¡Œæ—¥å¿—æ”¶é›†å’Œåˆ†æ
4. **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨ Docker + K8s å®ç°è‡ªåŠ¨æ‰©ç¼©å®¹

## é€‚ç”¨åœºæ™¯åˆ†æ

### æœ€é€‚åˆ SSR çš„åœºæ™¯

- **å†…å®¹å¯†é›†å‹ç½‘ç«™**ï¼šæ–°é—»ã€åšå®¢ã€æ–‡æ¡£
- **ç”µå•†å¹³å°**ï¼šå•†å“è¯¦æƒ…ã€æœç´¢ç»“æœé¡µ
- **è¥é”€æ´»åŠ¨é¡µé¢**ï¼šç§’æ€ã€ä¿ƒé”€ä¸“é¢˜
- **ä¼ä¸šå®˜ç½‘**ï¼šäº§å“ä»‹ç»ã€è§£å†³æ–¹æ¡ˆ

### ä¸é€‚åˆ SSR çš„åœºæ™¯

- **åå°ç®¡ç†ç³»ç»Ÿ**ï¼šäº¤äº’å¤æ‚ï¼Œå¯¹ SEO è¦æ±‚ä½
- **åœ¨çº¿åä½œå·¥å…·**ï¼šå®æ—¶æ€§è¦æ±‚é«˜
- **æ•°æ®å¯è§†åŒ–åº”ç”¨**ï¼šè®¡ç®—å¯†é›†ï¼Œæ¸²æŸ“å‹åŠ›å¤§

## æ€»ç»“ä¸å±•æœ›

ç»è¿‡å¤šå¹´çš„å®è·µï¼Œæˆ‘è®¤ä¸º SSR ä¸æ˜¯é“¶å¼¹ï¼Œè€Œæ˜¯ä¸€ä¸ªéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥æƒè¡¡çš„æŠ€æœ¯é€‰æ‹©ã€‚å®ƒèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³é¦–å±æ€§èƒ½å’Œ SEO é—®é¢˜ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ›´é«˜çš„å¼€å‘å’Œè¿ç»´æˆæœ¬ã€‚

æœªæ¥ï¼Œéšç€ Edge SSRã€Islands Architecture ç­‰æ–°æŠ€æœ¯çš„å‘å±•ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“çš„å®ç°æ–¹å¼ä¼šæ›´åŠ å¤šæ ·åŒ–ã€‚å»ºè®®å¼€å‘è€…åœ¨é€‰æ‹© SSR æ—¶ï¼Œè¦å……åˆ†è¯„ä¼°é¡¹ç›®éœ€æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¹¶åœ¨å®è·µä¸­ä¸æ–­ä¼˜åŒ–å’Œæ”¹è¿›ã€‚
