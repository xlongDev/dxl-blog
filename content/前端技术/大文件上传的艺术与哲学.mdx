---
title: "å¤§æ–‡ä»¶ä¸Šä¼ çš„è‰ºæœ¯ä¸å“²å­¦ ğŸ¨ | React + NestJS å®ç°åˆ†ç‰‡ã€æ–­ç‚¹ç»­ä¼ ä¸ç§’ä¼  ğŸš€"
date: "2024-07-10"
description: "æ·±å…¥å‰–æå¤§æ–‡ä»¶ä¸Šä¼ çš„å®ç°åŸç†ï¼Œç»“åˆ React å’Œ NestJSï¼Œæ¢ç´¢åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ ä¸ç§’ä¼ çš„æè‡´å®è·µï¼Œå…¼å…·æŠ€æœ¯æ·±åº¦ä¸å“²å­¦æ€è€ƒï¼Œé€‚åˆå‰ç«¯å¼€å‘è€…è¿›é˜¶ã€‚"
keywords: "å¤§æ–‡ä»¶ä¸Šä¼ , React, NestJS, åˆ†ç‰‡ä¸Šä¼ , æ–­ç‚¹ç»­ä¼ , ç§’ä¼ , å‰ç«¯å¼€å‘, ç³»ç»Ÿæ¶æ„, æ€§èƒ½ä¼˜åŒ–"
author: "æ™“é¾™"
image: "/images/hero/large-file-upload.jpg"
tags: ["React", "NestJS", "å‰ç«¯å¼€å‘", "æ–‡ä»¶ä¸Šä¼ ", "æ€§èƒ½ä¼˜åŒ–"]
category: "å‰ç«¯æŠ€æœ¯"
---

> â€œæˆ‘ä»¬ä¸æ˜¯åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨ä¸æ—¶é—´ã€ç©ºé—´å’Œå¤æ‚æ€§åšå¼ˆã€‚â€ â€”â€” çµæ„Ÿæ¥è‡ªã€Šé»‘å®¢å¸å›½ã€‹

å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œè¿™ä¸ªçœ‹ä¼¼å¹³å‡¡çš„åŠŸèƒ½ï¼Œå´è•´è—ç€æŠ€æœ¯çš„æ·±åº¦ä¸å“²å­¦çš„å¹¿åº¦ã€‚æ— è®ºæ˜¯è§†é¢‘å¹³å°çš„4Kç´ æã€äº‘ç›˜çš„TBçº§å¤‡ä»½ï¼Œè¿˜æ˜¯ä¼ä¸šçº§åº”ç”¨çš„å¤æ‚æ•°æ®è¿ç§»ï¼Œå¤§æ–‡ä»¶ä¸Šä¼ æ—©å·²æˆä¸ºç°ä»£Webå¼€å‘çš„æ ‡é…ã€‚ç„¶è€Œï¼Œå¦‚ä½•ä¼˜é›…ã€é«˜æ•ˆã€å¥å£®åœ°å®ç°å®ƒï¼Ÿå¦‚ä½•è®©ç”¨æˆ·ä½“éªŒåˆ°â€œå¿«å¦‚é—ªç”µâ€âš¡ï¸çš„ç§’ä¼ ï¼Ÿå¦‚ä½•åœ¨ä¸Šä¼ ä¸­æ–­åâ€œä»å®¹ç»­ä¼ â€ï¼Ÿè¿™äº›é—®é¢˜ä¸ä»…è€ƒéªŒæŠ€æœ¯åŠŸåº•ï¼Œæ›´æ˜¯ä¸€åœºå¯¹æ¶æ„è®¾è®¡ã€ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿå“²å­¦çš„ç»¼åˆè¾ƒé‡ã€‚

åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥ **React** å’Œ **NestJS** ä¸ºæŠ€æœ¯æ ˆï¼Œæ·±å…¥å‰–æå¤§æ–‡ä»¶ä¸Šä¼ çš„ä¸‰å¤§æ ¸å¿ƒåœºæ™¯ï¼š**åˆ†ç‰‡ä¸Šä¼ **ã€**æ–­ç‚¹ç»­ä¼ ** å’Œ **ç§’ä¼ **ã€‚æˆ‘ä»¬ä¼šä»åŸç†åˆ°å®è·µï¼Œä»ä»£ç åˆ°å“²å­¦ï¼Œä»æŠ€æœ¯ç»†èŠ‚åˆ°æœ€ä½³å®è·µï¼Œå¸¦ä½ é¢†ç•¥å¤§æ–‡ä»¶ä¸Šä¼ çš„æè‡´ä¹‹ç¾ ğŸŒŒã€‚æ— è®ºä½ æ˜¯å‰ç«¯æ–°æ‰‹è¿˜æ˜¯èµ„æ·±å¼€å‘è€…ï¼Œè¿™ç¯‡æ–‡ç« éƒ½å°†ä¸ºä½ æä¾›æ¸…æ™°çš„æ€ç»´é“¾ã€å®ç”¨çš„ä»£ç ç¤ºä¾‹å’Œæ·±åˆ»çš„æ´è§ã€‚

> **æ–‡ç« ç›®æ ‡**ï¼šé€šè¿‡æ¸…æ™°çš„è¡¨æ ¼ã€ä¸°å¯Œçš„ç¤ºä¾‹å’Œæ·±å…¥çš„åŸç†åˆ†æï¼Œè®©ä½ ä¸ä»…â€œçŸ¥å…¶ç„¶â€ï¼Œæ›´â€œçŸ¥å…¶æ‰€ä»¥ç„¶â€ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­æ¸¸åˆƒæœ‰ä½™åœ°å®ç°å¤§æ–‡ä»¶ä¸Šä¼ ã€‚

## 1. å¤§æ–‡ä»¶ä¸Šä¼ çš„æœ¬è´¨ï¼šä¸€åœºä¸å¤æ‚æ€§çš„åšå¼ˆ ğŸ§©

å¤§æ–‡ä»¶ä¸Šä¼ ä¸ºä½•å¤æ‚ï¼Ÿè¡¨é¢ä¸Šçœ‹ï¼Œå®ƒåªæ˜¯â€œæŠŠæ–‡ä»¶ä»å®¢æˆ·ç«¯ä¼ åˆ°æœåŠ¡ç«¯â€ã€‚ä½†æ·±å…¥æ€è€ƒï¼Œä½ ä¼šå‘ç°å®ƒæ¶‰åŠå¤šæ–¹åä½œï¼š**å®¢æˆ·ç«¯**ï¼ˆæµè§ˆå™¨æ€§èƒ½ã€ç”¨æˆ·äº¤äº’ï¼‰ã€**æœåŠ¡ç«¯**ï¼ˆå­˜å‚¨ã€å¹¶å‘å¤„ç†ï¼‰ã€**ç½‘ç»œ**ï¼ˆå¸¦å®½ã€ç¨³å®šæ€§ï¼‰ä»¥åŠ**ç”¨æˆ·ä½“éªŒ**ï¼ˆè¿›åº¦åé¦ˆã€é”™è¯¯å¤„ç†ï¼‰ã€‚è¿™äº›å› ç´ äº¤ç»‡åœ¨ä¸€èµ·ï¼Œç¨æœ‰ä¸æ…ä¾¿å¯èƒ½å¯¼è‡´ä¸Šä¼ å¤±è´¥ã€æ€§èƒ½ç“¶é¢ˆæˆ–ç”¨æˆ·æµå¤±ã€‚

### 1.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†ç‰‡ä¸Šä¼ ï¼Ÿ
ä¼ ç»Ÿçš„å°æ–‡ä»¶ä¸Šä¼ ï¼ˆå‡ MBï¼‰å¯ä»¥é€šè¿‡ç®€å•çš„ `multipart/form-data` æå®šã€‚ä½†å½“æ–‡ä»¶è¾¾åˆ°GBç”šè‡³TBçº§åˆ«ï¼Œé—®é¢˜æ¥è¸µè€Œè‡³ï¼š
- **ç½‘ç»œä¸ç¨³å®š**ï¼šä¸Šä¼ ä¸­æ–­åéœ€è¦ä»å¤´å¼€å§‹ï¼Œç”¨æˆ·ä½“éªŒæå·®ã€‚
- **æµè§ˆå™¨é™åˆ¶**ï¼šå¤§æ–‡ä»¶å¯èƒ½è€—å°½å†…å­˜ï¼Œç”šè‡³è§¦å‘æµè§ˆå™¨å´©æºƒã€‚
- **æœåŠ¡ç«¯å‹åŠ›**ï¼šä¸€æ¬¡æ€§æ¥æ”¶å¤§æ–‡ä»¶å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–å­˜å‚¨ç“¶é¢ˆã€‚

**åˆ†ç‰‡ä¸Šä¼ **ï¼ˆChunked Uploadï¼‰åº”è¿è€Œç”Ÿã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°†å¤§æ–‡ä»¶åˆ‡å‰²æˆå°å—ï¼Œé€å—ä¸Šä¼ ï¼Œæ¯å—ç‹¬ç«‹å¤„ç†**ã€‚è¿™ä¸ä»…é™ä½äº†å•æ¬¡ä¼ è¾“çš„å‹åŠ›ï¼Œè¿˜ä¸ºæ–­ç‚¹ç»­ä¼ å’Œå¹¶è¡Œä¸Šä¼ å¥ å®šäº†åŸºç¡€ã€‚

> *å°Tipsï¼šåˆ†ç‰‡å¤§å°é€šå¸¸è®¾ç½®ä¸º 5MB~10MBï¼Œæ—¢èƒ½ä¿è¯ä¼ è¾“æ•ˆç‡ï¼Œåˆèƒ½å…¼å®¹å¤§å¤šæ•°ç½‘ç»œç¯å¢ƒã€‚*

### 1.2 æ–­ç‚¹ç»­ä¼ ï¼šä»â€œå…¨ç›˜é‡æ¥â€åˆ°â€œä»å®¹ç»­æ¥â€
æ–­ç‚¹ç»­ä¼ ï¼ˆResumable Uploadï¼‰æ˜¯åˆ†ç‰‡ä¸Šä¼ çš„è‡ªç„¶å»¶ä¼¸ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯ï¼š**è®°å½•å·²ä¸Šä¼ çš„åˆ†ç‰‡çŠ¶æ€ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸­æ–­åä»ä¸Šæ¬¡è¿›åº¦ç»§ç»­ä¸Šä¼ **ã€‚è¿™éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ååŒä¿å­˜ä¸Šä¼ è¿›åº¦ï¼Œé€šå¸¸é€šè¿‡æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿè®°å½•åˆ†ç‰‡å…ƒæ•°æ®ã€‚

> *å°Tipsï¼šä½¿ç”¨ Redis æˆ–æ•°æ®åº“å­˜å‚¨åˆ†ç‰‡çŠ¶æ€æ—¶ï¼Œæ³¨æ„è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé¿å…å…ƒæ•°æ®æ— é™å †ç§¯ã€‚*

### 1.3 ç§’ä¼ ï¼šæ•ˆç‡çš„æè‡´è¿½æ±‚ âš¡ï¸
ç§’ä¼ ï¼ˆInstant Uploadï¼‰æ˜¯å¤§æ–‡ä»¶ä¸Šä¼ çš„â€œé»‘é­”æ³•â€ã€‚å®ƒçš„åŸç†æ˜¯ï¼š**é€šè¿‡æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼ˆé€šå¸¸æ˜¯ Hash å€¼ï¼‰åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨äºæœåŠ¡ç«¯ï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›æˆåŠŸï¼Œæ— éœ€å®é™…ä¸Šä¼ **ã€‚è¿™åœ¨äº‘ç›˜æˆ–è§†é¢‘å¹³å°ä¸­å°¤ä¸ºå¸¸è§ï¼Œæ¯”å¦‚ä¸Šä¼ ä¸€éƒ¨çƒ­é—¨ç”µå½±ï¼Œå¯èƒ½æœåŠ¡ç«¯æ—©å·²æœ‰å‰¯æœ¬ã€‚

> *å°Tipsï¼šè®¡ç®—æ–‡ä»¶ Hash æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ MD5 æˆ– SHA-256ï¼Œä½†è¦æ³¨æ„æ€§èƒ½å¼€é”€ï¼Œå»ºè®®åœ¨ Web Worker ä¸­å¼‚æ­¥è®¡ç®—ã€‚*

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼šä»å®è§‚åˆ°å¾®è§‚ ğŸ›ï¸

å®ç°å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œä¸ä»…éœ€è¦å†™ä»£ç ï¼Œæ›´éœ€è¦ç«™åœ¨æ¶æ„çš„é«˜åº¦æ€è€ƒã€‚æˆ‘ä»¬å°†ä»**å®¢æˆ·ç«¯**ï¼ˆReactï¼‰ã€**æœåŠ¡ç«¯**ï¼ˆNestJSï¼‰å’Œ**å­˜å‚¨å±‚**ä¸‰ä¸ªå±‚é¢è®¾è®¡ä¸€ä¸ªå¥å£®çš„ç³»ç»Ÿã€‚

### 2.1 æ¶æ„æ¦‚è§ˆ
ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿæ¶æ„å›¾ï¼ˆä»¥æ–‡å­—æè¿°ï¼Œå®é™…é¡¹ç›®å¯æ­é… UML å·¥å…·å¦‚ Draw.ioï¼‰ï¼š
- **å®¢æˆ·ç«¯ï¼ˆReactï¼‰**ï¼šè´Ÿè´£æ–‡ä»¶åˆ†ç‰‡ã€Hash è®¡ç®—ã€ä¸Šä¼ è¿›åº¦ç®¡ç†ã€ç”¨æˆ·äº¤äº’ã€‚
- **æœåŠ¡ç«¯ï¼ˆNestJSï¼‰**ï¼šå¤„ç†åˆ†ç‰‡æ¥æ”¶ã€å…ƒæ•°æ®ç®¡ç†ã€ç§’ä¼ æ ¡éªŒã€æ–‡ä»¶åˆå¹¶ã€‚
- **å­˜å‚¨å±‚**ï¼šæ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€äº‘å­˜å‚¨ï¼ˆå¦‚ AWS S3ï¼‰æˆ–åˆ†å¸ƒå¼å­˜å‚¨ã€‚
- **æ•°æ®åº“/ç¼“å­˜**ï¼šè®°å½•åˆ†ç‰‡çŠ¶æ€ã€æ–‡ä»¶å…ƒæ•°æ®ï¼Œæ¨è Redis æˆ– MongoDBã€‚
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼ˆå¯é€‰ï¼‰ï¼šå¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æ–‡ä»¶åˆå¹¶æˆ–é€šçŸ¥ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¸…æ™°çš„è¡¨æ ¼ï¼Œæ€»ç»“å„ç»„ä»¶çš„èŒè´£ï¼š

| **ç»„ä»¶**         | **èŒè´£**                                                                 | **æŠ€æœ¯é€‰å‹**                     |
|------------------|--------------------------------------------------------------------------|----------------------------------|
| å®¢æˆ·ç«¯           | æ–‡ä»¶åˆ†ç‰‡ã€Hash è®¡ç®—ã€ä¸Šä¼ è¿›åº¦å±•ç¤ºã€é”™è¯¯é‡è¯•                              | React, Web Worker, Axios         |
| æœåŠ¡ç«¯           | åˆ†ç‰‡æ¥æ”¶ã€ç§’ä¼ æ ¡éªŒã€æ–‡ä»¶åˆå¹¶ã€å…ƒæ•°æ®ç®¡ç†                                | NestJS, TypeORM, Multer          |
| å­˜å‚¨å±‚           | æ–‡ä»¶åˆ†ç‰‡å­˜å‚¨ã€æœ€ç»ˆæ–‡ä»¶å­˜å‚¨                                              | AWS S3, MinIO, æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ      |
| æ•°æ®åº“/ç¼“å­˜      | è®°å½•ä¸Šä¼ è¿›åº¦ã€åˆ†ç‰‡çŠ¶æ€ã€æ–‡ä»¶å…ƒæ•°æ®                                      | MongoDB, Redis                   |
| æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰ | å¼‚æ­¥å¤„ç†æ–‡ä»¶åˆå¹¶ã€é€šçŸ¥ç”¨æˆ·                                              | RabbitMQ, Kafka                  |

> *å°Tipsï¼šæ¶æ„è®¾è®¡æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘è§£è€¦å’Œå¯æ‰©å±•æ€§ã€‚æ¯”å¦‚ï¼Œå­˜å‚¨å±‚å¯ä»¥æŠ½è±¡ä¸ºæ¥å£ï¼Œæ–¹ä¾¿åˆ‡æ¢ S3 æˆ–æœ¬åœ°å­˜å‚¨ã€‚*

### 2.2 è®¾è®¡å“²å­¦ï¼šç®€å•å³æ˜¯ç¾
> â€œå¤§é“è‡³ç®€ï¼Œå¤æ‚é—®é¢˜éœ€ç®€å•è§£ã€‚â€ â€”â€” è€å­

å¤§æ–‡ä»¶ä¸Šä¼ çš„å®ç°çœ‹ä¼¼å¤æ‚ï¼Œä½†ä¼˜ç§€çš„æ¶æ„æ€»æ˜¯ä»¥ç®€å•ä¸ºå†…æ ¸ã€‚æˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å“²å­¦è§’åº¦ä¼˜åŒ–è®¾è®¡ï¼š
- **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—ï¼ˆå¦‚åˆ†ç‰‡ã€æ ¡éªŒã€å­˜å‚¨ï¼‰åªåšä¸€ä»¶äº‹ã€‚
- **çŠ¶æ€æ— å¤„ä¸åœ¨**ï¼šé€šè¿‡æ¸…æ™°çš„çŠ¶æ€ç®¡ç†ï¼ˆReduxã€Zustandï¼‰è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¿æŒåŒæ­¥ã€‚
- **æ‹¥æŠ±å¼‚æ­¥**ï¼šæ— è®ºæ˜¯æ–‡ä»¶ Hash è®¡ç®—è¿˜æ˜¯åˆ†ç‰‡ä¸Šä¼ ï¼Œå¼‚æ­¥æ˜¯æ€§èƒ½çš„åŸºçŸ³ã€‚

> *å°Tipsï¼šä½¿ç”¨çŠ¶æ€æœºï¼ˆState Machineï¼‰ç®¡ç†ä¸Šä¼ æµç¨‹ï¼Œèƒ½æ˜¾è‘—æå‡ä»£ç å¯ç»´æŠ¤æ€§ã€‚*

## 3. å®ç°åŸç†ä¸ä»£ç å®è·µï¼šä»ç†è®ºåˆ°è½åœ° ğŸ› ï¸

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡è¯¦ç»†çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ React å’Œ NestJS ä¸­å®ç°å¤§æ–‡ä»¶ä¸Šä¼ ã€‚æˆ‘ä»¬ä¼šåˆ†ä¸º**å®¢æˆ·ç«¯**å’Œ**æœåŠ¡ç«¯**ä¸¤éƒ¨åˆ†ï¼Œé€æ­¥å®ç°åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ å’Œç§’ä¼ ã€‚

### 3.1 å®¢æˆ·ç«¯ï¼ˆReactï¼‰ï¼šä¼˜é›…åœ°å¤„ç†æ–‡ä»¶åˆ†ç‰‡

#### 3.1.1 æ–‡ä»¶åˆ†ç‰‡é€»è¾‘
æˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶åˆ‡å‰²ä¸ºå›ºå®šå¤§å°çš„åˆ†ç‰‡ï¼ˆå‡è®¾ 5MBï¼‰ã€‚React ç«¯å¯ä»¥ä½¿ç”¨ `File.slice` æ–¹æ³•å®ç°åˆ†ç‰‡ï¼Œå¹¶é€šè¿‡ Web Worker å¼‚æ­¥è®¡ç®—æ–‡ä»¶ Hashã€‚

```jsx
import React, { useState, useCallback } from 'react';
import axios from 'axios';
import SparkMD5 from 'spark-md5';

const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB

const FileUploader: React.FC = () => {
  const [file, setFile] = useState<File | null>(null);
  const [progress, setProgress] = useState(0);
  const [fileHash, setFileHash] = useState<string>('');

  // å¤„ç†æ–‡ä»¶é€‰æ‹©
  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files) {
      setFile(e.target.files[0]);
    }
  };

  // è®¡ç®—æ–‡ä»¶ Hashï¼ˆåœ¨ Web Worker ä¸­è¿è¡Œï¼‰
  const calculateHash = useCallback(async (file: File): Promise<string> => {
    return new Promise((resolve) => {
      const worker = new Worker(URL.createObjectURL(new Blob([`
        importScripts('https://cdnjs.cloudflare.com/ajax/libs/spark-md5/3.0.2/spark-md5.min.js');
        self.onmessage = (e) => {
          const file = e.data;
          const spark = new SparkMD5.ArrayBuffer();
          const reader = new FileReader();
          reader.onload = (event) => {
            spark.append(event.target.result);
            self.postMessage(spark.end());
          };
          reader.readAsArrayBuffer(file);
        };
      `], { type: 'application/javascript' })));

      worker.onmessage = (e) => {
        resolve(e.data);
        worker.terminate();
      };

      worker.postMessage(file);
    });
  }, []);

  // åˆ†ç‰‡ä¸Šä¼ 
  const uploadFile = useCallback(async () => {
    if (!file) return;

    // è®¡ç®—æ–‡ä»¶ Hash
    const hash = await calculateHash(file);
    setFileHash(hash);

    // æ£€æŸ¥æ˜¯å¦æ”¯æŒç§’ä¼ 
    const { data: isExist } = await axios.post('/api/upload/check', { hash });
    if (isExist) {
      alert('æ–‡ä»¶å·²å­˜åœ¨ï¼Œç§’ä¼ æˆåŠŸï¼');
      return;
    }

    // åˆ†ç‰‡é€»è¾‘
    const totalChunks = Math.ceil(file.size / CHUNK_SIZE);
    for (let i = 0; i < totalChunks; i++) {
      const start = i * CHUNK_SIZE;
      const end = Math.min(start + CHUNK_SIZE, file.size);
      const chunk = file.slice(start, end);

      const formData = new FormData();
      formData.append('chunk', chunk);
      formData.append('hash', hash);
      formData.append('index', i.toString());
      formData.append('total', totalChunks.toString());

      await axios.post('/api/upload/chunk', formData, {
        onUploadProgress: (progressEvent) => {
          if (progressEvent.total) {
            setProgress((i / totalChunks) * 100);
          }
        },
      });
    }

    // é€šçŸ¥æœåŠ¡ç«¯åˆå¹¶åˆ†ç‰‡
    await axios.post('/api/upload/merge', { hash, name: file.name });
    alert('ä¸Šä¼ æˆåŠŸï¼');
  }, [file]);

  return (
    <div className="p-4">
      <input type="file" onChange={handleFileChange} className="mb-4" />
      <button
        onClick={uploadFile}
        disabled={!file}
        className="bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400"
      >
        ä¸Šä¼ æ–‡ä»¶
      </button>
      <div className="mt-4">
        ä¸Šä¼ è¿›åº¦ï¼š{progress.toFixed(2)}%
      </div>
    </div>
  );
};

export default FileUploader;
```

> *å°Tipsï¼šä½¿ç”¨ Web Worker è®¡ç®— Hash å¯ä»¥é¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚*

#### 3.1.2 è¿›åº¦ç®¡ç†ä¸é”™è¯¯é‡è¯•
ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦ï¼š
- **å®æ—¶è¿›åº¦åé¦ˆ**ï¼šé€šè¿‡ `onUploadProgress` äº‹ä»¶æ›´æ–°è¿›åº¦æ¡ã€‚
- **é”™è¯¯é‡è¯•æœºåˆ¶**ï¼šä¸ºæ¯ä¸ªåˆ†ç‰‡è®¾ç½®é‡è¯•æ¬¡æ•°ï¼ˆå»ºè®® 3 æ¬¡ï¼‰ã€‚
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ Redux æˆ– Zustand ç®¡ç†ä¸Šä¼ çŠ¶æ€ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯é‡è¯•é€»è¾‘ï¼š

```typescript
export async function uploadWithRetry(
  url: string,
  data: FormData,
  maxRetries: number = 3
): Promise<any> {
  let retries = 0;
  while (retries < maxRetries) {
    try {
      const response = await axios.post(url, data);
      return response.data;
    } catch (error) {
      retries++;
      if (retries === maxRetries) {
        throw new Error(`ä¸Šä¼ å¤±è´¥ï¼Œå·²é‡è¯• ${maxRetries} æ¬¡`);
      }
      await new Promise((resolve) => setTimeout(resolve, 1000 * retries));
    }
  }
}
```

> *å°Tipsï¼šæŒ‡æ•°é€€é¿ï¼ˆExponential Backoffï¼‰æ˜¯é”™è¯¯é‡è¯•çš„æœ€ä½³å®è·µï¼Œèƒ½æœ‰æ•ˆé™ä½æœåŠ¡ç«¯å‹åŠ›ã€‚*

### 3.2 æœåŠ¡ç«¯ï¼ˆNestJSï¼‰ï¼šå¥å£®åœ°å¤„ç†åˆ†ç‰‡

#### 3.2.1 ç§’ä¼ æ ¡éªŒ
æœåŠ¡ç«¯é¦–å…ˆéœ€è¦æ ¡éªŒæ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ã€‚æˆ‘ä»¬é€šè¿‡æ–‡ä»¶ Hash æŸ¥è¯¢æ•°æ®åº“ï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›æˆåŠŸã€‚

```typescript
import { Controller, Post, Body, UploadedFile, UseInterceptors } from '@nestjs/common';
import { FileInterceptor } from '@nestjs/platform-express';
import { UploadService } from './upload.service';

@Controller('upload')
export class UploadController {
  constructor(private readonly uploadService: UploadService) {}

  @Post('check')
  async checkFile(@Body('hash') hash: string) {
    return this.uploadService.checkFile(hash);
  }

  @Post('chunk')
  @UseInterceptors(FileInterceptor('chunk'))
  async uploadChunk(
    @UploadedFile() file: Express.Multer.File,
    @Body('hash') hash: string,
    @Body('index') index: string,
    @Body('total') total: string,
  ) {
    return this.uploadService.uploadChunk(file, hash, parseInt(index), parseInt(total));
  }

  @Post('merge')
  async mergeChunks(@Body('hash') hash: string, @Body('name') name: string) {
    return this.uploadService.mergeChunks(hash, name);
  }
}
```

#### 3.2.2 åˆ†ç‰‡å­˜å‚¨ä¸åˆå¹¶
åˆ†ç‰‡ä¸Šä¼ æ—¶ï¼ŒæœåŠ¡ç«¯å°†æ¯ä¸ªåˆ†ç‰‡å­˜å‚¨ä¸ºä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶è®°å½•å…ƒæ•°æ®ã€‚åˆå¹¶æ—¶ï¼Œå°†æ‰€æœ‰åˆ†ç‰‡æŒ‰é¡ºåºæ‹¼æ¥ä¸ºå®Œæ•´æ–‡ä»¶ã€‚

```typescript
import { Injectable } from '@nestjs/common';
import { join } from 'path';
import { createWriteStream, promises as fs } from 'fs';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from 'mongoose';
import { File, FileDocument } from './schemas/file.schema';

@Injectable()
export class UploadService {
  constructor(@InjectModel(File.name) private fileModel: Model<FileDocument>) {}

  async checkFile(hash: string): Promise<boolean> {
    const file = await this.fileModel.findOne({ hash });
    return !!file;
  }

  async uploadChunk(file: Express.Multer.File, hash: string, index: number, total: number) {
    const chunkPath = join('uploads', 'chunks', `${hash}-${index}`);
    await fs.writeFile(chunkPath, file.buffer);

    // æ›´æ–°åˆ†ç‰‡çŠ¶æ€
    await this.fileModel.updateOne(
      { hash },
      { $push: { chunks: { index, path: chunkPath } } },
      { upsert: true },
    );
  }

  async mergeChunks(hash: string, name: string) {
    const file = await this.fileModel.findOne({ hash });
    if (!file) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');

    const chunks = file.chunks.sort((a, b) => a.index - b.index);
    const finalPath = join('uploads', 'files', `${hash}-${name}`);
    const writeStream = createWriteStream(finalPath);

    for (const chunk of chunks) {
      const data = await fs.readFile(chunk.path);
      writeStream.write(data);
      await fs.unlink(chunk.path); // åˆ é™¤ä¸´æ—¶åˆ†ç‰‡
    }

    writeStream.end();
    await this.fileModel.updateOne({ hash }, { $set: { path: finalPath, name } });
  }
}
```

> *å°Tipsï¼šåˆå¹¶åˆ†ç‰‡æ—¶ï¼Œä½¿ç”¨æµå¼å†™å…¥ï¼ˆStreamï¼‰èƒ½æ˜¾è‘—é™ä½å†…å­˜å ç”¨ï¼Œé€‚åˆè¶…å¤§æ–‡ä»¶ã€‚*

### 3.3 æ•°æ®åº“Schemaè®¾è®¡
æˆ‘ä»¬ä½¿ç”¨ MongoDB å­˜å‚¨æ–‡ä»¶å…ƒæ•°æ®å’Œåˆ†ç‰‡çŠ¶æ€ï¼š

```typescript
import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
import { Document } from 'mongoose';

@Schema()
export class Chunk {
  @Prop()
  index: number;

  @Prop()
  path: string;
}

@Schema()
export class File extends Document {
  @Prop({ required: true, unique: true })
  hash: string;

  @Prop()
  name: string;

  @Prop()
  path: string;

  @Prop([Chunk])
  chunks: Chunk[];
}

export const FileSchema = SchemaFactory.createForClass(File);
```

> *å°Tipsï¼šä¸º Hash å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼Œèƒ½åŠ é€Ÿç§’ä¼ æ ¡éªŒã€‚*

## 4. æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ– ğŸš€

å®ç°å¤§æ–‡ä»¶ä¸Šä¼ åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œå¦‚ä½•è®©å®ƒæ›´å¿«ã€æ›´ç¨³ã€æ›´ä¼˜é›…ï¼Ÿä»¥ä¸‹æ˜¯ä¸€äº›å®æˆ˜ç»éªŒï¼š

### 4.1 å®¢æˆ·ç«¯ä¼˜åŒ–
- **å¹¶è¡Œä¸Šä¼ **ï¼šåŒæ—¶ä¸Šä¼ å¤šä¸ªåˆ†ç‰‡ï¼ˆå»ºè®® 3~5 ä¸ªï¼‰ï¼Œåˆ©ç”¨æµè§ˆå™¨å¤šçº¿ç¨‹èƒ½åŠ›ã€‚
- **åŠ¨æ€åˆ†ç‰‡å¤§å°**ï¼šæ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´åˆ†ç‰‡å¤§å°ï¼ˆæ¯”å¦‚å¼±ç½‘ç¯å¢ƒä¸‹å‡å°åˆ†ç‰‡ï¼‰ã€‚
- **é¢„ä¸Šä¼ æ ¡éªŒ**ï¼šä¸Šä¼ å‰æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€å¤§å°ï¼Œå‡å°‘æ— æ•ˆè¯·æ±‚ã€‚

> *å°Tipsï¼šä½¿ç”¨ `navigator.connection` API æ£€æµ‹ç½‘ç»œçŠ¶å†µï¼ŒåŠ¨æ€ä¼˜åŒ–ä¸Šä¼ ç­–ç•¥ã€‚*

### 4.2 æœåŠ¡ç«¯ä¼˜åŒ–
- **é™æµä¸è´Ÿè½½å‡è¡¡**ï¼šä¸ºä¸Šä¼ æ¥å£è®¾ç½® QPS é™åˆ¶ï¼Œé¿å…æœåŠ¡ç«¯è¿‡è½½ã€‚
- **å¼‚æ­¥åˆå¹¶**ï¼šå°†åˆ†ç‰‡åˆå¹¶ä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡è½»ä¸»çº¿ç¨‹å‹åŠ›ã€‚
- **åˆ†å¸ƒå¼å­˜å‚¨**ï¼šä½¿ç”¨ S3 æˆ– MinIO å­˜å‚¨å¤§æ–‡ä»¶ï¼Œæ”¯æŒé«˜å¹¶å‘ã€‚

> *å°Tipsï¼šä¸ºä¸Šä¼ æ¥å£å¯ç”¨ Gzip å‹ç¼©ï¼Œèƒ½æœ‰æ•ˆé™ä½ç½‘ç»œä¼ è¾“æˆæœ¬ã€‚*

### 4.3 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **è¿›åº¦åŠ¨ç”»**ï¼šä½¿ç”¨ CSS åŠ¨ç”»æˆ– Lottie åˆ¶ä½œä¸æ»‘çš„è¿›åº¦æ¡ã€‚
- **é”™è¯¯æç¤º**ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚â€œç½‘ç»œä¸­æ–­ï¼Œè¯·æ£€æŸ¥è¿æ¥â€ã€‚
- **æ‹–æ‹½ä¸Šä¼ **ï¼šæ”¯æŒ HTML5 Drag & Drop APIï¼Œæå‡äº¤äº’å‹å¥½æ€§ã€‚

> *å°Tipsï¼šä¸ºè¿›åº¦æ¡æ·»åŠ å¾®å¦™çš„â€œå‡è¿›åº¦â€åŠ¨ç”»ï¼Œèƒ½è®©ç”¨æˆ·æ„ŸçŸ¥æ›´å¿«ã€‚*

## 5. å“²å­¦æ€è€ƒï¼šæŠ€æœ¯ä¸äººæ€§çš„äº¤æ±‡ ğŸŒŒ

å¤§æ–‡ä»¶ä¸Šä¼ ä¸ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯å¯¹äººæ€§éœ€æ±‚çš„æ·±åˆ»å›åº”ã€‚ç”¨æˆ·å¸Œæœ›â€œå¿«â€ã€å¸Œæœ›â€œç¨³â€ã€å¸Œæœ›â€œç®€å•â€ï¼Œè€Œæˆ‘ä»¬ä½œä¸ºå¼€å‘è€…ï¼Œéœ€è¦åœ¨å¤æ‚æ€§ä¸­å¯»æ‰¾å¹³è¡¡ã€‚è¿™è®©æˆ‘æƒ³èµ·ã€Šé“å¾·ç»ã€‹ä¸­çš„ä¸€å¥è¯ï¼š

> â€œä¸ºå­¦æ—¥ç›Šï¼Œä¸ºé“æ—¥æŸï¼ŒæŸä¹‹åˆæŸï¼Œä»¥è‡³äºæ— ä¸ºã€‚â€

æŠ€æœ¯çš„è¿›æ­¥ï¼Œå¾€å¾€æ˜¯ä»â€œå¤æ‚â€èµ°å‘â€œç®€å•â€ã€‚åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ ã€ç§’ä¼ ï¼Œè¿™äº›æŠ€æœ¯æ‰‹æ®µçš„èƒŒåï¼Œæ˜¯å¯¹ç”¨æˆ·æ—¶é—´çš„å°Šé‡ã€å¯¹ç³»ç»Ÿèµ„æºçš„çè§†ã€‚ç«™åœ¨æ›´é«˜çš„æ ¼å±€ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒï¼š
- **æŠ€æœ¯çš„è¾¹ç•Œ**ï¼šå¤§æ–‡ä»¶ä¸Šä¼ çš„æè‡´ä¼˜åŒ–ï¼Œæ˜¯å¦ä¼šè®©æˆ‘ä»¬å¿½ç•¥å…¶ä»–ä½“éªŒï¼Ÿ
- **äººæ€§çš„éœ€æ±‚**ï¼šç”¨æˆ·çœŸæ­£æƒ³è¦çš„ï¼Œæ˜¯é€Ÿåº¦ï¼Œè¿˜æ˜¯æŒæ§æ„Ÿï¼Ÿ
- **è®¾è®¡çš„å“²å­¦**ï¼šå¦‚ä½•åœ¨åŠŸèƒ½ä¸ç¾å­¦ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼Ÿ

è¿™äº›é—®é¢˜æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œä½†å®ƒä»¬æé†’æˆ‘ä»¬ï¼š**æŠ€æœ¯ä¸ä»…æ˜¯å·¥å…·ï¼Œæ›´æ˜¯è¿æ¥äººä¸ä¸–ç•Œçš„æ¡¥æ¢**ã€‚

## 6. æ€»ç»“ä¸å±•æœ›ï¼šè¿ˆå‘æ›´å¹¿é˜”çš„æœªæ¥ ğŸŒ

å¤§æ–‡ä»¶ä¸Šä¼ æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œä¹Ÿæ˜¯ä¸€åœºå“²å­¦çš„ä¿®è¡Œã€‚é€šè¿‡ React å’Œ NestJSï¼Œæˆ‘ä»¬å®ç°äº†åˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ å’Œç§’ä¼ ï¼Œæ¢ç´¢äº†ä»åŸç†åˆ°å®è·µçš„å®Œæ•´è·¯å¾„ã€‚ä½†è¿™åªæ˜¯å¼€å§‹ã€‚æœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
- **å¼•å…¥ AI ä¼˜åŒ–**ï¼šé€šè¿‡æœºå™¨å­¦ä¹ é¢„æµ‹ç½‘ç»œçŠ¶å†µï¼ŒåŠ¨æ€è°ƒæ•´ä¸Šä¼ ç­–ç•¥ã€‚
- **æ‹¥æŠ± Web3**ï¼šç»“åˆ IPFS å®ç°å»ä¸­å¿ƒåŒ–æ–‡ä»¶ä¸Šä¼ ã€‚
- **æ¢ç´¢æ–°åè®®**ï¼šåˆ©ç”¨ WebTransport æˆ– QUIC æå‡ä¼ è¾“æ•ˆç‡ã€‚

> â€œæŠ€æœ¯æ˜¯çŸ­æš‚çš„ï¼Œæ€æƒ³æ˜¯æ°¸æ’çš„ã€‚â€ â€”â€” çµæ„Ÿæ¥è‡ªã€Šæ˜Ÿé™…ç©¿è¶Šã€‹

å¸Œæœ›è¿™ç¯‡æ–‡ç« ä¸ä»…ä¸ºä½ æä¾›äº†å®ç”¨çš„ä»£ç å’Œå®è·µï¼Œæ›´ç‚¹ç‡ƒäº†ä½ å¯¹æŠ€æœ¯ä¸å“²å­¦çš„æ€è€ƒç«èŠ± ğŸ”¥ã€‚å¤§æ–‡ä»¶ä¸Šä¼ çš„æ—…ç¨‹ï¼Œå°±åƒä¸€åœºæ˜Ÿé™…ç©¿è¶Šï¼Œæˆ‘ä»¬åœ¨ä»£ç çš„å®‡å®™ä¸­å¯»æ‰¾æ„ä¹‰ï¼Œåœ¨å¤æ‚æ€§ä¸­è¿½é€ç®€å•ã€‚æ„¿ä½ åœ¨è¿™æ¡è·¯ä¸Šï¼Œä»£ç ä¼˜é›…ï¼Œæ€æƒ³è‡ªç”±ï¼

---