---
title: "Webpackæ€§èƒ½ä¼˜åŒ–ä¹‹åˆ†åŒ…ï¼šä»ä»£ç åˆ°äººç”Ÿçš„æ‹†è§£è‰ºæœ¯ ğŸš€"
date: "2023-01-11"
description: "æ·±å…¥æ¢è®¨ Webpack åˆ†åŒ…ç­–ç•¥ï¼Œæ¶µç›–åŸç†ã€å®è·µã€æ¡ˆä¾‹ä¸ä¼˜åŒ–æŠ€å·§ï¼Œç»“åˆå“²å­¦æ€è€ƒä¸å¹½é»˜è¡¨è¾¾ï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘è€…æå‡æ€§èƒ½ä¸å¿ƒæ™ºã€‚"
keywords: "Webpack, åˆ†åŒ…, ä»£ç åˆ†å‰², æ€§èƒ½ä¼˜åŒ–, å‰ç«¯å¼€å‘, æ‡’åŠ è½½, åŠ¨æ€å¯¼å…¥, æ„å»ºå·¥å…·"
author: "æ™“é¾™"
image: "/images/hero/webpack-split.jpg"
tags: ["Webpack", "æ€§èƒ½ä¼˜åŒ–", "å‰ç«¯å¼€å‘", "JavaScript"]
category: "Build-Tools"
---

> â€œç”Ÿæ´»å°±åƒä¸€å †ä»£ç ï¼Œæ‹†å¾—ä¸å¥½ï¼Œå°±ä¼šå¡é¡¿ã€‚â€ â€”â€” æŸä¸çŸ¥åå‰ç«¯å¼€å‘è€…

åœ¨å‰ç«¯å¼€å‘çš„æµ©ç€šå®‡å®™ä¸­ï¼ŒWebpack å°±åƒä¸€è‰˜å·¨å‹é£èˆ¹ï¼Œæ‰¿è½½ç€æˆ‘ä»¬çš„ä»£ç ã€èµ„æºå’Œæ¢¦æƒ³ï¼Œé©¶å‘ç”¨æˆ·æµè§ˆå™¨çš„å½¼å²¸ã€‚ç„¶è€Œï¼Œå½“é£èˆ¹è£…è½½è¿‡å¤šè´§ç‰©ï¼ˆä»£ç ã€åº“ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œå®ƒçš„é€Ÿåº¦ä¼šå˜å¾—åƒä¹Œé¾Ÿçˆ¬è¡Œï¼Œç”šè‡³å¯èƒ½å æ¯ã€‚è¿™æ—¶ï¼Œåˆ†åŒ…ï¼ˆCode Splittingï¼‰å°±å¦‚åŒä¸€æŠŠé”‹åˆ©çš„æ‹†è§£ä¹‹å‰‘ï¼Œå°†åºæ‚çš„ä»£ç åˆ‡åˆ†æˆä¼˜é›…çš„æ¨¡å—ï¼Œè®©é£èˆ¹è½»ç›ˆèµ·èˆªã€‚

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ Webpack åˆ†åŒ…çš„åŸç†ã€ç­–ç•¥ä¸å®è·µï¼Œç»“åˆå¹½é»˜çš„ç±»æ¯”ã€ç”ŸåŠ¨çš„æ¡ˆä¾‹å’Œæ·±åˆ»çš„å“²å­¦æ€è€ƒï¼ŒåŠ©ä½ åœ¨æ€§èƒ½ä¼˜åŒ–çš„é“è·¯ä¸Šå¦‚é±¼å¾—æ°´ã€‚æ— è®ºä½ æ˜¯åˆšå…¥è¡Œçš„å°ç™½ï¼Œè¿˜æ˜¯èº«ç»ç™¾æˆ˜çš„è€å…µï¼Œè¿™ç¯‡åšå®¢éƒ½ä¼šè®©ä½ æœ‰æ‰€æ”¶è·ï¼Œç”šè‡³å¯èƒ½å¼•å‘ä½ å¯¹ä»£ç ã€èŒä¸šã€ä¹ƒè‡³äººç”Ÿçš„å…¨æ–°æ€è€ƒã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºä»ä»£ç åˆ°çµé­‚çš„æ‹†è§£ä¹‹æ—…ï¼ğŸŒŸ

## ä¸ºä»€ä¹ˆéœ€è¦åˆ†åŒ…ï¼Ÿä»â€œå¤§é”…é¥­â€åˆ°â€œç²¾è‡´ä¾¿å½“â€

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å»ä¸€å®¶é¤å…ç‚¹é¤ï¼ŒæœåŠ¡å‘˜ç«¯ä¸Šæ¥ä¸€ä¸ªå·¨å¤§çš„ç›˜å­ï¼Œé‡Œé¢å †æ»¡äº†ç±³é¥­ã€ç‰›è‚‰ã€è”¬èœã€ç”œç‚¹ï¼Œç”šè‡³è¿˜æœ‰ä¸€ç¢—æ±¤ã€‚æœåŠ¡å‘˜è¯´ï¼šâ€œå…¨åƒäº†å§ï¼Œåæ­£ä½ è¿Ÿæ—©è¦åƒã€‚â€ ä½ å¯èƒ½ä¼šä¸€è„¸æ‡µé€¼ï¼šæˆ‘åªæ˜¯æƒ³åƒä¸ªåˆé¥­ï¼Œä¸æ˜¯æ¥æŒ‘æˆ˜å‰å°¼æ–¯è®°å½•ï¼ğŸ˜…

å‰ç«¯å¼€å‘ä¸­çš„â€œå…¨å®¶æ¡¶â€æ‰“åŒ…æ–¹å¼å°±åƒè¿™ç›˜å¤§æ‚çƒ©ã€‚ä¼ ç»Ÿçš„ Webpack æ‰“åŒ…ä¼šå°†æ‰€æœ‰ä»£ç ï¼ˆåŒ…æ‹¬ä¸šåŠ¡é€»è¾‘ã€ç¬¬ä¸‰æ–¹åº“ã€è·¯ç”±é¡µé¢ç­‰ï¼‰å¡è¿›ä¸€ä¸ªå·¨å¤§çš„ `bundle.js` æ–‡ä»¶ï¼Œç”¨æˆ·åŠ è½½é¡µé¢æ—¶éœ€è¦ä¸€æ¬¡æ€§ä¸‹è½½è¿™ä¸ªâ€œå·¨æ— éœ¸â€ã€‚è¿™ä¸ä»…å¢åŠ äº†é¦–å±åŠ è½½æ—¶é—´ï¼Œè¿˜å¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

åˆ†åŒ…çš„æœ¬è´¨æ˜¯å°†è¿™ä¸ªâ€œå¤§é”…é¥­â€æ‹†åˆ†æˆå¤šä¸ªâ€œç²¾è‡´ä¾¿å½“â€ï¼šæŒ‰éœ€åŠ è½½ã€æŒ‰è·¯ç”±æ‹†åˆ†ã€æŒ‰åŠŸèƒ½æ¨¡å—åˆ†å‰²ã€‚è¿™æ ·ï¼Œç”¨æˆ·åªéœ€è¦åœ¨ç‰¹å®šåœºæ™¯ä¸‹åŠ è½½å¿…è¦çš„ä»£ç ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œè§£ææ—¶é—´ã€‚å°±åƒåœ¨é¤å…ç‚¹é¤ï¼Œä½ å¯ä»¥å…ˆåƒå‰èœï¼Œå†ä¸Šä¸»èœï¼Œæœ€åç”œç‚¹ï¼ŒèŠ‚å¥ä¼˜é›…ï¼Œä½“éªŒæä½³ã€‚

### åˆ†åŒ…çš„æ ¸å¿ƒä»·å€¼
1. **æå‡é¦–å±åŠ è½½é€Ÿåº¦**ï¼šé€šè¿‡åªåŠ è½½å¿…è¦çš„ä»£ç ï¼Œå‡å°‘åˆå§‹ `bundle` å¤§å°ï¼Œç¼©çŸ­ç™½å±æ—¶é—´ã€‚
2. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**ï¼šæ‡’åŠ è½½å’ŒåŠ¨æ€å¯¼å…¥è®©é¡µé¢äº¤äº’æ›´æµç•…ï¼Œé¿å…â€œå¡é¡¿äººç”Ÿâ€ã€‚
3. **é™ä½æœåŠ¡å™¨å‹åŠ›**ï¼šæŒ‰éœ€åŠ è½½å‡å°‘äº†ä¸å¿…è¦çš„èµ„æºè¯·æ±‚ï¼ŒèŠ‚çœå¸¦å®½ã€‚
4. **æé«˜å¼€å‘æ•ˆç‡**ï¼šæ¨¡å—åŒ–å¼€å‘è®©ä»£ç æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´ç®€å•ã€‚

> *â€œå¥½çš„ä»£ç å°±åƒå¥½çš„ç”Ÿæ´»ï¼šæ‹†å¾—æ¸…æ¥šï¼Œæ‰èƒ½æ´»å¾—æ˜ç™½ã€‚â€*

*Tipsï¼šåˆ†åŒ…ä¸ä»…æ˜¯æŠ€æœ¯ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯å¯¹ä»£ç ç»“æ„çš„åæ€ã€‚æ¯æ¬¡æ‹†åŒ…æ—¶ï¼Œé—®é—®è‡ªå·±ï¼šè¿™æ®µä»£ç çœŸçš„éœ€è¦åœ¨é¦–å±åŠ è½½å—ï¼Ÿ*

## Webpack åˆ†åŒ…çš„åŸç†ï¼šä»â€œé»‘ç›’â€åˆ°â€œé€æ˜æ‰‹æœ¯å®¤â€

è¦æŒæ¡åˆ†åŒ…ï¼Œé¦–å…ˆå¾—ææ¸…æ¥š Webpack çš„æ‰“åŒ…åŸç†ã€‚Webpack å°±åƒä¸€ä¸ªè¶…çº§å¨å¸ˆï¼ŒæŠŠä½ çš„ä»£ç ï¼ˆé£Ÿæï¼‰åŠ å·¥æˆä¸€ä¸ªä¸ª `bundle`ï¼ˆèœå“ï¼‰ã€‚ä½†å¦‚æœä¸è®¾ç½®åˆ†åŒ…è§„åˆ™ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰é£Ÿæä¸€è‚¡è„‘å„¿æ‰”è¿›ä¸€ä¸ªå¤§é”…ï¼Œç…®æˆä¸€é”…â€œä»£ç ç²¥â€ã€‚

### Webpack çš„æ¨¡å—è§£æä¸ä¾èµ–å›¾

Webpack çš„æ ¸å¿ƒæ˜¯æ„å»ºä¸€å¼ **ä¾èµ–å›¾ï¼ˆDependency Graphï¼‰**ã€‚å½“ä½ è¿è¡Œ `webpack` å‘½ä»¤æ—¶ï¼Œå®ƒä¼šï¼š
1. ä»å…¥å£æ–‡ä»¶ï¼ˆ`entry`ï¼‰å¼€å§‹ï¼Œè§£ææ‰€æœ‰ `import` æˆ– `require` çš„æ¨¡å—ã€‚
2. é€’å½’éå†æ¯ä¸ªæ¨¡å—çš„ä¾èµ–ï¼Œå½¢æˆä¸€æ£µä¾èµ–æ ‘ã€‚
3. å°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª `bundle` æ–‡ä»¶ã€‚

åˆ†åŒ…çš„æœ¬è´¨æ˜¯å¹²é¢„è¿™æ£µä¾èµ–æ ‘çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œé€šè¿‡é…ç½®æˆ–ä»£ç é€»è¾‘ï¼Œå°†æŸäº›æ¨¡å—â€œéš”ç¦»â€æˆç‹¬ç«‹çš„ `chunk`ï¼ˆä»£ç å—ï¼‰ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ã€‚

### åˆ†åŒ…çš„ä¸¤ç§æ–¹å¼
1. **é™æ€åˆ†åŒ…**ï¼šé€šè¿‡ Webpack é…ç½®ï¼ˆ`optimization.splitChunks`ï¼‰è‡ªåŠ¨æ‹†åˆ†å…¬å…±æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹åº“ã€‚
2. **åŠ¨æ€åˆ†åŒ…**ï¼šé€šè¿‡åŠ¨æ€å¯¼å…¥ï¼ˆ`import()`ï¼‰æˆ–æ‡’åŠ è½½å®ç°è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ã€‚

### åŠ¨æ€å¯¼å…¥çš„é­”æ³• âœ¨

åŠ¨æ€å¯¼å…¥æ˜¯åˆ†åŒ…çš„çµé­‚ï¼Œå®ƒåŸºäº ES Module çš„ `import()` è¯­æ³•ï¼Œè¿”å›ä¸€ä¸ª Promiseã€‚ä¾‹å¦‚ï¼š

```javascript
// åŠ¨æ€å¯¼å…¥ä¸€ä¸ªæ¨¡å—
import('./myModule').then(module => {
  module.doSomething();
});
```

å½“ Webpack é‡åˆ° `import()`ï¼Œå®ƒä¼šè‡ªåŠ¨å°† `myModule` æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„ `chunk`ï¼Œå¹¶åœ¨è¿è¡Œæ—¶é€šè¿‡ AJAX è¯·æ±‚åŠ è½½ã€‚è¿™å°±åƒä½ åœ¨é¤å…ç‚¹äº†ä¸€ä»½ç”œç‚¹ï¼Œå¨æˆ¿ç°åšç°é€ï¼Œè€Œä¸æ˜¯æå‰æŠŠç”œç‚¹å¡è¿›ä½ çš„ä¸»èœç›˜å­é‡Œã€‚

> *â€œåŠ¨æ€å¯¼å…¥å°±åƒäººç”Ÿçš„å»¶è¿Ÿæ»¡è¶³ï¼šåˆ«æ€¥ï¼Œå¥½çš„ä¸œè¥¿æ€»ä¼šåœ¨å¯¹çš„æ—¶æœºå‡ºç°ã€‚â€*

*Tipsï¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥æ—¶ï¼Œç¡®ä¿æ¨¡å—çš„ä½“ç§¯é€‚ä¸­ï¼Œè¿‡å°çš„æ¨¡å—å¯èƒ½å¢åŠ  HTTP è¯·æ±‚å¼€é”€ï¼Œå¾—ä¸å¿å¤±ã€‚*

## Webpack åˆ†åŒ…çš„å®æˆ˜ç­–ç•¥ ğŸ› ï¸

å¥½äº†ï¼ŒåŸç†è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ç¡¬æ ¸å®æˆ˜ç¯èŠ‚ï¼ä»¥ä¸‹æ˜¯ Webpack åˆ†åŒ…çš„äº”å¤§ç­–ç•¥ï¼Œæ¶µç›–é…ç½®ã€ä»£ç å®ç°å’Œæœ€ä½³å®è·µã€‚æ¯ä¸ªç­–ç•¥éƒ½é…æœ‰æ¡ˆä¾‹å’Œè¡¨æ ¼ï¼ŒåŠ›æ±‚è®©ä½ ä¸€çœ‹å°±æ‡‚ï¼Œä¸€ç”¨å°±ä¼šã€‚

### ç­–ç•¥ 1ï¼šåˆ©ç”¨ `optimization.splitChunks` æ‹†åˆ†å…¬å…±æ¨¡å—

`optimization.splitChunks` æ˜¯ Webpack 4 å¼•å…¥çš„å¼ºå¤§åŠŸèƒ½ï¼Œç”¨äºè‡ªåŠ¨æ‹†åˆ†å…¬å…±æ¨¡å—å’Œç¬¬ä¸‰æ–¹åº“ã€‚å®ƒçš„é»˜è®¤é…ç½®å·²ç»å¾ˆæ™ºèƒ½ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è§„åˆ™è®©å®ƒæ›´ç¬¦åˆé¡¹ç›®éœ€æ±‚ã€‚

#### ç¤ºä¾‹é…ç½®
å‡è®¾ä½ æœ‰ä¸€ä¸ª React é¡¹ç›®ï¼ŒåŒ…å«å¤šä¸ªé¡µé¢ï¼Œä¾èµ– `react`ã€`react-dom` å’Œ `lodash` ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚ä½ å¸Œæœ›å°†è¿™äº›åº“å•ç‹¬æ‰“åŒ…ï¼Œå‡å°‘ä¸» `bundle` çš„ä½“ç§¯ã€‚

```javascript
module.exports = {
  entry: {
    app: './src/index.js',
  },
  output: {
    filename: '[name].[contenthash].js',
    chunkFilename: '[name].[contenthash].js',
    path: path.resolve(__dirname, 'dist'),
  },
  optimization: {
    splitChunks: {
      chunks: 'all', // å¯¹æ‰€æœ‰æ¨¡å—ç”Ÿæ•ˆ
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/, // åŒ¹é… node_modules ä¸­çš„æ¨¡å—
          name: 'vendors', // è¾“å‡ºæ–‡ä»¶å
          priority: -10, // ä¼˜å…ˆçº§
        },
        default: {
          minChunks: 2, // è‡³å°‘è¢«å¼•ç”¨ 2 æ¬¡æ‰æ‹†åˆ†
          priority: -20,
          reuseExistingChunk: true, // å¤ç”¨å·²æœ‰çš„ chunk
        },
      },
    },
  },
};
```

#### æ•ˆæœåˆ†æ
è¿è¡Œ `webpack` åï¼ŒWebpack ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š
- `app.[hash].js`ï¼šä¸šåŠ¡ä»£ç 
- `vendors.[hash].js`ï¼šç¬¬ä¸‰æ–¹åº“ï¼ˆ`react`ã€`react-dom`ã€`lodash` ç­‰ï¼‰
- å…¶ä»–åŠ¨æ€ `chunk`ï¼ˆå¦‚åŠ¨æ€å¯¼å…¥çš„æ¨¡å—ï¼‰

#### é…ç½®å‚æ•°è¯¦è§£
ä»¥ä¸‹æ˜¯ `splitChunks` çš„æ ¸å¿ƒå‚æ•°è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€Ÿä¸Šæ‰‹ï¼š

| å‚æ•°å            | è¯´æ˜                                                                 | é»˜è®¤å€¼       | æ¨èåœºæ™¯                     |
|-------------------|----------------------------------------------------------------------|--------------|------------------------------|
| `chunks`          | æŒ‡å®šåˆ†åŒ…çš„æ¨¡å—èŒƒå›´ï¼ˆ`all`ã€`async`ã€`initial`ï¼‰                      | `async`      | `all` é€‚ç”¨äºå¤§å¤šæ•°é¡¹ç›®       |
| `minSize`         | æ‹†åˆ†åçš„ chunk æœ€å°ä½“ç§¯ï¼ˆå­—èŠ‚ï¼‰                                      | 30000        | å°é¡¹ç›®å¯è°ƒä½è‡³ 10000         |
| `maxSize`         | æ‹†åˆ†åçš„ chunk æœ€å¤§ä½“ç§¯ï¼ˆå­—èŠ‚ï¼‰ï¼Œè¶…å¤§ chunk ä¼šè¿›ä¸€æ­¥æ‹†åˆ†             | 0ï¼ˆä¸é™åˆ¶ï¼‰  | å¤§é¡¹ç›®å¯è®¾ä¸º 244000ï¼ˆçº¦ 244KBï¼‰ |
| `minChunks`       | æ¨¡å—è¢«å¼•ç”¨æ¬¡æ•°çš„æœ€å°å€¼ï¼Œä½äºæ­¤å€¼ä¸æ‹†åˆ†                              | 1            | è®¾ä¸º 2 é¿å…è¿‡åº¦æ‹†åˆ†          |
| `cacheGroups`     | å®šä¹‰æ‹†åˆ†è§„åˆ™çš„åˆ†ç»„ï¼Œå¯è‡ªå®šä¹‰ `test`ã€`name`ã€`priority` ç­‰           | -            | ç”¨äºåˆ†ç¦» vendors å’Œä¸šåŠ¡æ¨¡å—  |

#### æœ€ä½³å®è·µ
- **æå–ç¬¬ä¸‰æ–¹åº“**ï¼šå°† `node_modules` ä¸­çš„æ¨¡å—æ‰“åŒ…åˆ° `vendors` chunkï¼Œæ–¹ä¾¿æµè§ˆå™¨ç¼“å­˜ã€‚
- **æ§åˆ¶ chunk å¤§å°**ï¼šè®¾ç½® `maxSize` é¿å…å•ä¸ª chunk è¿‡å¤§ï¼ˆå¦‚è¶…è¿‡ 244KBï¼Œå¯èƒ½è§¦å‘æµè§ˆå™¨ç¼“å­˜é™åˆ¶ï¼‰ã€‚
- **å¤ç”¨ chunk**ï¼šå¯ç”¨ `reuseExistingChunk` å‡å°‘é‡å¤æ‰“åŒ…ã€‚

> *â€œå¥½çš„åˆ†åŒ…å°±åƒå¥½çš„å›¢é˜Ÿåˆ†å·¥ï¼šæ¯ä¸ªäººï¼ˆæ¨¡å—ï¼‰å„å¸å…¶èŒï¼Œåä½œæ— é—´ã€‚â€*

*Tipsï¼šå®šæœŸæ£€æŸ¥ `vendors` chunk çš„ä½“ç§¯ï¼Œå¦‚æœå‘ç°æŸä¸ªåº“ï¼ˆå¦‚ `moment.js`ï¼‰ä½“ç§¯è¿‡å¤§ï¼Œè€ƒè™‘æ›¿æ¢ä¸ºè½»é‡çº§æ›¿ä»£å“ï¼ˆå¦‚ `day.js`ï¼‰ã€‚*

### ç­–ç•¥ 2ï¼šåŠ¨æ€å¯¼å…¥ä¸æ‡’åŠ è½½

åŠ¨æ€å¯¼å…¥æ˜¯å®ç°æŒ‰éœ€åŠ è½½çš„æ€æ‰‹é”ï¼Œç‰¹åˆ«é€‚åˆè·¯ç”±çº§åˆ†åŒ…å’Œç»„ä»¶çº§æ‡’åŠ è½½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª React é¡¹ç›®çš„è·¯ç”±åˆ†åŒ…ç¤ºä¾‹ã€‚

#### ç¤ºä¾‹ä»£ç 
å‡è®¾ä½ æœ‰ä¸€ä¸ª React å•é¡µåº”ç”¨ï¼ŒåŒ…å« `Home`ã€`About` å’Œ `Contact` ä¸‰ä¸ªé¡µé¢ã€‚ä½ å¸Œæœ›åªæœ‰åœ¨è®¿é—®ç‰¹å®šè·¯ç”±æ—¶æ‰åŠ è½½å¯¹åº”çš„é¡µé¢ä»£ç ã€‚

```javascript
import React, { lazy, Suspense } from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';

// åŠ¨æ€å¯¼å…¥é¡µé¢ç»„ä»¶
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));
const Contact = lazy(() => import('./pages/Contact'));

function App() {
  return (
    <Router>
      <Suspense fallback={<div>Loading...</div>}>
        <Switch>
          <Route exact path="/" component={Home} />
          <Route path="/about" component={About} />
          <Route path="/contact" component={Contact} />
        </Switch>
      </Suspense>
    </Router>
  );
}

export default App;
```

#### Webpack é…ç½®
ç¡®ä¿ Webpack èƒ½æ­£ç¡®å¤„ç†åŠ¨æ€å¯¼å…¥ï¼š

```javascript
module.exports = {
  output: {
    chunkFilename: '[name].[contenthash].js', // åŠ¨æ€ chunk çš„å‘½åè§„åˆ™
  },
};
```

#### æ•ˆæœåˆ†æ
è¿è¡Œåï¼ŒWebpack ä¼šä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆç‹¬ç«‹çš„ chunkï¼š
- `home.[hash].js`
- `about.[hash].js`
- `contact.[hash].js`

å½“ç”¨æˆ·è®¿é—® `/about` æ—¶ï¼Œåªæœ‰ `about.[hash].js` ä¼šè¢«åŠ è½½ï¼Œæå¤§å‡å°‘äº†é¦–å±åŠ è½½çš„ä»£ç é‡ã€‚

#### æœ€ä½³å®è·µ
- **ä½¿ç”¨ `Suspense`**ï¼šä¸ºæ‡’åŠ è½½ç»„ä»¶æä¾› `fallback` UIï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
- **é¢„åŠ è½½ä¼˜åŒ–**ï¼šç»“åˆ `React.lazy` å’Œ `preload` æŠ€æœ¯ï¼Œæå‰åŠ è½½é«˜ä¼˜å…ˆçº§ chunkã€‚
- **é”™è¯¯è¾¹ç•Œ**ï¼šä¸ºåŠ¨æ€å¯¼å…¥æ·»åŠ é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢åŠ è½½å¤±è´¥å¯¼è‡´é¡µé¢å´©æºƒã€‚

```javascript
const About = lazy(() =>
  import('./pages/About').catch(() => ({
    default: () => <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>,
  }))
);
```

> *â€œæ‡’åŠ è½½å°±åƒäººç”Ÿçš„é€‰æ‹©ï¼šä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½éœ€è¦ç«‹åˆ»æ‹¥æœ‰ï¼Œå­¦ä¼šç­‰å¾…ï¼Œæ‰èƒ½æ‹¥æŠ±æ›´å¥½çš„æœªæ¥ã€‚â€*

*Tipsï¼šä¸ºåŠ¨æ€å¯¼å…¥çš„ chunk æ·»åŠ  `webpackChunkName` æ³¨é‡Šï¼Œç”Ÿæˆæ›´æœ‰æ„ä¹‰çš„ chunk åï¼Œä¾‹å¦‚ `/* webpackChunkName: "about" */ import('./pages/About')`ã€‚*

### ç­–ç•¥ 3ï¼šTree Shaking ä¸æŒ‰éœ€åŠ è½½

Tree Shaking æ˜¯ Webpack çš„å¦ä¸€å¤§åˆ©å™¨ï¼Œç”¨äºç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼ˆDead Codeï¼‰ã€‚ç»“åˆæŒ‰éœ€åŠ è½½ï¼Œå®ƒèƒ½è¿›ä¸€æ­¥å‡å°‘ chunk ä½“ç§¯ã€‚

#### ç¤ºä¾‹ï¼šæŒ‰éœ€åŠ è½½ Ant Design
Ant Design æ˜¯ä¸€ä¸ªæµè¡Œçš„ React UI åº“ï¼Œä½†å®ƒçš„å®Œæ•´åŒ…ä½“ç§¯è¾ƒå¤§ã€‚é€šè¿‡æŒ‰éœ€åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥åªå¼•å…¥ç”¨åˆ°çš„ç»„ä»¶ã€‚

1. å®‰è£… `babel-plugin-import`ï¼š
```bash
npm install babel-plugin-import --save-dev
```

2. é…ç½® Babelï¼š
```javascript
// .babelrc
{
  "plugins": [
    [
      "import",
      {
        "libraryName": "antd",
        "libraryDirectory": "es",
        "style": true
      }
    ]
  ]
}
```

3. ä½¿ç”¨æŒ‰éœ€å¯¼å…¥ï¼š
```javascript
import { Button, Modal } from 'antd'; // ä»…å¯¼å…¥ Button å’Œ Modal
```

#### æ•ˆæœåˆ†æ
æœªä¼˜åŒ–å‰ï¼Œæ•´ä¸ª `antd` åŒ…å¯èƒ½è¢«æ‰“åŒ…è¿› `vendors` chunkï¼Œä½“ç§¯é«˜è¾¾ 1MB+ã€‚ä¼˜åŒ–åï¼Œåªæœ‰ `Button` å’Œ `Modal` ç›¸å…³çš„ä»£ç è¢«æ‰“åŒ…ï¼Œä½“ç§¯å¯èƒ½ç¼©å‡è‡³ 100KB ä»¥ä¸‹ã€‚

#### æœ€ä½³å®è·µ
- **æ£€æŸ¥ Tree Shaking æ•ˆæœ**ï¼šä½¿ç”¨ `webpack-bundle-analyzer` åˆ†ææ‰“åŒ…ç»“æœï¼Œç¡®ä¿æ— ç”¨ä»£ç è¢«ç§»é™¤ã€‚
- **é¿å…å‰¯ä½œç”¨**ï¼šåœ¨ `package.json` ä¸­è®¾ç½® `"sideEffects": false`ï¼Œå‘Šè¯‰ Webpack å“ªäº›æ¨¡å—å¯ä»¥å®‰å…¨ Tree Shakingã€‚
- **åŠ¨æ€å¯¼å…¥å¤§ç»„ä»¶**ï¼šå¯¹äºä½“ç§¯è¾ƒå¤§çš„ç»„ä»¶ï¼ˆå¦‚å›¾è¡¨åº“ï¼‰ï¼Œç»“åˆåŠ¨æ€å¯¼å…¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

> *â€œTree Shaking å°±åƒæ–­èˆç¦»ï¼šæ‰”æ‰ä¸éœ€è¦çš„ä»£ç ï¼Œç”Ÿæ´»æ‰èƒ½æ›´è½»ç›ˆã€‚â€*

*Tipsï¼šå®šæœŸè¿è¡Œ `npm dedupe` æ¸…ç†é‡å¤ä¾èµ–ï¼Œç»“åˆ Tree Shaking æ•ˆæœæ›´ä½³ã€‚*

### ç­–ç•¥ 4ï¼šåˆ†åŒ…ä¸ç¼“å­˜ç­–ç•¥ç»“åˆ

åˆ†åŒ…çš„ç»ˆæç›®æ ‡æ˜¯è®©ç”¨æˆ·åŠ è½½æ›´å°‘çš„ä»£ç ï¼Œè€Œç¼“å­˜ç­–ç•¥èƒ½è®©ç”¨æˆ·é‡å¤è®¿é—®æ—¶â€œå‡ ä¹ä¸åŠ è½½â€ã€‚é€šè¿‡åˆç†çš„æ–‡ä»¶åå’Œ `Cache-Control` å¤´ï¼Œæˆ‘ä»¬å¯ä»¥æœ€å¤§åŒ–ç¼“å­˜å‘½ä¸­ç‡ã€‚

#### ç¤ºä¾‹é…ç½®
```javascript
module.exports = {
  output: {
    filename: '[name].[contenthash].js', // ä½¿ç”¨ contenthash ç¡®ä¿æ–‡ä»¶å†…å®¹ä¸å˜æ—¶æ–‡ä»¶åä¸å˜
    chunkFilename: '[name].[contenthash].js',
  },
};
```

#### ç¼“å­˜ç­–ç•¥
åœ¨æœåŠ¡å™¨ç«¯é…ç½® `Cache-Control`ï¼š
- ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `vendors.[hash].js`ï¼‰ï¼š`Cache-Control: public, max-age=31536000`ï¼ˆä¸€å¹´ï¼‰
- ä¸šåŠ¡ä»£ç ï¼ˆå¦‚ `app.[hash].js`ï¼‰ï¼š`Cache-Control: public, max-age=3600`ï¼ˆä¸€å°æ—¶ï¼‰

#### æ•ˆæœåˆ†æ
- ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶ï¼Œä¸‹è½½æ‰€æœ‰ chunk å¹¶ç¼“å­˜ã€‚
- ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œæµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜è¯»å–æœªå˜æ›´çš„ chunkï¼ˆå¦‚ `vendors.[hash].js`ï¼‰ï¼Œåªéœ€åŠ è½½å˜æ›´çš„ä¸šåŠ¡ä»£ç ã€‚

#### æœ€ä½³å®è·µ
- **ä½¿ç”¨ `contenthash`**ï¼šç›¸æ¯” `chunkhash`ï¼Œ`contenthash` æ›´ç²¾å‡†ï¼Œé¿å…æ— å…³æ¨¡å—å˜æ›´å¯¼è‡´æ–‡ä»¶åå˜åŒ–ã€‚
- **åˆ†ç¦» CSS**ï¼šä½¿ç”¨ `mini-css-extract-plugin` å°† CSS å•ç‹¬æ‰“åŒ…ï¼Œç»“åˆ `contenthash` å®ç°ç‹¬ç«‹ç¼“å­˜ã€‚
- **CDN åŠ é€Ÿ**ï¼šå°† chunk éƒ¨ç½²åˆ° CDNï¼Œå‡å°‘åŠ è½½å»¶è¿Ÿã€‚

> *â€œå¥½çš„ç¼“å­˜ç­–ç•¥å°±åƒäººç”Ÿçš„ç§¯ç´¯ï¼šå‰æœŸå¤šåŠªåŠ›ï¼ŒåæœŸäº«å›æŠ¥ã€‚â€*

*Tipsï¼šä½¿ç”¨ `workbox` æˆ– `service-worker` å®ç°ç¦»çº¿ç¼“å­˜ï¼Œè®©ç”¨æˆ·åœ¨æ–­ç½‘æ—¶ä¹Ÿèƒ½è®¿é—®é™æ€èµ„æºã€‚*

### ç­–ç•¥ 5ï¼šåˆ†åŒ…åçš„æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–

åˆ†åŒ…ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œåˆ†åŒ…åçš„æ€§èƒ½éœ€è¦æŒç»­ç›‘æ§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®ç”¨çš„ç›‘æ§å·¥å…·å’Œä¼˜åŒ–æŠ€å·§ã€‚

#### å·¥å…·æ¨è
| å·¥å…·å                     | åŠŸèƒ½                                                         | æ¨èåœºæ™¯                     |
|----------------------------|--------------------------------------------------------------|------------------------------|
| `webpack-bundle-analyzer`  | åˆ†æ bundle ç»„æˆï¼Œç”Ÿæˆå¯è§†åŒ–ä¾èµ–å›¾                           | é¡¹ç›®åˆæœŸä¼˜åŒ–å’Œå®šæœŸæ£€æŸ¥       |
| `Lighthouse`               | æä¾›æ€§èƒ½ã€SEO å’Œå¯è®¿é—®æ€§æŠ¥å‘Š                                 | é¦–å±æ€§èƒ½ä¼˜åŒ–                 |
| `web-vitals`               | ç›‘æ§æ ¸å¿ƒ Web æŒ‡æ ‡ï¼ˆå¦‚ LCPã€FIDã€CLSï¼‰                        | ç”Ÿäº§ç¯å¢ƒç”¨æˆ·ä½“éªŒç›‘æ§         |

#### ä¼˜åŒ–æŠ€å·§
- **åˆ†æ chunk ä¾èµ–**ï¼šä½¿ç”¨ `webpack-bundle-analyzer` æ£€æŸ¥æ˜¯å¦æœ‰æ„å¤–çš„é‡å¤ä¾èµ–ã€‚
- **ç›‘æ§åŠ è½½æ—¶é—´**ï¼šé€šè¿‡ `Performance API` è®°å½•åŠ¨æ€ chunk çš„åŠ è½½è€—æ—¶ï¼Œä¼˜åŒ–æ…¢åŠ è½½æ¨¡å—ã€‚
- **A/B æµ‹è¯•**ï¼šå°è¯•ä¸åŒçš„åˆ†åŒ…ç­–ç•¥ï¼ˆå¦‚æŒ‰è·¯ç”±æ‹†åˆ† vs. æŒ‰åŠŸèƒ½æ‹†åˆ†ï¼‰ï¼Œå¯¹æ¯”æ€§èƒ½æ•°æ®ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `web-vitals`
```javascript
import { getLCP, getFID, getCLS } from 'web-vitals';

getLCP(console.log);
getFID(console.log);
getCLS(console.log);
```

> *â€œæ€§èƒ½ä¼˜åŒ–å°±åƒä¿®ç¦…ï¼šä¸æ–­è§‚å¯Ÿã€è°ƒæ•´ï¼Œæ‰èƒ½æ¥è¿‘å®Œç¾ã€‚â€*

*Tipsï¼šå°†æ€§èƒ½æ•°æ®ä¸ŠæŠ¥åˆ°åç«¯ï¼ˆå¦‚é€šè¿‡ `Sentry`ï¼‰ï¼Œä¾¿äºé•¿æœŸè·Ÿè¸ªå’Œåˆ†æã€‚*

## åˆ†åŒ…çš„å“²å­¦æ€è€ƒï¼šä»ä»£ç åˆ°äººç”Ÿ

åˆ†åŒ…ä¸ä»…ä»…æ˜¯æŠ€æœ¯æ‰‹æ®µï¼Œå®ƒè¿˜è•´å«ç€æ·±åˆ»çš„å“²å­¦æ™ºæ…§ã€‚ä»£ç çš„åˆ†åŒ…å°±åƒäººç”Ÿçš„æ‹†è§£ï¼šæˆ‘ä»¬ä¸å¯èƒ½ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦åœ¨æ¯æ—¶æ¯åˆ»èƒŒè´Ÿæ‰€æœ‰è´Ÿæ‹…ã€‚å­¦ä¼šå°†ä»»åŠ¡ã€ç›®æ ‡å’Œæƒ…ç»ªæ‹†åˆ†æˆå°å—ï¼ŒæŒ‰éœ€å¤„ç†ï¼Œæ‰èƒ½æ´»å¾—æ›´ä»å®¹ã€‚

> â€œæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”Ÿæ´»çš„å…¨éƒ¨ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€‰æ‹©åŠ è½½å“ªäº›éƒ¨åˆ†ã€‚â€ â€”â€” æ™“é¾™

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œåˆ†åŒ…è®©æˆ‘ä»¬å­¦ä¼šäº†å–èˆå’Œä¼˜å…ˆçº§ç®¡ç†ï¼›åœ¨ç”Ÿæ´»ä¸­ï¼Œåˆ†åŒ…è®©æˆ‘ä»¬å­¦ä¼šäº†ä¸“æ³¨å’Œå»¶è¿Ÿæ»¡è¶³ã€‚æ— è®ºæ˜¯ä¼˜åŒ–ä¸€ä¸ªå¤§å‹ React åº”ç”¨ï¼Œè¿˜æ˜¯è§„åˆ’ä¸€æ®µèŒä¸šç”Ÿæ¶¯ï¼Œæ‹†è§£çš„è‰ºæœ¯éƒ½æ˜¯é€šå¾€æˆåŠŸçš„é’¥åŒ™ã€‚

## æ€»ç»“ï¼šåˆ†åŒ…çš„è‰ºæœ¯ä¸æœªæ¥

é€šè¿‡ `optimization.splitChunks`ã€åŠ¨æ€å¯¼å…¥ã€Tree Shakingã€ç¼“å­˜ç­–ç•¥å’Œæ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥å°† Webpack çš„åˆ†åŒ…ä¼˜åŒ–åšåˆ°æè‡´ã€‚è¿™äº›ç­–ç•¥ä¸ä»…æå‡äº†åº”ç”¨çš„æ€§èƒ½ï¼Œè¿˜è®©æˆ‘ä»¬åœ¨ä»£ç çš„æµ·æ´‹ä¸­æ‰¾åˆ°äº†ä¸€ä¸ç§©åºã€‚

æœªæ¥ï¼Œéšç€ Webpack 5 çš„æ™®åŠå’Œ ES Module çš„è¿›ä¸€æ­¥å‘å±•ï¼Œåˆ†åŒ…æŠ€æœ¯å°†å˜å¾—æ›´åŠ æ™ºèƒ½å’Œè‡ªåŠ¨åŒ–ã€‚ä¾‹å¦‚ï¼ŒWebpack 5 çš„ `Module Federation` è®©å¤šä¸ªåº”ç”¨å…±äº«æ¨¡å—ï¼Œä¸ºå¾®å‰ç«¯å’Œåˆ†å¸ƒå¼å¼€å‘å¼€è¾Ÿäº†æ–°å¤©åœ°ã€‚è€Œåƒ `esbuild` å’Œ `Vite` è¿™æ ·çš„æ–°å…´å·¥å…·ï¼Œä¹Ÿåœ¨æŒ‘æˆ˜ Webpack çš„åœ°ä½ï¼Œä¿ƒä½¿å®ƒä¸æ–­è¿›åŒ–ã€‚

æ— è®ºæŠ€æœ¯å¦‚ä½•å˜è¿ï¼Œåˆ†åŒ…çš„æ ¸å¿ƒç†å¿µâ€”â€”**åŒ–ç¹ä¸ºç®€ï¼ŒæŒ‰éœ€åŠ è½½**â€”â€”å°†å§‹ç»ˆæ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºçŸ³ã€‚å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½æˆä¸ºä½ ä¼˜åŒ– Webpack é¡¹ç›®çš„ç¯å¡”ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½åœ¨ä»£ç ä¸äººç”Ÿçš„æ‹†è§£ä¸­ï¼Œæ‰¾åˆ°å±äºè‡ªå·±çš„èŠ‚å¥ä¸ä¼˜é›…ã€‚

> *â€œä»£ç å¦‚äººç”Ÿï¼Œæ‹†å¾—ç²¾å½©ï¼Œæ‰èƒ½æ´»å¾—ç—›å¿«ï¼â€*

```mdx
---
title: "Webpackæ€§èƒ½ä¼˜åŒ–ä¹‹åˆ†åŒ…ï¼šä»ä»£ç åˆ°äººç”Ÿçš„æ‹†è§£è‰ºæœ¯"
date: "2025-04-16"
description: "æ·±å…¥æ¢è®¨ Webpack åˆ†åŒ…ç­–ç•¥ï¼Œæ¶µç›–åŸç†ã€å®è·µã€æ¡ˆä¾‹ä¸ä¼˜åŒ–æŠ€å·§ï¼Œç»“åˆå“²å­¦æ€è€ƒä¸å¹½é»˜è¡¨è¾¾ï¼ŒåŠ©åŠ›å‰ç«¯å¼€å‘è€…æå‡æ€§èƒ½ä¸å¿ƒæ™ºã€‚"
keywords: "Webpack, åˆ†åŒ…, ä»£ç åˆ†å‰², æ€§èƒ½ä¼˜åŒ–, å‰ç«¯å¼€å‘, æ‡’åŠ è½½, åŠ¨æ€å¯¼å…¥, æ„å»ºå·¥å…·"
author: "æ™“é¾™"
image: "/images/hero/webpack-split.jpg"
tags: ["Webpack", "æ€§èƒ½ä¼˜åŒ–", "å‰ç«¯å¼€å‘", "JavaScript"]
category: "å‰ç«¯å·¥ç¨‹åŒ–"
---

# Webpackæ€§èƒ½ä¼˜åŒ–ä¹‹åˆ†åŒ…ï¼šä»ä»£ç åˆ°äººç”Ÿçš„æ‹†è§£è‰ºæœ¯ ğŸš€

> â€œç”Ÿæ´»å°±åƒä¸€å †ä»£ç ï¼Œæ‹†å¾—ä¸å¥½ï¼Œå°±ä¼šå¡é¡¿ã€‚â€ â€”â€” æŸä¸çŸ¥åå‰ç«¯å¼€å‘è€…

åœ¨å‰ç«¯å¼€å‘çš„æµ©ç€šå®‡å®™ä¸­ï¼ŒWebpack å°±åƒä¸€è‰˜å·¨å‹é£èˆ¹ï¼Œæ‰¿è½½ç€æˆ‘ä»¬çš„ä»£ç ã€èµ„æºå’Œæ¢¦æƒ³ï¼Œé©¶å‘ç”¨æˆ·æµè§ˆå™¨çš„å½¼å²¸ã€‚ç„¶è€Œï¼Œå½“é£èˆ¹è£…è½½è¿‡å¤šè´§ç‰©ï¼ˆä»£ç ã€åº“ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œå®ƒçš„é€Ÿåº¦ä¼šå˜å¾—åƒä¹Œé¾Ÿçˆ¬è¡Œï¼Œç”šè‡³å¯èƒ½å æ¯ã€‚è¿™æ—¶ï¼Œåˆ†åŒ…ï¼ˆCode Splittingï¼‰å°±å¦‚åŒä¸€æŠŠé”‹åˆ©çš„æ‹†è§£ä¹‹å‰‘ï¼Œå°†åºæ‚çš„ä»£ç åˆ‡åˆ†æˆä¼˜é›…çš„æ¨¡å—ï¼Œè®©é£èˆ¹è½»ç›ˆèµ·èˆªã€‚

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ Webpack åˆ†åŒ…çš„åŸç†ã€ç­–ç•¥ä¸å®è·µï¼Œç»“åˆå¹½é»˜çš„ç±»æ¯”ã€ç”ŸåŠ¨çš„æ¡ˆä¾‹å’Œæ·±åˆ»çš„å“²å­¦æ€è€ƒï¼ŒåŠ©ä½ åœ¨æ€§èƒ½ä¼˜åŒ–çš„é“è·¯ä¸Šå¦‚é±¼å¾—æ°´ã€‚æ— è®ºä½ æ˜¯åˆšå…¥è¡Œçš„å°ç™½ï¼Œè¿˜æ˜¯èº«ç»ç™¾æˆ˜çš„è€å…µï¼Œè¿™ç¯‡åšå®¢éƒ½ä¼šè®©ä½ æœ‰æ‰€æ”¶è·ï¼Œç”šè‡³å¯èƒ½å¼•å‘ä½ å¯¹ä»£ç ã€èŒä¸šã€ä¹ƒè‡³äººç”Ÿçš„å…¨æ–°æ€è€ƒã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹è¿™åœºä»ä»£ç åˆ°çµé­‚çš„æ‹†è§£ä¹‹æ—…ï¼ğŸŒŸ

## ä¸ºä»€ä¹ˆéœ€è¦åˆ†åŒ…ï¼Ÿä»â€œå¤§é”…é¥­â€åˆ°â€œç²¾è‡´ä¾¿å½“â€

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å»ä¸€å®¶é¤å…ç‚¹é¤ï¼ŒæœåŠ¡å‘˜ç«¯ä¸Šæ¥ä¸€ä¸ªå·¨å¤§çš„ç›˜å­ï¼Œé‡Œé¢å †æ»¡äº†ç±³é¥­ã€ç‰›è‚‰ã€è”¬èœã€ç”œç‚¹ï¼Œç”šè‡³è¿˜æœ‰ä¸€ç¢—æ±¤ã€‚æœåŠ¡å‘˜è¯´ï¼šâ€œå…¨åƒäº†å§ï¼Œåæ­£ä½ è¿Ÿæ—©è¦åƒã€‚â€ ä½ å¯èƒ½ä¼šä¸€è„¸æ‡µé€¼ï¼šæˆ‘åªæ˜¯æƒ³åƒä¸ªåˆé¥­ï¼Œä¸æ˜¯æ¥æŒ‘æˆ˜å‰å°¼æ–¯è®°å½•ï¼ğŸ˜…

å‰ç«¯å¼€å‘ä¸­çš„â€œå…¨å®¶æ¡¶â€æ‰“åŒ…æ–¹å¼å°±åƒè¿™ç›˜å¤§æ‚çƒ©ã€‚ä¼ ç»Ÿçš„ Webpack æ‰“åŒ…ä¼šå°†æ‰€æœ‰ä»£ç ï¼ˆåŒ…æ‹¬ä¸šåŠ¡é€»è¾‘ã€ç¬¬ä¸‰æ–¹åº“ã€è·¯ç”±é¡µé¢ç­‰ï¼‰å¡è¿›ä¸€ä¸ªå·¨å¤§çš„ `bundle.js` æ–‡ä»¶ï¼Œç”¨æˆ·åŠ è½½é¡µé¢æ—¶éœ€è¦ä¸€æ¬¡æ€§ä¸‹è½½è¿™ä¸ªâ€œå·¨æ— éœ¸â€ã€‚è¿™ä¸ä»…å¢åŠ äº†é¦–å±åŠ è½½æ—¶é—´ï¼Œè¿˜å¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

åˆ†åŒ…çš„æœ¬è´¨æ˜¯å°†è¿™ä¸ªâ€œå¤§é”…é¥­â€æ‹†åˆ†æˆå¤šä¸ªâ€œç²¾è‡´ä¾¿å½“â€ï¼šæŒ‰éœ€åŠ è½½ã€æŒ‰è·¯ç”±æ‹†åˆ†ã€æŒ‰åŠŸèƒ½æ¨¡å—åˆ†å‰²ã€‚è¿™æ ·ï¼Œç”¨æˆ·åªéœ€è¦åœ¨ç‰¹å®šåœºæ™¯ä¸‹åŠ è½½å¿…è¦çš„ä»£ç ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚å’Œè§£ææ—¶é—´ã€‚å°±åƒåœ¨é¤å…ç‚¹é¤ï¼Œä½ å¯ä»¥å…ˆåƒå‰èœï¼Œå†ä¸Šä¸»èœï¼Œæœ€åç”œç‚¹ï¼ŒèŠ‚å¥ä¼˜é›…ï¼Œä½“éªŒæä½³ã€‚

### åˆ†åŒ…çš„æ ¸å¿ƒä»·å€¼
1. **æå‡é¦–å±åŠ è½½é€Ÿåº¦**ï¼šé€šè¿‡åªåŠ è½½å¿…è¦çš„ä»£ç ï¼Œå‡å°‘åˆå§‹ `bundle` å¤§å°ï¼Œç¼©çŸ­ç™½å±æ—¶é—´ã€‚
2. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**ï¼šæ‡’åŠ è½½å’ŒåŠ¨æ€å¯¼å…¥è®©é¡µé¢äº¤äº’æ›´æµç•…ï¼Œé¿å…â€œå¡é¡¿äººç”Ÿâ€ã€‚
3. **é™ä½æœåŠ¡å™¨å‹åŠ›**ï¼šæŒ‰éœ€åŠ è½½å‡å°‘äº†ä¸å¿…è¦çš„èµ„æºè¯·æ±‚ï¼ŒèŠ‚çœå¸¦å®½ã€‚
4. **æé«˜å¼€å‘æ•ˆç‡**ï¼šæ¨¡å—åŒ–å¼€å‘è®©ä»£ç æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´ç®€å•ã€‚

> *â€œå¥½çš„ä»£ç å°±åƒå¥½çš„ç”Ÿæ´»ï¼šæ‹†å¾—æ¸…æ¥šï¼Œæ‰èƒ½æ´»å¾—æ˜ç™½ã€‚â€*

*Tipsï¼šåˆ†åŒ…ä¸ä»…æ˜¯æŠ€æœ¯ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯å¯¹ä»£ç ç»“æ„çš„åæ€ã€‚æ¯æ¬¡æ‹†åŒ…æ—¶ï¼Œé—®é—®è‡ªå·±ï¼šè¿™æ®µä»£ç çœŸçš„éœ€è¦åœ¨é¦–å±åŠ è½½å—ï¼Ÿ*

## Webpack åˆ†åŒ…çš„åŸç†ï¼šä»â€œé»‘ç›’â€åˆ°â€œé€æ˜æ‰‹æœ¯å®¤â€

è¦æŒæ¡åˆ†åŒ…ï¼Œé¦–å…ˆå¾—ææ¸…æ¥š Webpack çš„æ‰“åŒ…åŸç†ã€‚Webpack å°±åƒä¸€ä¸ªè¶…çº§å¨å¸ˆï¼ŒæŠŠä½ çš„ä»£ç ï¼ˆé£Ÿæï¼‰åŠ å·¥æˆä¸€ä¸ªä¸ª `bundle`ï¼ˆèœå“ï¼‰ã€‚ä½†å¦‚æœä¸è®¾ç½®åˆ†åŒ…è§„åˆ™ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰é£Ÿæä¸€è‚¡è„‘å„¿æ‰”è¿›ä¸€ä¸ªå¤§é”…ï¼Œç…®æˆä¸€é”…â€œä»£ç ç²¥â€ã€‚

### Webpack çš„æ¨¡å—è§£æä¸ä¾èµ–å›¾

Webpack çš„æ ¸å¿ƒæ˜¯æ„å»ºä¸€å¼ **ä¾èµ–å›¾ï¼ˆDependency Graphï¼‰**ã€‚å½“ä½ è¿è¡Œ `webpack` å‘½ä»¤æ—¶ï¼Œå®ƒä¼šï¼š
1. ä»å…¥å£æ–‡ä»¶ï¼ˆ`entry`ï¼‰å¼€å§‹ï¼Œè§£ææ‰€æœ‰ `import` æˆ– `require` çš„æ¨¡å—ã€‚
2. é€’å½’éå†æ¯ä¸ªæ¨¡å—çš„ä¾èµ–ï¼Œå½¢æˆä¸€æ£µä¾èµ–æ ‘ã€‚
3. å°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª `bundle` æ–‡ä»¶ã€‚

åˆ†åŒ…çš„æœ¬è´¨æ˜¯å¹²é¢„è¿™æ£µä¾èµ–æ ‘çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œé€šè¿‡é…ç½®æˆ–ä»£ç é€»è¾‘ï¼Œå°†æŸäº›æ¨¡å—â€œéš”ç¦»â€æˆç‹¬ç«‹çš„ `chunk`ï¼ˆä»£ç å—ï¼‰ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ã€‚

### åˆ†åŒ…çš„ä¸¤ç§æ–¹å¼
1. **é™æ€åˆ†åŒ…**ï¼šé€šè¿‡ Webpack é…ç½®ï¼ˆ`optimization.splitChunks`ï¼‰è‡ªåŠ¨æ‹†åˆ†å…¬å…±æ¨¡å—æˆ–ç¬¬ä¸‰æ–¹åº“ã€‚
2. **åŠ¨æ€åˆ†åŒ…**ï¼šé€šè¿‡åŠ¨æ€å¯¼å…¥ï¼ˆ`import()`ï¼‰æˆ–æ‡’åŠ è½½å®ç°è¿è¡Œæ—¶æŒ‰éœ€åŠ è½½ã€‚

### åŠ¨æ€å¯¼å…¥çš„é­”æ³• âœ¨

åŠ¨æ€å¯¼å…¥æ˜¯åˆ†åŒ…çš„çµé­‚ï¼Œå®ƒåŸºäº ES Module çš„ `import()` è¯­æ³•ï¼Œè¿”å›ä¸€ä¸ª Promiseã€‚ä¾‹å¦‚ï¼š

```javascript
// åŠ¨æ€å¯¼å…¥ä¸€ä¸ªæ¨¡å—
import('./myModule').then(module => {
  module.doSomething();
});
```

å½“ Webpack é‡åˆ° `import()`ï¼Œå®ƒä¼šè‡ªåŠ¨å°† `myModule` æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„ `chunk`ï¼Œå¹¶åœ¨è¿è¡Œæ—¶é€šè¿‡ AJAX è¯·æ±‚åŠ è½½ã€‚è¿™å°±åƒä½ åœ¨é¤å…ç‚¹äº†ä¸€ä»½ç”œç‚¹ï¼Œå¨æˆ¿ç°åšç°é€ï¼Œè€Œä¸æ˜¯æå‰æŠŠç”œç‚¹å¡è¿›ä½ çš„ä¸»èœç›˜å­é‡Œã€‚

> *â€œåŠ¨æ€å¯¼å…¥å°±åƒäººç”Ÿçš„å»¶è¿Ÿæ»¡è¶³ï¼šåˆ«æ€¥ï¼Œå¥½çš„ä¸œè¥¿æ€»ä¼šåœ¨å¯¹çš„æ—¶æœºå‡ºç°ã€‚â€*

*Tipsï¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥æ—¶ï¼Œç¡®ä¿æ¨¡å—çš„ä½“ç§¯é€‚ä¸­ï¼Œè¿‡å°çš„æ¨¡å—å¯èƒ½å¢åŠ  HTTP è¯·æ±‚å¼€é”€ï¼Œå¾—ä¸å¿å¤±ã€‚*

## Webpack åˆ†åŒ…çš„å®æˆ˜ç­–ç•¥ ğŸ› ï¸

å¥½äº†ï¼ŒåŸç†è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ç¡¬æ ¸å®æˆ˜ç¯èŠ‚ï¼ä»¥ä¸‹æ˜¯ Webpack åˆ†åŒ…çš„äº”å¤§ç­–ç•¥ï¼Œæ¶µç›–é…ç½®ã€ä»£ç å®ç°å’Œæœ€ä½³å®è·µã€‚æ¯ä¸ªç­–ç•¥éƒ½é…æœ‰æ¡ˆä¾‹å’Œè¡¨æ ¼ï¼ŒåŠ›æ±‚è®©ä½ ä¸€çœ‹å°±æ‡‚ï¼Œä¸€ç”¨å°±ä¼šã€‚

### ç­–ç•¥ 1ï¼šåˆ©ç”¨ `optimization.splitChunks` æ‹†åˆ†å…¬å…±æ¨¡å—

`optimization.splitChunks` æ˜¯ Webpack 4 å¼•å…¥çš„å¼ºå¤§åŠŸèƒ½ï¼Œç”¨äºè‡ªåŠ¨æ‹†åˆ†å…¬å…±æ¨¡å—å’Œç¬¬ä¸‰æ–¹åº“ã€‚å®ƒçš„é»˜è®¤é…ç½®å·²ç»å¾ˆæ™ºèƒ½ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è§„åˆ™è®©å®ƒæ›´ç¬¦åˆé¡¹ç›®éœ€æ±‚ã€‚

#### ç¤ºä¾‹é…ç½®
å‡è®¾ä½ æœ‰ä¸€ä¸ª React é¡¹ç›®ï¼ŒåŒ…å«å¤šä¸ªé¡µé¢ï¼Œä¾èµ– `react`ã€`react-dom` å’Œ `lodash` ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚ä½ å¸Œæœ›å°†è¿™äº›åº“å•ç‹¬æ‰“åŒ…ï¼Œå‡å°‘ä¸» `bundle` çš„ä½“ç§¯ã€‚

```javascript
module.exports = {
  entry: {
    app: './src/index.js',
  },
  output: {
    filename: '[name].[contenthash].js',
    chunkFilename: '[name].[contenthash].js',
    path: path.resolve(__dirname, 'dist'),
  },
  optimization: {
    splitChunks: {
      chunks: 'all', // å¯¹æ‰€æœ‰æ¨¡å—ç”Ÿæ•ˆ
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/, // åŒ¹é… node_modules ä¸­çš„æ¨¡å—
          name: 'vendors', // è¾“å‡ºæ–‡ä»¶å
          priority: -10, // ä¼˜å…ˆçº§
        },
        default: {
          minChunks: 2, // è‡³å°‘è¢«å¼•ç”¨ 2 æ¬¡æ‰æ‹†åˆ†
          priority: -20,
          reuseExistingChunk: true, // å¤ç”¨å·²æœ‰çš„ chunk
        },
      },
    },
  },
};
```

#### æ•ˆæœåˆ†æ
è¿è¡Œ `webpack` åï¼ŒWebpack ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š
- `app.[hash].js`ï¼šä¸šåŠ¡ä»£ç 
- `vendors.[hash].js`ï¼šç¬¬ä¸‰æ–¹åº“ï¼ˆ`react`ã€`react-dom`ã€`lodash` ç­‰ï¼‰
- å…¶ä»–åŠ¨æ€ `chunk`ï¼ˆå¦‚åŠ¨æ€å¯¼å…¥çš„æ¨¡å—ï¼‰

#### é…ç½®å‚æ•°è¯¦è§£
ä»¥ä¸‹æ˜¯ `splitChunks` çš„æ ¸å¿ƒå‚æ•°è¡¨æ ¼ï¼Œå¸®ä½ å¿«é€Ÿä¸Šæ‰‹ï¼š

| å‚æ•°å            | è¯´æ˜                                                                 | é»˜è®¤å€¼       | æ¨èåœºæ™¯                     |
|-------------------|----------------------------------------------------------------------|--------------|------------------------------|
| `chunks`          | æŒ‡å®šåˆ†åŒ…çš„æ¨¡å—èŒƒå›´ï¼ˆ`all`ã€`async`ã€`initial`ï¼‰                      | `async`      | `all` é€‚ç”¨äºå¤§å¤šæ•°é¡¹ç›®       |
| `minSize`         | æ‹†åˆ†åçš„ chunk æœ€å°ä½“ç§¯ï¼ˆå­—èŠ‚ï¼‰                                      | 30000        | å°é¡¹ç›®å¯è°ƒä½è‡³ 10000         |
| `maxSize`         | æ‹†åˆ†åçš„ chunk æœ€å¤§ä½“ç§¯ï¼ˆå­—èŠ‚ï¼‰ï¼Œè¶…å¤§ chunk ä¼šè¿›ä¸€æ­¥æ‹†åˆ†             | 0ï¼ˆä¸é™åˆ¶ï¼‰  | å¤§é¡¹ç›®å¯è®¾ä¸º 244000ï¼ˆçº¦ 244KBï¼‰ |
| `minChunks`       | æ¨¡å—è¢«å¼•ç”¨æ¬¡æ•°çš„æœ€å°å€¼ï¼Œä½äºæ­¤å€¼ä¸æ‹†åˆ†                              | 1            | è®¾ä¸º 2 é¿å…è¿‡åº¦æ‹†åˆ†          |
| `cacheGroups`     | å®šä¹‰æ‹†åˆ†è§„åˆ™çš„åˆ†ç»„ï¼Œå¯è‡ªå®šä¹‰ `test`ã€`name`ã€`priority` ç­‰           | -            | ç”¨äºåˆ†ç¦» vendors å’Œä¸šåŠ¡æ¨¡å—  |

#### æœ€ä½³å®è·µ
- **æå–ç¬¬ä¸‰æ–¹åº“**ï¼šå°† `node_modules` ä¸­çš„æ¨¡å—æ‰“åŒ…åˆ° `vendors` chunkï¼Œæ–¹ä¾¿æµè§ˆå™¨ç¼“å­˜ã€‚
- **æ§åˆ¶ chunk å¤§å°**ï¼šè®¾ç½® `maxSize` é¿å…å•ä¸ª chunk è¿‡å¤§ï¼ˆå¦‚è¶…è¿‡ 244KBï¼Œå¯èƒ½è§¦å‘æµè§ˆå™¨ç¼“å­˜é™åˆ¶ï¼‰ã€‚
- **å¤ç”¨ chunk**ï¼šå¯ç”¨ `reuseExistingChunk` å‡å°‘é‡å¤æ‰“åŒ…ã€‚

> *â€œå¥½çš„åˆ†åŒ…å°±åƒå¥½çš„å›¢é˜Ÿåˆ†å·¥ï¼šæ¯ä¸ªäººï¼ˆæ¨¡å—ï¼‰å„å¸å…¶èŒï¼Œåä½œæ— é—´ã€‚â€*

*Tipsï¼šå®šæœŸæ£€æŸ¥ `vendors` chunk çš„ä½“ç§¯ï¼Œå¦‚æœå‘ç°æŸä¸ªåº“ï¼ˆå¦‚ `moment.js`ï¼‰ä½“ç§¯è¿‡å¤§ï¼Œè€ƒè™‘æ›¿æ¢ä¸ºè½»é‡çº§æ›¿ä»£å“ï¼ˆå¦‚ `day.js`ï¼‰ã€‚*

### ç­–ç•¥ 2ï¼šåŠ¨æ€å¯¼å…¥ä¸æ‡’åŠ è½½

åŠ¨æ€å¯¼å…¥æ˜¯å®ç°æŒ‰éœ€åŠ è½½çš„æ€æ‰‹é”ï¼Œç‰¹åˆ«é€‚åˆè·¯ç”±çº§åˆ†åŒ…å’Œç»„ä»¶çº§æ‡’åŠ è½½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª React é¡¹ç›®çš„è·¯ç”±åˆ†åŒ…ç¤ºä¾‹ã€‚

#### ç¤ºä¾‹ä»£ç 
å‡è®¾ä½ æœ‰ä¸€ä¸ª React å•é¡µåº”ç”¨ï¼ŒåŒ…å« `Home`ã€`About` å’Œ `Contact` ä¸‰ä¸ªé¡µé¢ã€‚ä½ å¸Œæœ›åªæœ‰åœ¨è®¿é—®ç‰¹å®šè·¯ç”±æ—¶æ‰åŠ è½½å¯¹åº”çš„é¡µé¢ä»£ç ã€‚

```javascript
import React, { lazy, Suspense } from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';

// åŠ¨æ€å¯¼å…¥é¡µé¢ç»„ä»¶
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));
const Contact = lazy(() => import('./pages/Contact'));

function App() {
  return (
    <Router>
      <Suspense fallback={<div>Loading...</div>}>
        <Switch>
          <Route exact path="/" component={Home} />
          <Route path="/about" component={About} />
          <Route path="/contact" component={Contact} />
        </Switch>
      </Suspense>
    </Router>
  );
}

export default App;
```

#### Webpack é…ç½®
ç¡®ä¿ Webpack èƒ½æ­£ç¡®å¤„ç†åŠ¨æ€å¯¼å…¥ï¼š

```javascript
module.exports = {
  output: {
    chunkFilename: '[name].[contenthash].js', // åŠ¨æ€ chunk çš„å‘½åè§„åˆ™
  },
};
```

#### æ•ˆæœåˆ†æ
è¿è¡Œåï¼ŒWebpack ä¼šä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆç‹¬ç«‹çš„ chunkï¼š
- `home.[hash].js`
- `about.[hash].js`
- `contact.[hash].js`

å½“ç”¨æˆ·è®¿é—® `/about` æ—¶ï¼Œåªæœ‰ `about.[hash].js` ä¼šè¢«åŠ è½½ï¼Œæå¤§å‡å°‘äº†é¦–å±åŠ è½½çš„ä»£ç é‡ã€‚

#### æœ€ä½³å®è·µ
- **ä½¿ç”¨ `Suspense`**ï¼šä¸ºæ‡’åŠ è½½ç»„ä»¶æä¾› `fallback` UIï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
- **é¢„åŠ è½½ä¼˜åŒ–**ï¼šç»“åˆ `React.lazy` å’Œ `preload` æŠ€æœ¯ï¼Œæå‰åŠ è½½é«˜ä¼˜å…ˆçº§ chunkã€‚
- **é”™è¯¯è¾¹ç•Œ**ï¼šä¸ºåŠ¨æ€å¯¼å…¥æ·»åŠ é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢åŠ è½½å¤±è´¥å¯¼è‡´é¡µé¢å´©æºƒã€‚

```javascript
const About = lazy(() =>
  import('./pages/About').catch(() => ({
    default: () => <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>,
  }))
);
```

> *â€œæ‡’åŠ è½½å°±åƒäººç”Ÿçš„é€‰æ‹©ï¼šä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½éœ€è¦ç«‹åˆ»æ‹¥æœ‰ï¼Œå­¦ä¼šç­‰å¾…ï¼Œæ‰èƒ½æ‹¥æŠ±æ›´å¥½çš„æœªæ¥ã€‚â€*

*Tipsï¼šä¸ºåŠ¨æ€å¯¼å…¥çš„ chunk æ·»åŠ  `webpackChunkName` æ³¨é‡Šï¼Œç”Ÿæˆæ›´æœ‰æ„ä¹‰çš„ chunk åï¼Œä¾‹å¦‚ `/* webpackChunkName: "about" */ import('./pages/About')`ã€‚*

### ç­–ç•¥ 3ï¼šTree Shaking ä¸æŒ‰éœ€åŠ è½½

Tree Shaking æ˜¯ Webpack çš„å¦ä¸€å¤§åˆ©å™¨ï¼Œç”¨äºç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼ˆDead Codeï¼‰ã€‚ç»“åˆæŒ‰éœ€åŠ è½½ï¼Œå®ƒèƒ½è¿›ä¸€æ­¥å‡å°‘ chunk ä½“ç§¯ã€‚

#### ç¤ºä¾‹ï¼šæŒ‰éœ€åŠ è½½ Ant Design
Ant Design æ˜¯ä¸€ä¸ªæµè¡Œçš„ React UI åº“ï¼Œä½†å®ƒçš„å®Œæ•´åŒ…ä½“ç§¯è¾ƒå¤§ã€‚é€šè¿‡æŒ‰éœ€åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥åªå¼•å…¥ç”¨åˆ°çš„ç»„ä»¶ã€‚

1. å®‰è£… `babel-plugin-import`ï¼š
```bash
npm install babel-plugin-import --save-dev
```

2. é…ç½® Babelï¼š
```javascript
// .babelrc
{
  "plugins": [
    [
      "import",
      {
        "libraryName": "antd",
        "libraryDirectory": "es",
        "style": true
      }
    ]
  ]
}
```

3. ä½¿ç”¨æŒ‰éœ€å¯¼å…¥ï¼š
```javascript
import { Button, Modal } from 'antd'; // ä»…å¯¼å…¥ Button å’Œ Modal
```

#### æ•ˆæœåˆ†æ
æœªä¼˜åŒ–å‰ï¼Œæ•´ä¸ª `antd` åŒ…å¯èƒ½è¢«æ‰“åŒ…è¿› `vendors` chunkï¼Œä½“ç§¯é«˜è¾¾ 1MB+ã€‚ä¼˜åŒ–åï¼Œåªæœ‰ `Button` å’Œ `Modal` ç›¸å…³çš„ä»£ç è¢«æ‰“åŒ…ï¼Œä½“ç§¯å¯èƒ½ç¼©å‡è‡³ 100KB ä»¥ä¸‹ã€‚

#### æœ€ä½³å®è·µ
- **æ£€æŸ¥ Tree Shaking æ•ˆæœ**ï¼šä½¿ç”¨ `webpack-bundle-analyzer` åˆ†ææ‰“åŒ…ç»“æœï¼Œç¡®ä¿æ— ç”¨ä»£ç è¢«ç§»é™¤ã€‚
- **é¿å…å‰¯ä½œç”¨**ï¼šåœ¨ `package.json` ä¸­è®¾ç½® `"sideEffects": false`ï¼Œå‘Šè¯‰ Webpack å“ªäº›æ¨¡å—å¯ä»¥å®‰å…¨ Tree Shakingã€‚
- **åŠ¨æ€å¯¼å…¥å¤§ç»„ä»¶**ï¼šå¯¹äºä½“ç§¯è¾ƒå¤§çš„ç»„ä»¶ï¼ˆå¦‚å›¾è¡¨åº“ï¼‰ï¼Œç»“åˆåŠ¨æ€å¯¼å…¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

> *â€œTree Shaking å°±åƒæ–­èˆç¦»ï¼šæ‰”æ‰ä¸éœ€è¦çš„ä»£ç ï¼Œç”Ÿæ´»æ‰èƒ½æ›´è½»ç›ˆã€‚â€*

*Tipsï¼šå®šæœŸè¿è¡Œ `npm dedupe` æ¸…ç†é‡å¤ä¾èµ–ï¼Œç»“åˆ Tree Shaking æ•ˆæœæ›´ä½³ã€‚*

### ç­–ç•¥ 4ï¼šåˆ†åŒ…ä¸ç¼“å­˜ç­–ç•¥ç»“åˆ

åˆ†åŒ…çš„ç»ˆæç›®æ ‡æ˜¯è®©ç”¨æˆ·åŠ è½½æ›´å°‘çš„ä»£ç ï¼Œè€Œç¼“å­˜ç­–ç•¥èƒ½è®©ç”¨æˆ·é‡å¤è®¿é—®æ—¶â€œå‡ ä¹ä¸åŠ è½½â€ã€‚é€šè¿‡åˆç†çš„æ–‡ä»¶åå’Œ `Cache-Control` å¤´ï¼Œæˆ‘ä»¬å¯ä»¥æœ€å¤§åŒ–ç¼“å­˜å‘½ä¸­ç‡ã€‚

#### ç¤ºä¾‹é…ç½®
```javascript
module.exports = {
  output: {
    filename: '[name].[contenthash].js', // ä½¿ç”¨ contenthash ç¡®ä¿æ–‡ä»¶å†…å®¹ä¸å˜æ—¶æ–‡ä»¶åä¸å˜
    chunkFilename: '[name].[contenthash].js',
  },
};
```

#### ç¼“å­˜ç­–ç•¥
åœ¨æœåŠ¡å™¨ç«¯é…ç½® `Cache-Control`ï¼š
- ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ `vendors.[hash].js`ï¼‰ï¼š`Cache-Control: public, max-age=31536000`ï¼ˆä¸€å¹´ï¼‰
- ä¸šåŠ¡ä»£ç ï¼ˆå¦‚ `app.[hash].js`ï¼‰ï¼š`Cache-Control: public, max-age=3600`ï¼ˆä¸€å°æ—¶ï¼‰

#### æ•ˆæœåˆ†æ
- ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶ï¼Œä¸‹è½½æ‰€æœ‰ chunk å¹¶ç¼“å­˜ã€‚
- ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œæµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜è¯»å–æœªå˜æ›´çš„ chunkï¼ˆå¦‚ `vendors.[hash].js`ï¼‰ï¼Œåªéœ€åŠ è½½å˜æ›´çš„ä¸šåŠ¡ä»£ç ã€‚

#### æœ€ä½³å®è·µ
- **ä½¿ç”¨ `contenthash`**ï¼šç›¸æ¯” `chunkhash`ï¼Œ`contenthash` æ›´ç²¾å‡†ï¼Œé¿å…æ— å…³æ¨¡å—å˜æ›´å¯¼è‡´æ–‡ä»¶åå˜åŒ–ã€‚
- **åˆ†ç¦» CSS**ï¼šä½¿ç”¨ `mini-css-extract-plugin` å°† CSS å•ç‹¬æ‰“åŒ…ï¼Œç»“åˆ `contenthash` å®ç°ç‹¬ç«‹ç¼“å­˜ã€‚
- **CDN åŠ é€Ÿ**ï¼šå°† chunk éƒ¨ç½²åˆ° CDNï¼Œå‡å°‘åŠ è½½å»¶è¿Ÿã€‚

> *â€œå¥½çš„ç¼“å­˜ç­–ç•¥å°±åƒäººç”Ÿçš„ç§¯ç´¯ï¼šå‰æœŸå¤šåŠªåŠ›ï¼ŒåæœŸäº«å›æŠ¥ã€‚â€*

*Tipsï¼šä½¿ç”¨ `workbox` æˆ– `service-worker` å®ç°ç¦»çº¿ç¼“å­˜ï¼Œè®©ç”¨æˆ·åœ¨æ–­ç½‘æ—¶ä¹Ÿèƒ½è®¿é—®é™æ€èµ„æºã€‚*

### ç­–ç•¥ 5ï¼šåˆ†åŒ…åçš„æ€§èƒ½ç›‘æ§ä¸ä¼˜åŒ–

åˆ†åŒ…ä¸æ˜¯ä¸€åŠ³æ°¸é€¸ï¼Œåˆ†åŒ…åçš„æ€§èƒ½éœ€è¦æŒç»­ç›‘æ§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å®ç”¨çš„ç›‘æ§å·¥å…·å’Œä¼˜åŒ–æŠ€å·§ã€‚

#### å·¥å…·æ¨è
| å·¥å…·å                     | åŠŸèƒ½                                                         | æ¨èåœºæ™¯                     |
|----------------------------|--------------------------------------------------------------|------------------------------|
| `webpack-bundle-analyzer`  | åˆ†æ bundle ç»„æˆï¼Œç”Ÿæˆå¯è§†åŒ–ä¾èµ–å›¾                           | é¡¹ç›®åˆæœŸä¼˜åŒ–å’Œå®šæœŸæ£€æŸ¥       |
| `Lighthouse`               | æä¾›æ€§èƒ½ã€SEO å’Œå¯è®¿é—®æ€§æŠ¥å‘Š                                 | é¦–å±æ€§èƒ½ä¼˜åŒ–                 |
| `web-vitals`               | ç›‘æ§æ ¸å¿ƒ Web æŒ‡æ ‡ï¼ˆå¦‚ LCPã€FIDã€CLSï¼‰                        | ç”Ÿäº§ç¯å¢ƒç”¨æˆ·ä½“éªŒç›‘æ§         |

#### ä¼˜åŒ–æŠ€å·§
- **åˆ†æ chunk ä¾èµ–**ï¼šä½¿ç”¨ `webpack-bundle-analyzer` æ£€æŸ¥æ˜¯å¦æœ‰æ„å¤–çš„é‡å¤ä¾èµ–ã€‚
- **ç›‘æ§åŠ è½½æ—¶é—´**ï¼šé€šè¿‡ `Performance API` è®°å½•åŠ¨æ€ chunk çš„åŠ è½½è€—æ—¶ï¼Œä¼˜åŒ–æ…¢åŠ è½½æ¨¡å—ã€‚
- **A/B æµ‹è¯•**ï¼šå°è¯•ä¸åŒçš„åˆ†åŒ…ç­–ç•¥ï¼ˆå¦‚æŒ‰è·¯ç”±æ‹†åˆ† vs. æŒ‰åŠŸèƒ½æ‹†åˆ†ï¼‰ï¼Œå¯¹æ¯”æ€§èƒ½æ•°æ®ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ `web-vitals`
```javascript
import { getLCP, getFID, getCLS } from 'web-vitals';

getLCP(console.log);
getFID(console.log);
getCLS(console.log);
```

> *â€œæ€§èƒ½ä¼˜åŒ–å°±åƒä¿®ç¦…ï¼šä¸æ–­è§‚å¯Ÿã€è°ƒæ•´ï¼Œæ‰èƒ½æ¥è¿‘å®Œç¾ã€‚â€*

*Tipsï¼šå°†æ€§èƒ½æ•°æ®ä¸ŠæŠ¥åˆ°åç«¯ï¼ˆå¦‚é€šè¿‡ `Sentry`ï¼‰ï¼Œä¾¿äºé•¿æœŸè·Ÿè¸ªå’Œåˆ†æã€‚*

## åˆ†åŒ…çš„å“²å­¦æ€è€ƒï¼šä»ä»£ç åˆ°äººç”Ÿ

åˆ†åŒ…ä¸ä»…ä»…æ˜¯æŠ€æœ¯æ‰‹æ®µï¼Œå®ƒè¿˜è•´å«ç€æ·±åˆ»çš„å“²å­¦æ™ºæ…§ã€‚ä»£ç çš„åˆ†åŒ…å°±åƒäººç”Ÿçš„æ‹†è§£ï¼šæˆ‘ä»¬ä¸å¯èƒ½ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦åœ¨æ¯æ—¶æ¯åˆ»èƒŒè´Ÿæ‰€æœ‰è´Ÿæ‹…ã€‚å­¦ä¼šå°†ä»»åŠ¡ã€ç›®æ ‡å’Œæƒ…ç»ªæ‹†åˆ†æˆå°å—ï¼ŒæŒ‰éœ€å¤„ç†ï¼Œæ‰èƒ½æ´»å¾—æ›´ä»å®¹ã€‚

> â€œæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”Ÿæ´»çš„å…¨éƒ¨ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€‰æ‹©åŠ è½½å“ªäº›éƒ¨åˆ†ã€‚â€ â€”â€” æ™“é¾™

åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œåˆ†åŒ…è®©æˆ‘ä»¬å­¦ä¼šäº†å–èˆå’Œä¼˜å…ˆçº§ç®¡ç†ï¼›åœ¨ç”Ÿæ´»ä¸­ï¼Œåˆ†åŒ…è®©æˆ‘ä»¬å­¦ä¼šäº†ä¸“æ³¨å’Œå»¶è¿Ÿæ»¡è¶³ã€‚æ— è®ºæ˜¯ä¼˜åŒ–ä¸€ä¸ªå¤§å‹ React åº”ç”¨ï¼Œè¿˜æ˜¯è§„åˆ’ä¸€æ®µèŒä¸šç”Ÿæ¶¯ï¼Œæ‹†è§£çš„è‰ºæœ¯éƒ½æ˜¯é€šå¾€æˆåŠŸçš„é’¥åŒ™ã€‚

## æ€»ç»“ï¼šåˆ†åŒ…çš„è‰ºæœ¯ä¸æœªæ¥

é€šè¿‡ `optimization.splitChunks`ã€åŠ¨æ€å¯¼å…¥ã€Tree Shakingã€ç¼“å­˜ç­–ç•¥å’Œæ€§èƒ½ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥å°† Webpack çš„åˆ†åŒ…ä¼˜åŒ–åšåˆ°æè‡´ã€‚è¿™äº›ç­–ç•¥ä¸ä»…æå‡äº†åº”ç”¨çš„æ€§èƒ½ï¼Œè¿˜è®©æˆ‘ä»¬åœ¨ä»£ç çš„æµ·æ´‹ä¸­æ‰¾åˆ°äº†ä¸€ä¸ç§©åºã€‚

æœªæ¥ï¼Œéšç€ Webpack 5 çš„æ™®åŠå’Œ ES Module çš„è¿›ä¸€æ­¥å‘å±•ï¼Œåˆ†åŒ…æŠ€æœ¯å°†å˜å¾—æ›´åŠ æ™ºèƒ½å’Œè‡ªåŠ¨åŒ–ã€‚ä¾‹å¦‚ï¼ŒWebpack 5 çš„ `Module Federation` è®©å¤šä¸ªåº”ç”¨å…±äº«æ¨¡å—ï¼Œä¸ºå¾®å‰ç«¯å’Œåˆ†å¸ƒå¼å¼€å‘å¼€è¾Ÿäº†æ–°å¤©åœ°ã€‚è€Œåƒ `esbuild` å’Œ `Vite` è¿™æ ·çš„æ–°å…´å·¥å…·ï¼Œä¹Ÿåœ¨æŒ‘æˆ˜ Webpack çš„åœ°ä½ï¼Œä¿ƒä½¿å®ƒä¸æ–­è¿›åŒ–ã€‚

æ— è®ºæŠ€æœ¯å¦‚ä½•å˜è¿ï¼Œåˆ†åŒ…çš„æ ¸å¿ƒç†å¿µâ€”â€”**åŒ–ç¹ä¸ºç®€ï¼ŒæŒ‰éœ€åŠ è½½**â€”â€”å°†å§‹ç»ˆæ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºçŸ³ã€‚å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½æˆä¸ºä½ ä¼˜åŒ– Webpack é¡¹ç›®çš„ç¯å¡”ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½åœ¨ä»£ç ä¸äººç”Ÿçš„æ‹†è§£ä¸­ï¼Œæ‰¾åˆ°å±äºè‡ªå·±çš„èŠ‚å¥ä¸ä¼˜é›…ã€‚

> *â€œä»£ç å¦‚äººç”Ÿï¼Œæ‹†å¾—ç²¾å½©ï¼Œæ‰èƒ½æ´»å¾—ç—›å¿«ï¼â€*

---