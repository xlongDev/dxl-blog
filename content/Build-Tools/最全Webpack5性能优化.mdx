---

title: "æœ€å…¨ Webpack 5 æ€§èƒ½ä¼˜åŒ–ï¼šä»å…¥é—¨åˆ°è¶…ç¥"
date: "2022-03-22"
description: "æ·±åº¦å‰–æ Webpack 5 æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå¸¦ä½ ä»æ„å»ºé€Ÿåº¦åˆ°è¿è¡Œæ—¶ä¼˜åŒ–å…¨è¦†ç›–ï¼ŒåŸç† + å®è·µ + è¿›é˜¶ï¼Œæ‰“é€ æè‡´å‰ç«¯é¡¹ç›®ã€‚"
keywords: "Webpack 5, æ€§èƒ½ä¼˜åŒ–, æ„å»ºé€Ÿåº¦, ä»£ç åˆ†å‰², Tree Shaking, æ¨¡å—è”é‚¦, å‰ç«¯å¼€å‘, JavaScript, æŒä¹…åŒ–ç¼“å­˜, å¹¶è¡Œæ„å»º"
author: "æ™“é¾™"
image: "/images/hero/webpack5-performance.jpg"
tags: ["Webpack", "æ€§èƒ½ä¼˜åŒ–", "å‰ç«¯å¼€å‘"]
category: "Build-Tools"

---

å˜¿ï¼Œå‰ç«¯å°ä¼™ä¼´ä»¬ï¼ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠ **Webpack 5 æ€§èƒ½ä¼˜åŒ–** è¿™ä¸ªç¡¬æ ¸ä½†è¶…å®ç”¨çš„è¯é¢˜ã€‚ä½œä¸ºå‰ç«¯é¡¹ç›®çš„â€œæ‰“åŒ…å¤§å¸ˆâ€ï¼ŒWebpack å°±åƒä¸€ä½æœ‰ç‚¹è„¾æ°”çš„è€åŒ äººâ€”â€”åŠŸèƒ½å¼ºå¤§ï¼Œä½†ä¸è°ƒæ•™å¥½ï¼Œå®ƒå¯èƒ½ä¼šæ‹–æ…¢ä½ çš„æ„å»ºé€Ÿåº¦ï¼Œæˆ–è€…è®©çº¿ä¸Šä»£ç å˜å¾—åƒâ€œåƒäº†é¡¿å¤§é¤â€çš„èƒ–å­ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°†å¸¦ä½ ä»**æ„å»ºé€Ÿåº¦ä¼˜åŒ–**åˆ°**è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–**ï¼Œæ·±å…¥åŸç†ï¼Œé…ä¸Šå®æˆ˜ä»£ç ï¼Œå†åŠ ä¸Šä¸€äº›ç±»æ¯”ã€å¹½é»˜å’Œç‹¬å®¶ Tipsï¼Œä¿è¯ä½ çœ‹å®Œèƒ½æŠŠ Webpack 5 çš„æ€§èƒ½æ¦¨å¾—ä¸€æ»´ä¸å‰©ï¼ğŸŒŸ

Webpack 5 å‘å¸ƒè‡³ä»Šï¼Œå¸¦æ¥äº†æŒä¹…åŒ–ç¼“å­˜ã€æ¨¡å—è”é‚¦ã€æ›´å¥½çš„ Tree Shaking ç­‰ä¸€å †æ–°ç‰¹æ€§ã€‚ä½†å¦‚æœä½ åªæ˜¯ç®€å•ä¸¢ä¸ª `webpack.config.js` å°±è·‘ï¼Œé‚£å¯çœŸæ˜¯â€œæ‹¿ç€é‡‘é¥­ç¢—è®¨é¥­â€ã€‚å’±ä»¬çš„ç›®æ ‡æ˜¯ï¼šè®©æ„å»ºå¿«åˆ°é£èµ·ï¼Œçº¿ä¸Šä»£ç è½»åˆ°é£˜èµ·æ¥ã€‚è¿™ç¯‡æ–‡ç« ä¼šä»ä¸¤å¤§ç»´åº¦å±•å¼€ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå±‚å±‚é€’è¿›ï¼Œè¿˜ä¼šå¤šèŠèŠè¿›é˜¶æŠ€å·§å’Œè¸©å‘ç»éªŒã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿç³»å¥½å®‰å…¨å¸¦ï¼Œå’±ä»¬å¼€æ•´ï¼

## ä¼˜åŒ–å‰çš„â€œçƒ­èº«â€ï¼šæ˜ç¡®æ–¹å‘

åœ¨åŠ¨æ‰‹ä¼˜åŒ–ä¹‹å‰ï¼Œå’±ä»¬å¾—å…ˆææ¸…æ¥šç›®æ ‡ã€‚Webpack çš„æ€§èƒ½ä¼˜åŒ–ä¸»è¦åˆ†ä¸¤å—ï¼š

1. **æ„å»ºé€Ÿåº¦ä¼˜åŒ–**ï¼šè®© `npm run build` ä»â€œæ³¡æ¯å’–å•¡å†åˆ·ä¸ªæŠ–éŸ³â€çš„ç…ç†¬ï¼Œå˜æˆâ€œçœ¨çœ¼å°±å®Œäº‹â€çš„å¿«æ„Ÿã€‚
2. **è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–**ï¼šè®©æ‰“åŒ…åçš„ä»£ç åœ¨æµè§ˆå™¨é‡Œè·‘å¾—åƒé£ä¸€æ ·ï¼Œç”¨æˆ·ä½“éªŒä¸æ»‘åˆ°é£èµ·ã€‚

è¿™å°±åƒæ˜¯â€œå¨å¸ˆåšèœâ€å’Œâ€œé¡¾å®¢åƒèœâ€çš„å…³ç³»â€”â€”æ„å»ºé€Ÿåº¦å†³å®šå¨æˆ¿æ•ˆç‡ï¼Œè¿è¡Œæ—¶æ€§èƒ½å†³å®šç”¨æˆ·å£æ„Ÿã€‚ä¸¤æ‰‹éƒ½è¦æŠ“ï¼Œä¸¤æ‰‹éƒ½è¦ç¡¬ï¼æ¥ä¸‹æ¥ï¼Œå’±ä»¬æŒ‰è¿™ä¸ªæ€è·¯é€æ­¥æ‹†è§£ï¼Œå¸¦ä¸Šä»£ç ã€åŸç†å’Œå®æˆ˜æ¡ˆä¾‹ï¼Œç»ä¸å«ç³Šã€‚

---

## ä¸€ã€æ„å»ºé€Ÿåº¦ä¼˜åŒ–ï¼šè®© Webpack â€œè·‘â€èµ·æ¥

æ„å»ºé€Ÿåº¦æ…¢æ˜¯å‰ç«¯å¼€å‘è€…çš„å™©æ¢¦ï¼Œå°¤å…¶æ˜¯å¤§é¡¹ç›®ï¼ŒåŠ¨ä¸åŠ¨å‡ åˆ†é’Ÿèµ·æ­¥ï¼Œç®€ç›´æ˜¯â€œç”Ÿäº§åŠ›æ€æ‰‹â€ã€‚Webpack 5 æä¾›äº†ä¸å°‘æ–°å·¥å…·ï¼Œå’±ä»¬ä¸€èµ·æ¥æŠŠå®ƒçš„â€œå‘åŠ¨æœºâ€å‡çº§æˆæ¶¡è½®å¢å‹ç‰ˆï¼

### 1. æŒä¹…åŒ–ç¼“å­˜ï¼šåˆ«è®© Webpack æ¯æ¬¡éƒ½â€œå¤±å¿†â€

Webpack 5 çš„æŒä¹…åŒ–ç¼“å­˜ï¼ˆ`cache.type: 'filesystem'`ï¼‰ç»å¯¹æ˜¯â€œæ‡’äººç¦éŸ³â€ã€‚ä»¥å‰æ¯æ¬¡æ„å»ºï¼ŒWebpack éƒ½åƒä¸ªå¥å¿˜çš„è€çˆ·çˆ·ï¼Œä»å¤´è§£ææ‰€æœ‰æ¨¡å—ã€‚ç°åœ¨æœ‰äº†ç¼“å­˜ï¼Œå®ƒä¼šæŠŠç»“æœå­˜åˆ°ç¡¬ç›˜ï¼Œä¸‹æ¬¡ç›´æ¥å¤ç”¨ï¼Œé€Ÿåº¦å¿«åˆ°ä½ æ€€ç–‘äººç”Ÿã€‚

#### åŸç†æ·±åº¦è§£æ
æŒä¹…åŒ–ç¼“å­˜çš„æ ¸å¿ƒæ˜¯æŠŠæ¨¡å—è§£æã€ç¼–è¯‘çš„ç»“æœåºåˆ—åŒ–åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚Webpack ä¼šç”Ÿæˆä¸€ä¸ªç¼“å­˜å“ˆå¸Œï¼Œæ ¹æ®æ–‡ä»¶å†…å®¹ã€ä¾èµ–å’Œé…ç½®ç”Ÿæˆå”¯ä¸€æ ‡è¯†ã€‚åªè¦è¿™äº›æ²¡å˜ï¼ˆé€šè¿‡ `mtime` æˆ–å†…å®¹ hash åˆ¤æ–­ï¼‰ï¼Œå®ƒå°±è·³è¿‡é‡å¤å·¥ä½œã€‚è¿™å°±åƒä½ ç© RPG æ¸¸æˆå­˜äº†ä¸ªæ¡£ï¼Œä¸‹æ¬¡ç›´æ¥è¯»æ¡£è·³è¿‡å‰é¢çš„è·‘å›¾ï¼Œå¤šçœå¿ƒï¼

#### å®æˆ˜ä»£ç 
åœ¨ `webpack.config.js` ä¸­å¯ç”¨ï¼š
```javascript
const path = require('path');

module.exports = {
  cache: {
    type: 'filesystem', // æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œå†…å­˜ç¼“å­˜ï¼ˆmemoryï¼‰ä¹Ÿè¡Œï¼Œä½†é‡å¯å°±æ²¡äº†
    cacheDirectory: path.resolve(__dirname, '.webpack_cache'), // è‡ªå®šä¹‰ç¼“å­˜ç›®å½•ï¼Œåˆ«æ”¾ git é‡Œ
    buildDependencies: {
      config: [__filename], // é…ç½®æ–‡ä»¶æ”¹äº†å°±æ¸…ç¼“å­˜
    },
    version: '1.0', // é¡¹ç›®å‡çº§æ—¶æ‰‹åŠ¨æ”¹ç‰ˆæœ¬ï¼Œæ¸…æ—§ç¼“å­˜
  },
};
```

#### è¿›é˜¶ç©æ³•
- **ç¯å¢ƒå˜é‡ä¼˜åŒ–**ï¼šåŠ ä¸ª `process.env.CACHE_VERSION` åˆ° `version`ï¼ŒCI é‡ŒåŠ¨æ€æ›´æ–°ï¼Œé¿å…ç¼“å­˜å†²çªã€‚
- **ç¼“å­˜å‹ç¼©**ï¼šç”¨ `compression-webpack-plugin` æŠŠç¼“å­˜æ–‡ä»¶å‹ç¼©ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ã€‚

#### å° Tips
- **ç¼“å­˜å¤±æ•ˆæ’æŸ¥**ï¼šå¦‚æœæ”¹äº† `node_modules` ä½†æ²¡æ›´æ–° `package-lock.json`ï¼Œç¼“å­˜å¯èƒ½â€œè£…æ­»â€ã€‚åŠ ä¸ª `buildDependencies: { lockfile: ['package-lock.json'] }`ã€‚
- **å¹½é»˜æé†’**ï¼šç¼“å­˜æ²¡ç”Ÿæ•ˆï¼Ÿåˆ«æ€¥ç€ç ¸é”®ç›˜ï¼Œæ£€æŸ¥ä¸‹ `.webpack_cache` æ˜¯ä¸æ˜¯è¢« `.gitignore` å¿½ç•¥äº†ã€‚ğŸ˜‚

### 2. å¹¶è¡Œæ„å»ºï¼šå¤šçº¿ç¨‹â€œé½ä¸Šé˜µâ€

å•çº¿ç¨‹æ„å»ºå°±åƒä¸€ä¸ªäººæ‰›ç€æ‰€æœ‰æ´»ï¼Œå¤ªç´¯ï¼Webpack 5 æ”¯æŒ `thread-loader` å’Œ `parallel-webpack`ï¼ŒæŠŠä»»åŠ¡åˆ†ç»™å¤šä¸ª workerï¼Œæ•ˆç‡ç¿»å€ã€‚

#### åŸç†æµ…æ
`thread-loader` ä¼šæŠŠè€—æ—¶ä»»åŠ¡ï¼ˆæ¯”å¦‚ Babel ç¼–è¯‘ï¼‰ä¸¢åˆ° Node.js çš„ worker çº¿ç¨‹é‡Œå¹¶è¡Œå¤„ç†ã€‚Webpack æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†è¿™ç§â€œå¤–åŒ…â€æ–¹å¼èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUã€‚å°±åƒçƒ§çƒ¤åº—é‡Œå¤šä¸ªå¸ˆå‚…åŒæ—¶çƒ¤ä¸²ï¼Œé¡¾å®¢ä¸ç”¨å¹²ç­‰ã€‚

#### å®æˆ˜ä»£ç 
é…ç½® `thread-loader`ï¼š
```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [
          {
            loader: 'thread-loader',
            options: {
              workers: 2, // æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ï¼Œé»˜è®¤æ˜¯ CPU æ ¸æ•° - 1
              workerParallelJobs: 50, // æ¯ä¸ª worker å¤„ç†çš„ä»»åŠ¡æ•°
            },
          },
          'babel-loader',
        ],
      },
    ],
  },
};
```

#### è¿›é˜¶ä¼˜åŒ–
- **HappyPack**ï¼šä¸€ä¸ªæ›´è€ç‰Œçš„å¹¶è¡Œæ–¹æ¡ˆï¼Œè™½ç„¶ Webpack 5 å®˜æ–¹æ¨ `thread-loader`ï¼Œä½† HappyPack åœ¨æŸäº›åœºæ™¯ä¸‹ä»å€¼å¾—ä¸€è¯•ã€‚
- **åŠ¨æ€è°ƒæ•´**ï¼šç”¨ `os.cpus().length` åŠ¨æ€è®¾ç½® `workers`ï¼Œé€‚é…ä¸åŒæœºå™¨ã€‚

#### å° Tips
- **é€‚ç”¨åœºæ™¯**ï¼šæ–‡ä»¶å¤šã€ç¼–è¯‘è€—æ—¶é•¿æ—¶ç”¨ï¼Œå°é¡¹ç›®å¯èƒ½å› ä¸ºçº¿ç¨‹å¼€é”€å¾—ä¸å¿å¤±ã€‚
- **é¢„çƒ­æŠ€å·§**ï¼šåŠ  `thread-loader.preload`ï¼Œè®© worker æå‰çƒ­èº«ï¼Œåˆ«å†·å¯åŠ¨æ‹–åè…¿ã€‚

### 3. ç¼©å°è§£æèŒƒå›´ï¼šåˆ«è®© Webpack â€œæ»¡ä¸–ç•Œæ‰¾æ–‡ä»¶â€

Webpack é»˜è®¤ä¼šè§£ææ‰€æœ‰å¯èƒ½çš„è·¯å¾„å’Œæ–‡ä»¶ï¼ŒåŒ…æ‹¬ `node_modules` é‡Œçš„æ¯ä¸ªè§’è½ã€‚è¿™å°±åƒè®©å¿«é€’å‘˜è·‘éå…¨åŸé€ä¸€å°ä¿¡ï¼Œå¤ªæµªè´¹æ—¶é—´ï¼å’±ä»¬å¾—ç»™å®ƒåˆ’ä¸ªâ€œæ´»åŠ¨èŒƒå›´â€ã€‚

#### å®æˆ˜ä»£ç 
ä¼˜åŒ– `resolve` é…ç½®ï¼š
```javascript
const path = require('path');

module.exports = {
  resolve: {
    modules: [path.resolve(__dirname, 'src'), 'node_modules'], // ä¼˜å…ˆæ‰¾ srcï¼Œå‡å°‘æœç´¢èŒƒå›´
    extensions: ['.js', '.jsx', '.ts'], // åªè§£æå¸¸ç”¨åç¼€ï¼Œåˆ«ççŒœ .coffee
    symlinks: false, // è·³è¿‡ç¬¦å·é“¾æ¥è§£æï¼Œçœç‚¹åŠ›æ°”
    alias: {
      '@utils': path.resolve(__dirname, 'src/utils'), // åˆ«åæå‡å¼€å‘ä½“éªŒ
    },
  },
};
```

#### è¿›é˜¶ç»†èŠ‚
- **exclude/include**ï¼šåœ¨ loader é‡ŒåŠ  `exclude: /node_modules/`ï¼Œé¿å…é‡å¤è§£æä¾èµ–ã€‚
- **noParse**ï¼šå¯¹çº¯å‡€çš„åº“ï¼ˆå¦‚ `lodash`ï¼‰åŠ  `noParse: /lodash/`ï¼Œå‘Šè¯‰ Webpack åˆ«è§£æå®ƒï¼Œç›´æ¥æ‰“åŒ…ã€‚

#### å° Tips
- **å¹½é»˜åŠ æˆ**ï¼šå¦‚æœä½ çš„é¡¹ç›®è¿˜åœ¨è§£æ `.scss` ä½†æ²¡ç”¨ Sassï¼Œé‚£å°±åˆ«æ€ª Webpack â€œå¤šç®¡é—²äº‹â€äº†ã€‚ğŸ˜…
- **æ€§èƒ½æ£€æŸ¥**ï¼šç”¨ `stats` è¾“å‡ºçœ‹çœ‹è§£æè€—æ—¶ï¼Œæ‰¾æ‰¾â€œæ¼ç½‘ä¹‹é±¼â€ã€‚

### 4. æ›¿æ¢æ…¢ Loaderï¼šç”¨â€œé—ªç”µä¾ â€ esbuild

`babel-loader` è™½ç„¶å¼ºå¤§ï¼Œä½†é€Ÿåº¦æ…¢å¾—åƒä¹Œé¾Ÿçˆ¬ã€‚Webpack 5 æ”¯æŒç”¨ `esbuild-loader` æ›¿æ¢ï¼Œå·ç§°æ¯” Babel å¿« 10-100 å€ï¼Œç®€ç›´æ˜¯â€œé—ªç”µä¾ â€ï¼

#### å®æˆ˜ä»£ç 
```javascript
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'esbuild-loader',
        options: {
          target: 'es2015', // æŒ‡å®šç›®æ ‡ç¯å¢ƒ
          loader: 'jsx', // æ”¯æŒ JSX
        },
      },
    ],
  },
};
```

#### å° Tips
- **å…¼å®¹æ€§**ï¼š`esbuild` ä¸æ”¯æŒæ‰€æœ‰ Babel æ’ä»¶ï¼Œå¤æ‚ polyfill è¿˜å¾—é  Babelã€‚
- **æ··æ­ä½¿ç”¨**ï¼šå¯ä»¥ç”¨ `oneOf` è§„åˆ™ï¼Œç®€å•æ–‡ä»¶èµ° `esbuild`ï¼Œå¤æ‚æ–‡ä»¶èµ° `babel-loader`ã€‚

---

## äºŒã€è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–ï¼šè®©ä»£ç â€œé£â€èµ·æ¥

æ„å»ºé€Ÿåº¦å¿«äº†è¿˜ä¸å¤Ÿï¼Œçº¿ä¸Šä»£ç çš„ä½“ç§¯å’Œæ‰§è¡Œæ•ˆç‡å¾—è·Ÿä¸Šã€‚Webpack 5 åœ¨è¿è¡Œæ—¶ä¼˜åŒ–ä¸Šæä¾›äº†ä¸å°‘â€œç§˜å¯†æ­¦å™¨â€ï¼Œå’±ä»¬æŒ¨ä¸ªæ‹†è§£ï¼

### 1. ä»£ç åˆ†å‰²ï¼šåˆ«æŠŠæ‰€æœ‰ä¸œè¥¿å¡ä¸€ä¸ªåŒ…é‡Œ

ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰æ˜¯ Webpack çš„æ‹›ç‰ŒåŠŸèƒ½ï¼Œèƒ½æŠŠä»£ç æ‹†æˆå¤šä¸ªå°å—ï¼ŒæŒ‰éœ€åŠ è½½ã€‚Webpack 5 ä¼˜åŒ–äº†åˆ†å‰²ç®—æ³•ï¼Œæ•ˆæœæ›´æ™ºèƒ½ã€‚

#### åŸç†æ·±åº¦è§£æ
é€šè¿‡åŠ¨æ€ `import()` æˆ– `SplitChunksPlugin`ï¼ŒWebpack æ ¹æ®æ¨¡å—ä¾èµ–ç”Ÿæˆå¤šä¸ª chunkã€‚å®ƒä¼šåˆ†æå¼•ç”¨å…³ç³»ï¼ŒæŠŠå…¬å…±æ¨¡å—æŠ½å‡ºæ¥ï¼Œé¿å…é‡å¤æ‰“åŒ…ã€‚å°±åƒæ‰“åŒ…è¡Œæï¼Œä½ ä¸ä¼šæŠŠæ‰€æœ‰è¡£æœå¡ä¸€ä¸ªç®±å­ï¼Œè€Œæ˜¯æŒ‰éœ€åˆ†è£…ï¼Œæ‹¿å–æ–¹ä¾¿ã€‚

#### å®æˆ˜ä»£ç 
é…ç½® `SplitChunksPlugin`ï¼š
```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all', // åŒæ­¥ + å¼‚æ­¥ä»£ç éƒ½åˆ†å‰²
      minSize: 20000, // æ¨¡å—å¤§äº 20KB æ‰æ‹†
      maxSize: 50000, // å¤§æ¨¡å—å°½é‡æ‹†åˆ° 50KB ä»¥ä¸‹
      minChunks: 2, // è¢«å¼•ç”¨ 2 æ¬¡ä»¥ä¸Šæ‰æŠ½å‡ºæ¥
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          priority: -10,
        },
        commons: {
          name: 'commons',
          minChunks: 2,
          priority: -20,
        },
      },
    },
  },
};
```

#### è¿›é˜¶ç©æ³•
- **åŠ¨æ€åŠ è½½**ï¼šè·¯ç”±æ‡’åŠ è½½ç”¨ `import()`ï¼Œæ¯”å¦‚ï¼š
  ```javascript
  const Home = () => import(/* webpackChunkName: "home" */ './Home');
  ```
- **é¢„åŠ è½½**ï¼šåŠ  `/* webpackPreload: true */`ï¼Œæå‡é¦–å±ä½“éªŒã€‚

#### å° Tips
- **å¹½é»˜æé†’**ï¼šå¦‚æœä½ çš„ bundle è¿˜æ˜¯å‡  MBï¼Œå¯èƒ½æ˜¯æ—¶å€™è·Ÿé‚£äº›â€œå…¨å®¶æ¡¶â€è¯´å†è§äº†ã€‚ğŸ˜‚
- **åˆ†æå·¥å…·**ï¼šç”¨ `webpack-bundle-analyzer` æ£€æŸ¥åˆ†å‰²æ•ˆæœã€‚

### 2. Tree Shakingï¼šæŠ–æ‰â€œæ­»ä»£ç â€

Tree Shaking æ˜¯ Webpack çš„â€œå‡è‚¥ç§˜ç±â€ï¼Œèƒ½å»æ‰æœªä½¿ç”¨çš„ä»£ç ã€‚Webpack 5 å¢å¼ºäº†å¯¹ ESM çš„æ”¯æŒï¼ŒæŠ–å¾—æ›´å½»åº•ã€‚

#### åŸç†æ·±åº¦è§£æ
åŸºäº ESM çš„é™æ€åˆ†æï¼ŒWebpack æ ‡è®°æœªå¼•ç”¨çš„å¯¼å‡ºï¼ˆ`usedExports`ï¼‰ï¼Œç„¶åäº¤ç»™å‹ç¼©å·¥å…·ï¼ˆå¦‚ Terserï¼‰æ¸…ç†ã€‚å®ƒä¾èµ–æ¨¡å—çš„â€œçº¯æ€§â€ï¼Œå¦‚æœæœ‰å‰¯ä½œç”¨ï¼ˆside effectsï¼‰ï¼Œå¯èƒ½ä¼šæ¼æŠ–ã€‚å°±åƒç§‹å¤©æ‰«è½å¶ï¼ŒæŠŠæ²¡ç”¨çš„å…¨æŠ–æ‰ï¼

#### å®æˆ˜ä»£ç 
```javascript
module.exports = {
  mode: 'production',
  optimization: {
    usedExports: true, // æ ‡è®°æœªä½¿ç”¨ä»£ç 
    minimize: true, // å‹ç¼©æ—¶ç§»é™¤
    sideEffects: true, // é…åˆ package.json çš„ sideEffects
  },
};
```

#### è¿›é˜¶ç»†èŠ‚
- åœ¨ `package.json` åŠ ï¼š
  ```json
  "sideEffects": ["*.css", "*.scss"] // å‘Šè¯‰ Webpack å“ªäº›æœ‰å‰¯ä½œç”¨
  ```
- æ£€æŸ¥ `stats.json` çš„ `modules` å­—æ®µï¼Œçœ‹çœ‹å“ªäº›æ²¡è¢«æŠ–æ‰ã€‚

#### å° Tips
- **å¸¸è§å‘**ï¼šCommonJS æ¨¡å— Tree Shaking æ•ˆæœå·®ï¼Œå°½é‡ç”¨ ESMã€‚
- **å¹½é»˜åŠ æˆ**ï¼šæ²¡æŠ–å¹²å‡€ï¼Ÿå¯èƒ½æ˜¯ä½ çš„ä»£ç å¤ªâ€œé»äººâ€äº†ã€‚ğŸ˜œ

### 3. æ¨¡å—è”é‚¦ï¼šå›¢é˜Ÿåä½œçš„â€œæ–°ç©å…·â€

æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰æ˜¯ Webpack 5 çš„æ˜æ˜Ÿç‰¹æ€§ï¼Œè®©å¤šä¸ªç‹¬ç«‹é¡¹ç›®å…±äº«æ¨¡å—ï¼Œåƒä¹é«˜ç§¯æœ¨ä¸€æ ·æ‹¼èµ·æ¥ï¼Œæ—¢çœä½“ç§¯åˆæé€Ÿã€‚

#### å®æˆ˜ä»£ç 
ä¸»æœºé…ç½®ï¼š
```javascript
const { ModuleFederationPlugin } = require('webpack').container;

module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'host',
      remotes: {
        app1: 'app1@http://localhost:3001/remoteEntry.js',
      },
      shared: {
        react: { singleton: true }, // å…±äº«å•ä¾‹ï¼Œé¿å…é‡å¤åŠ è½½
        'react-dom': { singleton: true },
      },
    }),
  ],
};
```

è¿œç¨‹é…ç½®ï¼š
```javascript
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'app1',
      filename: 'remoteEntry.js',
      exposes: {
        './Button': './src/Button',
      },
      shared: {
        react: { singleton: true },
        'react-dom': { singleton: true },
      },
    }),
  ],
};
```

#### ç±»æ¯”æ—¶é—´
æ¨¡å—è”é‚¦å°±åƒå¤–å–å…±äº«ï¼Œä½ ä¸ç”¨è‡ªå·±åšé¥­ï¼Œç›´æ¥ä»éš”å£â€œå¨æˆ¿â€æ‹¿ç°æˆçš„ï¼Œå¤šé¦™å•Šï¼ğŸœ

#### å° Tips
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šç”¨ `semver` çº¦æŸå…±äº«æ¨¡å—ç‰ˆæœ¬ï¼Œä¸ç„¶å¯èƒ½ä¼šâ€œåƒåˆ°è¿‡æœŸå¤–å–â€ã€‚
- **è°ƒè¯•ç¥å™¨**ï¼šChrome çš„ `federated-modules` æ’ä»¶ï¼Œå®æ—¶æŸ¥çœ‹åŠ è½½æƒ…å†µã€‚

### 4. å‹ç¼©ä¸ä¼˜åŒ–ï¼šè®©ä»£ç â€œç˜¦èº«â€

Webpack 5 é»˜è®¤ç”¨ Terser å‹ç¼© JSï¼Œä½†è¿˜å¯ä»¥åŠ  CSS å’Œå›¾ç‰‡ä¼˜åŒ–ï¼Œå…¨é¢â€œå‡è„‚â€ã€‚

#### å®æˆ˜ä»£ç 
```javascript
const TerserPlugin = require('terser-webpack-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');

module.exports = {
  optimization: {
    minimizer: [
      new TerserPlugin({
        parallel: true, // å¤šçº¿ç¨‹å‹ç¼©
        terserOptions: {
          compress: { drop_console: true }, // å»æ‰ console.log
        },
      }),
      new CssMinimizerPlugin(),
    ],
  },
};
```

#### å° Tips
- **å›¾ç‰‡å‹ç¼©**ï¼šç”¨ `image-webpack-loader` æˆ– `svgo-loader`ï¼Œè®© logo ç˜¦æˆä¸€é“é—ªç”µã€‚
- **å¹½é»˜æé†’**ï¼šå¦‚æœä¸Šçº¿åè¿˜æœ‰ console.logï¼Œé‚£å¯çœŸæ˜¯â€œå¼€å‘è€…çš„è‡ªæˆ‘æš´éœ²â€ã€‚ğŸ˜…

---

## ä¸‰ã€è¿›é˜¶æœ€ä½³å®è·µï¼šé”¦ä¸Šæ·»èŠ±çš„â€œç‹¬å®¶ç§˜ç±â€

æ ¸å¿ƒä¼˜åŒ–è®²å®Œäº†ï¼Œè¿™é‡Œå†åˆ†äº«ä¸€äº›â€œé”¦å›Šå¦™è®¡â€ï¼Œè®©ä½ çš„ Webpack é…ç½®å¦‚è™æ·»ç¿¼ï¼

### 1. Source Map ä¼˜åŒ–
å¼€å‘ç”¨ `cheap-module-source-map`ï¼Œç”Ÿäº§ç”¨ `hidden-source-map`ï¼Œæ—¢çœæ—¶é—´åˆä¿å®‰å…¨ã€‚

### 2. åŠ¨æ€ Polyfill
ç”¨ `@babel/preset-env` å’Œ `useBuiltIns: 'usage'`ï¼ŒæŒ‰éœ€åŠ è½½ polyfillï¼Œåˆ«ä¸€è‚¡è„‘å…¨å¡è¿›å»ã€‚

### 3. HTTP/2 ä¸ CDN
æ‰“åŒ…åç”¨ HTTP/2 æ¨é€ï¼Œé…åˆ CDNï¼Œè®©èµ„æºåŠ è½½å¿«åˆ°é£èµ·ã€‚Webpack æ˜¯â€œå¨å¸ˆâ€ï¼Œåˆ†å‘ä¹Ÿå¾—è®²ç©¶ï¼

### 4. åˆ†æä¸ç›‘æ§
- **webpack-bundle-analyzer**ï¼šå¯è§†åŒ– bundle ä½“ç§¯ï¼Œæ‰¾â€œèƒ–å­â€ã€‚
- **speed-measure-webpack-plugin**ï¼šæµ‹é‡æ¯ä¸ª loader å’Œ plugin çš„è€—æ—¶ï¼Œç²¾å‡†ä¼˜åŒ–ã€‚

---

## ç»“è¯­ï¼šWebpack 5ï¼Œä¼˜åŒ–æ— æ­¢å¢ƒ

Webpack 5 çš„æ€§èƒ½ä¼˜åŒ–å°±åƒä¸€åœºâ€œä¿®ç‚¼ä¹‹æ—…â€ï¼Œä»æ„å»ºé€Ÿåº¦åˆ°è¿è¡Œæ—¶æ•ˆç‡ï¼Œæ¯ä¸€æ­¥éƒ½èƒ½è®©ä½ æ›´æ¥è¿‘â€œè¶…ç¥â€ã€‚è¿™ç¯‡æ–‡ç« ä»åŸç†åˆ°å®è·µï¼Œå°½é‡æŠŠæ¯ä¸ªè§’è½éƒ½æŒ–é€äº†ã€‚å¸Œæœ›ä½ çœ‹å®Œèƒ½ä¿¡å¿ƒæ»¡æ»¡åœ°ä¼˜åŒ–è‡ªå·±çš„é¡¹ç›®ï¼Œä¸‹æ¬¡ `npm run build` æ—¶ï¼Œåˆ«å¿˜äº†æ³¡æ¯å’–å•¡â€”â€”ä¸è¿‡è¿™æ¬¡å¯èƒ½æ˜¯å› ä¸ºä½ å¤ªé—²äº†ï¼Œè€Œä¸æ˜¯åœ¨ç­‰å®ƒè·‘å®Œã€‚ğŸ˜

æœ‰ä»€ä¹ˆä¼˜åŒ–å¿ƒå¾—æˆ–è¸©è¿‡çš„å‘ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼å’±ä»¬ä¸€èµ·æŠŠå‰ç«¯æ€§èƒ½ç©å‡ºèŠ±å„¿æ¥ï¼ğŸŒˆ

---